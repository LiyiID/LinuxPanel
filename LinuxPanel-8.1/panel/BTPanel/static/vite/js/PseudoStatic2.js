import{_ as e}from"./index85.js?v=1714377894636";import{q as a,s as t,w as s,x as l}from"./element-lib.js?v=1714377894636";import{g as i,n as o,a as r,q as n,b as c}from"./main.js?v=1714377894636";import{_ as p}from"./index118.js?v=1714377894636";import{_ as m}from"./index120.js?v=1714377894636";import{e as u,b as v,v as d,h as f,j as h}from"./vue-lib.js?v=1714377894636";import{g as x,cm as y,ai as g,al as w,cn as b}from"./site.store.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./check.js?v=1714377894636";const _=o(u({__name:"PseudoStatic",props:{compData:{default:()=>({})}},setup(e){const a=e,{proxy:t}=h(),s=v(""),l=v(""),o=v([]),r=v(!1),n=v(!1),c=v(!1),p=v(["php","proxy","html","phpasync","nginx"]),{refs:{webServerType:m}}=i(),{refs:{modulesTableParams:u,siteTabActiveList:_,siteInfo:j}}=x(),C=d({name:""}),T=v({mode:"ace/mode/nginx",theme:"ace/theme/chrome",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!1,fontSize:"12px"}),F=v(""),P=v([{text:"请选择您的应用，若设置伪静态后，网站无法正常访问，请尝试设置回default"},{text:"您可以对伪静态规则进行修改，修改完后保存即可。"}]),S=v(""),$=async()=>{r.value=!0;try{const e=await y({siteName:("php"===S.value||"proxy"===S.value?"":S.value+"_")+j.value.name});o.value=e.data.rewrite,F.value=e.data.sitePath+"/.htaccess","nginx"===m.value&&(F.value="/www/server/panel/vhost/rewrite/".concat(("php"===S.value||"proxy"===S.value?"":S.value+"_")+j.value.name,".conf")),l.value=e.data.rewrite[0]}catch(e){}finally{r.value=!1}},D=async e=>{try{r.value=!0;const{data:a}=await g({path:e||"".concat(F.value)});s.value=a.data,r.value=!1}catch(a){}finally{r.value=!1}};return f((async()=>{var e,a,t;let s=null==(e=j.value.project_type)?void 0:e.toLowerCase();S.value=s,c.value=!!(null==(t=null==(a=j.value)?void 0:a.project_config)?void 0:t.bind_extranet),p.value.includes(S.value)&&(c.value=!0),await $(),await D()})),{__sfc:!0,vm:t,props:a,staticContent:s,textValue:l,optionData:o,textLoading:r,otherSavePopup:n,isBindExtranet:c,specialData:p,webServerType:m,modulesTableParams:u,siteTabActiveList:_,siteInfo:j,tempForm:C,templateRules:{name:[{required:!0,message:"请输入模板名称",trigger:"blur"}]},config:T,sitePath:F,helpList:P,siteType:S,getReWriteData:$,getReWriteBody:D,handleChange:e=>{let a="/www/server/panel/rewrite/".concat(m.value,"/").concat(e,".conf");D("0.当前"===e?"":a)},saveData:async()=>{let e=t.$load("正在保存伪静态内容，请稍候...");try{const e=await w({data:s.value,encoding:"utf-8",path:"".concat(F.value)});t.$message.msg({dangerouslyUseHTMLString:!0,message:e.msg,type:e.status?"success":"error",duration:e.status?2e3:0,showClose:!e.status})}catch(a){}finally{e.close()}},setSave:async()=>{if(t.$refs.tempFormRef.validate((async e=>{})),C.name=C.name.trim(),C.name.includes(" "))return t.$message.error("模板名称不能包含空格");if(""===C.name)return t.$message.error("模板名称不能为空");if(o.value.includes(C.name))return t.$message.error("模板名称不能和已有的模板名称重复且不可为空");let e=t.$load("正在设置模板，请稍候...");try{const e=await b({data:s.value,name:C.name});t.$message.request(e),n.value=!1,C.name="",await $(),await D()}catch(a){}finally{e.close()}},onCancel:()=>{n.value=!1,C.name="",t.$refs.tempFormRef.clearValidate()},jumpPath:()=>{_.value.moduleSettingsAct="mapping",_.value.isJump=!0}}}}),(function(){var i=this,o=i._self._c,u=i._self._setupProxy;return o("div",{staticClass:"h-full"},[u.isBindExtranet?o("div",["php"===u.siteType||"proxy"===u.siteType||"phpasync"===u.siteType?o("div",{staticClass:"flex items-center justify-between"},[o(a,{on:{change:u.handleChange},model:{value:u.textValue,callback:function(e){u.textValue=e},expression:"textValue"}},i._l(u.optionData,(function(e,a){return o(t,{key:a,attrs:{value:e,label:e}})})),1),o("span",{staticClass:"flex items-center"},[i._v("规则转换工具： "),o(r,{attrs:{href:"https://www.bt.cn/Tools"}},[i._v("Apache转Nginx "),o("i",{staticClass:"el-icon-paperclip"})])],1)],1):i._e(),o(m,{directives:[{name:"loading",rawName:"v-loading",value:u.textLoading,expression:"textLoading"}],staticClass:"!h-[40rem] !w-full my-12x border border-[#DCDFE6] rounded-4x",attrs:{id:"staticContentRef","file-path":"".concat(u.sitePath),config:u.config},model:{value:u.staticContent,callback:function(e){u.staticContent=e},expression:"staticContent"}}),o("div",[o(n,{on:{click:u.saveData}},[i._v("保存")]),"php"===u.siteType||"proxy"===u.siteType?o(n,{on:{click:function(e){u.otherSavePopup=!0}}},[i._v("另存为模板")]):i._e()],1),o(p,{staticClass:"ml-20x mt-20x",attrs:{list:u.helpList,"list-style":"disc"}})],1):o("div",{staticClass:"bg-[#7F7F7F] flex items-center justify-center h-full"},[o("div",{staticClass:"bg-white px-48x py-16x text-[#333]"},[i._v(" 请开启 "),o(r,{on:{click:u.jumpPath}},[i._v("外网映射")]),i._v(" 后查看配置信息 ")],1)]),o(c,{attrs:{title:"另存为模板",visible:u.otherSavePopup,area:42,showFooter:""},on:{"update:visible":function(e){u.otherSavePopup=e},confirm:u.setSave,cancel:u.onCancel}},[o("div",{staticClass:"p-20x"},[o(s,{ref:"tempFormRef",attrs:{"label-position":"right",model:u.tempForm,rules:u.templateRules}},[o(l,{attrs:{label:"模板名称",prop:"name"}},[o(e,{attrs:{placeholder:"请输入模板名称"},model:{value:u.tempForm.name,callback:function(e){i.$set(u.tempForm,"name",e)},expression:"tempForm.name"}})],1)],1)],1)])],1)}),[],!1,null,"bf7091af",null,null).exports;export{_ as default};
