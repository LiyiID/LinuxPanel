import{_ as e}from"./index51.js?v=1714377894636";import{_ as t}from"./index118.js?v=1714377894636";import{n as a,q as s,g as r,c as n,a as o,l as i,$ as l,J as c,b as p}from"./main.js?v=1714377894636";import{_ as m}from"./result.js?v=1714377894636";import{_ as u}from"./index39.js?v=1714377894636";import{_ as d}from"./index52.js?v=1714377894636";import{q as g,s as _}from"./element-lib.js?v=1714377894636";import{_ as f}from"./index59.js?v=1714377894636";import{_ as b}from"./preload-helper.js?v=1714377894636";import{e as v,b as x,j as y,v as h,H as w,w as k,h as j}from"./vue-lib.js?v=1714377894636";import{l as D}from"./database.table.js?v=1714377894636";import{ak as C,al as P,m as T,am as E,an as B,ao as $,ap as R,aq as L,ar as S,as as q,at as M}from"./mysql.store.js?v=1714377894636";import{c as I}from"./check.js?v=1714377894636";import{j as z}from"./database.popup.js?v=1714377894636";import{g as H}from"./index28.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./index38.js?v=1714377894636";import"./index45.js?v=1714377894636";import"./index.vue_vue_type_style_index_0_lang.js?v=1714377894636";import"./index77.js?v=1714377894636";import"./index42.js?v=1714377894636";const O=a(v({__name:"ShowLog",props:{compData:{default:{}}},setup(e){const t=e,{proxy:a}=y(),{id:s}=t.compData,r=x(t.compData.msg),n=async e=>{try{const t=await P({id:s});r.value=t.data.msg,e&&a.$message.success("刷新成功")}catch(t){}};return{__sfc:!0,vm:a,props:t,id:s,logMsg:r,logEvent:async()=>{try{await a.$confirm({title:"提示",message:"确定清空日志吗？",iconType:"warning",type:"warning"});const e=await C({id:s});a.$message.request(e),n(!1)}catch(e){}},getLog:n}}}),(function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("div",{staticClass:"p-20x"},[t(s,{on:{click:function(e){return a.getLog(!0)}}},[e._v(" 刷新日志 ")]),t(s,{attrs:{type:"default"},on:{click:a.logEvent}},[e._v(" 清空日志 ")]),t("div",{staticClass:"bg-[#333] mt-12x text-white h-[48rem] overflow-auto p-20x"},[t("pre",{domProps:{innerHTML:e._s(a.logMsg)}})])],1)}),[],!1,null,null,null,null).exports;const F=a(v({__name:"BackupDataBaseTable",props:{compData:{default:()=>[]},tableInnerBack:{type:Boolean,default:!1}},setup(e){const t=e,{refs:{authType:a}}=r(),{getDatabase:s,getMsgConfig:p}=T(),{refs:{isSearchClick:m}}=H(),u=x(!1),d=x({resultStatus:!1,resultMsg:"",resultPath:""}),{proxy:g}=y(),_=x([]),f=x(0),v=x(!1),C=h({p:1,limit:10,db_name:"全部"}),F=x([]),A=h({title:"企业增量备份",ps:"企业增量备份只定时备份发生变化新增、修改、删除文件和数据，不会每次都备份所有数据",source:m.value?260:54,desc:[],tabImgs:[{title:"概览",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/database/database_enterprise_backup.png"}]}),J=x(!0),N=x([{text:"备份大小：备份大小包含完全备份数据大小和增量备份数据大小"},{text:"备份会保留一个星期的备份数据，当备份时，检测到完全备份为一个星期前，会重新完全备份"},{text:"请勿同一时间添加多个备份任务，否则可能因同一时间执行多个备份任务导致文件句柄数打开过多或者爆内存"}]),V=x([{color:"text-[#ef0808]",text:"恢复：会从最早【全量备份】开始恢复至选择的【增量备份】时间点"}]),G=x([{label:"备份名称",prop:"name"},{label:"备份大小",render:e=>w("span",[n(e.size)])},{label:"类型",prop:"type",render:e=>w("span",[1===e.type?"全量":"增量"])},{label:"时间点",prop:"addtime"},{label:"操作",align:"right",render:e=>w("div",{class:"flex items-center justify-end"},[w(o,{class:"text-[#409eff]",on:{click:()=>{Y(e)}}},["恢复"]),w("span",{class:"mx-4x"},["|"]),w(o,{class:"text-[#409eff]",on:{click:()=>{ee(e)}}},["导出"])])}]),K=x([]),Q=async e=>{try{if(0===e.cron_id||0===e.cron_id.length)return g.$message.error("备份计划任务丢失，无法执行");const t=await $({id:e.cron_id});g.$message.request(t),se(),s()}catch(t){}},U=e=>{0!==e.cron_id&&0!==e.cron_id.length?i({title:"编辑备份任务-"+e.name,area:64,component:()=>b((()=>import("./IncrementForm.js?v=1714377894636")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]),import.meta.url),compData:{selectOptions:F.value,rowData:e,refreshEvent:se},open:()=>{p()},showFooter:!0}):g.$message.error("备份计划任务丢失，无法编辑")},W=async e=>{try{if(0===e.cron_id||0===e.cron_id.length)return void g.$message.error("备份计划任务丢失，无法查看日志");const{msg:t}=await P({id:e.cron_id});i({title:"查看日志",area:[76,59],component:O,compData:{msg:t,id:e.cron_id},showFooter:!1})}catch(t){}},X=async({cron_id:e})=>{await g.$confirm({type:"input",width:50,title:"删除备份任务"+name,message:"删除备份任务后，备份数据将永久消失，是否继续操作？",isCalc:!0,icon:"warning",inputText:"删除备份任务"});const t=await R({id:e});g.$message.request(t),se()},Y=async e=>{try{await g.$confirm({title:"恢复数据",type:"input",message:"恢复后会覆盖当前数据库数据，此操作不可逆，是否继续操作？",icon:"warning",inputText:"我已知晓",iconColor:"#E6A23C"});const{cron_id:t,addtime:a}=e,s=await E({cron_id:t,node_time:a});g.$message.request(s)}catch(t){}},Z=async e=>{try{const{cron_id:t}=e,a=await L({cron_id:t});K.value=a.data,v.value=!0}catch(t){}},ee=async e=>{try{const{cron_id:t,addtime:a}=e,s=await B({cron_id:t,node_time:a});d.value.resultMsg=s.data.name,d.value.resultStatus=s.status,d.value.resultPath=s.data.path,u.value=!0}catch(t){}},te=D({executeEvent:Q,editEvent:U,logEvent:W,recordsEvent:Z,delInBackEvent:X}),ae=async()=>{try{await S();const e=await q();F.value=I(e.data,"array",[]),F.value.unshift({name:"全部",value:"all"}),await se(),J.value=!1}catch(e){}},se=async()=>{try{const e=await M({...C,db_name:"全部"==C.db_name?"":C.db_name});_.value=e.data,f.value=c(e.page)}catch(e){}};return k((()=>{t.tableInnerBack&&(C.db_name=t.compData.name)})),j((async()=>{await ae()})),{__sfc:!0,authType:a,getDatabase:s,getMsgConfig:p,isSearchClick:m,props:t,recordResults:u,exportResultsData:d,vm:g,incrementTableData:_,inCompletedTotal:f,recordsPopup:v,tableParam:C,selectOptions:F,productData:A,tableLoad:J,backupTipList:N,recorderHelp:V,recordColumn:G,recordData:K,sizeChange:e=>{C.p=e,se()},limitChange:e=>{C.p=1,C.limit=e,se()},executeEvent:Q,editEvent:U,logEvent:W,delInBackEvent:X,openBackTask:async()=>{z(F.value,!!t.tableInnerBack,se,t.compData.name)},restoreRecord:Y,recordsEvent:Z,downLoadData:async()=>{window.open("/download?filename="+d.value.resultPath)},outPutRecord:ee,copyResult:(e,t)=>{l({value:e})},inBackTableColumn:te,initEnBack:ae,getDatabaseBack:se}}}),(function(){var a=this,r=a._self._c,n=a._self._setupProxy;return r("div",["ltd"===n.authType?r("div",[r(f,{scopedSlots:a._u([{key:"header-left",fn:function(){return[r(s,{attrs:{type:"primary"},on:{click:n.openBackTask}},[a._v("添加备份任务")])]},proxy:!0},{key:"header-right",fn:function(){return[r("div",[r("span",{staticClass:"h-[3rem] bg-[#e8e8e8] leading-[3rem] text-center w-[6rem] inline-block"},[a._v("数据库")]),r(g,{staticClass:"rounded-none",on:{change:n.getDatabaseBack},model:{value:n.tableParam.db_name,callback:function(e){a.$set(n.tableParam,"db_name",e)},expression:"tableParam.db_name"}},a._l(n.selectOptions,(function(e,t){return r(_,{key:t,attrs:{label:e.name,value:e.name}})})),1)],1)]},proxy:!0},{key:"content",fn:function(){return[r(u,{directives:[{name:"loading",rawName:"v-loading",value:n.tableLoad,expression:"tableLoad"}],ref:"incrementBackupTable",attrs:{"max-height":420,data:n.incrementTableData,column:n.inBackTableColumn,"element-loading-text":"正在加载列表，请稍后..."}})]},proxy:!0},{key:"footer-right",fn:function(){return[r(d,{attrs:{total:n.inCompletedTotal,"current-page":n.tableParam.p,"page-size":n.tableParam.limit},on:{"update:currentPage":function(e){return a.$set(n.tableParam,"p",e)},"update:current-page":function(e){return a.$set(n.tableParam,"p",e)},"current-change":n.sizeChange,"size-change":n.limitChange}})]},proxy:!0},{key:"popup",fn:function(){return[r(p,{attrs:{title:"备份记录",visible:n.recordsPopup,area:60},on:{"update:visible":function(e){n.recordsPopup=e}}},[r("div",{staticClass:"p-20x"},[r(u,{attrs:{"max-height":"400",column:n.recordColumn,data:n.recordData}}),r(t,{attrs:{list:n.recorderHelp}})],1)]),r(p,{attrs:{title:"导出结果",visible:n.recordResults,area:38},on:{"update:visible":function(e){n.recordResults=e}}},[r(m,{attrs:{icon:n.exportResultsData.resultStatus?"success":"error",title:n.exportResultsData.resultStatus?"导出成功":"导出失败"}},[r("template",{slot:"extra"},[r("div",{staticClass:"break-words flex items-center justify-center w-full text-[#666]"},[r("span",{},[a._v(a._s(n.exportResultsData.resultMsg))]),r(s,{attrs:{type:"text"},on:{click:function(e){return n.copyResult(n.exportResultsData.resultMsg,e)}}},[a._v(" 复制 ")]),r(s,{staticClass:"!ml-4x",attrs:{type:"text"},on:{click:n.downLoadData}},[a._v("下载")])],1)])],2)],1)]},proxy:!0}],null,!1,1960789003)}),r(t,{staticClass:"mt-16x ml-20x",attrs:{list:n.backupTipList,listStyle:"disc"}})],1):r(e,{staticClass:"p-20x",attrs:{data:n.productData}})],1)}),[],!1,null,"ee227af3",null,null).exports;export{F as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./IncrementForm.js?v=1714377894636","./index118.js?v=1714377894636","./vue-lib.js?v=1714377894636","./__commonjsHelpers__.js?v=1714377894636","./main.js?v=1714377894636","./modulepreload-polyfill.js?v=1714377894636","./preload-helper.js?v=1714377894636","./request-lib.js?v=1714377894636","./locales-lib.js?v=1714377894636","./public-lib.js?v=1714377894636","./element-lib.js?v=1714377894636","./AlertForm.js?v=1714377894636","./index85.js?v=1714377894636","./element-lib.js?v=1714377894636","./index134.js?v=1714377894636","./element-lib.js?v=1714377894636","./config.js?v=1714377894636","./index41.js?v=1714377894636","./element-lib.js?v=1714377894636","./mysql.store.js?v=1714377894636","./check.js?v=1714377894636","./confirm.js?v=1714377894636"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
