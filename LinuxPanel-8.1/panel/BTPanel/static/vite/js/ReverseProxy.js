import{g as a,a as e,o as t,n as r,q as s,b as o}from"./main.js?v=1714377894636";import{_ as i}from"./index120.js?v=1714377894636";import{_ as l}from"./index118.js?v=1714377894636";import{_ as n}from"./index85.js?v=1714377894636";import{w as c,x as p}from"./element-lib.js?v=1714377894636";import{_ as m}from"./index46.js?v=1714377894636";import{_ as u}from"./index53.js?v=1714377894636";import{_ as d}from"./index39.js?v=1714377894636";import{_ as y}from"./index59.js?v=1714377894636";import{e as x,b,v,H as f,h,j as w}from"./vue-lib.js?v=1714377894636";import{o as g,a as D}from"./confirm.js?v=1714377894636";import{a as _,e as j}from"./index38.js?v=1714377894636";import{cU as k,cV as C,cW as $,cX as S,cY as R,cZ as E,c_ as P,c$ as L,d0 as q,d1 as F,d2 as U,d3 as N,d4 as T,d5 as O}from"./site.store.js?v=1714377894636";import{o as J}from"./index61.js?v=1714377894636";import{r as V}from"./site.popup.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./index.vue_vue_type_style_index_0_lang.js?v=1714377894636";import"./config.js?v=1714377894636";import"./index45.js?v=1714377894636";import"./check.js?v=1714377894636";import"./element-ui.common.js?v=1714377894636";import"./date-util.js?v=1714377894636";import"./vdom.js?v=1714377894636";import"./index62.js?v=1714377894636";import"./cascader-panel.js?v=1714377894636";const B=r(x({__name:"ReverseProxy",props:{compData:{default:()=>({})}},setup(r){const s=r,{proxy:o}=w(),{refs:{webServerType:i}}=a(),l=b(""),n=b([]),c=b(""),p=b([]),m=b([]),u=b(!1),d=b(!1),y=b({}),x=v({proxyname:[{required:!0,message:"请输入代理名称",trigger:["blur","change"]},{trigger:["blur","input","change"],validator:(a,e,t)=>{e.length<3||e.length>40?t(new Error("代理名称必须大于3小于40个字符串")):t()}}],proxysite:[{required:!0,message:"请输入目标url",trigger:"blur",validator:(a,e,t)=>{e?t():t(new Error("目标URL不能为空"))}}],todomain:[{required:!0,message:"请输入发送域名",trigger:["blur","change"]}]}),B=b({isEdit:!1,type:!0,cache:!1,advanced:!1,proxyname:"",cachetime:1,proxydir:"/",proxysite:"http://",todomain:"",subfilter:[{sub1:"",sub2:"",id:1}],subNum:1,path:"",content:""}),H=b({mode:"ace/mode/nginx",theme:"ace/theme/chrome",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!1,fontSize:"12px"}),I=b(!1),M=b(!1),z=b([{text:"代理目录：访问这个目录时将会把目标URL的内容返回并显示(需要开启高级功能)"},{text:"目标URL：可以填写你需要代理的站点，目标URL必须为可正常访问的URL，否则将返回错误"},{text:"发送域名：将域名添加到请求头传递到代理服务器，默认为目标URL域名，若设置不当可能导致代理无法正常运行"},{text:"内容替换：只能在使用nginx时提供，最多可以添加3条替换内容,如果不需要替换请留空"}]),G=async(a,e)=>{var t;let r=o.$load("正在修改状态中，请稍后...");try{let r,i={};"cache"===e?i.cache=a.cache?0:1:i.type=a.type?0:1,r="proxy"===s.compData.project_type?await E({...a,subfilter:JSON.stringify(a.subfilter),...i}):"phpasync"===s.compData.project_type?await k({...a,subfilter:JSON.stringify(a.subfilter),...i}):await C({...a,subfilter:JSON.stringify(a.subfilter),...i}),o.$message.request(r),((null==(t=r.data)?void 0:t.status)||r.status)&&ra()}catch(i){}finally{r.close()}},W=async a=>{try{const{data:e}=await P({sitename:s.compData.name,proxyname:a.proxyname,webserver:i.value});!1===e.status?o.$message.request(e):(B.value.content=e[0].data,B.value.path=e[1],B.value.proxyname=a.proxyname,M.value=!0)}catch(e){}},X=async a=>{B.value.isEdit=!0,B.value.proxyname=a.proxyname,B.value.proxydir=a.proxydir,B.value.proxysite=a.proxysite,B.value.todomain=a.todomain,B.value.type=!!a.type,B.value.cache=!!a.cache,B.value.advanced=!!a.advanced,B.value.cachetime=a.cachetime,B.value.subfilter=a.subfilter.map(((a,e)=>({sub1:a.sub1,sub2:a.sub2,id:e}))).filter((a=>""!==a.sub1)),I.value=!0},Y=async()=>{B.value.isEdit=!1,B.value.proxyname="",B.value.proxydir="/",B.value.proxysite="http://",B.value.todomain="",B.value.type=!0,B.value.cache=!1,B.value.advanced=!1,B.value.cachetime=1,B.value.subfilter=[{sub1:"",sub2:"",id:1}],B.value.subNum=1},Z=a=>{const e=[...a];for(;e.length<3;)e.push({sub1:"",sub2:""});return e.map(((a,e)=>({sub1:a.sub1,sub2:a.sub2,id:100*Math.random()})))},A=b([{label:"名称",prop:"proxyname"},{label:"结果",render:a=>f("span",{class:a.status?"text-primary":"text-danger"},a.msg)}]),K=async(a,e)=>{D({confirm:{icon:"warning",title:e?"批量删除反向代理规则":"删除反向代理规则".concat(a.proxyname),message:e?"批量删除选中的规则后，配置的反向代理规则将会彻底失效，是否继续操作？":"删除选中的规则后，配置的反向代理规则将会彻底失效，是否继续操作？"},loading:"正在删除，请稍后...",request:async()=>{if(e){let e=a.map((a=>({proxyname:a.proxyname,id:a.id}))),t=[];return await e.forEach((async(a,r)=>{var o,i;let l;l="proxy"===s.compData.project_type?await N({sitename:s.compData.name,proxyname:[a.proxyname]}):"phpasync"===s.compData.project_type?await T({sitename:s.compData.name,proxyname:a.proxyname}):await O({sitename:s.compData.name,proxyname:[a.proxyname]}),t.push({proxyname:a.proxyname,status:(null==(o=l.data)?void 0:o.status)||l.status,msg:(null==(i=l.data)?void 0:i.msg)||l.msg}),r===e.length-1&&(await V({resultData:t,resultTitle:"删除反向代理规则",resultColumn:A.value}),ra(),close())})),null}return"proxy"===s.compData.project_type?await N({sitename:s.compData.name,proxyname:[a.proxyname]}):"phpasync"===s.compData.project_type?await T({sitename:s.compData.name,proxyname:a.proxyname}):await O({sitename:s.compData.name,proxyname:[a.proxyname]})},async complete(){ra()}})},Q=b([{type:"selection"},{label:"名称",prop:"proxyname"},{label:"代理目录",prop:"proxydir"},{label:"目标URL",prop:"proxysite",width:140,render:a=>f(e,{class:"truncate block",on:{click:()=>{window.open(a.proxysite)}}},a.proxysite)},{prop:"cache",label:"缓存",width:60,render:a=>f(e,{class:a.cache?"text-primary":"!text-danger",on:{click:()=>{G(a,"cache")}}},a.cache?"已开启":"已关闭")},_({prop:"type",event:G,data:["已暂停","运行中"]}),j([{onClick:W,title:"配置文件",width:50},{onClick:X,title:"编辑"},{onClick:a=>{K(a)},title:"删除"}])]),aa=b([{label:"启用反向代理规则",value:"enable",diyBatch:async()=>{ta(!0)}},{label:"停用反向代理规则",value:"disable",diyBatch:async()=>{ta(!1)}},{label:"删除反向代理规则",value:"delete",diyBatch:async()=>{K(p.value,!0)}}]),ea=v({isRecurrence:!1,describe:{title:"批量删除脚本",th:"脚本",message:"批量删除后脚本信息将无法恢复，是否继续？",propsValue:"name"}}),ta=async a=>{J({title:a?"批量启用当前选中的规则后，配置的反向代理规则将继续生效，是否继续操作？":"批量停用当前选中的规则后，配置的反向代理规则将会失效，是否继续操作？",dataList:p.value,titleType:a?"批量启用反向代理规则":"批量停用反向代理规则",requestFun:async e=>"phpasync"===s.compData.project_type?await k({...e,subfilter:JSON.stringify(e.subfilter),type:a?1:0}):await C({...e,subfilter:JSON.stringify(e.subfilter),type:a?1:0}),isRecurrence:!0,tableColumn:[{prop:"proxyname",label:"名称"},{prop:"result",label:"状态"}],isReturnResult:!0,callback:()=>{ra()}})},ra=async()=>{u.value=!0;try{let a;a="proxy"===s.compData.project_type?await $({sitename:s.compData.name}):"phpasync"===s.compData.project_type?await S({sitename:s.compData.name}):await R({sitename:s.compData.name}),m.value=a.data,u.value=!1}catch(a){}};return h((async()=>{ra()})),{__sfc:!0,vm:o,props:s,webServerType:i,domainValue:l,pathData:n,pathValue:c,checkedList:p,tableData:m,tableLoading:u,formDisabled:d,proxyForm:y,proxyFormRules:x,rowData:B,config:H,proxyPopup:I,configFilePopup:M,helpList:z,handelInputTodo:a=>{let e=a.replace(/^http[s]?:\/\//,"");e=e.replace(/(:|\?|\/|\\)(.*)$/,""),B.value.todomain=e},changeEvent:G,configFileEvent:W,saveFile:async()=>{try{const a=o.$load("正在保存配置文件，请稍后...");let e;e="phpasync"===s.compData.project_type?await L({path:B.value.path,config:B.value.content,encoding:"utf-8"}):await q({path:B.value.path,data:B.value.content,encoding:"utf-8"}),a.close(),o.$message.request(e.data),e.data.status&&(M.value=!1,Y(),ra())}catch(a){}},editDataEvent:X,addProxy:async()=>{Y(),I.value=!0},resetProxy:Y,addSub:async()=>{3!==B.value.subfilter.length?B.value.subfilter.push({sub1:"",sub2:"",id:100*Math.random()}):o.$message.error("最多添加三条内容替换")},delSub:async a=>{1!==B.value.subfilter.length?B.value.subfilter=B.value.subfilter.filter((e=>e.id!==a.id)):o.$message.error("至少保留一条内容替换")},subfilterHandle:Z,editProxyConfirm:async()=>{o.$refs.proxyForm.validate((async a=>{if(a){let a=o.$load("正在提交中，请稍后...");g({$refs:y.value,loading:{disable:d,text:"提交中，请稍候..."},request:async()=>{var e;const t=Z(B.value.subfilter).map((a=>({sub1:a.sub1,sub2:a.sub2})));let r,i={subfilter:JSON.stringify(t),type:B.value.type?1:0,cache:B.value.cache?1:0,advanced:B.value.advanced?1:0,sitename:s.compData.name,proxyname:B.value.proxyname,proxydir:B.value.proxydir,proxysite:B.value.proxysite,todomain:B.value.todomain,cachetime:B.value.cachetime};r="phpasync"===s.compData.project_type?B.value.isEdit?await k(i):await F(i):B.value.isEdit?await C(i):await U(i),o.$message.request(r.data?r.data:r),((null==(e=r.data)?void 0:e.status)||r.status)&&(ra(),I.value=!1),a.close()}})}}))},resultColumn:A,deleteDataEvent:K,tableColumns:Q,batchGroup:aa,batchConfig:ea,multStatusEvent:ta,handleSelect:a=>{p.value=a},batchEvent:async(a,e,t)=>{},getReverseProxy:ra,isRelease:t}}}),(function(){var a=this,t=a._self._c,r=a._self._setupProxy;return t("div",[t(y,{scopedSlots:a._u([{key:"header-left",fn:function(){return[t(s,{on:{click:r.addProxy}},[a._v("添加反向代理")])]},proxy:!0},{key:"header-right",fn:function(){},proxy:!0},{key:"content",fn:function(){return[t(d,{directives:[{name:"loading",rawName:"v-loading",value:r.tableLoading,expression:"tableLoading"}],attrs:{column:r.tableColumns,data:r.tableData},on:{"selection-change":r.handleSelect}})]},proxy:!0},{key:"footer-left",fn:function(){return[t(u,{staticClass:"mt-12x",attrs:{data:r.batchGroup,config:r.batchConfig,"batch-fn":r.batchEvent}})]},proxy:!0},{key:"footer-right",fn:function(){},proxy:!0},{key:"popup",fn:function(){},proxy:!0}])}),a._m(0),t(o,{attrs:{title:r.rowData.isEdit?"修改反向代理【".concat(r.rowData.proxyname,"】"):"添加反向代理",visible:r.proxyPopup,"show-footer":!0,area:68},on:{"update:visible":function(a){r.proxyPopup=a},confirm:r.editProxyConfirm}},[t("div",{staticClass:"p-20x"},[t(c,{ref:"proxyForm",attrs:{model:r.rowData,rules:r.proxyFormRules,disabled:r.formDisabled,"label-width":"80px"}},[t(p,{attrs:{label:"开启代理"}},[t("div",{staticClass:"flex items-center"},[t(m,{model:{value:r.rowData.type,callback:function(e){a.$set(r.rowData,"type",e)},expression:"rowData.type"}}),r.isRelease?a._e():t(p,{staticClass:"!mt-0",attrs:{label:"开启缓存"}},[t(m,{model:{value:r.rowData.cache,callback:function(e){a.$set(r.rowData,"cache",e)},expression:"rowData.cache"}})],1),t(p,{staticClass:"!mt-0",attrs:{label:"高级功能"}},[t(m,{model:{value:r.rowData.advanced,callback:function(e){a.$set(r.rowData,"advanced",e)},expression:"rowData.advanced"}})],1)],1)]),t(p,{attrs:{label:"代理名称",prop:"proxyname"}},[t(n,{attrs:{disabled:r.rowData.isEdit,placeholder:"请输入代理名称",width:"20rem"},model:{value:r.rowData.proxyname,callback:function(e){a.$set(r.rowData,"proxyname",e)},expression:"rowData.proxyname"}})],1),r.rowData.cache?t(p,{attrs:{label:"缓存时间",prop:"cachetime"}},[t(n,{attrs:{placeholder:"请输入缓存时间",width:"20rem",textType:"分钟"},model:{value:r.rowData.cachetime,callback:function(e){a.$set(r.rowData,"cachetime",e)},expression:"rowData.cachetime"}})],1):a._e(),r.rowData.advanced?t(p,{attrs:{label:"代理目录",prop:"proxydir"}},[t(n,{attrs:{placeholder:"请输入代理目录",width:"20rem"},model:{value:r.rowData.proxydir,callback:function(e){a.$set(r.rowData,"proxydir",e)},expression:"rowData.proxydir"}})],1):a._e(),t(p,{attrs:{label:"目标URL",prop:"proxysite","label-width":"80px"}},[t("div",{staticClass:"flex items-center"},[t(n,{attrs:{placeholder:"请输入目标URL",width:"20rem"},on:{input:r.handelInputTodo},model:{value:r.rowData.proxysite,callback:function(e){a.$set(r.rowData,"proxysite",e)},expression:"rowData.proxysite"}}),t(p,{attrs:{label:"发送域名",prop:"todomain","label-width":"50px"}},[t(n,{attrs:{placeholder:"请输入发送域名",width:"20rem"},model:{value:r.rowData.todomain,callback:function(e){a.$set(r.rowData,"todomain",e)},expression:"rowData.todomain"}})],1)],1)]),t(p,{attrs:{label:"内容替换"}},[a._l(r.rowData.subfilter,(function(s,o){return[t("div",{key:s.id,staticClass:"flex items-center mb-1rem"},[t(n,{staticClass:"mr-2rem",attrs:{placeholder:"被替换的文本，可留空",width:"20rem"},model:{value:s.sub1,callback:function(e){a.$set(s,"sub1",e)},expression:"item.sub1"}}),t(n,{staticClass:"mr-1rem",attrs:{placeholder:"替换为，可留空",width:"20rem"},model:{value:s.sub2,callback:function(e){a.$set(s,"sub2",e)},expression:"item.sub2"}}),t(e,{attrs:{type:"danger"},on:{click:function(a){return r.delSub(s)}}},[a._v("删除")])],1)]})),t(s,{staticClass:"!mt-1rem",attrs:{disabled:3===r.rowData.subfilter.length,icon:"el-icon-plus"},on:{click:r.addSub}},[a._v("添加内容替换")])],2)],1),t(l,{staticClass:"mt-2rem",attrs:{list:r.helpList,"list-type":"disc"}})],1)]),t(o,{attrs:{title:"编辑配置文件【".concat(r.rowData.proxyname,"】"),visible:r.configFilePopup,area:55},on:{"update:visible":function(a){r.configFilePopup=a}}},[t("div",{staticClass:"p-2rem"},[t("div",{staticClass:"text-[#666] h-[2rem] leading-[2rem] mb-[1rem]"},[a._v("提示：Ctrl+S 保存")]),t(i,{staticClass:"!h-38rem",attrs:{filePath:r.rowData.path,config:r.config,"is-request":!1},model:{value:r.rowData.content,callback:function(e){a.$set(r.rowData,"content",e)},expression:"rowData.content"}}),t(s,{staticClass:"!mt-2rem",on:{click:r.saveFile}},[a._v("保存")])],1)])],1)}),[function(){var a=this,e=a._self._c;return a._self._setupProxy,e("ul",{staticClass:"mt-20x leading-8 text-[1.2rem] list-disc ml-20x"},[e("li",[a._v("设置了反向代理后，【访问限制】中的相应路径的规则将会失效")])])}],!1,null,"d153b984",null,null).exports;export{B as default};
