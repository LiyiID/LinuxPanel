import{_ as e}from"./index85.js?v=1714377894636";import{w as t,x as a,q as o,s as r}from"./element-lib.js?v=1714377894636";import{aS as s,e as l,bI as i,n as d,r as n}from"./main.js?v=1714377894636";import{_ as p}from"./index46.js?v=1714377894636";import{e as m,b as c,v as u,h as _,j as v}from"./vue-lib.js?v=1714377894636";import{g as b,i as h,G as S,aH as f}from"./site.store.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./index.vue_vue_type_style_index_0_lang.js?v=1714377894636";import"./check.js?v=1714377894636";const w=d(m({__name:"AddSitePopup",setup(e,{expose:t}){const{getModulesList:a}=b(),{proxy:o}=v(),r=c({site_path:"/www/wwwroot",project_cmd:"",install_dependence:!0,php_version:"",domains:"",sql:!1,project_ps:"",project_port:"",codeing:"utf8mb4",open_proxy:!1,project_proxy_path:"",datauser:"",datapassword:""}),d=c([]),n=u({domains:[{validator:(e,t,a)=>{t?a():a(new Error("请输入绑定域名"))},trigger:["blur","input"]}],path:[{valitor:(e,t,a)=>{t?a():a(new Error("请输入项目目录"))},trigger:["blur","input"]}]}),p=async()=>{try{const e=await S();d.value=e.data.filter((e=>"纯静态"!==e.name)),r.value.php_version=d.value[0].version}catch(e){}},m=e=>{var t;let a={...e,sql_user:e.datauser,sql_pwd:e.datapassword,sql_codeing:e.codeing,install_dependence:e.install_dependence?1:0,open_proxy:e.open_proxy?1:0,webname:{domain:"",domainlist:[],count:0}};return(null==(t=e.domains)?void 0:t.split("\n")).forEach(((e,t)=>{let o=e.replace(/\r\n/,"").split(":");0===t?a.webname.domain=o[0]:a.webname.domainlist.push(o[0])})),a.webname.count=a.webname.domainlist.length,a.webname=JSON.stringify(a.webname),delete a.domains,delete a.datauser,delete a.datapassword,delete a.codeing,a},w=async e=>{let t=m(r.value);try{const r=await f(t);o.$message.request(r),r.status&&(e(),a("phpAsync"))}catch(s){}};return t({onConfirm:w}),_((async()=>{await p()})),{__sfc:!0,getModulesList:a,vm:o,addSiteForm:r,versionOptions:d,rules:n,onPathChange:()=>{s({type:"dir",path:r.value.site_path,change:e=>{r.value.site_path=e}})},installOtherPhp:async()=>{try{const{data:e}=await h({sName:"php-8.2"});l({name:"php-8.2",type:e.type,softData:e})}catch(e){}},getPHPVersion:p,handleInputName:e=>{var t;r.value.domains=e,r.value.datauser=null==(t=e.split("\n")[0])?void 0:t.replace(/\./g,"_"),r.value.datapassword=i(12)},handleData:m,onConfirm:w}}}),(function(){var s=this,l=s._self._c,i=s._self._setupProxy;return l("div",{staticClass:"p-20x"},[l(t,{attrs:{model:i.addSiteForm,rules:i.rules,"label-width":"12rem"}},[l(a,{attrs:{label:"绑定域名"}},[l(n,{ref:"popover",attrs:{placement:"top-start","popper-class":"green-tips-popover",title:"",width:"400",trigger:"focus"}},[l("div",{staticClass:"!p-12x bg-[#20a53a] text-white"},[s._v(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),l("br"),s._v(" IP地址格式：192.168.1.199"),l("br"),s._v(" 泛解析添加方法 *.domain.com"),l("br"),s._v(" 如另加端口格式为 www.domain.com:88 ")]),l(e,{directives:[{name:"popover",rawName:"v-popover:popover",arg:"popover"}],attrs:{slot:"reference",type:"textarea",width:"52rem",rows:8,resize:"none",placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},on:{input:i.handleInputName},slot:"reference",model:{value:i.addSiteForm.domains,callback:function(e){s.$set(i.addSiteForm,"domains",e)},expression:"addSiteForm.domains"}})],1)],1),l(a,{attrs:{label:"项目目录",prop:"path"}},[l(e,{attrs:{placeholder:"请输入项目目录",iconType:"folder",width:"52rem"},on:{folder:i.onPathChange},model:{value:i.addSiteForm.site_path,callback:function(e){s.$set(i.addSiteForm,"site_path",e)},expression:"addSiteForm.site_path"}})],1),l(a,{attrs:{label:"PHP版本"}},[l(o,{model:{value:i.addSiteForm.php_version,callback:function(e){s.$set(i.addSiteForm,"php_version",e)},expression:"addSiteForm.php_version"}},s._l(i.versionOptions,(function(e){return l(r,{key:e.value,attrs:{label:e.name,value:e.version}})})),1)],1),l(a,{attrs:{label:"数据库"}},[l("div",{staticClass:"flex items-center"},[l(o,{model:{value:i.addSiteForm.sql,callback:function(e){s.$set(i.addSiteForm,"sql",e)},expression:"addSiteForm.sql"}},[l(r,{attrs:{label:"不创建",value:!1}}),l(r,{attrs:{label:"MySQL",value:"MYSQL"}})],1),i.addSiteForm.sql?l(o,{staticClass:"ml-8x",model:{value:i.addSiteForm.codeing,callback:function(e){s.$set(i.addSiteForm,"codeing",e)},expression:"addSiteForm.codeing"}},[l(r,{attrs:{label:"utf8mb4",value:"utf8mb4"}}),l(r,{attrs:{label:"utf8",value:"utf8"}}),l(r,{attrs:{label:"gbk",value:"gbk"}}),l(r,{attrs:{label:"big5",value:"big5"}})],1):s._e()],1)]),i.addSiteForm.sql?l(a,{attrs:{label:"数据库账号"}},[l("div",{staticClass:"flex items-center"},[l(e,{attrs:{placeholder:"创建数据库账号"},model:{value:i.addSiteForm.datauser,callback:function(e){s.$set(i.addSiteForm,"datauser",e)},expression:"addSiteForm.datauser"}}),l(a,{attrs:{label:"密码"}},[l(e,{attrs:{placeholder:"数据库密码"},model:{value:i.addSiteForm.datapassword,callback:function(e){s.$set(i.addSiteForm,"datapassword",e)},expression:"addSiteForm.datapassword"}})],1)],1),l("span",{staticClass:"text-[#999] text-[1.2rem]"},[s._v(" 创建站点的同时，为站点创建一个对应的数据库帐户，方便不同站点使用不同数据库。 ")])]):s._e(),l(a,{attrs:{label:"常驻服务启动命令"}},[l(e,{attrs:{type:"textarea",width:"52rem",rows:4,resize:"none",placeholder:"请输入项目的启动命令"},model:{value:i.addSiteForm.project_cmd,callback:function(e){s.$set(i.addSiteForm,"project_cmd",e)},expression:"addSiteForm.project_cmd"}})],1),l(a,{attrs:{label:"自动安装项目依赖"}},[l(p,{model:{value:i.addSiteForm.install_dependence,callback:function(e){s.$set(i.addSiteForm,"install_dependence",e)},expression:"addSiteForm.install_dependence"}})],1),l(a,{attrs:{label:"反向代理"}},[l(p,{model:{value:i.addSiteForm.open_proxy,callback:function(e){s.$set(i.addSiteForm,"open_proxy",e)},expression:"addSiteForm.open_proxy"}})],1),i.addSiteForm.open_proxy?l(a,{attrs:{label:"项目端口"}},[l(e,{attrs:{placeholder:"请输入项目端口",type:"number",width:"52rem"},model:{value:i.addSiteForm.project_port,callback:function(e){s.$set(i.addSiteForm,"project_port",e)},expression:"addSiteForm.project_port"}})],1):s._e(),i.addSiteForm.open_proxy?l(a,{attrs:{label:"代理路由"}},[l(e,{attrs:{placeholder:"请输入代理路由",width:"52rem"},model:{value:i.addSiteForm.project_proxy_path,callback:function(e){s.$set(i.addSiteForm,"project_proxy_path",e)},expression:"addSiteForm.project_proxy_path"}})],1):s._e(),l(a,{attrs:{label:"备注"}},[l(e,{attrs:{placeholder:"请输入备注,可为空",width:"52rem"},model:{value:i.addSiteForm.project_ps,callback:function(e){s.$set(i.addSiteForm,"project_ps",e)},expression:"addSiteForm.project_ps"}})],1)],1)],1)}),[],!1,null,"75739b9d",null,null).exports;export{w as default};
