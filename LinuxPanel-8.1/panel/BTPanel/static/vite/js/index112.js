import{_ as t}from"./index85.js?v=1714377894636";import{u as a,w as e,x as r}from"./element-lib.js?v=1714377894636";import{g as s,l as i,J as o,n,q as l,b as p}from"./main.js?v=1714377894636";import{_ as c}from"./index52.js?v=1714377894636";import{_ as m}from"./index53.js?v=1714377894636";import{_ as d}from"./index39.js?v=1714377894636";import{_ as u}from"./index57.js?v=1714377894636";import{_ as g}from"./index59.js?v=1714377894636";import{_ as f}from"./index77.js?v=1714377894636";import{e as y,v as _,b,h,j as v}from"./vue-lib.js?v=1714377894636";import{g as x,c as j,s as w,a as P,b as S}from"./index35.js?v=1714377894636";import{u as k,v as E,w as F,x as C}from"./crontab.api.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./index42.js?v=1714377894636";import"./index43.js?v=1714377894636";import"./upload.js?v=1714377894636";import"./index62.js?v=1714377894636";import"./index38.js?v=1714377894636";import"./index45.js?v=1714377894636";import"./index61.js?v=1714377894636";const $=n(y({__name:"index",setup(t){const{proxy:a}=v(),{refs:{scriptLibraryData:e},getScriptList:r}=x(),{refs:{authType:n,mainHeight:l}}=s(),p=_({p:1,rows:20,search:"",type_id:""}),c=b(!1),m=b(0),d=b([]),u=b([]),g=_({isRecurrence:!0,describe:{title:"批量删除脚本",th:"脚本",message:"批量删除后脚本信息将无法恢复，是否继续？",propsValue:"name"}}),f=b([{label:"删除",value:"delete"}]),y=b(),$=_({argsPopup:!1,title:"脚本参数",script_id:"",form:{args:"",placeholder:"请输入脚本参数"},name:"",rules:{args:[{required:!0,message:"请输入脚本参数",trigger:"blur"},{validator:(t,a,e)=>{if("端口检测"===$.name){/^(\d{1,3}\.){3}\d{1,3}:\d{1,5}$/.test(a)?e():e(new Error("请输入正确的IP:端口格式"))}else e()}}]}}),D=async(t,e=!1)=>{try{const e=await k({script_id:t.script_id});a.$message.request(e)}catch(r){}},L=async({name:t,script_id:e,is_args:r,args_ps:s,args_title:o},n)=>{if(r)return $.argsPopup=!0,$.title=o,$.form.placeholder="端口检测"===t?"127.0.0.1:433":s,$.script_id=e,$.form.args="",void($.name=t);let l;try{if(n?await y.value.validate((t=>{t&&($.argsPopup=!1)})):$.argsPopup=!1,$.argsPopup)return;await a.$confirm({title:"执行脚本",width:"35rem",icon:"warning",message:"立即执行【".concat(t,"】中的脚本任务，执行过程可能等待时间较长，请耐心等待。是否继续？")}),l=a.$load(a.$t("正在执行脚本，请稍后..."));const r=await E({data:JSON.stringify({script_id:e,args:n?$.form.args:""})});i({title:"执行结果",area:40,showFooter:!1,component:{render:t=>t("pre",{class:"min-h-[20rem] bg-[#333] overflow-auto text-white w-full break-all p-12x"},r.msg)}})}catch(p){}finally{l&&l.close()}},q=t=>{w((()=>{N()}),p.type_id,t)},H=t=>{const a=P({});S((async a=>(await C({data:JSON.stringify({...a,script_id:t.script_id})})).data),a)},z=async t=>{try{await a.$confirm({title:"删除脚本",icon:"question",iconColor:"#E6A23C",message:"删除后脚本信息不可恢复,是否继续操作？"});const e=await k({script_id:t.script_id});a.$message.request(e),N()}catch(e){}},J=async()=>{await r();const t=e.value.map((t=>({type_id:t.type_id,name:t.name})));u.value=t,p.type_id=String(t[0].type_id)},N=async()=>{try{c.value=!0;const t=await F({data:JSON.stringify(p)});d.value=t.data.data,m.value=o(t.data.page)}catch(t){}finally{c.value=!1}},T=j({executionEvent:L,editEvent:q,openLogEvent:H,deleteDataEvent:z});return h((async()=>{await J(),N()})),{__sfc:!0,vm:a,scriptLibraryData:e,getScriptList:r,authType:n,mainHeight:l,tableParam:p,loading:c,total:m,tableData:d,scriptMenuData:u,batchConfig:g,batchGroup:f,argsFormRef:y,argsForm:$,batchEvent:(t,a,e)=>D(a,!0),delBackEvent:D,changePage:t=>{p.p=t,N()},changeSize:t=>{p.rows=t,N()},executionEvent:L,editEvent:q,openLogEvent:H,deleteDataEvent:z,getScriptListEvent:J,getScriptData:N,scriptTabClick:t=>{p.type_id=t.name,N()},searchSubmit:t=>{p.search=t,N()},addScript:()=>{w((()=>{N()}),p.type_id)},tableColumns:T}}}),(function(){var s=this,i=s._self._c,o=s._self._setupProxy;return i("div",[i(f,{attrs:{type:"navtwo"},on:{"tab-click":o.scriptTabClick},model:{value:o.tableParam.type_id,callback:function(t){s.$set(o.tableParam,"type_id",t)},expression:"tableParam.type_id"}},s._l(o.scriptMenuData,(function(t,e){return i(a,{key:e,staticClass:"h-0",attrs:{label:t.name,name:String(t.type_id)}})})),1),i(g,{staticClass:"py-20x",scopedSlots:s._u([{key:"header-left",fn:function(){return[i(l,{on:{click:o.addScript}},[s._v("创建脚本")])]},proxy:!0},{key:"header-right",fn:function(){return[i("div",{staticClass:"flex items-center"},[i(u,{staticClass:"ml-12x",attrs:{placeholder:"请输入搜索关键字"},on:{clear:o.searchSubmit,search:o.searchSubmit}})],1)]},proxy:!0},{key:"content",fn:function(){return[i(d,{directives:[{name:"loading",rawName:"v-loading",value:o.loading,expression:"loading"}],attrs:{"max-height":o.mainHeight-300,"element-loading-text":"正在加载中...",column:o.tableColumns,data:o.tableData}})]},proxy:!0},{key:"footer-left",fn:function(){return[i(m,{attrs:{data:o.batchGroup,config:o.batchConfig,"batch-fn":o.batchEvent}})]},proxy:!0},{key:"footer-right",fn:function(){return[i(c,{attrs:{total:o.total,"current-page":o.tableParam.p,"page-size":o.tableParam.rows},on:{"current-change":o.changePage,"size-change":o.changeSize}})]},proxy:!0},{key:"popup",fn:function(){return[i(p,{attrs:{title:"执行脚本参数",visible:o.argsForm.argsPopup,area:42,"show-footer":!0},on:{"update:visible":function(t){return s.$set(o.argsForm,"argsPopup",t)},confirm:function(t){return o.executionEvent({name:o.argsForm.title,is_args:!1,script_id:o.argsForm.script_id},!0)}}},[i("div",{staticClass:"p-20x"},[i(e,{ref:"argsFormRef",attrs:{"label-position":"right",rules:o.argsForm.rules,model:o.argsForm.form}},[i(r,{attrs:{label:o.argsForm.title,prop:"args"}},[i(t,{attrs:{placeHolder:o.argsForm.form.placeholder},model:{value:o.argsForm.form.args,callback:function(t){s.$set(o.argsForm.form,"args",t)},expression:"argsForm.form.args"}})],1)],1)],1)])]},proxy:!0}])})],1)}),[],!1,null,"3f69a2be",null,null).exports;export{$ as default};
