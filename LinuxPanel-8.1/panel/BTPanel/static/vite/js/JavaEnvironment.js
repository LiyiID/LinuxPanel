import{a as t,o as e,Q as a,aS as s,n,r as o,q as l,b as i}from"./main.js?v=1714377894636";import{u as r,q as c,s as p}from"./element-lib.js?v=1714377894636";import{_ as m}from"./index85.js?v=1714377894636";import{_ as u}from"./ServiceStatus.js?v=1714377894636";import{_ as d}from"./index39.js?v=1714377894636";import{_ as v}from"./index55.js?v=1714377894636";import{_ as f}from"./index59.js?v=1714377894636";import{_ as k}from"./index77.js?v=1714377894636";import{e as h,b as g,H as b,h as x,i as y,j as _}from"./vue-lib.js?v=1714377894636";import{o as j}from"./index38.js?v=1714377894636";import{aV as w,aW as C,aX as S,aY as J,aZ as T,a_ as P,a$ as V,b0 as D,b1 as L,b2 as q}from"./site.store.js?v=1714377894636";import{a as I}from"./confirm.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./index42.js?v=1714377894636";import"./index45.js?v=1714377894636";import"./check.js?v=1714377894636";import"./config.js?v=1714377894636";const $=n(h({__name:"JavaEnvironment",props:{compData:{default:{}}},setup(n){const o=n,{proxy:l}=_(),i=g("jdkSettings"),r=g(""),c=g(""),p=g(!1),m=g([]),u=g([]),d=g([]),v=g(!1),f=g(""),k=g([]),h=g(!1),$=g(!1),E=g("正在请求安装...");let K=null;const M=()=>{K=a({route:"/sock_shell",onMessage:O})},N=()=>{const t=document.querySelector(".logMsg");l.$nextTick((()=>{t&&(t.scrollTop=t.scrollHeight)}))},O=(t,e)=>{const a=e.data;E.value+="\n"+a,N(),a.includes("Successify ")&&($.value=!1,null==K||K.close(),E.value="正在请求安装...",R())},F=async()=>{h.value=!0;try{const t=await w();k.value=t.data,m.value.length=0;for(let e=0;e<t.data.length;e++)t.data[e].is_current&&(c.value=t.data[e].name),1===t.data[e].operation&&m.value.push({label:t.data[e].name,value:t.data[e].name})}catch(t){}h.value=!1},H=async t=>{try{k.value.find((e=>{e.name===t.name&&(e.operation=3)}));const e=await S({name:"jdk",version:t.name,type:1});l.$message.request(e),F()}catch(e){}},A=async t=>{I({confirm:{title:"删除jdk",icon:"warning",useHtml:!0,message:"是否删除【 "+t.name+'】，<span class="text-danger">此操作将会删除该JDK目录下的所有文件，请确保该JDK未被使用</span>，是否继续操作？'},loading:"正在删除，请稍后...",request:async()=>await T({data:JSON.stringify({jdk:t.path})}),complete:F})},R=async()=>{try{const t=await P();d.value=[],Object.keys(t.data.tomcat_info).forEach((e=>{var a;d.value.push({name:e,...t.data.tomcat_info[e],popover:!1,portInput:null==(a=t.data.tomcat_info[e].info)?void 0:a.port})})),u.value=[],t.data.jdk_info.forEach((t=>{0!==t.operation&&u.value.push({label:t.name,value:t.path})}))}catch(t){}},W=t=>{i.value=t.name,"tomcatSettings"===t.name?R():F()},z=g({}),U=g([{label:"JDK版本",prop:"name",width:100},{label:"JDK地址",render:e=>2===e.operation?b("span",{class:"truncate"},[e.path]):b(t,{class:"truncate",on:{click:()=>{j(e)}}},[e.path])},{label:"操作",align:"right",width:136,render:e=>{switch(e.operation){case 0:return b(t,{on:{click:()=>{H(e)}}},["安装"]);case 1:return b(t,{on:{click:()=>{A(e)}}},["删除"]);case 2:return b("span",["不可操作"]);case 3:return b(t,{on:{click:()=>{F()}}},["正在安装,点击刷新"])}}}]);return x((async()=>{o.compData.name?(i.value=o.compData.name,W({name:o.compData.name})):(i.value="jdkSettings",await F())})),y((()=>{null==K||K.close()})),{__sfc:!0,props:o,vm:l,tabActive:i,jdkPath:r,currentVersion:c,popoverVisible:p,jdkLinVersion:m,jdkTomcatList:u,tomcatList:d,installPopup:v,jdkTomcatVersion:f,tableData:k,tableLoading:h,logPopup:$,logsMsg:E,useSocket:K,createWebSocket:M,scrollEnd:N,onWSReceive:O,getLocalJdkVersionEvent:F,onPathChange:()=>{s({type:"file",path:r.value,change:t=>{r.value=t}})},addJdk:async()=>{try{const t=await C({data:JSON.stringify({jdk:r.value})});l.$message.request(t),F()}catch(t){}},installJdkEvent:H,setJdkLin:async()=>{try{const t=await J({name:c.value});t.status?l.$message.request(t):l.$message.error(t)}catch(t){}},delJdk:A,getTomcatList:R,handleClickTab:W,setStatus:async(t,e)=>{let a=e.name.replace("tomcat",""),s=l.$load("正在"+("start"===t?"启动":"stop"===t?"停止":"重载")+"Tomcat"+a+"，请稍后...");try{const e=await V({data:JSON.stringify({type:t,version:a})});l.$message.request(e),R()}catch(n){}finally{s.close()}},currentItem:z,openInstall:t=>{v.value=!0,z.value=t},setTomcatPortEvent:async t=>{let e=l.$load("正在更改Tomcat端口，请稍后...");try{const e=await D({data:JSON.stringify({port:t.portInput,version:t.name.replace("tomcat","")})});t.popover=!1,l.$message.request(e),R()}catch(a){}finally{e.close()}},cancelTomcatPopover:t=>{t.popover=!t.popover,t.portInput!==t.info.port&&(t.portInput=t.info.port)},handleConfirmInstall:async t=>{try{const e=L({data:JSON.stringify({jdk_path:f.value,type:t,version:z.value.name.replace("tomcat","")})});M(),v.value=!1,null==K||K.send({"x-http-token":window.vite_public_request_token}),null==K||K.send("tail -f /tmp/panelShell2.pl"),$.value=!0,l.$message.request(await e)}catch(e){}},handleUnInstall:async t=>{I({confirm:{title:"卸载Tomcat",icon:"warning",message:"是否卸载【"+t.name+"】，此操作将会删除该Tomcat目录下的所有文件，请确保该Tomcat未被使用，是否继续操作？"},loading:"正在卸载Tomcat，请稍后...",request:async()=>await L({data:JSON.stringify({jdk_path:t.info.jdk_path,type:"uninstall",version:t.name.replace("tomcat","")})}),complete:R})},handleChangeJdkPath:async t=>{let e=l.$load("正在更改JDK路径，请稍后...");try{const e=await q({version:z.value.name.replace("tomcat",""),jdk_path:t.info.jdk_path});l.$message.request(e)}catch(a){}finally{e.close()}},tableColumns:U,isRelease:e}}}),(function(){var e=this,a=e._self._c,s=e._self._setupProxy;return a("div",[a(k,{attrs:{type:"left"},on:{"tab-click":s.handleClickTab},model:{value:s.tabActive,callback:function(t){s.tabActive=t},expression:"tabActive"}},[a(r,{staticClass:"overflow-y-auto",attrs:{label:"JDK管理",name:"jdkSettings"}},[a(f,{scopedSlots:e._u([{key:"header-left",fn:function(){return[a("div",{staticClass:"flex items-center"},[a(o,{attrs:{placement:"bottom",width:"380",trigger:"manual","popper-class":"white-tips-popover"},model:{value:s.popoverVisible,callback:function(t){s.popoverVisible=t},expression:"popoverVisible"}},[a("div",{staticClass:"flex items-center p-20x"},[e._v(" jdk路径: "),a(m,{staticClass:"w-[20rem] mx-12x",attrs:{"icon-type":"folder",placeholder:"请输入JDK路径"},on:{folder:s.onPathChange},model:{value:s.jdkPath,callback:function(t){s.jdkPath=t},expression:"jdkPath"}}),a(l,{on:{click:s.addJdk}},[e._v("添加")])],1),a(l,{attrs:{slot:"reference"},on:{click:function(t){s.popoverVisible=!s.popoverVisible}},slot:"reference"},[e._v("添加自定义JDK")])],1),s.isRelease?e._e():a("div",{staticClass:"flex items-center mx-12x"},[a("span",{staticClass:"mr-4x"},[e._v("命令行版本")]),a(c,{staticClass:"w-[10rem]",on:{change:s.setJdkLin},model:{value:s.currentVersion,callback:function(t){s.currentVersion=t},expression:"currentVersion"}},e._l(s.jdkLinVersion,(function(t){return a(p,{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1)]},proxy:!0},{key:"header-right",fn:function(){return[a(v,{attrs:{refresh:s.getLocalJdkVersionEvent}})]},proxy:!0},{key:"content",fn:function(){return[a(d,{directives:[{name:"loading",rawName:"v-loading",value:s.tableLoading,expression:"tableLoading"}],attrs:{height:"440",column:s.tableColumns,data:s.tableData}})]},proxy:!0}])})],1),a(r,{attrs:{label:"Tomcat管理",name:"tomcatSettings",lazy:!0}},e._l(s.tomcatList,(function(n,i){return a("div",{key:n.name,staticClass:"border border-[#EBEEF5] mb-16x"},[a("div",{staticClass:"flex items-center bg-[#F9F9F9] h-[3.6rem] px-8x"},[e._v(e._s(n.name))]),n.status?a("div",{staticClass:"flex flex-col p-16x"},[a("div",{staticClass:"inline-block flex items-center justify-between"},[a("div",{staticClass:"flex items-center"},[e._v(" 当前状态："),a(u,{attrs:{status:n.info.status,statusData:["运行中","已停止"]}})],1),a("div",{staticClass:"flex items-center"},[e._v(" 端口："+e._s(n.info.port)+" "),a(o,{attrs:{placement:"bottom",width:"400",trigger:"click","popper-class":"white-tips-popover"}},[a("div",{staticClass:"flex items-center p-20x"},[e._v(" 端口: "),a(m,{staticClass:"w-[20rem] mx-12x",attrs:{type:"number",placeholder:"请输入端口"},model:{value:n.portInput,callback:function(t){e.$set(n,"portInput",t)},expression:"item.portInput"}}),a(l,{on:{click:function(t){return s.setTomcatPortEvent(n)}}},[e._v("更改")])],1),a(t,{staticClass:"ml-4x",attrs:{slot:"reference"},on:{click:function(t){return s.cancelTomcatPopover(n)}},slot:"reference"},[e._v("更改")])],1)],1),a("span",{staticClass:"ml-8x"},[e._v("jdk路径:"+e._s(n.info.jdk_path))])]),a("div",{staticClass:"flex items-center mt-16x"},[n.info.status?e._e():a(l,{attrs:{type:"defalut"},on:{click:function(t){return s.setStatus("start",n)}}},[e._v("启动")]),n.info.status?a(l,{attrs:{type:"defalut"},on:{click:function(t){return s.setStatus("stop",n)}}},[e._v("停止")]):e._e(),a(l,{attrs:{type:"defalut"},on:{click:function(t){return s.setStatus("restart",n)}}},[e._v("重载配置")]),a(l,{staticClass:"!mr-8x danger-button",attrs:{type:"info"},on:{click:function(t){return s.handleUnInstall(n)}}},[e._v("卸载")])],1)]):a("div",{staticClass:"flex flex-col p-16x"},[a("div",[e._v(" 当前版本未安装，点击安装后操作 "),a(l,{attrs:{type:"default",size:"mini"},on:{click:function(t){return s.openInstall(n)}}},[e._v("点击安装")])],1)])])})),0)],1),a(i,{attrs:{title:"安装tomcat",visible:s.installPopup,area:36,showFooter:""},on:{"update:visible":function(t){s.installPopup=t},confirm:function(t){return s.handleConfirmInstall("install")}}},[a("div",{staticClass:"p-20x"},[a("div",{staticClass:"flex items-center text-[1.4rem]"},[a("i",{staticClass:"el-icon-warning text-warning text-[4rem] mr-12x"}),e._v(" 是否安装Tomcat？ ")]),a("div",{staticClass:"flex items-center ml-40x"},[e._v(" jdk版本： "),a(c,{staticClass:"ml-12x",model:{value:s.jdkTomcatVersion,callback:function(t){s.jdkTomcatVersion=t},expression:"jdkTomcatVersion"}},[a(p,{attrs:{label:"默认版本",value:""}}),e._l(s.jdkTomcatList,(function(t){return a(p,{key:t.value,attrs:{label:t.label,value:t.value}})}))],2)],1)])]),a(i,{attrs:{title:"安装信息",visible:s.logPopup,area:[50,36]},on:{"update:visible":function(t){s.logPopup=t},cancel:()=>s.logsMsg="正在请求安装..."}},[a("div",{staticClass:"bg-[#333] p-12x h-full text-white overflow-auto logMsg"},[a("pre",{staticClass:"whitespace-pre-wrap",domProps:{innerHTML:e._s(s.logsMsg)}})])])],1)}),[],!1,null,"211621c3",null,null).exports;export{$ as default};
