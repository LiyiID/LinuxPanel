import{_ as a}from"./index120.js?v=1714377894636";import{Q as t,d0 as e,d2 as s,c_ as n,d3 as i,n as o,F as c,q as l,b as r}from"./main.js?v=1714377894636";import{_ as p}from"./index53.js?v=1714377894636";import{_ as u}from"./index39.js?v=1714377894636";import{_ as m}from"./index59.js?v=1714377894636";import{L as d}from"./element-lib.js?v=1714377894636";import"./index45.js?v=1714377894636";import{e as f,b as g,v,h,j as _}from"./vue-lib.js?v=1714377894636";import{k as b}from"./firewall.table.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./index46.js?v=1714377894636";import"./index.vue_vue_type_style_index_0_lang.js?v=1714377894636";import"./firewall.popup.js?v=1714377894636";import"./check.js?v=1714377894636";import"./index38.js?v=1714377894636";const x=o(f({__name:"SafeTrojanScan",props:{compData:{default:()=>{}}},setup(a){const o=a,{proxy:c}=_(),l=g("loading"),r=g(!1),p=g(""),u=g({});let m=null;const d=v({scanInfo:"",scanCount:0,scanningCount:0,scanningText:"进行中"}),f=g([]),x=v({isRecurrence:!0,describe:{title:"批量删除文件",th:"文件路径",message:"批量删除已选文件，删除文件将移动至回收站，是否继续？"}}),j=()=>{m=t({route:"/ws_panel",onMessage:y})},y=(a,t)=>{if("token error"===t.data)return c.$message.error("token error"),void(null==m||m.close());const e=JSON.parse(t.data);d.scanInfo=e.info,e.is_count&&(d.scanCount=e.count,d.scanningCount=e.is_count),e.path&&f.value.push({path:e.path,name:e.path.substring(e.path.lastIndexOf("/")+1)}),e.result&&(l.value="success",d.scanningText="已完成",d.scanInfo="扫描已完成",d.scanningCount=d.scanCount,e.result.length>0&&(l.value="danger"),null==m||m.close())},C=async()=>{f.value=[],j(),l.value="loading",d.scanningText="进行中",null==m||m.send({def_name:"ws_webshell_check",mod_name:"files",path:o.compData.row.path,ws_callback:"1"})},w=async(a,t=!1)=>{try{!t&&c.$confirm({title:"提示",message:"确定删除文件【"+a.path+"】?删除后文件将移至回收站，是否继续操作?",icon:"warning",type:"calc"});const e=await s({path:a.path,type:"File"});!t&&c.$message.request(e),f.value=f.value.filter((t=>t.path!==a.path))}catch(e){}},D=b({openFileEvent:async a=>{try{const t=await n({path:a.path});p.value=t.data.data,r.value=!0}catch(t){}},falseAlarmEvent:async a=>{try{c.$confirm({title:"提示",message:"是否确定提交误报反馈",icon:"warning",type:"calc"});const t=await i({filename:a.path});c.$message.request(t),f.value=f.value.filter((t=>t.path!==a.path))}catch(t){}},deleteEvent:w});return h((()=>{C()})),{__sfc:!0,props:o,vm:c,scanLoad:l,editorPopup:r,editorValue:p,rowData:u,useSocket:m,scanningData:d,tableData:f,tableBatch:[{value:"delete",label:"删除"}],batchConfig:x,batchEvent:(a,t,e)=>w(t,!0),createWebSocket:j,onWSReceive:y,scanData:C,cancelScan:async()=>{await c.$confirm({title:"提示",message:"查杀正在进行中，确定要停止扫描吗？",icon:"warning"}),d.scanningText="已取消",l.value="success",null==m||m.close()},saveFile:async()=>{try{const a=await e({path:u.value.path,data:p.value,encoding:"utf-8"});c.$message.request(a)}catch(a){}},deleteEvent:w,tableColumns:D}}}),(function(){var t=this,e=t._self._c,s=t._self._setupProxy;return e("div",{staticClass:"p-20x"},[e("div",{staticClass:"title-box flex items-center justify-between"},[e("div",{staticClass:"flex items-center"},["loading"==s.scanLoad?e("div",{staticClass:"scan-icon relative h-[8rem] w-[8rem]"},[e("div",{staticClass:"animate-spin absolute top-0 border-primary border-b-2 rounded-full h-full w-full bg-#cccccc00"}),e(c,{staticClass:"absolute top-0 left-0 right-0 bottom-0 m-[auto]",attrs:{name:"scanning-scan",size:"5"}})],1):t._e(),"success"==s.scanLoad?e(c,{attrs:{name:"scanning-success",size:"6"}}):t._e(),"danger"==s.scanLoad?e(c,{attrs:{name:"scanning-danger",size:"6"}}):t._e(),e("div",{staticClass:"scan-title flex flex-col items-start ml-20x"},[e("span",{staticClass:"font-bold text-[1.8rem] text-[#444]"},[t._v("查杀"+t._s(s.scanningData.scanningText)+" ，已扫描文件 "+t._s(s.scanningData.scanningCount)+" /"+t._s(s.scanningData.scanCount)+" 个；发现木马文件 "),e("span",{staticClass:"text-danger"},[t._v(t._s(s.tableData.length))]),t._v("个")]),e("span",{staticClass:"text-[1.2rem] text-[#666] mt-12x"},[t._v(t._s(s.scanningData.scanInfo.length>70?"..."+s.scanningData.scanInfo.substring(s.scanningData.scanInfo.length-70):s.scanningData.scanInfo))])])],1),e("div",{staticClass:"flex items-center ml-12x"},["loading"===s.scanLoad?e(l,{attrs:{type:"default"},on:{click:s.cancelScan}},[t._v("取消")]):t._e(),"loading"!=s.scanLoad?e(l,{on:{click:function(a){return s.scanData()}}},[t._v("重新查杀")]):t._e()],1)]),e(d),e(m,{scopedSlots:t._u([{key:"content",fn:function(){return[e(u,{attrs:{column:s.tableColumns,data:s.tableData}})]},proxy:!0},{key:"footer-left",fn:function(){return[e(p,{attrs:{config:s.batchConfig,data:s.tableBatch,"batch-fn":s.batchEvent}})]},proxy:!0},{key:"popup",fn:function(){return[e(r,{attrs:{title:"在线编辑",showFooter:"",visible:s.editorPopup,area:70},on:{"update:visible":function(a){s.editorPopup=a},confirm:s.saveFile}},[e("div",{staticClass:"p-20x"},[e(a,{staticClass:"!h-[40rem]",model:{value:s.editorValue,callback:function(a){s.editorValue=a},expression:"editorValue"}})],1)])]},proxy:!0}])})],1)}),[],!1,null,"51fafeea",null,null).exports;export{x as default};
