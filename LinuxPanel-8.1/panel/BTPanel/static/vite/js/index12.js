import{a1 as e,f as t,a2 as n,K as i,b4 as s,b5 as a,b6 as l,b7 as o,b8 as p,b9 as r,ba as u,n as c,_ as g,a as m,q as f,R as v}from"./main.js?v=1714377894636";import{_ as d}from"./index41.js?v=1714377894636";import{_}from"./index45.js?v=1714377894636";import{e as h,A as y,v as I,b as w,c as b,f as C,h as x,j as D}from"./vue-lib.js?v=1714377894636";import{g as V}from"./files.js?v=1714377894636";import{d as j,r as M}from"./check.js?v=1714377894636";import{c as O,h as k,d as E,s as S,a as P}from"./popup.js?v=1714377894636";import{g as $}from"./soft.store.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./element-lib.js?v=1714377894636";import"./index85.js?v=1714377894636";import"./index118.js?v=1714377894636";import"./index39.js?v=1714377894636";import"./index59.js?v=1714377894636";import"./index119.js?v=1714377894636";import"./soft.api.js?v=1714377894636";const U=c(h({__name:"index",props:{compData:{default:()=>({name:"",type:"",pluginInfo:{},softData:{name:"",endtime:0,setup:!1,pid:"",type:0}})}},emits:["close","refresh"],setup(c,{emit:g}){const m=c,{softData:f,pluginInfo:v}=m.compData,{proxy:d}=D(),{isInstall:_}=y(e()),{refs:{speedInstallView:h}}=$(),U=I({isBeta:!!m.compData.isBeta&&m.compData.isBeta,title:"",dependnetFlag:!1,arrs:["apache","nginx","mysql"],speedConfig:{}}),A=I({name:m.compData.name,pluginInfo:{},info:{},newVersion:"",changeUpdateTime:"",PluginUpgradesData:[]}),B=I({imgArrValue:0,imgArr:[]}),F=w({selectValue:"",selectOption:[],compile:!1,phpVersion:"",size:!1}),T=b((()=>{var e;return"/soft_ico/ico-"+((null==(e=A.pluginInfo.name)?void 0:e.includes("php-"))?"php":A.pluginInfo.name)+".png"})),N=b((()=>{var e;return A.changeUpdateTime?A.changeUpdateTime:A.PluginUpgradesData&&A.PluginUpgradesData.length&&(null==(e=A.PluginUpgradesData[0])?void 0:e.update_time)?t(A.PluginUpgradesData[0].update_time,"yyyy/MM/dd"):"暂无"})),q=w([[7,"免","border-[#E1E1E1] text-[#9a9a9a]"],[8,"专","border-[#F9EE9E] text-[#FFC82F]"],[12,"企","border-[#E8D6B3] text-[#A3782F]"]]),L=async e=>{var t,s;try{switch(F.value.selectOption=[],m.compData.type){case"i":U.title="安装",m.compData.update&&(U.title="更新");break;case"u":U.title="更新";break;case"r":U.title="修复";break;default:U.title="安装"}if(e)A.pluginInfo=m.compData.pluginInfo,A.pluginInfo||(A.pluginInfo=m.compData.softData);else{const{data:e}=await n({sName:A.name});A.pluginInfo=e}if(A.pluginInfo.introduction){const e=A.pluginInfo.introduction.split(";");B.imgArr=[],e.forEach(((e,t)=>{const n=e.split("|");B.imgArr.push({title:n[0],src:A.name.indexOf("php-")>-1?"https://www.bt.cn/Public/new/plugin/php/"+n[1]:"https://www.bt.cn/Public/new/plugin/"+A.name+"/"+n[1]})}))}await z(),U.dependnetFlag=!A.pluginInfo.dependnet.need&&!A.pluginInfo.dependnet.selected,i(A.pluginInfo.dependnet.need)&&(U.dependnetFlag=!A.pluginInfo.dependnet.need.length&&!A.pluginInfo.dependnet.selected.length),U.arrs.indexOf(A.name)>=0?(A.pluginInfo.versions.length>1?(A.pluginInfo.versions.forEach(((e,t)=>{F.value.selectOption.push({title:A.name+e.m_version,key:t})})),F.value.selectValue=null==(t=F.value.selectOption[0])?void 0:t.key):F.value.phpVersion=A.name+(A.name.indexOf("php-")>-1?"":A.pluginInfo.versions[0].m_version),F.value.compile=!0,F.value.size=!0):A.pluginInfo.versions.length>1?(F.value.selectOption=[],"修复"!==U.title&&(A.pluginInfo.versions.forEach(((e,t)=>{let n=1===e.beta?" Beta":" Stable";F.value.selectOption.push({title:e.m_version+"."+e.version+n,key:t})})),F.value.selectValue=null==(s=F.value.selectOption[0])?void 0:s.key,F.value.size=!0)):A.name.indexOf("php-")>=0?(F.value.selectOption=[],F.value.selectValue=A.name.split("php-")[1],A.pluginInfo.other_php.forEach(((e,t)=>{F.value.selectOption.push({id:e.id,title:e.name,key:e.version})})),F.value.compile=!0):A.pluginInfo.install_version=A.pluginInfo.versions[0]}catch(a){}},z=async()=>{try{const t=await s({plugin_name:A.name,show:1});if(A.PluginUpgradesData=t,U.isBeta){let e=t[t.length-1];A.info=e.beta?e:{}}else A.info=t[0];if("i"===m.compData.type&&t.forEach(((e,t)=>{e.m_version+"."+e.version===A.pluginInfo.versions&&(A.info=e)})),A.pluginInfo.versions.length>1&&A.pluginInfo.version)A.pluginInfo.versions.some(((e,t)=>{const n=j(A.pluginInfo.m_version+"."+A.pluginInfo.version,e.m_version+"."+e.version);if(0==n&&(A.newVersion=e.m_version+"."+e.version),-1==n)return A.newVersion=e.m_version+"."+e.version,!0}));else{var e=A.pluginInfo.versions[0];A.newVersion=e.m_version+"."+e.version}}catch(t){}},H=async()=>{var e,t,n;const s=A.pluginInfo,o=s.type;if(_.value&&await G(),U.isBeta,F&&5==o&&"更新"!==U.title)A.pluginInfo.versions.length>1?(A.pluginInfo.install_version=i(s.versions)&&(null==(e=s.versions)?void 0:e.filter(((e,t)=>t===F.value.selectValue))[0]),A.pluginInfo.install_type="1",await K(A.pluginInfo)):(A.pluginInfo.install_version=null==(t=A.pluginInfo)?void 0:t.versions[0],A.pluginInfo.install_type="1",await W(A.pluginInfo));else if(5===o&&A.pluginInfo.name.indexOf("php-")>-1)J({title:"正在更新，请稍后...",status:!0,soft:{type:o}});else{if(11===o||m.compData.update)try{return await d.$confirm({title:"安全验证",width:"35rem",useHtml:!0,message:'<span class="text-danger">'.concat("宝塔"===A.pluginInfo.authorauthor?"更新过程可能会导致服务中断,是否继续升级？<br>建议您在服务器负载闲时进行软件更新。":"安装第三方插件存在一定的安全风险，是否继续安装？","</span>"),icon:"warning"}),await R(s.name,s.tmp_path,s),!1}catch(v){}if("修复"===U.title)return R(s.name,s.tmp_path,s);if(s.install_version=i(s.versions)&&(null==(n=s.versions)?void 0:n.filter(((e,t)=>t===F.value.selectValue))[0]),""!=F.value.selectValue)if(s.tmp_path)await R(s.name,s.tmp_path,s);else try{const e={sName:s.name,version:s.install_version.m_version,min_version:s.install_version.version};s.install_type&&(e.type=s.install_type);const t=await a(e);if(t.msg&&!t.status)return d.$message.error(t.msg);await R(t.name,t.tmp_path,t)}catch(v){}else if(s.version&&s.versions.length>1&&"修复"!==U.title)for(var p=0;p<s.versions.length;p++){var r=s.versions[p],u=j(s.version,r.m_version+"."+r.version);if(0===u){d.$message.error("当前已是最新版本");break}if(u<0){const e={sName:s.name,version:s.versions[0].m_version,min_version:s.versions[0].version,upgrade:s.versions[0].m_version};"mysql"===s.name&&await d.$confirm({type:"calc",title:"更新MySQL【".concat(s.versions[0].m_version,".").concat(s.versions[0].version,"】"),width:"35rem",useHtml:!0,message:'<span class="text-[#000000] text-[1.2rem]">更新过程可能会导致服务中断,您真的现在就将【MySQL】更新到【'.concat(s.versions[0].m_version,".").concat(s.versions[0].version,"】吗？</span>\n                            <br>\n                            <span>更新数据库有风险，建议在更新前先备份您的数据库.如果您的是云服务器，强烈建议您在更新前做一个快照.建议您在服务器负载闲时进行软件更新.</span>")});var c=d.$load("正在获取插件安装信息，请稍候");const t=await a(e);h.value=!0,c.close(),d.$message.request(t),5===o?(await l(),d.$emit("close")):await R(s.name,t.tmp_path,t);break}}else{if("更新"!=U.title){const e={sName:s.name,version:s.versions[0].m_version,min_version:s.versions[0].version},t=await a(e);return R(s.name,t.tmp_path,t)}var g=!!(r=s.versions[0]).beta&&r.beta,f=r.m_version+"."+r.version;s.version!=f&&g==s.is_beta&&J({title:"正在更新，请稍后...",status:!0,soft:{type:o}})}}},Q=async()=>{await E(A.pluginInfo)},R=async(e,t,n)=>{J({title:"正在安装【"+n.title+"】，可能需要几分钟时间，请耐心等候!",status:!0},(async()=>{const i=await u({plugin_name:e,tmp_path:t,install_opt:n.install_opt});Z(),h.value=!1,d.$message.request(i)}))},J=(e,t)=>(e.soft||(e.soft={type:10}),5===e.soft.type?(t&&t(),!1):10!==e.soft.type||e.status?(U.speedConfig=e,U.speedConfig.msg="正在下载中...",S(U.speedConfig),g("close"),void(t&&t())):(t&&t(),!1)),K=async e=>{const t=e.install_version,n=t.m_version,i=t.version;M(e.title,"-"+n,""),10===e.type?(await d.$confirm({title:"信息",width:"35rem",message:"您真的要安装".concat(5!==e.type?e.title:e.title+"-"+n,"吗？")}),await W(e)):5===e.type&&e.versions.length<2?(m.compData.type=e.install_opt,m.compData.name=e.name,await L(!1)):(await W(e),5!==e.type&&await X({pluginName:e.name,name:e.title,version:n,minVersion:i}))},W=async e=>{try{const t=d.$load("正在获取插件安装信息，请稍候");10===e.type&&0===e.endtime&&await o({pid:e.id,cycle:999,type:0});const n=await a({sName:e.name,version:e.install_version.m_version,min_version:e.install_version.version,type:e.install_type?e.install_type:""});if(t.close(),!n.status)return d.$message.error(n.msg);if(n.install_opt)return m.compData.type=n.install_opt,m.compData.name=n.name,L(!1);n.size;if((await p()).data>0&&5===e.type&&(d.$emit("close"),l(),!n.status))return d.$message.error(n.msg);n.msg.indexOf("依赖以下软件")>-1&&(m.compData.type=n.install_opt,m.compData.name=n.name,F.value.size=!0,L(!1))}catch(t){}},G=async()=>{try{const e=["openlitespeed","nginx","apache"],t=await V(),n=/\[(.*)\]/;t.task&&t.task.forEach(((t,i)=>{var s,a;const l=t.name.match(n),o=null!=(a=null==(s=l[1])?void 0:s.split("-"))?a:[];return e.indexOf(A.name)>-1&&e.indexOf(o[0])>-1?d.$message.error("存在同类型的环境正在安装，请删除重试！"):l[1]===A.name||o[0]===A.name?d.$message.error("当前插件正在安装，请稍后重试！"):void 0}))}catch(e){}},X=async(e,t)=>{if(U.speedConfig=e,await P(U.speedConfig),t)try{await r({plugin_name:e.pluginName})}catch(n){}else;},{getSoftTableList:Y}=$(),Z=()=>{window.location.href.indexOf("soft")>-1&&Y(),f&&f.callBack&&f.callBack(),f||(window.location.reload(),localStorage.clear(),sessionStorage.clear())};return C((()=>m.compData),(e=>{var t;U.isBeta=!!m.compData.isBeta&&m.compData.isBeta,A.name=m.compData.name,B.imgArr=[],F.value={selectValue:"",selectOption:[],compile:!1,phpVersion:"",size:!1},A.info={},m.compData.name&&10!=(null==(t=m.compData.pluginInfo)?void 0:t.type)&&L(!0)}),{deep:!0,immediate:!0}),x((()=>{})),{__sfc:!0,props:m,softData:f,pluginInfo:v,emits:g,vm:d,isInstall:_,speedInstallView:h,state:U,pluginMsg:A,pluginShow:B,config:F,pluginImgSrc:T,pluginUpdateTime:N,tagList:q,installPlugin:L,handleVersionChange:e=>{F.value.selectValue=e,A.PluginUpgradesData.forEach(((n,i)=>{i==Number(e)&&(A.changeUpdateTime=t(n.update_time,"yyyy/MM/dd"))}))},showPluginInfo:z,isEmptyObject:e=>0===Object.keys(e).length,installEvent:async e=>{e?H():Q()},installPluginEvent:H,installEnviromentEvent:Q,inputPackage:R,showSpeedWindow:J,installSoft:K,getInstallPlugin:W,getRealtimeTasks:G,monitorSoftDownloadSpeed:X,getSoftTableList:Y,closeInstall:Z,compileInstallDialog:O,historyVersionDialog:k}}}),(function(){var e,t,n=this,i=n._self._c,s=n._self._setupProxy;return i("div",{staticClass:"install-plugin"},[i("div",{staticClass:"install-plugin-header"},[i("div",{staticClass:"install-plugin-header-left"},[i(g,{staticClass:"h-[4rem] mt-[0.6rem]",attrs:{src:s.pluginImgSrc}}),i("div",{staticClass:"install-plugin-header-left-title"},[i("div",{staticClass:"flex items-center text-[#333]"},[i("span",{staticClass:"text-[2rem] font-bold"},[n._v(n._s(s.pluginMsg.pluginInfo.title))]),s.config.compile?n._e():i("div",{staticClass:"install-plugin-header-left-title-tag"},[n._l(s.tagList,(function(e,t){return[!e||"boolean"!=typeof e[0]&&e[0]!==s.pluginMsg.pluginInfo.type?n._e():i("div",{key:t,staticClass:"install-plugin-header-left-title-tag-item",class:e[2]+" border-[0.1rem]"},[e&&"boolean"==typeof e[0]?i("i",{staticClass:"plugin_official_icon"}):n._e(),i("span",[n._v(n._s(e[1]))])])]}))],2)]),5!==s.pluginMsg.pluginInfo.type?i("div",{staticClass:"mt-[1rem]"},[i("span",{staticClass:"font-normal"},[n._v("更新时间：")]),i("span",{staticClass:"font-normal"},[n._v(" "+n._s(s.pluginUpdateTime)+" ")]),"更新"!==s.state.title?i(_):n._e(),"更新"!==s.state.title?i(m,{staticClass:"font-normal",on:{click:function(e){return s.historyVersionDialog({title:s.pluginMsg.pluginInfo.title,data:s.pluginMsg.PluginUpgradesData})}}},[n._v(" 更新日志 ")]):n._e()],1):n._e(),i("div",{staticClass:"flex items-center mt-[1rem]"},["更新"===s.state.title?i("span",{staticClass:"font-normal"},[n._v(" 最新版本： "),i("span",[n._v(" "+n._s(s.state.isBeta?"测试版"+s.pluginMsg.info.m_version+"."+s.pluginMsg.info.version:s.pluginMsg.newVersion)+" ")])]):n._e(),s.config&&!s.config.selectOption.length?i("span",{staticClass:"ml-[.5rem] font-normal"},[n._v("当前版本："+n._s((null==(e=s.pluginMsg.pluginInfo.versions[0])?void 0:e.m_version)+"."+(null==(t=s.pluginMsg.pluginInfo.versions[0])?void 0:t.version)))]):n._e()])])],1),i("div",{staticClass:"flex items-center"},[s.config&&(s.config.selectOption.length||s.config.phpVersion)&&"安装"==s.state.title?i("div",[s.config.phpVersion?i("span",[n._v(n._s(s.config.phpVersion))]):[i(d,{staticClass:"mr-[1rem] w-[11.6rem]",attrs:{options:s.config.selectOption,change:s.handleVersionChange},model:{value:s.config.selectValue,callback:function(e){n.$set(s.config,"selectValue",e)},expression:"config.selectValue"}})]],2):n._e(),s.config&&s.config.compile&&"安装"==s.state.title?i(f,{attrs:{type:"default",disabled:s.pluginMsg.pluginInfo.dependnet.length>0},on:{click:function(e){s.compileInstallDialog(s.installEvent,s.isEmptyObject(s.pluginMsg.pluginInfo.dependnet)||s.state.dependnetFlag)}}},[n._v(" 编译安装 ")]):n._e(),i(f,{on:{click:function(e){s.installEvent(s.isEmptyObject(s.pluginMsg.pluginInfo.dependnet)||s.state.dependnetFlag)}}},[i("span",{staticClass:"flex items-center text-[1.4rem] font-normal"},["更新"===s.state.title?i("span",{staticClass:"update_plugin_button_icon"}):n._e(),n._v(" "+n._s(s.config&&5==s.pluginMsg.pluginInfo.type&&"更新"!=s.state.title?"极速安装":"立即"+s.state.title)+" ")])])],1)]),i("hr",{staticClass:"my-[3rem] border-[#eee]"}),s.pluginShow.imgArr.length?i("div",{staticClass:"install-plugin-introduce"},[i("div",{staticClass:"install-plugin-introduce-left"},[i("ul",{staticClass:"install-plugin-introduce-left-tab"},n._l(s.pluginShow.imgArr,(function(e,t){return i("li",{key:t,class:t===s.pluginShow.imgArrValue?"on":"",on:{click:function(e){s.pluginShow.imgArrValue=t}}},[n._v(" "+n._s(e.title)+" ")])})),0)]),i(v,{staticClass:"w-[40rem] max-h-[100%]",attrs:{src:s.pluginShow.imgArr[s.pluginShow.imgArrValue].src}})],1):n._e(),i("div",{staticClass:"install-plugin-detail"},["更新"!==s.state.title?[i("div",{staticClass:"install-plugin-detail-title"},[n._v("插件说明：")]),i("div",{staticClass:"install-plugin-detail-content",domProps:{innerHTML:n._s(s.pluginMsg.pluginInfo.ps)}})]:[i("div",{staticClass:"install-plugin-detail-title"},[n._v("更新日志：")]),i("div",{staticClass:"install-plugin-detail-content"},[n._v(" "+n._s(s.pluginMsg.pluginInfo.update_msg?s.pluginMsg.pluginInfo.update_msg:"暂无内容")+" ")])]],2),i("ul",{staticClass:"install-plugin-helper"},[s.config?n._e():i("li",[i("span",[n._v(" 插件来源"+n._s(s.pluginMsg.pluginInfo.author)+"，网址 "),i(m,{staticClass:"decoration-revert",attrs:{href:s.pluginMsg.pluginInfo.home,target:"_blank"}},[n._v(" "+n._s(s.pluginMsg.pluginInfo.home)+" ")])],1)]),n._m(0),"{}"!==JSON.stringify(s.pluginMsg.pluginInfo.dependnet)?i("li",[i("span",{staticClass:"red"},[n._v("请手动安装插件依赖环境，如果未安装，将无法正常使用该插件")])]):n._e(),s.pluginMsg.pluginInfo.update&&"mysql"===s.pluginMsg.pluginInfo.name?i("li",[i("span",{staticClass:"redr"},[n._v("更新数据库有风险,建议在更新前,先备份您的数据库！")])]):n._e(),!s.pluginMsg.pluginInfo.update?i("li",[i("span",[n._v("安装过程可能需要几分钟时间，请耐心等候!")])]):[n._m(1),n._m(2)]],2)])}),[function(){var e=this,t=e._self._c;return e._self._setupProxy,t("li",[t("span",[e._v("如果已存在此插件，文件将被替换！")])])},function(){var e=this,t=e._self._c;return e._self._setupProxy,t("li",[t("span",{staticClass:"red"},[e._v("更新过程可能会导致服务中断,请须知")])])},function(){var e=this,t=e._self._c;return e._self._setupProxy,t("li",[t("span",{staticClass:"red"},[e._v("建议您在服务器负载闲时进行软件更新")])])}],!1,null,"a3206eb1",null,null).exports;export{U as default};
