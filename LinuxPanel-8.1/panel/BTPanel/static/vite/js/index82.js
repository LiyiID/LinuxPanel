import{e,b as t,v as s,f as a,j as i,h as r}from"./vue-lib.js?v=1714377894636";import{D as o}from"./index131.js?v=1714377894636";import n from"./SetPwd.js?v=1714377894636";import{_ as l}from"./index85.js?v=1714377894636";import{w as m,x as p}from"./element-lib.js?v=1714377894636";import{c1 as d,n as c,l as u}from"./main.js?v=1714377894636";import{_ as j}from"./index41.js?v=1714377894636";import{x as _}from"./mysql.store.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{o as f}from"./confirm.js?v=1714377894636";import{g as b}from"./index28.js?v=1714377894636";import{d as x}from"./database.table.js?v=1714377894636";import{d as v,t as h,i as g}from"./database.popup.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./index52.js?v=1714377894636";import"./index53.js?v=1714377894636";import"./index39.js?v=1714377894636";import"./index57.js?v=1714377894636";import"./index54.js?v=1714377894636";import"./index56.js?v=1714377894636";import"./index43.js?v=1714377894636";import"./index58.js?v=1714377894636";import"./index45.js?v=1714377894636";import"./index59.js?v=1714377894636";import"./index60.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./check.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./config.js?v=1714377894636";import"./index77.js?v=1714377894636";import"./index42.js?v=1714377894636";import"./index38.js?v=1714377894636";import"./index.vue_vue_type_style_index_0_lang.js?v=1714377894636";const y=c(e({__name:"SetPgsqlPermession",props:{compData:{default:{}}},setup(e,{expose:r}){const o=e,{proxy:n}=i(),{loading:l}=d(n),{getDatabase:m}=b(),p=t(),c=t(!1),u=s({listen_ip:"0.0.0.0/0",host:""}),j=t([{title:"所有人",key:"0.0.0.0/0"},{title:"本地服务器",key:"127.0.0.1/32"},{title:"指定ip",key:"ip"}]);a((()=>o.compData),(e=>{const t="0.0.0.0/0"!==e.listen_ip&&"127.0.0.1/32"!==e.listen_ip;u.host=t?e.listen_ip:"",u.listen_ip=t?"ip":e.listen_ip}),{immediate:!0});const x={host:[{validator:(e,t,s)=>{"ip"===u.listen_ip&&(""===t?s(new Error("请输入IP地址")):s()),s()},trigger:["blur","change"]}]},v=async e=>{const{listen_ip:t,host:s}=u;"0.0.0.0/0"===t&&await n.$confirm({title:"提示",message:"设置权限为所有人后，将会导致数据库安全性降低，他人可以随意访问数据库，是否继续操作？",icon:"warning",iconColor:"#E6A23C"});let a={data_name:o.compData.name,username:o.compData.username,listen_ip:"ip"===t?s:t};f({$refs:p.value,loading:c,message:!1,request:async()=>await _({data:JSON.stringify(a)}),complete:e=>e.data.status?(n.$message.success(e.data.msg),m()):(n.$message.error(e.data.data),Promise.reject())})};return r({onConfirm:v}),{__sfc:!0,vm:n,loading:l,props:o,getDatabase:m,permissionForm:p,formDisabled:c,ruleForm:u,pgsqlPermissionOptions:j,rules:x,onSubmit:v,checkIpAddress:(e,t,s)=>{if(!t)return s("请输入IP地址");if(!/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(t))return s("IP地址格式不正确");if(!t.split(".").every((e=>parseInt(e,10)>=0&&parseInt(e,10)<=255)))return s("IP地址格式不正确");s()}}}}),(function(){var e=this,t=e._self._c,s=e._self._setupProxy;return t("div",{staticClass:"p-20x"},[t(m,{ref:"permissionForm",attrs:{disabled:s.formDisabled,model:s.ruleForm,rules:s.rules,"label-width":"5rem"}},[t(p,{attrs:{label:e.$t("DataBase.VisitPermission"),prop:"listen_ip"}},[t(j,{staticClass:"w-[22rem]",attrs:{value:s.ruleForm.listen_ip,options:s.pgsqlPermissionOptions},on:{"update:value":function(t){return e.$set(s.ruleForm,"listen_ip",t)}}})],1),"ip"===s.ruleForm.listen_ip?t(p,{attrs:{prop:"host",label:e.$t("DataBase.IpAddress")}},[t(l,{attrs:{width:"22rem",placeholder:"填写格式如：192.168.69.11/24"},model:{value:s.ruleForm.host,callback:function(t){e.$set(s.ruleForm,"host",t)},expression:"ruleForm.host"}})],1):e._e()],1)],1)}),[],!1,null,null,null,null).exports;const D=c(e({__name:"index",setup(e){const{refs:{tableParam:s}}=b(),{proxy:a}=i(),l=t([{label:"同步数据库",value:"Synchronization",event:()=>{}},{label:"备份数据库",value:"BackDatabase",event:()=>{}},{label:"删除数据库",value:"delete",event:()=>{},isRefBatch:!0}]),m=e=>{u({title:"设置数据库"+e.name+"密码",area:53,component:n,compData:e,showFooter:!0})},p=async e=>{let t=[];t.push(e.id),v(t,"single")},d=async(e,t)=>{"back"==t&&h(e),"import"==t&&g(e)},c=async e=>{u({title:"设置数据库权限【"+e.name+"】",area:42,component:y,compData:e,showFooter:!0})},j=x({editPasswordEvent:m,changePermissionEvent:c,deleteDataEvent:p,setBackupEvents:d});return r((async()=>{})),{__sfc:!0,tableParam:s,vm:a,tableBatchData:l,editPasswordEvent:m,deleteDataEvent:p,setBackupEvents:d,changePermissionEvent:c,tableColumn:j,DatabaseView:o}}}),(function(){var e=this._self._c,t=this._self._setupProxy;return e("div",{staticClass:"relative"},[e(t.DatabaseView,{attrs:{databaseType:"PgSql",tableColumn:t.tableColumn,tableBatch:t.tableBatchData,tableData:t.tableParam.databaseList}})],1)}),[],!1,null,null,null,null).exports;export{D as default};
