import{_ as e}from"./index51.js?v=1714377894636";import{g as t,Q as s,n as a,_ as i,q as r}from"./main.js?v=1714377894636";import{F as n,j as c}from"./element-lib.js?v=1714377894636";import{e as l,v as m,h as o,i as d,j as p}from"./vue-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";const b=a(l({__name:"index",setup(e){const{refs:{authType:a}}=t(),{proxy:i}=p(),r=m({title:"容器安全一键检测-功能介绍",ps:"检测敏感信息、后门、漏洞、可疑操作等常见风险。",source:151,desc:["异常历史命令","敏感信息泄露","后门排查","容器逃逸"],tabImgs:[{title:"容器检测",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/docker/dockerContainerScan.png"}]}),n=m({title:"立即进行镜像检测,确保您的项目安全。",isFirst:!0,isScan:!1,isEnd:!1,iconType:"normal",detect:0,imageList:[],msg:"",btnObj:{text:"一键检测",type:"primary",disabled:!1},score:100,scanTime:0});let c=[],l=0,b=null;let _=null;const g=()=>{_=s({route:"/ws_model",onMessage:f})},f=(e,t)=>{var s;const a=JSON.parse(t.data);if(a.hasOwnProperty("image_list"))return n.imageList=a.image_list.map((e=>(e.active=!1,e))),void(c=JSON.parse(JSON.stringify(a.image_list)));if(a.hasOwnProperty("end")){n.msg=a.msg,n.score=n.score-a.score;const e=n.imageList[l-1];1!=a.status&&(n.detect++,null==e.riskList&&(e.riskList=[]),null==(s=e.riskList)||s.push(a)),a.end&&l>0&&(void 0===e.riskList&&(e.noWarring=!0),u())}},u=()=>{l<n.imageList.length?(null==_||_.send({model_index:"btdocker",mod_name:"security",def_name:"image_safe_scan",image_id:n.imageList[l].id,ws_callback:"123"}),l++):(n.isScan=!1,n.isEnd=!0,n.imageList=n.imageList.sort(((e,t)=>e.noWarring?1:t.noWarring?-1:0)),clearInterval(b),v("end"))},v=e=>{switch(e){case"scan":n.title="正在检测镜像，请稍候...",n.isEnd=!1,n.btnObj.text="取消检测",n.btnObj.type="default";break;case"restart":n.title="立即进行镜像检测,确保您的项目安全。",n.btnObj.text="重新检测",n.btnObj.type="primary";break;case"end":let e="";e=0==n.detect?"未发现安全漏洞":'一共发现<span class="text-[#fc6d26]">'.concat(n.detect,"</span>项风险"),n.title="检测完成,"+e,n.msg="检测完成，共耗时"+n.scanTime+"秒",n.btnObj.text="重新检测",n.btnObj.type="primary"}},y=()=>{n.title="立即进行镜像检测,确保您的项目安全。",n.msg="",n.isFirst=!0,n.isScan=!1,n.isEnd=!1,n.iconType="normal",n.detect=0,n.imageList=JSON.parse(JSON.stringify(c)),n.btnObj.text="一键检测",n.btnObj.type="primary",n.btnObj.disabled=!1,n.score=100},x=()=>{null==_||_.send({model_index:"btdocker",mod_name:"security",def_name:"get_image_list",ws_callback:"123"})};return o((()=>{g(),x()})),d((()=>{clearInterval(b)})),{__sfc:!0,authType:a,vm:i,productData:r,colors:[{color:"#ff0000",percentage:20},{color:"#ff0000",percentage:40},{color:"#fc6d26",percentage:60},{color:"#fc6d26",percentage:80},{color:"#20a53a",percentage:100}],scanParam:n,defaultImageList:c,currentIndex:l,timer:b,format:e=>e+"分",titleClick:e=>{n.imageList[e].active=!n.imageList[e].active},useSocket:_,createWebSocket:g,onWSReceive:f,scanDetectEvent:()=>{if(l=0,n.scanTime=0,n.detect=0,n.score=100,b=setInterval((()=>{n.scanTime++}),1e3),n.isFirst){if(0==n.imageList.length)return i.$message.error("请先添加镜像");n.isScan||g(),u(),n.isScan=!0,n.isFirst=!1,v("scan")}else n.isScan?(null==_||_.close(),y()):(n.imageList=JSON.parse(JSON.stringify(c)),u(),n.isScan=!0,v("scan"))},sendImageId:u,switchBtnStatus:v,resetData:y,getImageList:x}}}),(function(){var t=this,s=t._self._c,a=t._self._setupProxy;return s("section",{staticClass:"p-2rem"},["ltd"===a.authType?[s("div",{staticClass:"scanHead flex justify-between mb-2rem"},[s("div",{staticClass:"scanHead__left flex"},[s("div",{staticClass:"w-[8rem] h-[8rem]"},[a.scanParam.isFirst&&!a.scanParam.isScan?s(i,{staticClass:"w-full",attrs:{src:"/firewall/icon-safe-detect.svg"}}):s(n,{attrs:{type:"circle",percentage:a.scanParam.score,format:a.format,color:a.colors,width:80}})],1),s("div",{staticClass:"pt-[2rem] pl-2rem w-[40rem]"},[s("div",{staticClass:"text-[1.8rem] font-bold",domProps:{innerHTML:t._s(a.scanParam.title)}}),s("div",{staticClass:"text-[#666] mt-1rem"},[t._v(" "+t._s(a.scanParam.msg.length>35?a.scanParam.msg.substring(0,35)+"...":a.scanParam.msg)+" ")])])]),s("div",{staticClass:"scanHead__right pt-[2.6rem]"},[s(r,{attrs:{type:a.scanParam.btnObj.type,disabled:a.scanParam.btnObj.disabled},on:{click:a.scanDetectEvent}},[t._v(" "+t._s(a.scanParam.btnObj.text)+" ")])],1)]),s("div",{staticClass:"scanBody h-[50rem] overflow-auto"},t._l(a.scanParam.imageList,(function(e,r){return s("div",{key:r,staticClass:"bg-[#FCFCFC] mb-1rem",class:e.active?"active":""},[s("div",{staticClass:"scanBody__title flex justify-between cursor-pointer rounded-[0.4rem] px-[2rem] h-[3.5rem] leading-[3.5rem] text-[1.3rem]",on:{click:function(e){return a.titleClick(r)}}},[s(c,{staticClass:"item",attrs:{effect:"dark",content:e.name,placement:"top-start"}},[s("span",{staticClass:"text-[1.4rem] font-bold leading-[3.5rem]"},[t._v(t._s(e.name.length>50?e.name.substring(0,50)+"...":e.name))])]),a.scanParam.isEnd||a.scanParam.isScan?s("div",{staticClass:"flex"},[e.riskList&&e.riskList.length>0?[s("span",{staticClass:"text-danger"},[t._v("发现"+t._s(e.riskList.length)+"项风险")])]:e.noWarring||e.riskList?[s("span",{staticClass:"text-primary"},[t._v("无风险项")])]:[s("span",[t._v("检测中")])],s(i,{staticClass:"w-[1.6rem] ml-2rem",attrs:{src:"/firewall/arrow-down.svg"}})],2):t._e()],1),s("div",{staticClass:"scanBody__content mb-[2rem] mx-[2rem]"},t._l(e.riskList,(function(e,a){return s("div",{key:a,staticClass:"bg-[#ff00000a] text-[#666] py-1rem px-[1.5rem] mb-[0.8rem] rounded-[0.4rem]"},[s("div",{staticClass:"scanBody__content__title border-b border-[#ececec] pb-4x mb-4x"},[t._v(" "+t._s(e.msg)+" ")]),s("div",{staticClass:"scanBody__content__desc flex border-b border-[#ececec] pb-4x mb-4x"},[s("span",{staticClass:"w-[6rem] flex-shrink-0 inline-block"},[t._v("详情：")]),s("span",{domProps:{innerHTML:t._s(e.detail)}})]),s("div",{staticClass:"scanBody__content__repair flex"},[s("span",{staticClass:"w-[6rem] flex-shrink-0 inline-block"},[t._v("修复方案：")]),s("span",{domProps:{innerHTML:t._s(e.repair)}})])])})),0)])})),0)]:[s(e,{attrs:{data:a.productData}})]],2)}),[],!1,null,"9be6a9ae",null,null).exports;export{b as default};
