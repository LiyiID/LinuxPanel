import{_ as e}from"./index85.js?v=1714377894636";import{j as t,w as a,x as s,q as o,s as r}from"./element-lib.js?v=1714377894636";import{n,q as i,b as c}from"./main.js?v=1714377894636";import{_ as l}from"./index53.js?v=1714377894636";import{_ as m}from"./index39.js?v=1714377894636";import{_ as p}from"./index58.js?v=1714377894636";import{_ as u}from"./index59.js?v=1714377894636";import{e as d,b as f,v as g,H as h,h as j,j as v}from"./vue-lib.js?v=1714377894636";import{S as b}from"./public-lib.js?v=1714377894636";import{Z as y}from"./site.popup.js?v=1714377894636";import{g as w,aL as x,aM as _,D as C,aN as D,aO as P}from"./site.store.js?v=1714377894636";import{c as k}from"./check.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./index45.js?v=1714377894636";import"./index38.js?v=1714377894636";import"./element-ui.common.js?v=1714377894636";import"./date-util.js?v=1714377894636";import"./vdom.js?v=1714377894636";import"./index62.js?v=1714377894636";import"./cascader-panel.js?v=1714377894636";const F=n(d({__name:"editGroup",props:{compData:null},setup(e){const t=e,{proxy:a}=v(),s=f(),{refs:{projectGroupData:o,modulesTableParams:r},getProjectGroup:n,getModulesList:i}=w();let c=g({list:[],loading:!1});const l=f(!1),m=f(),p=g({projectName:""}),u=g({projectName:[{required:!0,message:"请选择项目",trigger:"change"}]}),d=f(!1),F=f(),N=g({interval:t.compData.interval}),$=g({interval:[{validator:(e,t,a)=>{t<5||t>60||""===t||t%1!=0?a(new Error("请输入5-60之间的整数")):a()},trigger:["input","change"]}]}),q=f([{active:!0,content:"添加项目",event:()=>{l.value=!0}},{content:"启动间隔",event:async()=>{d.value=!0}}]),G=g({selectList:[]}),R=f(""),S=f([{label:"启动项目",value:"start",event:()=>{}},{label:"停止项目",value:"stop",event:()=>{}},{label:"删除项目",value:"delete",event:()=>{}}]);let E=[],A=!1,B=0;const T=g({isRecurrence:!1,describe:{title:"",th:"",message:"",propsValue:"sitename"},tableDisplayConfig:{label:"状态",prop:"status",render:e=>h("span",{class:0!==E.length||A?E.find((t=>t.sitename===e.sitename)).status?"text-primary":"text-danger":"text-warning"},(()=>{if(0!==E.length||A){let t=E.find((t=>t.sitename===e.sitename)).msg;return B++,t}return"等待执行"})())}}),L=async e=>{const t={sitename:e.sitename,project_action:e.status?"stop":"start"};o.value.loading=!0;const s=await C({data:JSON.stringify(t)});o.value.loading=!1,s.status?(Z(),i("phpAsync"),a.$message.success(s.msg)):a.$message.error(s.msg)},M=async({sitename:e,project_id:a})=>{try{const{data:a}=await D({group_name:t.compData.name,sitename:e});return E.push({sitename:e,msg:a.msg,status:a.status}),a.status?a:Promise.reject(a)}catch(s){return Promise.reject(!1)}},O=async(e,t)=>{try{const t=await C({data:JSON.stringify({sitename:e.sitename,project_action:e.status?"stop":"start"})});return E.push({sitename:e.sitename,msg:t.msg,status:t.status}),t.status?t:Promise.reject(t)}catch(a){return Promise.reject(!1)}},H=async e=>{try{const s=await D({group_name:t.compData.name,sitename:e.sitename});a.$message.request(s),s.status&&Z()}catch(s){}},I=y({changeStatusEvent:L,deleteGroupEvent:H}),J=async()=>{try{c.loading=!0,c.list=[];const{project_list:e}=o.value.list.find((e=>e.name===t.compData.name));c.list=k(e,"array",[])}catch(e){}finally{c.loading=!1}},V=()=>{const e=document.querySelector(".project-table .el-table__body-wrapper tbody");b.create(e,{animation:500,onEnd:async e=>{const s=[...c.list],o=s.splice(e.oldIndex,1)[0];s.splice(e.newIndex,0,o);const r=s.map((e=>e.sitename));c={...c};const n=await P({group_name:t.compData.name,project_list:r.join(",")});a.$message.request(n)}})},Z=async()=>{await n(),await J()};return j((async()=>{J(),V()})),{__sfc:!0,props:t,vm:a,Table:s,projectGroupData:o,modulesTableParams:r,getProjectGroup:n,getModulesList:i,projectData:c,showAddPopup:l,addFromRef:m,addForm:p,addRules:u,showConfigPopup:d,configFormRef:F,configForm:N,configRules:$,tableBtnGroup:q,onConfirmAdd:async()=>{m.value.validate((async e=>{if(e)try{const e=a.$load("正在添加项目，请稍后..."),s=await x({group_name:t.compData.name,sitename:p.projectName});e.close(),a.$message.request(s),s.status&&(l.value=!1,await i("phpAsync"),Z(),p.projectName="")}catch(s){}}))},onConfirmConfig:async()=>{F.value.validate((async e=>{if(e)try{const e=a.$load("正在设置启动间隔，请稍后..."),s=await _({group_name:t.compData.name,interval:N.interval});e.close(),a.$message.request(s),s.status&&(d.value=!1,n())}catch(s){}}))},select:G,batchType:R,tableBatchData:S,list:E,isComplete:A,index:B,batchConfig:T,batchEvent:(e,t,a)=>{switch(e){case"start":case"stop":return O(t);case"delete":return M(t)}},handleBathComplete:async e=>{A=!0,"delete"!==R.value&&await i("phpAsync"),Z()},changeStatusEvent:L,deleteDataEvent:async e=>{await a.$confirm({type:"calc",title:"删除项目名称【".concat(e.sitename,"】"),width:"35rem",message:"您真的要删除项目名称【".concat(e.sitename,"】吗？")});const s=await D({group_name:t.compData.name,sitename:e.sitename});a.$message.request(s),s.status&&Z()},batchDeleteData:M,batchStatusData:O,handleBatch:e=>{A=!1,E=[],B=0;let t=[];switch(e){case"start":t=["启动","启动已选的项目"];break;case"stop":t=["停止","停止已选的项目"];break;case"delete":t=["删除","彻底失去访问和操作权限"]}R.value=e,T.isRecurrence=!0,T.describe.th="项目名称",T.describe.title="批量".concat(t[0],"项目"),T.describe.message="批量".concat(t[0],"已选的项目，是否继续操作！")},handleSelectionChange:e=>{G.selectList=e},deleteGroupEvent:H,tableColumn:I,getGroupProject:J,rowDrop:V,refresh:Z}}}),(function(){var n=this,d=n._self._c,f=n._self._setupProxy;return d("div",{staticClass:"p-[2rem]"},[d(u,{scopedSlots:n._u([{key:"header-left",fn:function(){return[d("div",{staticClass:"flex items-center"},[d(p,{attrs:{group:f.tableBtnGroup}})],1)]},proxy:!0},{key:"header-right",fn:function(){return[d(t,{staticClass:"item",attrs:{effect:"dark",content:"点击刷新数据",placement:"top-start"}},[d(i,{attrs:{type:"default",icon:"el-icon-refresh"},on:{click:f.refresh}})],1)]},proxy:!0},{key:"content",fn:function(){return[d(m,{directives:[{name:"loading",rawName:"v-loading",value:f.projectData.loading,expression:"projectData.loading"}],ref:"Table",staticClass:"project-table",attrs:{"row-key":"project_id",column:f.tableColumn,"max-height":340,data:f.projectData.list,description:"项目列表为空","element-loading-text":"正在加载项目列表，请稍后..."},on:{"selection-change":f.handleSelectionChange}})]},proxy:!0},{key:"footer-left",fn:function(){return[d(l,{attrs:{data:f.tableBatchData,config:f.batchConfig,"batch-fn":f.batchEvent},on:{"handle-batch":f.handleBatch,"handle-complete":f.handleBathComplete}})]},proxy:!0},{key:"popup",fn:function(){return[d(c,{staticClass:"overflow-hidden",attrs:{title:"添加项目",visible:f.showAddPopup,area:42,"show-footer":!0},on:{"update:visible":function(e){f.showAddPopup=e},confirm:f.onConfirmAdd}},[d("div",{staticClass:"p-20x"},[d(a,{ref:"addFromRef",attrs:{model:f.addForm,rules:f.addRules}},[d(s,{attrs:{label:"项目",prop:"projectName"}},[d(o,{staticClass:"w-[20rem]",attrs:{placeholder:"请选择项目"},model:{value:f.addForm.projectName,callback:function(e){n.$set(f.addForm,"projectName",e)},expression:"addForm.projectName"}},n._l(f.modulesTableParams.list,(function(e,t){return d(r,{key:t,attrs:{label:e.name,value:e.name}})})),1)],1)],1)],1)]),d(c,{staticClass:"overflow-hidden",attrs:{title:"设置启动间隔",visible:f.showConfigPopup,area:42,"show-footer":!0},on:{"update:visible":function(e){f.showConfigPopup=e},confirm:f.onConfirmConfig}},[d("div",{staticClass:"p-20x"},[d(a,{ref:"configFormRef",attrs:{model:f.configForm,rules:f.configRules}},[d(s,{attrs:{label:"项目启动间隔",prop:"interval"}},[d(e,{attrs:{placeholder:"请输入项目启动时间间隔",textType:"秒",max:"60",min:"5",type:"number"},model:{value:f.configForm.interval,callback:function(e){n.$set(f.configForm,"interval",e)},expression:"configForm.interval"}})],1)],1)],1)])]},proxy:!0}])})],1)}),[],!1,null,"7498f9b4",null,null).exports;export{F as default};
