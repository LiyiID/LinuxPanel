import{a as e,bb as t,bc as a,bd as s,be as o,bf as l,n,q as r,b as i,b5 as c,a2 as m,e as p,bg as u,f as d,l as f}from"./main.js?v=1714377894636";import{w as _,x as g,o as v,z as x}from"./element-lib.js?v=1714377894636";import{_ as b}from"./index85.js?v=1714377894636";import{_ as h}from"./index118.js?v=1714377894636";import{_ as y}from"./index39.js?v=1714377894636";import{_ as D}from"./index59.js?v=1714377894636";import{e as C,b as w,H as F,h as j,j as $,l as k,z as S,v as T,A as M,f as P}from"./vue-lib.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{_ as I}from"./index119.js?v=1714377894636";import{g as R}from"./soft.store.js?v=1714377894636";import{c as V}from"./check.js?v=1714377894636";const q=n(C({__name:"CompileInstall",props:{compData:{type:Object,default:()=>({})}},setup(n,{expose:r}){const i=n,{proxy:c}=$(),m=w({args_name:"",ps:"",args:"",init:"#在编译前执行的shell脚本内容，通常为第三方模块的依赖安装和源码下载等前置准备"}),p=w(!1),u=w([{width:35,type:"selection"},{label:"模块名称",prop:"name"},{label:"模块描述",prop:"ps"},{label:"操作",align:"right",render:(t,a)=>[F("div",{class:"flex items-center justify-end"},[F(e,{on:{click:()=>g(t)}},["删除"])])]}]),d=w([{name:"模块名称",ps:"模块描述"}]),f=w({args_name:[{required:!0,message:"请输入模块名称",trigger:"blur"}],args:[{required:!0,message:"请输入模块参数",trigger:"blur"}]}),_=async()=>{try{const e=await s({name:""});d.value=e.data.args;let t=e.data.config.split("\n");d.value.forEach((e=>{t.includes(e.name)&&k((()=>{o(c.$refs.customTableRef).toggleRowSelection(e)}))}))}catch(e){}},g=async e=>{try{await c.$confirm("确认删除模块【 ".concat(e.name,"】 吗？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",icon:"warning"});const a=await t({name:"",args_name:e.name});_(),c.$message.request(a)}catch(a){}},v=async()=>{i.compData.installEvent(i.compData.temp),c.$emit("close")};return j((()=>{_()})),r({onConfirm:v}),{__sfc:!0,vm:c,props:i,customForm:m,customVisible:p,tableColumn:u,customData:d,rules:f,handleAddCustomModule:()=>{p.value=!0},submitCustomModule:async()=>{try{c.$refs.customFormRef.validate((async e=>{if(!e)return c.$message.error("请填写表单必填项");{p.value=!1;const e=await a({name:"",...m.value});c.$message.request(e),e.status&&c.$refs.customFormRef.resetFields(),_()}}))}catch(e){}},getCustomModuleData:_,delCustomModuleData:g,setCustomModuleData:async e=>{try{let t=e.map((e=>e.name)).join("\n");const a=await l({name:"",args_names:t});c.$message.request(a)}catch(t){}},clearAddForm:()=>{c.$refs.customFormRef.resetFields(),c.$refs.customFormRef.clearValidate()},onConfirm:v}}}),(function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("div",{staticClass:"p-20x"},[t(D,{scopedSlots:e._u([{key:"header-left",fn:function(){return[t(r,{attrs:{type:"primary"},on:{click:a.handleAddCustomModule}},[e._v("添加自定义模块")])]},proxy:!0},{key:"content",fn:function(){return[t(y,{ref:"customTableRef",attrs:{column:a.tableColumn,"max-height":"30rem",data:a.customData},on:{"select-all":a.setCustomModuleData,select:a.setCustomModuleData}})]},proxy:!0}])}),t(h,{staticClass:"ml-20x",attrs:{list:[{text:"勾选对应自定义模块，提交后即可编译安装"}],"list-style":"disc"}}),t(i,{attrs:{title:"添加自定义选装模块",visible:a.customVisible,area:"56","show-footer":""},on:{"update:visible":function(e){a.customVisible=e},confirm:a.submitCustomModule,cancel:a.clearAddForm}},[t("div",{staticClass:"p-20x"},[t(_,{ref:"customFormRef",attrs:{model:a.customForm,rules:a.rules}},[t(g,{attrs:{prop:"args_name",label:"模块名称"}},[t(b,{attrs:{placeholder:"请输入模块名称，只能输入字母、数字、下划线",width:"30rem",clearable:""},model:{value:a.customForm.args_name,callback:function(t){e.$set(a.customForm,"args_name",t)},expression:"customForm.args_name"}})],1),t(g,{attrs:{prop:"ps",label:"模块描述"}},[t(b,{attrs:{maxlength:"30",placeholder:"请输入模块描述，30字以内",width:"30rem","show-word-limit":"",clearable:""},model:{value:a.customForm.ps,callback:function(t){e.$set(a.customForm,"ps",t)},expression:"customForm.ps"}})],1),t(g,{attrs:{prop:"args",label:"模块参数"}},[t(b,{attrs:{placeholder:"如：--add-module=/tmp/echo/echo-nginx-module-master",width:"30rem",clearable:""},model:{value:a.customForm.args,callback:function(t){e.$set(a.customForm,"args",t)},expression:"customForm.args"}})],1),t(g,{attrs:{prop:"init",label:"前置脚本"}},[t(v,{attrs:{type:"textarea",placeholder:"请输入内容"},model:{value:a.customForm.init,callback:function(t){e.$set(a.customForm,"init",t)},expression:"customForm.init"}})],1)],1)],1)])],1)}),[],!1,null,"78f2ccdc",null,null).exports,A=S("soft",(()=>{const e=T({name:"",pluginInfo:{},callBack:()=>{}});return{softData:e,initMysql:()=>{},openPlugin:async(t,a)=>{t.plugin_info;try{if(10===t.type){const s={sName:t.name,version:t.versions[0].version,min_version:t.versions[0].min_version},o=await c(s);return e.name=t.name,e.pluginInfo=o,void(a&&a())}e.pluginInfo=t}catch(s){}}}}));const H=n(C({__name:"DependInstall",props:{compData:{default:()=>{}}},emits:["close"],setup(e,{expose:t,emit:a}){const s=e,{softData:o}=M(A()),{openPlugin:l}=A(),n=w("nginx"),r=async()=>{try{let e=n.value;s.compData.need.length&&(e=s.compData.need[0]);const t=await m({sName:e});a("close"),p({name:e,type:"i",softData:t.data})}catch(e){}};return t({onConfirm:r}),{__sfc:!0,softData:o,openPlugin:l,props:s,emit:a,dependData:n,submitDependent:r}}}),(function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("div",{staticClass:"p-20x"},[t("div",[e.compData.need.length?t("div",[t("div",{staticClass:"flex items-center"},[t("i",{staticClass:"el-icon-warning-outline mr-8x text-[4rem] text-warning"}),t("span",{staticClass:"text-[1.4rem] leading-10"},[e._v("检测到当前插件缺失安装必要环境"+e._s(e.compData.need.join("、"))+",是否安装？")])])]):e._e(),e.compData.selected.length?t("div",{staticClass:"flex flex-col !mb-12x"},[e._m(0),e._l(e.compData.selected,(function(s,o){return t("div",{staticClass:"flex flex-col"},e._l(s,(function(s,o){return t(x,{key:o,staticClass:"!m-0 !mt-8x",attrs:{label:s,border:"",size:"medium"},model:{value:a.dependData,callback:function(e){a.dependData=e},expression:"dependData"}},[e._v(e._s(s))])})),1)}))],2):e._e()])])}),[function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"flex items-center"},[t("i",{staticClass:"el-icon-warning-outline mr-8x text-[4rem] text-warning"}),t("span",{staticClass:"text-[1.4rem] leading-10"},[e._v("检测到当前插件缺失选装依赖环境，请选择其一进行安装")])])}],!1,null,null,null,null).exports;const z=n(C({__name:"DownloadSpeed",props:{compData:{default:()=>({})}},setup:e=>({__sfc:!0,props:e,percentum:w(0),getSoftDownloadSpeed:async()=>{}})}),(function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("div",{staticClass:"download-speed"},[t("div",{staticClass:"download-speed-top"},[t("div",{staticClass:"download-speed-top-title"},[e._v(" 正在下载"+e._s(e.compData.name+" "+e.compData.version+"."+e.compData.minVersion)+"，请稍后 ... ")]),t("div",{staticClass:"download-speed-top-score"},[e._v(e._s(a.percentum)+"%")])]),t(I,{attrs:{strokeWidth:5,percentage:a.percentum,showText:!1}})],1)}),[],!1,null,"56015b14",null,null).exports;const B=n(C({__name:"SpeedInstall",props:{compData:{default:()=>({})}},emits:["close"],setup(e,{emit:t}){const a=e,{proxy:s}=$(),o=w(a.compData.msg),{refs:{inputZipFlag:l,speedInstallView:n},getSoftTableList:r}=R();P((()=>n.value),(()=>{n.value||s.$emit("close")}));const i=async()=>{try{const e=await u({num:10,filename:"/tmp/panelShell.pl"}),a=e.msg.trim().split("\n");if("Successify"===a[a.length-1]||1==l.value)return l.value=!1,await r(),t("close"),!1;if(!0!==e.status)return;o.value=e.msg,s.$refs.installShow.scrollTop=s.$refs.installShow.scrollHeight,setTimeout((()=>{i()}),1e3)}catch(e){}};return j((()=>{i(),n.value=!0})),{__sfc:!0,props:a,emits:t,vm:s,msg:o,inputZipFlag:l,speedInstallView:n,getSoftTableList:r,showSpeed:i}}}),(function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("pre",{ref:"installShow",staticClass:"install-show !h-[25.6rem]"},[e._v("\t"+e._s(a.msg)+"\n")])}),[],!1,null,"4146a13b",null,null).exports;const E=n(C({__name:"HistoryVersion",props:{compData:{default:()=>({})}},setup(e){const t=e,a=w(!1),s=w(V(t.compData.data,"array",[]));return j((()=>{})),{__sfc:!0,props:t,loading:a,data:s,formatTime:d}}}),(function(){var e,t=this,a=t._self._c,s=t._self._setupProxy;return a("div",{staticClass:"p-[2rem]"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:s.loading,expression:"loading"}],staticClass:"h-[32rem] overflow-auto"},[t._l(s.data,(function(e,o){var l;return(null==(l=s.data)?void 0:l.length)?a("div",{key:o,staticClass:"log-info-item"},[a("span",{staticClass:"log-info-item-active"}),a("div",{staticClass:"log-info-item-date"},[t._v(t._s(s.formatTime(e.update_time)))]),a("div",{staticClass:"log-info-item-title"},[t._v(" "+t._s(t.compData.title+e.m_version+"."+e.version+" - "+(e.beta?"测试版":"正式版"))+" ")]),a("div",{staticClass:"log-info-item-content",domProps:{innerHTML:t._s(e.update_msg.replace(/\n/g,"<br>"))}})]):t._e()})),(null==(e=s.data)?void 0:e.length)?t._e():a("div",{staticClass:"flex items-center justify-center h-full"},[a("span",{staticClass:"text-[#666]"},[t._v("暂无日志数据")])])],2)])}),[],!1,null,"c3a365b3",null,null).exports,L=(e,t)=>f({title:"自定义模块编译安装",area:45,btn:["提交并安装","取消"],component:q,compData:{installEvent:e,temp:t}}),N=e=>f({title:"【".concat(e.name,"】安装环境缺失"),area:34,btn:["安装","取消"],component:H,compData:e.dependnet}),Z=e=>f({area:45,component:z,compData:e}),O=e=>f({title:"".concat(e.title,"- 更新日志"),area:52,component:E,compData:{data:e.data,title:e.title}}),W=e=>f({title:e.title||"正在执行安装脚本，请稍候...",area:50,component:B,compData:e});export{Z as a,L as c,N as d,O as h,W as s};
