import{_ as t}from"./index77.js?v=1714377894636";import{_ as a}from"./preload-helper.js?v=1714377894636";import{e as s,b as e,v as i,h as o,j as r}from"./vue-lib.js?v=1714377894636";import{g as l,o as n,aS as c,bI as p,p as m,n as d,q as u,a as g,F as f,b as _}from"./main.js?v=1714377894636";import{_ as v}from"./index120.js?v=1714377894636";import{_ as h}from"./index85.js?v=1714377894636";import{q as b,s as y,B as w,L as x,w as F,x as P}from"./element-lib.js?v=1714377894636";import"./index45.js?v=1714377894636";import{a as C}from"./confirm.js?v=1714377894636";import{bQ as k,bR as D,bS as $,bT as L,bU as j,bV as T,bW as V,bX as M,bY as S,i as q,bZ as R,b_ as I,b$ as G,c0 as N,ai as A,c1 as E,c2 as W}from"./site.store.js?v=1714377894636";import{o as U}from"./software2.js?v=1714377894636";import"./index42.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./config.js?v=1714377894636";import"./check.js?v=1714377894636";const z=d(s({__name:"CatalugeSetting",props:{compData:{default:()=>({})}},setup(t){const a=t,{proxy:s}=r(),d=e(!1),{refs:{authType:u}}=l(),g=i({path:"",runPath:"",dirs:[],userini:!1,sync_git:!1,logs:!1,pass:!1}),f=e(!1),_=i({ftp_status:!1,ftp_name:"",ftp_pwd:""}),v=e(!1),h=e(!1),b=i({git_addr:"",branch:"",cycle:1}),y=e(""),w=e(!1),x=e(!1),F=e({mode:"ace/mode/nginx",theme:"ace/theme/monokai",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!0,fontSize:"12px"}),P=i({status:!1,username:"",password:"",rePass:""}),z={username:[{required:!0,message:"账号不能为空",trigger:["blur"]}],password:[{required:!0,message:"密码不能为空",trigger:["blur"]}],rePass:[{required:!0,message:"重复密码不能为空",trigger:["blur"]},{validator:(t,a,s)=>{a!==P.password?s(new Error("两次输入密码不一致")):s()},trigger:["blur","change"]}]},O=async()=>{try{const t=await $({table:"sites",key:"path",id:a.compData.id});g.path=t}catch(t){}},Q=async()=>{try{const t=await L({path:g.path,id:a.compData.id});g.dirs=t.data.runPath.dirs,g.runPath=t.data.runPath.runPath,g.sync_git=t.data.sync_git,g.logs=t.data.logs,g.userini=t.data.userini,P.status=t.data.pass}catch(t){}},H=async()=>{var t,s,e;try{const i=await V({site_id:a.compData.id});(null==(t=i.data.info)?void 0:t.id)?(_.ftp_status=!0,_.ftp_id=null==(s=i.data.info)?void 0:s.id,_.ftp_name=null==(e=i.data.info)?void 0:e.name,_.ftp_pwd=i.data.info.password):(_.ftp_status=!1,_.ftp_name="",_.ftp_pwd="",_.ftp_id="")}catch(i){}},B=async(t,e)=>{if(e){let t=s.$load("正在处理中,请稍后...");try{if(!_.ftp_id)return void B(!0,!1);let t={site_id:a.compData.id,..._,siteName:a.compData.name};delete t.ftp_status;const e=await M(t);s.$message.request(e),f.value=!1,H()}catch(i){}finally{t.close()}}else{t&&(_.ftp_name=_.ftp_name||p(12),_.ftp_pwd=_.ftp_pwd||p(12));let s={site_id:a.compData.id,..._,siteName:a.compData.name};s.ftp_id||delete s.ftp_id,_.ftp_status=!t,C({confirm:{icon:"warning",title:"FTP状态",message:t?"创建FTP将会同步到FTP界面，是否继续操作？":"关闭FTP后，将会删除当前网站的FTP账号，是否继续操作？"},loading:"正在处理中,请稍后...",request:async()=>await M(s),complete:H})}},X=async()=>{try{const t=await S({path:g.path});v.value=t.data.have_sync}catch(t){}},Y=async()=>{var t;try{const s=await I({site_id:a.compData.id});(null==(t=s.data)?void 0:t.git_addr)?(b.git_addr=s.data.git_addr,b.branch=s.data.branch,b.cycle=s.data.cycle):(b.git_addr="",b.branch="",b.cycle=1,h.value=!0)}catch(s){}},Z=async()=>{w.value=!0;try{const t=await A({path:"/www/wwwlogs/syncsite/"+a.compData.id+".log"});y.value=t.data.data||"暂无日志数据"}catch(t){}finally{w.value=!1}};return o((async()=>{d.value=!0;try{await O(),await Q(),await H(),await X()}catch(t){}finally{d.value=!1}})),{__sfc:!0,vm:s,props:a,viewLoading:d,authType:u,siteMessage:g,ftpPopup:f,ftpForm:_,rsyncStatus:v,gitPopup:h,gitForm:b,logsText:y,gitLogsLoading:w,gitLogPopup:x,gitRules:{git_addr:[{required:!0,message:"请输入git地址",trigger:"blur"}]},config:F,passVisitForm:P,passVisitRules:z,onPassVisitConfirm:async()=>{s.$refs.passVisitFormRef.validate((async t=>{if(t){let t=s.$load("正在设置,请稍后...");try{const t=await k({id:a.compData.id,username:P.username,password:P.password});s.$message.request(t)}catch(e){}finally{t.close()}}}))},onChangePassStatus:async t=>{let e;try{if(!t){e=s.$load("正在关闭密码访问,请稍后...");const t=await D({id:a.compData.id});e.close(),s.$message.request(t)}}catch(i){}finally{null==e||e.close()}},getPath:O,onPathChange:()=>{c({type:"dir",path:g.path,change:t=>{g.path=t}})},getDirUser:Q,saveSitePath:async()=>{let t=s.$load("正在保存中...");try{const t=await j({path:g.path,id:a.compData.id});s.$message.request(t),Q()}catch(e){}finally{t.close()}},setRunPath:async()=>{let t=s.$load("正在设置,请稍后...");try{const t=await T({runPath:g.runPath,id:a.compData.id});s.$message.request(t)}catch(e){}finally{t.close()}},getSitesFtpEvent:H,changeFtpStatus:B,getRsync:X,openRsync:async()=>{try{const{data:t}=await q({sName:"rsync"});await U({name:"rsync",softData:t})}catch(t){}},changeGit:async t=>{if("ltd"!==u.value)return m({sourceId:310,disablePro:!0});t?(g.sync_git=!1,await Y()):(g.sync_git=!0,C({confirm:{icon:"warning",title:"关闭git同步",message:"关闭后将不在同步git文件到网站目录，是否继续操作？"},loading:"正在关闭，请稍后...",request:async()=>await R({site_id:a.compData.id})}))},openGitPopup:async()=>{if("ltd"!==u.value)return m({sourceId:310,disablePro:!0});await Y(),h.value=!0},checkGit:Y,addGitConfig:async()=>{s.$refs.gitFormRef.validate((async t=>{t&&C({confirm:{icon:"warning",title:"git同步覆盖提示",message:"从git同步文件到网站目录将覆盖网站目录的文件，是否继续操作？"},loading:"正在设置，请稍后...",request:async()=>{const t=await G({site_id:a.compData.id,...b});return s.$message.request(t),h.value=!1,Q(),null}})}))},runGit:async()=>{if("ltd"!==u.value)return m({sourceId:310,disablePro:!0});try{const t=await N({site_id:a.compData.id});s.$message.request(t)}catch(t){}},openGitLog:async()=>{await Z(),x.value=!0},getGitLogs:Z,setDirUser:async()=>{let t=s.$load("正在处理中,请稍后...");try{const t=await E({path:g.path});s.$message.request(t),Q()}catch(a){}finally{t.close()}},setLogs:async()=>{let t=s.$load("正在处理中,请稍后...");try{const t=await W({id:a.compData.id});s.$message.request(t),Q()}catch(e){}finally{t.close()}},isRelease:n}}}),(function(){var t=this,a=t._self._c,s=t._self._setupProxy;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:s.viewLoading,expression:"viewLoading"}],staticClass:"py-16x px-12x"},[a("div",{staticClass:"formItem"},[a("span",{staticClass:"formLabel"},[t._v("网站目录")]),a(h,{staticClass:"mr-12x",attrs:{iconType:"folder",width:"32rem"},on:{folder:s.onPathChange},model:{value:s.siteMessage.path,callback:function(a){t.$set(s.siteMessage,"path",a)},expression:"siteMessage.path"}}),a(u,{on:{click:s.saveSitePath}},[t._v("保存 ")])],1),a("span",{staticClass:"formTips"},[t._v("当前网站的部署目录，可以选择其他目录")]),a("div",{staticClass:"formItem"},[a("span",{staticClass:"formLabel"},[t._v("运行目录")]),a(b,{staticClass:"mr-12x w-[32rem]",model:{value:s.siteMessage.runPath,callback:function(a){t.$set(s.siteMessage,"runPath",a)},expression:"siteMessage.runPath"}},t._l(s.siteMessage.dirs,(function(t){return a(y,{key:t,attrs:{label:t,value:t}})})),1),a(u,{on:{click:s.setRunPath}},[t._v("保存")])],1),a("span",{staticClass:"formTips"},[t._v("部分程序需要指定二级目录作为运行目录，如ThinkPHP5,Laravel")]),a("div",{staticClass:"formItem"},[a("span",{staticClass:"formLabel"},[t._v("添加FTP")]),a(w,{staticClass:"mr-12x",on:{change:s.changeFtpStatus},model:{value:s.ftpForm.ftp_status,callback:function(a){t.$set(s.ftpForm,"ftp_status",a)},expression:"ftpForm.ftp_status"}}),a("span",{staticClass:"text-[#999]"},[t._v("为当前目录添加一个FTP账号，以支持访问")]),a(g,{on:{click:function(t){s.ftpPopup=!0}}},[t._v("点击配置>>")])],1),s.isRelease?t._e():a("div",{staticClass:"formItem"},[a("span",{staticClass:"formLabel"},[t._v("文件同步")]),a(w,{staticClass:"mr-12x",model:{value:s.rsyncStatus,callback:function(t){s.rsyncStatus=t},expression:"rsyncStatus"}}),a("span",{staticClass:"text-[#999]"},[t._v("可以同步网站文件至其他服务节点 ")]),a(g,{on:{click:s.openRsync}},[t._v("点击配置>>")])],1),s.isRelease?t._e():a("div",{staticClass:"formItem"},[a("span",{staticClass:"formLabel"},[t._v("git同步 ")]),a(w,{staticClass:"mr-12x",on:{change:s.changeGit},model:{value:s.siteMessage.sync_git,callback:function(a){t.$set(s.siteMessage,"sync_git",a)},expression:"siteMessage.sync_git"}}),a(f,{staticClass:"mr-4x",attrs:{name:"icon-ltd",size:"1.6"}}),a("span",{staticClass:"text-[#999]"},[t._v("可以从git中下载文件到网站目录中")]),a(g,{on:{click:s.openGitPopup}},[t._v("点击配置>>")]),a(x,{attrs:{direction:"vertical"}}),a(g,{on:{click:s.openGitLog}},[t._v("查看日志")]),a(x,{attrs:{direction:"vertical"}}),a(g,{on:{click:s.runGit}},[t._v("立即同步")])],1),a(x),a("div",{staticClass:"formItem"},[a("span",{staticClass:"formLabel"},[t._v("防跨站攻击")]),a(w,{staticClass:"mr-12x",on:{change:s.setDirUser},model:{value:s.siteMessage.userini,callback:function(a){t.$set(s.siteMessage,"userini",a)},expression:"siteMessage.userini"}}),a("span",{staticClass:"text-[#999]"},[t._v("防跨站攻击(open_basedir)，防止黑客通过其他网站目录进行入侵攻击")])],1),a("div",{staticClass:"formItem"},[a("span",{staticClass:"formLabel"},[t._v("写访问日志")]),a(w,{staticClass:"mr-12x",on:{change:s.setLogs},model:{value:s.siteMessage.logs,callback:function(a){t.$set(s.siteMessage,"logs",a)},expression:"siteMessage.logs"}}),a("span",{staticClass:"text-[#999]"},[t._v("允许当前日志增加访问日志")])],1),a(x),a("div",{staticClass:"flex items-center"},[a("span",{staticClass:"mr-20x w-[7rem] text-right"},[t._v("密码访问")]),a(w,{on:{change:s.onChangePassStatus},model:{value:s.passVisitForm.status,callback:function(a){t.$set(s.passVisitForm,"status",a)},expression:"passVisitForm.status"}})],1),s.passVisitForm.status?a(F,{ref:"passVisitFormRef",staticClass:"mt-20x",attrs:{model:s.passVisitForm,rules:s.passVisitRules,"label-width":"70px","label-position":"right"}},[a(P,{attrs:{label:"账号",prop:"username"}},[a(h,{attrs:{placeholder:"不修改请留空"},model:{value:s.passVisitForm.username,callback:function(a){t.$set(s.passVisitForm,"username",a)},expression:"passVisitForm.username"}})],1),a(P,{attrs:{label:"访问密码",prop:"password"}},[a(h,{attrs:{type:"password",placeholder:"不修改请留空"},model:{value:s.passVisitForm.password,callback:function(a){t.$set(s.passVisitForm,"password",a)},expression:"passVisitForm.password"}})],1),a(P,{attrs:{label:"重复密码",prop:"rePass"}},[a(h,{attrs:{type:"password",placeholder:"不修改请留空"},model:{value:s.passVisitForm.rePass,callback:function(a){t.$set(s.passVisitForm,"rePass",a)},expression:"passVisitForm.rePass"}})],1),a(P,{attrs:{label:" "}},[a(u,{on:{click:s.onPassVisitConfirm}},[t._v("保存")])],1)],1):t._e(),a(_,{attrs:{title:"FTP配置",visible:s.ftpPopup,area:42,showFooter:""},on:{"update:visible":function(t){s.ftpPopup=t},confirm:function(t){return s.changeFtpStatus(!1,!0)}}},[a("div",{staticClass:"p-20x"},[a(F,{attrs:{"label-position":"right",model:s.ftpForm}},[a(P,{attrs:{label:"用户名"}},[a(h,{attrs:{placeholder:"请输入ftp用户名"},model:{value:s.ftpForm.ftp_name,callback:function(a){t.$set(s.ftpForm,"ftp_name",a)},expression:"ftpForm.ftp_name"}})],1),a(P,{attrs:{label:"密码"}},[a(h,{attrs:{placeholder:"请输入ftp密码","icon-type":"refresh",isNull:s.ftpForm.ftp_pwd},model:{value:s.ftpForm.ftp_pwd,callback:function(a){t.$set(s.ftpForm,"ftp_pwd",a)},expression:"ftpForm.ftp_pwd"}})],1),a(P,{attrs:{label:"根目录"}},[a(h,{attrs:{disabled:""},model:{value:s.siteMessage.path,callback:function(a){t.$set(s.siteMessage,"path",a)},expression:"siteMessage.path"}})],1)],1)],1)]),a(_,{attrs:{title:"配置GIT同步",visible:s.gitPopup,area:42,showFooter:""},on:{"update:visible":function(t){s.gitPopup=t},confirm:s.addGitConfig}},[a("div",{staticClass:"p-20x"},[a(F,{ref:"gitFormRef",attrs:{"label-position":"right",model:s.gitForm,rules:s.gitRules}},[a(P,{attrs:{label:"git地址",prop:"git_addr"}},[a(h,{attrs:{placeholder:"请输入git地址"},model:{value:s.gitForm.git_addr,callback:function(a){t.$set(s.gitForm,"git_addr",a)},expression:"gitForm.git_addr"}})],1),a(P,{attrs:{label:"分支"}},[a(h,{attrs:{placeholder:"请输入git分支,为空默认主分支"},model:{value:s.gitForm.branch,callback:function(a){t.$set(s.gitForm,"branch",a)},expression:"gitForm.branch"}})],1),a(P,{attrs:{label:"同步周期"}},[a(h,{attrs:{"text-type":"天",type:"number",min:1},model:{value:s.gitForm.cycle,callback:function(a){t.$set(s.gitForm,"cycle",a)},expression:"gitForm.cycle"}})],1)],1)],1)]),a(_,{attrs:{title:"GIT日志",visible:s.gitLogPopup,area:70},on:{"update:visible":function(t){s.gitLogPopup=t}}},[a("div",{staticClass:"p-20x"},[a(u,{on:{click:s.getGitLogs}},[t._v("刷新")]),a(v,{directives:[{name:"loading",rawName:"v-loading",value:s.gitLogsLoading,expression:"gitLogsLoading"}],staticClass:"!h-[54rem] !w-full my-12x",attrs:{config:s.config},model:{value:s.logsText,callback:function(t){s.logsText=t},expression:"logsText"}}),a("span",{staticClass:"text-[#999] mt-8x"},[t._v("提示：支持Ctrl + F，快捷搜索日志内容")])],1)])],1)}),[],!1,null,"086d8132",null,null).exports;const O=d(s({__name:"SiteCataluge",props:{compData:{default:()=>({})}},setup(t){const s=t,{proxy:i}=r(),l=e(s.compData.tabName||"catalugeTab"),n=e([{title:"网站目录",type:"catalugeTab",compData:s.compData,component:z},{title:"网站配额",compData:s.compData,type:"flowQuota",component:()=>a((()=>import("./SiteCapacityQuota.js?v=1714377894636")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]),import.meta.url)},{title:"nginx WebDav",compData:s.compData,type:"nginxWebDav",component:()=>a((()=>import("./NginxWebDav.js?v=1714377894636")),__vite__mapDeps([22,14,1,2,3,4,5,6,7,8,9,10,18,15,16,17,23,19,20]),import.meta.url)}]);return o((()=>{n.value.splice(2,1)})),{__sfc:!0,vm:i,props:s,tabActive:l,handleClickTab:t=>{},tabConfig:n}}}),(function(){var a=this._self._c,s=this._self._setupProxy;return a("div",[a(t,{attrs:{type:"navtwo",config:s.tabConfig},on:{"tab-click":s.handleClickTab},model:{value:s.tabActive,callback:function(t){s.tabActive=t},expression:"tabActive"}})],1)}),[],!1,null,"1d675dcc",null,null).exports;export{O as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./SiteCapacityQuota.js?v=1714377894636","./main.js?v=1714377894636","./modulepreload-polyfill.js?v=1714377894636","./vue-lib.js?v=1714377894636","./__commonjsHelpers__.js?v=1714377894636","./preload-helper.js?v=1714377894636","./request-lib.js?v=1714377894636","./locales-lib.js?v=1714377894636","./public-lib.js?v=1714377894636","./element-lib.js?v=1714377894636","./element-lib.js?v=1714377894636","./index40.js?v=1714377894636","./element-lib.js?v=1714377894636","./config.js?v=1714377894636","./index85.js?v=1714377894636","./index46.js?v=1714377894636","./element-lib.js?v=1714377894636","./index.vue_vue_type_style_index_0_lang.js?v=1714377894636","./element-lib.js?v=1714377894636","./site.store.js?v=1714377894636","./check.js?v=1714377894636","./confirm.js?v=1714377894636","./NginxWebDav.js?v=1714377894636","./index45.js?v=1714377894636"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
