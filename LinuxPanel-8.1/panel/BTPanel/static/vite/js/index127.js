import{_ as e}from"./index53.js?v=1714377894636";import{_ as t}from"./index39.js?v=1714377894636";import{_ as a}from"./index58.js?v=1714377894636";import{_ as s}from"./index59.js?v=1714377894636";import{_ as o}from"./preload-helper.js?v=1714377894636";import{e as n,b as r,v as i,H as l,h as c,j as p}from"./vue-lib.js?v=1714377894636";import{l as m,n as u}from"./main.js?v=1714377894636";import{g as d,a as b,e as f}from"./index38.js?v=1714377894636";import{aa as h}from"./site.popup.js?v=1714377894636";import{e8 as g,e9 as y,ea as v,eb as j}from"./site.store.js?v=1714377894636";import{o as x}from"./index61.js?v=1714377894636";import"./element-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./index45.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./element-ui.common.js?v=1714377894636";import"./date-util.js?v=1714377894636";import"./vdom.js?v=1714377894636";import"./index62.js?v=1714377894636";import"./cascader-panel.js?v=1714377894636";import"./check.js?v=1714377894636";const _=u(n({__name:"index",props:{compData:{default:{}}},setup(e){const t=e,{proxy:a}=p(),s=[{content:"添加计划任务",active:!0,event:()=>{$()}}],n=r([]),u=r(!1),_=r({}),C=r([]),w=r(!1),k=r(!1),D=r(!1),E=r([{label:"执行任务",value:"stark"},{label:"启动任务",value:"start",diyBatch:()=>{q(C.value,!0,1)}},{label:"停止任务",value:"stop",isRefBatch:!0,diyBatch:()=>{q(C.value,!0,0)}},{label:"删除任务",value:"delete"}]);let L=[],R=0;const B=i({isRecurrence:!1,describe:{title:"",th:"",message:"",propsValue:"name"},tableDisplayConfig:{label:"状态",prop:"status",render:e=>l("span",{class:0===L.length?"text-warning":L.includes(e.id)?"text-primary":"text-danger"},(()=>{if(0===L.length)return"等待执行";{let t=L.includes(e.id)?"执行成功":"执行失败";return R===2*L.length?(L=[],R=0):R++,t}})())}}),q=async(e,t=!1,s)=>{let o;_.value=e;try{if(t)x({title:s?"是否要批量开启选中任务？":"是否要批量停止选中任务？",dataList:C.value,titleType:s?"批量开启任务":"批量停止任务",requestFun:async e=>await g({id:e.id,status:s}),isRecurrence:!0,tableColumn:[{prop:"rname",label:"计划任务"},{prop:"status",label:"状态"}],isReturnResult:!0,callback:()=>{F()}});else{await a.$confirm({title:e.status?"停用计划任务":"启用计划任务",message:e.status?"计划任务暂停后将无法继续运行，您真的要停用这个计划任务吗？":"该计划任务已停用，是否要启用这个计划任务？",icon:"question",iconColor:"#E6A23C"}),o=a.$load("正在设置计划任务状态，请稍候...");const t=await g({id:Number.parseInt(e.id)});a.$message.request(t),F()}}catch(n){}finally{o&&o.close()}},$=e=>{m({isAsync:!0,title:"".concat(e?"编辑":"添加","计划任务").concat(e?"【"+e.name+"】":""),area:74,component:()=>o((()=>import("./editCrontab.js?v=1714377894636")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]),import.meta.url),compData:{isEdit:!!e,row:e||void 0,sitename:t.compData.name,getCrontab:F},showFooter:!0})},S=e=>{h(e)},G=async(e,t,s=!1)=>{try{const t=await v({id:e.id});t.status&&s&&L.push(e.id),!s&&a.$message.request(t),!s&&h(e)}catch(o){}},P=async({id:e,name:t},s=!1)=>{"boolean"!=typeof s&&(s=!1);try{!s&&await a.$confirm({title:"删除计划任务",message:"您确定要删除计划任务【".concat(t,"】，是否继续？"),icon:"warning"});const o=await j({id:e});o.status&&s?L.push(e):L.push(0),!s&&F(),!s&&a.$message.request(o)}catch(o){}},A=r([d(),{label:"计划任务",prop:"rname",render:e=>e.rname||e.name},b({event:e=>{q(e)},data:["停用","正常"]}),{label:"执行周期",prop:"cycle"},{label:"上次执行时间",prop:"addtime"},f([{onClick:G,title:"执行"},{onClick:e=>{$(e)},title:"编辑"},{onClick:e=>{S(e)},title:"日志"},{onClick:P,title:"删除"}])]),F=async()=>{try{u.value=!0;const{data:e}=await y({sitename:t.compData.name});n.value=e,u.value=!1}catch(e){}};return c((()=>{F()})),{__sfc:!0,props:t,vm:a,tableBtnGroup:s,tableData:n,tableLoading:u,rowData:_,tableList:C,confirmPopup:w,isMultStop:k,statusFalse:D,batchGroup:E,resList:L,index:R,batchConfig:B,changeStatusEvent:q,handleSelectionChange:e=>{C.value=e},editCrontab:$,openLogEvent:S,startTaskEvent:G,deleteDataEvent:P,batchEvent:async(e,t,a)=>{switch(e){case"stark":return await G(t,0,!0);case"delete":return await P(t,!0)}return Promise.resolve()},handleBatch:e=>{let t={stop:"停止",start:"启动",stark:"执行",delete:"删除",set:"设置"};B.isRecurrence=!0,"stop"!=e&&"start"!=e||(B.isRecurrence=!1),B.describe.message="即将批量".concat(t[e],"选中的计划任务，是否继续？"),B.describe.th="计划任务",B.describe.title="批量".concat(t[e],"计划任务")},tableColumns:A,getCrontab:F}}}),(function(){var o=this,n=o._self._c,r=o._self._setupProxy;return n("div",[n(s,{scopedSlots:o._u([{key:"header-left",fn:function(){return[n(a,{attrs:{group:r.tableBtnGroup}})]},proxy:!0},{key:"header-right",fn:function(){},proxy:!0},{key:"content",fn:function(){return[n(t,{directives:[{name:"loading",rawName:"v-loading",value:r.tableLoading,expression:"tableLoading"}],attrs:{"max-height":"560",column:r.tableColumns,"element-loading-text":"正在加载中...",data:r.tableData},on:{"selection-change":r.handleSelectionChange}})]},proxy:!0},{key:"footer-left",fn:function(){return[n(e,{attrs:{data:r.batchGroup,config:r.batchConfig,"batch-fn":r.batchEvent},on:{"handle-complete":r.getCrontab,"handle-batch":r.handleBatch}})]},proxy:!0},{key:"footer-right",fn:function(){},proxy:!0},{key:"popup",fn:function(){},proxy:!0}])})],1)}),[],!1,null,"ee3e4501",null,null).exports;export{_ as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./editCrontab.js?v=1714377894636","./index85.js?v=1714377894636","./main.js?v=1714377894636","./modulepreload-polyfill.js?v=1714377894636","./vue-lib.js?v=1714377894636","./__commonjsHelpers__.js?v=1714377894636","./preload-helper.js?v=1714377894636","./request-lib.js?v=1714377894636","./locales-lib.js?v=1714377894636","./public-lib.js?v=1714377894636","./element-lib.js?v=1714377894636","./element-lib.js?v=1714377894636","./element-lib.js?v=1714377894636","./element-lib.js?v=1714377894636","./confirm.js?v=1714377894636","./config.js?v=1714377894636","./site.store.js?v=1714377894636","./check.js?v=1714377894636"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
