import{q as e,s as t}from"./element-lib.js?v=1714377894636";import{n as a,q as s,b as i}from"./main.js?v=1714377894636";import{_ as o}from"./index39.js?v=1714377894636";import{_ as n}from"./index59.js?v=1714377894636";import{e as r,A as l,v as m,b as c,h as p,j as d}from"./vue-lib.js?v=1714377894636";import{r as u,a as f,b as j,t as x}from"./index28.js?v=1714377894636";import{u as y}from"./index81.js?v=1714377894636";import{d as b}from"./mysql.api.js?v=1714377894636";import{a as g}from"./confirm.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./index77.js?v=1714377894636";import"./index42.js?v=1714377894636";import"./check.js?v=1714377894636";import"./mysql.store.js?v=1714377894636";import"./index52.js?v=1714377894636";import"./index53.js?v=1714377894636";import"./index57.js?v=1714377894636";import"./index58.js?v=1714377894636";import"./index45.js?v=1714377894636";import"./index60.js?v=1714377894636";import"./index38.js?v=1714377894636";import"./config.js?v=1714377894636";const v=a(r({__name:"RedisBackList",setup(e){const{tableParam:t}=l(u()),{initTable:a}=u(),{proxy:s}=d(),i=m({search:"",p:1,limit:10,total:0,load:!1}),o=c([]),n=c(0),r=c(!1),v=async()=>{try{i.load=!0;const e=await f({data:JSON.stringify({sort:"desc"})});o.value=e.data,i.load=!1}catch(e){}},_=async e=>{await s.$confirm({title:"覆盖数据",type:"input",iconType:"warning",iconColor:"#F7B500",inputText:"覆盖数据",message:"即将使用【"+e.name+"】对数据进行覆盖，是否继续?"});let i=s.$load("正在恢复备份中，请稍后...");try{const o=await j({data:JSON.stringify({file:e.filepath,sid:t.value.sid})});i.close(),a(),s.$message.request(o)}catch(o){}finally{i.close()}},k=async e=>{g({confirm:{title:"删除备份【"+e.name+"】",icon:"warning",message:"是否删除【"+e.name+"】备份?"},loading:"正在删除备份，请稍后...",request:async()=>await b({path:e.filepath}),complete:v})},h=y({restoreBackEvent:_,deleteBackEvent:k});return p((async()=>{await v()})),{__sfc:!0,storeParam:t,initTable:a,vm:s,tableParam:i,tableData:o,assignedDb:n,assignedBackPopup:r,getRedisBack:v,restoreBackEvent:_,onNowBack:async()=>{const e=s.$load("正在备份数据库...");try{const e=await x();s.$message.request(e),v()}catch(t){}finally{e.close()}},onAssigned:async()=>{const e=s.$load("正在备份数据库...");try{const e=await x({data:JSON.stringify({db_idx:String(n.value),sid:t.value.sid})});s.$message.request(e),v(),r.value=!1}catch(a){}finally{e.close()}},deleteBackEvent:k,tableColumn:h}}}),(function(){var a=this,r=a._self._c,l=a._self._setupProxy;return r("div",{staticClass:"p-20x"},[r(n,{scopedSlots:a._u([{key:"header-left",fn:function(){return[r(s,{on:{click:l.onNowBack}},[a._v("立即备份")])]},proxy:!0},{key:"content",fn:function(){return[r(o,{directives:[{name:"loading",rawName:"v-loading",value:l.tableParam.load,expression:"tableParam.load"}],ref:"routeBackup",staticClass:"h-full",attrs:{"max-height":"400","element-loading-text":"正在加载备份列表，请稍后...",data:l.tableData,column:l.tableColumn}})]},proxy:!0},{key:"popup",fn:function(){return[r(i,{attrs:{area:36,title:"指定备份数据库","show-footer":"",visible:l.assignedBackPopup},on:{confirm:l.onAssigned,"update:visible":function(e){l.assignedBackPopup=e}}},[r("div",{staticClass:"flex items-center p-20x"},[a._v(" 数据库 "),r(e,{staticClass:"ml-20x w-[24rem]",model:{value:l.assignedDb,callback:function(e){l.assignedDb=e},expression:"assignedDb"}},a._l(l.storeParam.keyList,(function(e,a){return r(t,{key:a,attrs:{value:e.id,label:e.name}})})),1)],1)])]},proxy:!0}])}),a._m(0)],1)}),[function(){var e=this,t=e._self._c;return e._self._setupProxy,t("ul",{staticClass:"mt-12x leading-8 text-[1.2rem] list-disc ml-20x"},[t("li",[e._v("注：备份的为所有数据库数据")])])}],!1,null,null,null,null).exports;export{v as default};
