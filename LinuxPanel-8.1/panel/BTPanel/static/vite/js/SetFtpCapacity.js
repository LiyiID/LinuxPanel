import{g as e,n as s,a as t}from"./main.js?v=1714377894636";import{w as a,x as r,o as i}from"./element-lib.js?v=1714377894636";import{e as l,b as o,v as u,h as n,U as m,j as p}from"./vue-lib.js?v=1714377894636";import{g as c,i as d}from"./ftp.store.js?v=1714377894636";import{o as g}from"./confirm.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./config.js?v=1714377894636";const f=s(l({__name:"SetFtpCapacity",props:{compData:{default:()=>{}}},setup(s,{expose:t}){const a=s,{getPushConfigInfo:r,authType:i}=e(),{getFtpList:l}=c(),{proxy:f}=p(),v=o(),y={size:[{required:!0,message:"容量不能为空",trigger:["blur"]},{validator:(e,s,t)=>{Number.isInteger(1*b.size)?t():t(new Error("容量必须为整数"))},trigger:["blur","change"]}],alarmSize:[{required:!0,message:"触发告警大小不能为空",trigger:["blur"]},{validator:(e,s,t)=>{b.status?Number.isInteger(1*b.alarmNum)?t():t(new Error("触发告警大小必须为整数")):t()},trigger:["blur","change"]}],alarmNum:[{required:!0,message:"告警次数不能为空",trigger:["blur"]},{validator:(e,s,t)=>{b.status?Number.isInteger(1*b.alarmNum)?t():t(new Error("告警次数必须为整数")):t()},trigger:["blur","change"]}],module:[{required:!0,validator:(e,s,t)=>{b.status&&0===b.module.length?t(new Error("请选择告警方式")):t()},trigger:["blur","change"]}]},b=u({used:0,size:0,status:!1,alarmSize:0,alarmNum:0,alarmModel:[],module:[],option:{}}),_=o(),h=o(!1),C=()=>{if(0===b.size)return void(_.value="未配置");const e=1024*b.size*1024;b.size>0&&b.used>=e?_.value="当前容量已用完":_.value=(b.used/1024/1024).toFixed(2)||0},z=()=>{const{quota:e}=a.compData;let{quota_storage:s,quota_push:t}=e;s&&(b.used=s.used,b.size=s.size),t&&void 0!==t.module&&(b.status=t.status,b.alarmSize=t.size,b.alarmNum=t.push_count,b.module=t.module.split(",")),C()},x=()=>{const{path:e}=a.compData;let s={path:e,quota_type:"ftp",quota_push:{status:b.status,size:Number(b.alarmSize),push_count:Number(b.alarmNum),module:b.module.join(",")},quota_storage:{size:Number(b.size)}};if(b.status&&0===s.quota_push.module.length)return f.$message.error("请选择至少一种告警方式");g({$refs:v.value,loading:h,request:async()=>await d({data:JSON.stringify(s)}),complete:async e=>{f.$message.success(e.msg),await l()},message:!1,fail:async e=>{f.$message.msg({customClass:"el-error-html-message",dangerouslyUseHTMLString:!0,message:e.msg,type:"error"})}})};return n((()=>{z()})),t({onConfirm:x}),{__sfc:!0,props:a,getPushConfigInfo:r,authType:i,getFtpList:l,vm:f,capFtpInfo:v,rules:y,capacityData:b,useSize:_,formDisabled:h,useSizeFun:C,init:z,onConfirm:x,isNumber:m}}}),(function(){var e=this,s=e._self._c,l=e._self._setupProxy;return s("div",{staticClass:"p-[2rem] container-dialog"},[s(a,{ref:"capFtpInfo",attrs:{model:l.capacityData,rules:l.rules,"label-width":"10rem"}},[s(r,{attrs:{label:e.$t("FtpContent.CurrentlyUseCapacity")}},[s(i,{staticClass:"!w-[22rem]",attrs:{readonly:""},scopedSlots:e._u([l.isNumber(l.useSize)?{key:"append",fn:function(){return[s("span",{staticClass:"text-gray-500"},[e._v("MB")])]},proxy:!0}:null],null,!0),model:{value:l.useSize,callback:function(e){l.useSize=e},expression:"useSize"}})],1),s(r,{attrs:{label:e.$t("FtpContent.CurrentCapacityQuota"),prop:"size"}},[s(i,{staticClass:"!w-[22rem]",attrs:{min:0,type:"number"},scopedSlots:e._u([{key:"append",fn:function(){return[s("span",{staticClass:"text-gray-500"},[e._v("MB")])]},proxy:!0}]),model:{value:l.capacityData.size,callback:function(s){e.$set(l.capacityData,"size",s)},expression:"capacityData.size"}})],1),s("div",{staticClass:"tip"},[s("ul",{staticClass:"mt-8x leading-10 list-disc ml-20x"},[s("li",{directives:[{name:"show",rawName:"v-show",value:"ltd"!==l.authType,expression:"authType !== 'ltd'"}],staticClass:"items-center leading-[2.4rem]"},[s("span",{staticClass:"text-danger"},[e._v("温馨提示：此功能为企业版专享功能")])]),s("li",{directives:[{name:"show",rawName:"v-show",value:l.capacityData.status,expression:"capacityData.status"}],staticClass:"items-center leading-[2.4rem]"},[e._v(" 点击配置后状态未更新，尝试点击【 "),s(t,{on:{click:l.getPushConfigInfo}},[e._v("手动刷新")]),e._v(" 】 ")],1),s("li",{staticClass:"items-center leading-[2.4rem]"},[s("span",{staticClass:"text-[#777]"},[e._v("需要XFS文件系统，且包含prjquota挂载参数才能使用")])]),s("li",{staticClass:"items-center leading-[2.4rem]"},[s("span",{staticClass:"text-[#777]"},[e._v("fstab配置示例：/dev/vdc1 /data xfs defaults,prjquota 0 0")])]),s("li",{staticClass:"items-center leading-[2.4rem]"},[s("span",{staticClass:"text-[#777]"},[e._v("配额容量：如需取消容量配额，请设为“0”")])])])])],1)],1)}),[],!1,null,"d8fb7df1",null,null).exports;export{f as default};
