import{_ as e}from"./index85.js?v=1714377894636";import{w as t,x as o,q as a,s as r}from"./element-lib.js?v=1714377894636";import{n as s,D as m,r as l}from"./main.js?v=1714377894636";import{e as n,b as i,v as c,h as p,j as u}from"./vue-lib.js?v=1714377894636";import{o as w}from"./confirm.js?v=1714377894636";import{eM as b,eN as h}from"./site.store.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./config.js?v=1714377894636";import"./check.js?v=1714377894636";const d=s(n({__name:"editCrontab",props:{compData:{default:{}}},setup(e,{expose:t}){const o=e,{proxy:a}=u(),r=i(o.compData.isEdit),s=i(),m=i(!1),l=c({cron_name:"",type:"week",week:"1",where1:"3",hour:"1",minute:"30",flock:!1,sBody:""}),n=c({cron_name:[{required:!0,message:"请输入计划任务名称",trigger:"blur"}]}),d=i(5);let y=i([{type:"day",text:"每天",showDay:!1,showHour:!0,showMinute:!0},{type:"day-n",text:"N天",showDay:!0,showHour:!0,showMinute:!0},{type:"hour",text:"每小时",showDay:!1,showHour:!1,showMinute:!0},{type:"hour-n",text:"N小时",showDay:!1,showHour:!0,showMinute:!0},{type:"minute-n",text:"N分钟",showDay:!1,showHour:!1,showMinute:!0},{type:"week",text:"每周",showDay:!1,showHour:!0,showMinute:!0},{type:"month",text:"每月",showDay:!0,showHour:!0,showMinute:!0}]);const f=e=>{w({$refs:s.value,loading:m,request:async()=>{let t,s={sitename:o.compData.sitename,...l,flock:l.flock?1:0};r.value?(s.id=o.compData.row.id,t=await b(s)):t=await h(s),a.$message.request(t),e(),o.compData.getCrontab()}})};return p((()=>{r.value=o.compData.isEdit,l.type=o.compData.row?o.compData.row.type:"week",l.week=o.compData.row?o.compData.row.where1:"1",l.where1=o.compData.row?o.compData.row.where1:"3",l.hour=o.compData.row?o.compData.row.where_hour:"1",l.minute=o.compData.row?o.compData.row.where_minute:"30",l.flock=!!o.compData.row&&!!o.compData.row.flock,l.sBody=o.compData.row?o.compData.row.sBody:"",l.cron_name=o.compData.row?o.compData.row.rname||o.compData.row.name:""})),t({onConfirm:f}),{__sfc:!0,props:o,vm:a,isEdit:r,crontabFormRef:s,formDisabled:m,crontabForm:l,crontabFormRules:n,cycleTime:d,timeType:y,handleTypeChange:(e,t=!1)=>{l.type=e,d.value=y.value.findIndex((t=>t.type===e)),"minute-n"===l.type&&(l.where1=l.minute),"hour-n"===l.type&&(l.where1=l.hour),s.value&&s.value.clearValidate()},onConfirm:f}}}),(function(){var s,n,i,c=this,p=c._self._c,u=c._self._setupProxy;return p(t,{ref:"crontabFormRef",staticClass:"p-2rem",attrs:{model:u.crontabForm,rules:u.crontabFormRules,disabled:u.formDisabled,"label-width":"80px"}},[p(o,{attrs:{label:"任务名称",prop:"cron_name"}},[p(e,{attrs:{placeholder:"请输入计划任务名称",width:"36rem"},model:{value:u.crontabForm.cron_name,callback:function(e){c.$set(u.crontabForm,"cron_name",e)},expression:"crontabForm.cron_name"}})],1),p(o,{attrs:{label:"执行周期"}},[p("div",{staticClass:"flex items-center"},[p(a,{staticClass:"w-[8rem] mr-4x",on:{change:function(e){return u.handleTypeChange(u.crontabForm.type,!0)}},model:{value:u.crontabForm.type,callback:function(e){c.$set(u.crontabForm,"type",e)},expression:"crontabForm.type"}},c._l(u.timeType,(function(e,t){return p(r,{key:t,attrs:{label:e.text,value:e.type}})})),1),"week"==u.crontabForm.type?p(o,{staticClass:"el-form-item-item"},[p(a,{staticClass:"ml-8x mr-4x !w-[8rem]",model:{value:u.crontabForm.week,callback:function(e){c.$set(u.crontabForm,"week",e)},expression:"crontabForm.week"}},[p(r,{attrs:{label:"周一",value:"1"}}),p(r,{attrs:{label:"周二",value:"2"}}),p(r,{attrs:{label:"周三",value:"3"}}),p(r,{attrs:{label:"周四",value:"4"}}),p(r,{attrs:{label:"周五",value:"5"}}),p(r,{attrs:{label:"周六",value:"6"}}),p(r,{attrs:{label:"周日",value:"7"}})],1)],1):c._e(),p(o,{staticClass:"el-form-item-item",attrs:{prop:"where1"}},[(null==(s=u.timeType[u.cycleTime])?void 0:s.showDay)?p(e,{staticClass:"mr-4x ml-8x",attrs:{min:1,width:"12rem",textType:"天",type:"number"},model:{value:u.crontabForm.where1,callback:function(e){c.$set(u.crontabForm,"where1",e)},expression:"crontabForm.where1"}}):c._e()],1),p(o,{staticClass:"el-form-item-item",attrs:{prop:"hour"}},[(null==(n=u.timeType[u.cycleTime])?void 0:n.showHour)?p(e,{staticClass:"mr-4x ml-8x",attrs:{width:"12rem",textType:"小时",max:"23",min:"0",type:"number"},model:{value:u.crontabForm.hour,callback:function(e){c.$set(u.crontabForm,"hour",e)},expression:"crontabForm.hour"}}):c._e()],1),p(o,{staticClass:"el-form-item-item",attrs:{prop:"minute"}},[(null==(i=u.timeType[u.cycleTime])?void 0:i.showMinute)?p(e,{staticClass:"mr-4x ml-8x",attrs:{width:"12rem",textType:"分钟",max:"59",min:"0",type:"number"},model:{value:u.crontabForm.minute,callback:function(e){c.$set(u.crontabForm,"minute",e)},expression:"crontabForm.minute"}}):c._e()],1)],1)]),p(o,{attrs:{label:" ","label-width":"0rem"}},[p("div",{staticClass:"flex items-center"},[p(m,{attrs:{disabled:u.isEdit},model:{value:u.crontabForm.flock,callback:function(e){c.$set(u.crontabForm,"flock",e)},expression:"crontabForm.flock"}},[c._v(" 开启进程锁")]),p(l,{attrs:{placement:"right-start",width:"440","popper-class":"white-tips-popover",trigger:"hover",content:""}},[p("div",{staticClass:"p-12x"},[p("span",{staticClass:"text-[#666]"},[c._v(" 在同一时间内只用一个进程在执行，若上一个进程未执行结束，下一次不执行 ")])]),p("i",{staticClass:"el-icon-question text-warning ml-12x",attrs:{slot:"reference"},slot:"reference"})])],1)]),p(o,{attrs:{label:"脚本内容",prop:"sBody"}},[p(e,{attrs:{width:"58rem",placeholder:"请输入脚本内容",type:"textarea",resize:"both",rows:10},model:{value:u.crontabForm.sBody,callback:function(e){c.$set(u.crontabForm,"sBody",e)},expression:"crontabForm.sBody"}})],1)],1)}),[],!1,null,"a338411f",null,null).exports;export{d as default};
