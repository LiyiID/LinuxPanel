import{_ as a}from"./index118.js?v=1714377894636";import{L as t,w as e,x as s,y as n,ab as i,u as o}from"./element-lib.js?v=1714377894636";import{n as r,q as l,b as c,o as p,ae as m,J as u,a as d}from"./main.js?v=1714377894636";import"./radio-button.js?v=1714377894636";import{_ as f}from"./index85.js?v=1714377894636";import{_ as b}from"./index39.js?v=1714377894636";import"./index45.js?v=1714377894636";import{_ as g}from"./index46.js?v=1714377894636";import{_ as v}from"./index59.js?v=1714377894636";import{e as h,b as y,v as k,h as x,j as _}from"./vue-lib.js?v=1714377894636";import{U as w,W as j}from"./site.popup.js?v=1714377894636";import{a1 as B,a2 as C,a3 as T,a4 as P,a5 as D,a6 as L,g as $,a7 as E,a8 as S}from"./site.store.js?v=1714377894636";import{c as F}from"./check.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{_ as q}from"./index52.js?v=1714377894636";import{_ as M}from"./index53.js?v=1714377894636";import{_ as A}from"./index77.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./index.vue_vue_type_style_index_0_lang.js?v=1714377894636";import"./index38.js?v=1714377894636";import"./element-ui.common.js?v=1714377894636";import"./date-util.js?v=1714377894636";import"./vdom.js?v=1714377894636";import"./index62.js?v=1714377894636";import"./cascader-panel.js?v=1714377894636";import"./index42.js?v=1714377894636";const z=r(h({__name:"IncrementBackView",props:{compData:{default:()=>[]},tableInnerBack:{type:Boolean,default:!1}},setup(a){const t=a,e=y(!1),s=y(!1),{proxy:n}=_(),i=y([]),o=k({path:t.compData.path,time:"30分钟"}),r={30:"30分钟",60:"1小时",1440:"1天"},l=y(!0),c=y([{text:"温馨提示：如果文件未发生改变，则不会触发增量备份"},{text:"增量备份第一次备份,会备份一个完整的备份用于恢复，之后的备份则仅备份修改的文件"}]),p=async a=>{try{await n.$confirm({title:"恢复数据",message:"恢复备份【".concat(a.name,"】到文件后，文件将被覆盖，是否继续操作？"),icon:"warning"});const t=await B({backup_file:a.name});n.$message.request(t)}catch(t){}},m=async a=>{try{const t=await C({backup_file:a.name});window.open("/download?filename="+t.data.msg)}catch(t){}},u=async a=>{try{await n.$confirm({width:50,title:"删除备份",message:"删除备份【".concat(a.name,"】后，备份文件将被删除，是否继续操作？"),icon:"warning"});const t=await T({backup_file:a.name});n.$message.request(t),await f()}catch(t){}},d=async()=>{try{const a=await P({src_folder:t.compData.path});s.value="1"===a.data.status||1===a.data.status,o.time=r[a.data.backup_interval],o.path=a.data.src_folder}catch(a){}},f=async()=>{try{await d();const a=await D({src_folder:t.compData.path}),e=F(a.data.value,"array",[]);i.value=e,l.value=!1}catch(a){}},b=w({restoreBackupEvent:p,downloadEvent:m,delInBackEvent:u});return x((async()=>{await f()})),{__sfc:!0,props:t,configurationPopup:e,incrementStatus:s,vm:n,incrementTableData:i,configForm:o,timeData:r,tableLoad:l,backupTipList:c,restoreBackupEvent:p,downloadEvent:m,delInBackEvent:u,getConfig:d,initEnBack:f,handleConfirm:async()=>{try{const a=await L({src_folder:o.path,status:1,backup_interval:Object.keys(r).find((a=>r[a]==o.time))});n.$message.request(a),e.value=!1,await d()}catch(a){}},changeStatus:async a=>{if(a)e.value=!0;else{await n.$confirm({title:"关闭增量文件备份",message:"关闭增量文件备份后，将会删除增量备份配置，是否继续操作？",icon:"warning"});try{const a=await L({src_folder:o.path,status:0,backup_interval:Object.keys(r).find((a=>r[a]==o.time))});n.$message.request(a),await d()}catch(t){}}},inBackTableColumn:b}}}),(function(){var o=this,r=o._self._c,p=o._self._setupProxy;return r("div",[r("div",[r(v,{scopedSlots:o._u([{key:"header-left",fn:function(){return[r("div",{staticClass:"flex items-center"},[r("div",{staticClass:"flex items-center"},[r("span",{staticClass:"mr-4x"},[o._v("启用增量文件备份")]),r(g,{on:{change:p.changeStatus},model:{value:p.incrementStatus,callback:function(a){p.incrementStatus=a},expression:"incrementStatus"}})],1),r(t,{attrs:{direction:"vertical"}}),r(l,{attrs:{type:"default"},on:{click:function(a){p.configurationPopup=!0}}},[o._v("增量备份配置")])],1)]},proxy:!0},{key:"header-right",fn:function(){},proxy:!0},{key:"content",fn:function(){return[r(b,{directives:[{name:"loading",rawName:"v-loading",value:p.tableLoad,expression:"tableLoad"}],ref:"incrementSiteTable",attrs:{height:"400",data:p.incrementTableData,column:p.inBackTableColumn,"element-loading-text":"正在加载列表，请稍后..."}})]},proxy:!0},{key:"footer-right",fn:function(){},proxy:!0},{key:"popup",fn:function(){return[r(c,{attrs:{title:"增量文件备份配置",visible:p.configurationPopup,area:48,showFooter:""},on:{"update:visible":function(a){p.configurationPopup=a},confirm:p.handleConfirm}},[r("div",{staticClass:"p-20x"},[r(e,{attrs:{model:p.configForm}},[r(s,{attrs:{label:"备份目录"}},[r(f,{attrs:{disabled:""},model:{value:p.configForm.path,callback:function(a){o.$set(p.configForm,"path",a)},expression:"configForm.path"}})],1),r(s,{attrs:{label:"备份时间"}},[r(n,{attrs:{size:"small"},model:{value:p.configForm.time,callback:function(a){o.$set(p.configForm,"time",a)},expression:"configForm.time"}},[r(i,{attrs:{label:"30分钟"}}),r(i,{attrs:{label:"1小时"}}),r(i,{attrs:{label:"1天"}})],1)],1)],1),r(a,{staticClass:"mt-16x ml-20x",attrs:{list:[{text:"温馨提示：如果文件未发生改变，则不会触发增量备份"}],listStyle:"disc"}})],1)])]},proxy:!0}])}),r(a,{staticClass:"mt-16x ml-20x",attrs:{list:p.backupTipList,listStyle:"disc"}})],1)])}),[],!1,null,"5efa0fc0",null,null).exports;const I=r(h({__name:"BackupView",props:{compData:{default:()=>[]}},setup(a){const t=a,{refs:{phpModulesTableParams:e,siteTabActive:s},getPhpModulesList:n,getModulesList:i}=$(),{proxy:o}=_(),r=y(0),l=y(!1),c=y("routeBackup"),d=y([]),f=y(!1),b=y(!1);let g=k({title:"备份数据库",password:"",file:""});const v=y([{label:"删除",value:"delete"}]),h=k({isRecurrence:!0,describe:{title:"批量删除备份",th:"文件名",message:"批量删除已选备份文件，是否继续？",propsValue:"filename"}}),{id:w,name:B}=t.compData,C=k({p:1,limit:10,search:w,type:0,table:"backup"}),T=a=>{window.open("/download?filename="+a.filename,"_self")},P=async(a,t=!1)=>{try{"boolean"!=typeof t&&(t=!1),t||await o.$confirm({width:"40rem",title:"删除备份",message:'<p>删除选中站点备份文件后，<span class="text-danger">该站点备份文件将永久消失</span>，是否继续？</p>',icon:"warning",useHtml:!0});const e=await E({id:a.id});return t||(o.$message.request(e),D()),await q(),0===d.value.length&&(C.p=1,q()),e}catch(e){}},D=()=>{"php"===s.value?n():i(s.value)},L=j({downBackEvent:T,delBackEvent:P}),q=async()=>{try{l.value=!0;const{data:a}=await m({...C}),t=F(a.data,"array",[]);d.value=t,r.value=u(a.page),l.value=!1}catch(a){}finally{l.value=!1}};return x((()=>{q()})),{__sfc:!0,props:t,phpModulesTableParams:e,siteTabActive:s,getPhpModulesList:n,getModulesList:i,vm:o,backTotal:r,tableLoading:l,tabActive:c,tableData:d,showBackupMysql:f,formDisabled:b,backupForm:g,batchGroup:v,batchConfig:h,id:w,name:B,tableParam:C,batchEvent:(a,t,e)=>P(t,!0),downBackEvent:T,delBackEvent:P,refreshTable:D,backTableColumn:L,pageChange:a=>{C.p=a,q()},sizeChange:a=>{C.limit=a,q()},routeBackupBtn:async()=>{let a=o.$load("正在备份站点...");try{const e=await S({id:t.compData.id});o.$message.request(e),a.close(),q(),D()}catch(e){}finally{a.close()}},tabChange:(a,t)=>{},beforeLeave:(a,t)=>{},onOpen:q,isRelease:p}}}),(function(){var a=this,t=a._self._c,e=a._self._setupProxy;return t("div",{staticClass:"p-20x h-full"},[t(A,{staticClass:"bt-tabs bt-tabs-card",attrs:{type:"card","before-leave":e.beforeLeave},on:{"tab-click":e.tabChange},model:{value:e.tabActive,callback:function(a){e.tabActive=a},expression:"tabActive"}},[t(o,{staticClass:"mt-4",attrs:{name:"routeBackup",label:"常规备份"}},[t(v,{scopedSlots:a._u([{key:"header-left",fn:function(){return[t(l,{attrs:{type:"primary"},on:{click:e.routeBackupBtn}},[a._v("备份站点")])]},proxy:!0},{key:"content",fn:function(){return[t(b,{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"routeBackup",attrs:{data:e.tableData,maxHeight:"408","element-loading-text":"正在加载中，请稍后...",column:e.backTableColumn},scopedSlots:a._u([{key:"empty",fn:function(){return[t("div",{staticClass:"flex items-center justify-center !text-[1.2rem]"},[a._v(" 您的列表为空，您可以 "),t(d,{on:{click:e.routeBackupBtn}},[a._v("备份当前站点")])],1)]},proxy:!0}])})]},proxy:!0},{key:"footer-left",fn:function(){return[t(M,{attrs:{data:e.batchGroup,config:e.batchConfig,"batch-fn":e.batchEvent},on:{"handle-complete":e.refreshTable}})]},proxy:!0},{key:"footer-right",fn:function(){return[t(q,{attrs:{total:e.backTotal,"current-page":e.tableParam.p,"page-size":e.tableParam.limit},on:{"update:currentPage":function(t){return a.$set(e.tableParam,"p",t)},"update:current-page":function(t){return a.$set(e.tableParam,"p",t)},"size-change":e.sizeChange,"current-change":e.pageChange}})]},proxy:!0}])})],1),e.isRelease?a._e():t(o,{staticClass:"mt-4",attrs:{name:"increment"}},[t("span",{attrs:{slot:"label"},slot:"label"},[a._v("增量备份")]),t(z,{attrs:{tableInnerBack:!0,compData:a.compData}})],1)],1)],1)}),[],!1,null,"908a5a8a",null,null).exports;export{I as default};
