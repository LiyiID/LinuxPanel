import{_ as e}from"./index57.js?v=1714377894636";import{_ as a}from"./date-picker.js?v=1714377894636";import{g as t,o as s,p as i,l as r,n as l,q as o,D as c,_ as n}from"./main.js?v=1714377894636";import{y as m,ab as p}from"./element-lib.js?v=1714377894636";import"./radio-button.js?v=1714377894636";import{_ as u}from"./index46.js?v=1714377894636";import{_ as g}from"./preload-helper.js?v=1714377894636";import{e as d,v as y,b as h,f as w,h as f,j as b}from"./vue-lib.js?v=1714377894636";import{c as _,a as v}from"./index33.js?v=1714377894636";import{g as x,H as j,I as k,J as V,K as C,L as S,M as T}from"./logs.table.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./date-util.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./index.vue_vue_type_style_index_0_lang.js?v=1714377894636";import"./index77.js?v=1714377894636";import"./index42.js?v=1714377894636";import"./index43.js?v=1714377894636";import"./check.js?v=1714377894636";import"./index52.js?v=1714377894636";import"./index39.js?v=1714377894636";import"./index58.js?v=1714377894636";import"./index45.js?v=1714377894636";import"./index59.js?v=1714377894636";const P=l(d({__name:"WebLogs",setup(e,{expose:a}){const{proxy:l}=b(),{refs:{clearForm:o,webSiteName:c,webSiteLogTabActive:n}}=x(),{refs:{authType:m,mainHeight:p}}=t(),u=y({ipArea:!1,typeValue:"运行",timeValue:"",searchValue:"",keywordSwitch:!1,keywordConfig:{}}),d=h(""),P={disabledDate:e=>e.getTime()>Date.now()},L=e=>{let a=[];switch(e){case"7":a=[(new Date).getTime()-6048e5,(new Date).getTime()];break;case"30":a=[(new Date).getTime()-2592e6,(new Date).getTime()];break;case"180":a=[(new Date).getTime()-15552e6,(new Date).getTime()]}return a},D=async()=>{r({title:"【".concat(c.value,"】关键字告警配置"),area:72,isAsync:!0,btn:"保存",compData:{config:u.keywordConfig,refreshEvent:O},component:()=>g((()=>import("./KeywordConfig.js?v=1714377894636")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]),import.meta.url)})},A=async()=>{const e=l.$load("正在加载数据中，请稍后....");try{let a={ip_area:u.ipArea?1:0,siteName:c.value,time_search:JSON.stringify(u.timeValue),search:u.searchValue};u.timeValue&&(u.timeValue[0]=new Date(u.timeValue[0]).setHours(0,0,0,0),u.timeValue[1]=new Date(u.timeValue[1]).setHours(23,59,59,0),a.time_search=JSON.stringify([u.timeValue[0]/1e3,u.timeValue[1]/1e3])),!u.searchValue&&delete a.search,!u.timeValue&&delete a.time_search;const t=await k(a);e.close(),d.value=t.msg?t.msg:"暂无数据"}catch(a){}finally{O(),e.close()}},N=async()=>{const e=l.$load("正在加载数据中，请稍后....");try{let a={siteName:c.value,time_search:JSON.stringify(u.timeValue),search:u.searchValue};!u.searchValue&&delete a.search,!u.timeValue&&delete a.time_search,u.timeValue&&(a.time_search=JSON.stringify([u.timeValue[0]/1e3,u.timeValue[1]/1e3]));const t=await V(a);e.close(),d.value=t.msg?t.msg:"暂无数据"}catch(a){}finally{e.close()}},W=()=>{"运行"===u.typeValue?(o.value.webSiteLogType="access",A()):(o.value.webSiteLogType="error",N())},O=async()=>{try{const{data:e}=await C({sitename:c.value});u.keywordConfig=e.config,u.keywordSwitch=e.status}catch(e){}};w((()=>c.value),(()=>{"WebLogs"===n.value&&A()})),w((()=>n.value),(()=>{"WebLogs"===n.value&&A()}));const $=()=>{W()};return f((()=>{A()})),a({cutTab:$}),{__sfc:!0,vm:l,clearForm:o,webSiteName:c,webSiteLogTabActive:n,authType:m,mainHeight:p,logParams:u,msg:d,pickerOptions:P,changeIpArea:e=>{if("ltd"!==m.value)return u.ipArea=!e,i({sourceId:136});A()},clearWebSite:()=>{_("清理相关日志可能会导致故障排查困难，请谨慎操作","website",(async(e,a)=>{let t=L(e);try{const e=await S({siteName:c.value,logType:a,time_search:JSON.stringify(t)});l.$message.request(e)}catch(s){}}))},outWebSite:()=>{v("website",(async(e,a)=>{let t=L(a);try{const a=await T({siteName:c.value,logType:e,time_search:JSON.stringify(t)});window.open("/download?filename="+a.msg)}catch(s){}}))},dateSwitch:L,onChangeKeyword:async e=>{let a=null;try{a=l.$load("正在设置关键字告警...");const t={sitename:c.value};e&&(t.cycle=u.keywordConfig.cycle,t.keys=JSON.stringify(u.keywordConfig.keys),t.channel=u.keywordConfig.channel);const{data:s}=await j(t);l.$message.request(s),s.status||(u.keywordSwitch=!e)}catch(t){u.keywordSwitch=!e}finally{0!==u.keywordConfig.keys.length&&""!==u.keywordConfig.channel||D(),a.close()}},setKeywordConfig:D,getSiteAccessLogsData:A,getSiteErrorLogsData:N,changeWebLogType:W,getKeywordAlarmData:O,cutTab:$,isRelease:s}}}),(function(){var t=this,s=t._self._c,i=t._self._setupProxy;return s("div",{staticClass:"pt-20x flex flex-col"},[s("div",{staticClass:"flex items-center justify-end mb-12x"},[s("div",{staticClass:"flex justify-between w-full"},[s("div",{staticClass:"flex items-center"},[s(o,{attrs:{type:"defalut"},on:{click:i.clearWebSite}},[t._v("清理日志")]),s(o,{staticClass:"!mr-12x",attrs:{type:"defalut"},on:{click:i.outWebSite}},[t._v("导出日志")]),i.isRelease?t._e():[s(u,{attrs:{width:36},on:{change:i.onChangeKeyword},model:{value:i.logParams.keywordSwitch,callback:function(e){t.$set(i.logParams,"keywordSwitch",e)},expression:"logParams.keywordSwitch"}}),s("span",{staticClass:"pl-[1rem] mr-12x"},[t._v("日志关键词告警"),s("span",{staticClass:"cursor-pointer text-primary",on:{click:i.setKeywordConfig}},[t._v("[配置]")])]),"运行"===i.logParams.typeValue?s(c,{staticClass:"pr-[2rem]",on:{change:i.changeIpArea},model:{value:i.logParams.ipArea,callback:function(e){t.$set(i.logParams,"ipArea",e)},expression:"logParams.ipArea"}},[s("span",{staticClass:"text-[1.2rem]"},[t._v("显示IP归属地信息")]),s(n,{staticClass:"align-bottom ml-4x",attrs:{src:"/vip/icon-sub-vip-ltd.svg"}})],1):t._e()]],2),s("div",{staticClass:"flex items-center"},[s(m,{staticClass:"mr-12x",attrs:{size:"mini"},on:{change:i.changeWebLogType},model:{value:i.logParams.typeValue,callback:function(e){t.$set(i.logParams,"typeValue",e)},expression:"logParams.typeValue"}},[s(p,{attrs:{label:"运行"}}),s(p,{attrs:{label:"异常"}})],1),s(a,{staticClass:"!w-[24rem]",attrs:{size:"mini","value-format":"timestamp",type:"daterange","range-separator":"-","picker-options":i.pickerOptions,"start-placeholder":"开始","end-placeholder":"结束"},on:{change:i.changeWebLogType},model:{value:i.logParams.timeValue,callback:function(e){t.$set(i.logParams,"timeValue",e)},expression:"logParams.timeValue"}}),s(e,{staticClass:"ml-12x",attrs:{placeholder:"请输入搜索关键字"},on:{clear:i.changeWebLogType,search:i.changeWebLogType},model:{value:i.logParams.searchValue,callback:function(e){t.$set(i.logParams,"searchValue",e)},expression:"logParams.searchValue"}})],1)])]),s("pre",{staticClass:"bt-logs-pre",style:{height:i.mainHeight-282+"px"},domProps:{innerHTML:t._s(i.msg)}})])}),[],!1,null,null,null,null).exports;export{P as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./KeywordConfig.js?v=1714377894636","./main.js?v=1714377894636","./modulepreload-polyfill.js?v=1714377894636","./vue-lib.js?v=1714377894636","./__commonjsHelpers__.js?v=1714377894636","./preload-helper.js?v=1714377894636","./request-lib.js?v=1714377894636","./locales-lib.js?v=1714377894636","./public-lib.js?v=1714377894636","./element-lib.js?v=1714377894636","./element-lib.js?v=1714377894636","./index40.js?v=1714377894636","./element-lib.js?v=1714377894636","./config.js?v=1714377894636","./index85.js?v=1714377894636","./element-lib.js?v=1714377894636","./confirm.js?v=1714377894636","./logs.table.js?v=1714377894636"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
