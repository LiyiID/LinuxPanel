import{_ as a}from"./index118.js?v=1714377894636";import{g as t,a as e,n as s,q as i,b as o}from"./main.js?v=1714377894636";import{_ as l}from"./index120.js?v=1714377894636";import{q as n,s as r}from"./element-lib.js?v=1714377894636";import{_ as c}from"./index53.js?v=1714377894636";import{_ as d}from"./index39.js?v=1714377894636";import{_ as p}from"./index59.js?v=1714377894636";import{_ as m}from"./index85.js?v=1714377894636";import{e as u,b as f,v,H as h,h as g,j as x}from"./vue-lib.js?v=1714377894636";import{a as b}from"./confirm.js?v=1714377894636";import{bL as y,bM as w,bN as j,bO as _,al as C,bP as k,ai as D}from"./site.store.js?v=1714377894636";import{r as V}from"./site.popup.js?v=1714377894636";import{e as L}from"./index38.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./config.js?v=1714377894636";import"./check.js?v=1714377894636";import"./element-ui.common.js?v=1714377894636";import"./date-util.js?v=1714377894636";import"./vdom.js?v=1714377894636";import"./index62.js?v=1714377894636";import"./cascader-panel.js?v=1714377894636";import"./index45.js?v=1714377894636";const S=s(u({__name:"SubdirectoryBind",props:{compData:{default:()=>({})}},setup(a){const s=a,{proxy:i}=x(),{refs:{webServerType:o}}=t(),l=f(""),n=f([]),r=f(""),c=f([]),d=f(!1),p=f(""),m=f(""),u=f([]),S=f(""),P=f(!1),T=f([{text:"请选择您的应用，若设置伪静态后，网站无法正常访问，请尝试设置回default"},{text:"您可以对伪静态规则进行修改，修改完后保存即可。"}]),$=f({mode:"ace/mode/nginx",theme:"ace/theme/chrome",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!1,fontSize:"12px"}),q=f([]),N=f(!1),E=f([{label:"删除",value:"delete",diyBatch:async()=>{b({confirm:{title:"批量删除",message:"批量删除，该操作可能会存在风险，是否继续？",icon:"warning"},loading:"正在删除，请稍后...",request:async()=>{let a=[c.value.map((a=>a.id))];const t=await y({bind_ids:a,id:s.compData.id});let e=[];await t.success.forEach((a=>{e.push({name:a,msg:"删除成功",status:!0})})),await Object.keys(t.error).forEach((a=>{e.push({name:a,msg:t.data.error[a],status:!1})})),await V({resultData:e,resultTitle:"删除",resultColumn:[{label:"域名",prop:"name"},{label:"结果",render:a=>h("span",{class:a.status?"text-primary":"text-danger"},a.status?a.msg||"操作成功":a.msg||"操作失败")}]}),M()}})}}]),H=v({isRecurrence:!1,describe:{title:"批量删除脚本",th:"脚本",message:"批量删除后脚本信息将无法恢复，是否继续？",propsValue:"name"}}),M=async()=>{N.value=!0;try{const a=await w({id:s.compData.id});n.value=a.data.dirs,r.value=a.data.dirs[0],q.value=a.data.binding,N.value=!1}catch(a){}},O=async a=>{b({confirm:{title:"删除【".concat(a.domain,"】"),message:"删除选中的子目录绑定后，将无法访问该子目录绑定的域名，是否继续操作？",icon:"warning"},loading:"正在删除，请稍后...",request:async()=>await _({id:a.id}),complete:M})},R=async a=>{let t=i.$load("正在获取伪静态内容，请稍候..."),e={id:a.id};a.add&&(e.add=1);try{const s=await k(e);t.close(),s.data.status?(p.value=s.data.data,u.value=s.data.rlist,m.value=s.data.rlist[0],S.value=s.data.filename,d.value=!0):(await i.$confirm({title:"创建伪静态",icon:"warning",message:"你真的要为这个子目录创建独立的伪静态规则吗？"}),R({...a,add:1}))}catch(s){}finally{t.close()}},z=f([{type:"selection"},{prop:"domain",label:"域名",render:a=>h(e,{on:{click:()=>{window.open("http://".concat(a.domain,":").concat(a.port))}}},[a.domain])},{prop:"port",label:"端口"},{width:220,label:"子目录",render:a=>h("span",{domProps:{innerHTML:a.path}},[])},L([{onClick:R,title:"伪静态"},{onClick:O,title:"删除"}])]);return g((async()=>{M()})),{__sfc:!0,vm:i,props:s,webServerType:o,domainValue:l,pathData:n,pathValue:r,checkedList:c,staticPopup:d,staticContent:p,textValue:m,optionData:u,staticPath:S,textLoading:P,helpList:T,config:$,tableData:q,tableLoading:N,batchGroup:E,batchConfig:H,handleSelect:a=>{c.value=a},getSubdirectiry:M,addPath:async()=>{if(!r.value||!l.value)return void i.$message.error("域名和子目录都不可为空！");let a=i.$load("正在添加子目录中,清稍后...");try{const t=await j({id:s.compData.id,domain:l.value,dirName:r.value});l.value="",a.close(),i.$message.request(t),M()}catch(t){}finally{a.close()}},delEvent:O,saveData:async()=>{let a=i.$load("正在保存伪静态内容，请稍候...");try{const a=await C({data:p.value,encoding:"utf-8",path:S.value});i.$message.msg({dangerouslyUseHTMLString:!0,message:a.msg,type:a.status?"success":"error",duration:a.status?2e3:0,showClose:!a.status})}catch(t){}finally{a.close()}},getDirRewriteEvent:R,handleChange:async a=>{try{P.value=!0;const{data:t}=await D({path:"/www/server/panel/rewrite/".concat(o.value,"/").concat(a,".conf")});p.value=t.data,P.value=!1}catch(t){}finally{P.value=!1}},tableColumns:z}}}),(function(){var t=this,s=t._self._c,u=t._self._setupProxy;return s("div",[s("div",{staticClass:"flex items-center"},[s("div",{staticClass:"flex items-center mr-16x"},[s("span",{staticClass:"mr-16x"},[t._v("域名")]),s(m,{attrs:{placeholder:"请输入域名"},model:{value:u.domainValue,callback:function(a){u.domainValue=a},expression:"domainValue"}})],1),s("div",{staticClass:"flex items-center mr-16x"},[s("span",{staticClass:"mr-16x"},[t._v("子目录")]),s(n,{attrs:{filterable:""},model:{value:u.pathValue,callback:function(a){u.pathValue=a},expression:"pathValue"}},t._l(u.pathData,(function(a,t){return s(r,{key:t,attrs:{value:a,label:a}})})),1)],1),s(i,{on:{click:u.addPath}},[t._v("添加")])],1),s(p,{scopedSlots:t._u([{key:"header-left",fn:function(){},proxy:!0},{key:"header-right",fn:function(){},proxy:!0},{key:"content",fn:function(){return[s(d,{directives:[{name:"loading",rawName:"v-loading",value:u.tableLoading,expression:"tableLoading"}],attrs:{"max-height":"500",column:u.tableColumns,data:u.tableData},on:{"selection-change":u.handleSelect}})]},proxy:!0},{key:"footer-left",fn:function(){return[s(c,{staticClass:"mt-12x",attrs:{data:u.batchGroup,config:u.batchConfig,"batch-fn":()=>{}}})]},proxy:!0},{key:"footer-right",fn:function(){},proxy:!0},{key:"popup",fn:function(){return[s(o,{attrs:{title:"伪静态规则",visible:u.staticPopup,area:50},on:{"update:visible":function(a){u.staticPopup=a}}},[s("div",{staticClass:"p-20x"},[s("div",{staticClass:"flex items-center justify-between"},[s(n,{on:{change:u.handleChange},model:{value:u.textValue,callback:function(a){u.textValue=a},expression:"textValue"}},t._l(u.optionData,(function(a,t){return s(r,{key:t,attrs:{value:a,label:a}})})),1),s("span",{staticClass:"flex items-center"},[t._v("规则转换工具： "),s(e,{attrs:{href:"https://www.bt.cn/Tools"}},[t._v("Apache转Nginx "),s("i",{staticClass:"el-icon-paperclip"})])],1)],1),s(l,{directives:[{name:"loading",rawName:"v-loading",value:u.textLoading,expression:"textLoading"}],staticClass:"!h-[40rem] !w-full my-12x",attrs:{id:"statictRef",config:u.config},model:{value:u.staticContent,callback:function(a){u.staticContent=a},expression:"staticContent"}}),s("div",[s(i,{on:{click:u.saveData}},[t._v("保存")])],1),s(a,{staticClass:"ml-20x mt-20x",attrs:{list:u.helpList,"list-style":"disc"}})],1)])]},proxy:!0}])})],1)}),[],!1,null,"afa54a03",null,null).exports;export{S as default};
