import{g as e,o as a,c as t,aS as s,n as l,q as o,r as i,D as r,a as n,b as p}from"./main.js?v=1714377894636";import{q as m,s as c,w as u,x as d,z as g}from"./element-lib.js?v=1714377894636";import{_ as v}from"./index85.js?v=1714377894636";import{_ as f}from"./index135.js?v=1714377894636";import{e as y,v as h,b as _,h as x,i as b,j as w}from"./vue-lib.js?v=1714377894636";import{a as j}from"./confirm.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{g as F,dP as D,dQ as C,dR as $,dS as k,dT as z,bc as P,dU as L}from"./site.store.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./config.js?v=1714377894636";import"./check.js?v=1714377894636";const S=l(y({__name:"ProjectLogs",props:{compData:{default:{}}},setup(l){const o=l,{refs:{mainHeight:i,mainWidth:r}}=e(),{refs:{siteInfo:n}}=F(),p=h({type:"0",hour:2,minute:0,num:180,log_size:0,compress:!1}),m=_(!1),c=_(!1),{proxy:u}=w(),d=_(""),g=h({path:"",logs:"",type:"",split:!1,size:"",isNew:!1,isGunicorn:!1}),v=_("开启后默认每天2点0分进行切割日志文件，如需修改请点击"),f=_(null),y=_(!1),S=_({num:[{required:!0,message:"请输入保留最新份数",trigger:"blur"},{validator:(e,a,t)=>{/^(?:[1-9]\d{0,2}|1[01]\d{2}|1800)$/.test(a)?t():t(new Error("请输入1-1800的整数"))}}],log_size:[{required:!0,message:"请输入日志大小",trigger:["blur","change"]},{validator:(e,a,t)=>{!/^\d+(\.\d+)?$/.test(a)||a<=0?t(new Error("请输入大于0的数")):t()}}]}),N=async()=>{var e,a,t;y.value=!0;try{let s;s="python"===d.value?await D({data:JSON.stringify({name:o.compData.name})}):await C({data:JSON.stringify({project_name:o.compData.name})},d.value);let l=null==(e=n.value.project_config)?void 0:e.log_path;g.logs=s.data.data||"暂无日志信息",g.path=s.data.path||l||"",g.size=(null==(a=s.data)?void 0:a.szie)||(null==(t=s.data)?void 0:t.size)||"0B"}catch(s){}finally{y.value=!1}},T=async()=>{y.value=!0;let e={name:o.compData.name};"python"!==d.value&&("net"===d.value&&(e.project_name=o.compData.name,delete e.name),e.data=JSON.stringify(e),delete e.name);try{const a=await $(e,d.value);a.data.status?(g.isNew=!1,g.split=!!a.data.data.status,p.hour=a.data.data.hour,p.minute=a.data.data.minute,p.num=a.data.data.num,p.compress=a.data.data.compress,p.log_size=t(a.data.data.log_size,!1,2,"MB"),p.type=a.data.data.log_size?"1":"0",v.value="开启后".concat("1"===p.type?"日志文件大小超过":"默认每天").concat("1"===p.type?p.log_size+"MB":"".concat(p.hour,"点").concat(p.minute,"分"),"进行切割日志文件，如需修改请点击")):(g.isNew=!0,g.split=!1)}catch(a){}finally{y.value=!1}},R=()=>{c.value=!1,u.$refs.pushFormRef.resetFields(),u.$refs.pushFormRef.clearValidate()};return x((async()=>{var e,a,t;let s=null==(e=o.compData.project_type)?void 0:e.toLowerCase();"node"===s&&(s="nodejs"),d.value=s,g.type=(null==(a=o.compData.project_config)?void 0:a.loglevel)||"",g.isGunicorn="gunicorn"===(null==(t=o.compData.project_config)?void 0:t.stype),N(),T()})),b((()=>{clearInterval(f.value)})),{__sfc:!0,props:o,mainHeight:i,mainWidth:r,siteInfo:n,splitForm:p,fullLogPopup:m,logTaskPopup:c,vm:u,logType:d,logData:g,tips:v,realTimer:f,viewLoading:y,rules:S,getLogsInfo:N,getInfo:async()=>{},getLogsSplit:T,changeSplit:async e=>{g.split=!e,j({confirm:{icon:"warning",title:"设置日志切割任务",message:(e?"开启后":"关闭后停止")+"对该项目日志进行切割，是否继续操作？"},loading:"正在设置，请稍后...",request:async()=>g.isNew?await k({data:JSON.stringify({name:o.compData.name})},d.value):await z({data:JSON.stringify({name:o.compData.name})},d.value),async complete(){await T(),await N()}})},onCancelPopup:R,savePath:async()=>{let e=u.$load("正在保存日志配置，请稍后...");try{let e;e="python"===d.value?await P({data:JSON.stringify({name:o.compData.name,data:{path:g.path,loglevel:g.type}})}):await L({data:JSON.stringify({project_name:o.compData.name,path:g.path})},d.value),n.value.project_config.log_path=g.path,u.$message.request(e),N()}catch(a){}finally{e.close()}},onPathChange:()=>{s({type:"dir",path:g.path,change:e=>{g.path=e}})},openRealTimeLogs:()=>{m.value=!0,f.value=setInterval((()=>{N()}),2e3)},cancelRealLogs:()=>{m.value=!1,clearInterval(f.value)},openConfig:()=>{c.value=!0},onConfirmPopup:async()=>{u.$refs.pushFormRef.validate((async e=>{if(!e)return;if("1"===p.type&&p.log_size<=0)return void u.$message.error("日志大小必须大于0");let a=u.$load("正在保存配置，请稍后...");try{let e=Object.assign({},p);e.name=o.compData.name,"0"===e.type&&(e.log_size=0),e.hour=e.hour.toString(),e.minute=e.minute.toString(),e.num=e.num.toString(),delete e.type,g.split||await z({data:JSON.stringify({name:o.compData.name})},d.value);const a=await k({data:JSON.stringify(e)},d.value);u.$message.request(a),T(),R()}catch(t){}finally{a.close(),c.value=!1,R()}}))},isRelease:a}}}),(function(){var e=this,a=e._self._c,t=e._self._setupProxy;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.viewLoading,expression:"viewLoading"}],staticClass:"flex flex-col"},[a("div",{staticClass:"flex items-center"},[t.logData.isGunicorn?a("div",[a("span",[e._v("日志级别")]),a(m,{staticClass:"mx-8x w-[10rem]",model:{value:t.logData.type,callback:function(a){e.$set(t.logData,"type",a)},expression:"logData.type"}},[a(c,{attrs:{label:"debug",value:"debug"}}),a(c,{attrs:{label:"info",value:"info"}}),a(c,{attrs:{label:"warning",value:"warning"}}),a(c,{attrs:{label:"error",value:"error"}}),a(c,{attrs:{label:"critical",value:"critical"}})],1)],1):e._e(),a("span",[e._v("日志路径")]),a(v,{staticClass:"mx-8x",attrs:{width:"38rem","icon-type":"folder"},on:{folder:t.onPathChange},model:{value:t.logData.path,callback:function(a){e.$set(t.logData,"path",a)},expression:"logData.path"}}),a(o,{on:{click:t.savePath}},[e._v("保存")])],1),a("div",{staticClass:"mt-16x flex items-center"},[a("span",{staticClass:"mr-8x"},[e._v("日志大小")]),a("span",[e._v(e._s(t.logData.size))])]),a("div",{staticClass:"mt-16x flex items-center"},[a(i,{attrs:{placement:"bottom",width:"200","popper-class":"green-tips-popover",trigger:"hover"}},[a("span",{staticClass:"p-8x inline-block"},[e._v("当日志文件过大时，读取和搜索时间会增加，同时也会占用存储空间，因此需要对日志进行切割以方便管理和维护。")]),a(r,{attrs:{slot:"reference",size:"small"},on:{change:t.changeSplit},slot:"reference",model:{value:t.logData.split,callback:function(a){e.$set(t.logData,"split",a)},expression:"logData.split"}},[e._v("日志切割")])],1),a("span",{staticClass:"ml-8x"},[e._v(e._s(t.tips)),a(n,{on:{click:t.openConfig}},[e._v("编辑配置")])],1)],1),"java"===t.logType?a("ul",{staticClass:"mt-16x leading-8 text-[1.2rem] list-disc ml-20x"},[a("li",[e._v("修改日志路径会重启项目")]),a("li",[e._v("Tomcat内置项目，修改日志路径会对当前版本Tomcat的所有站点生效，不能单独设置")])]):e._e(),a("div",{staticClass:"mt-16x"},["java"===t.logType?a("div",[a(o,{on:{click:t.getLogsInfo}},[e._v("刷新日志")]),a(o,{attrs:{type:"default"},on:{click:t.openRealTimeLogs}},[e._v("实时日志")])],1):e._e(),a(f,{staticClass:"mt-16x",style:{height:"java"===t.logType?"46rem":"58rem",width:"99.5%"},attrs:{title:"全屏查看【项目】日志",content:t.logData.logs,isHtml:!0,refresh:t.getLogsInfo}})],1),a(p,{attrs:{title:"查看日志",visible:t.fullLogPopup,area:["100%","100%"],"close-btn":1},on:{cancel:t.cancelRealLogs,"update:visible":function(e){t.fullLogPopup=e}}},[a("div",{staticClass:"bg-[#333] text-white overflow-auto w-full h-full",style:"height: ".concat(t.mainHeight,"px;")},[a("pre",{staticClass:"p-12x",domProps:{innerHTML:e._s(t.logData.logs)}})])]),a(p,{attrs:{title:"配置日志切割任务",visible:t.logTaskPopup,area:50,showFooter:""},on:{confirm:t.onConfirmPopup,cancel:t.onCancelPopup,"update:visible":function(e){t.logTaskPopup=e}}},[a("div",{staticClass:"p-20x"},[a(u,{ref:"pushFormRef",attrs:{model:t.splitForm,rules:t.rules}},[a(d,{attrs:{label:"切割方式"}},[a(g,{attrs:{label:"1"},model:{value:t.splitForm.type,callback:function(a){e.$set(t.splitForm,"type",a)},expression:"splitForm.type"}},[e._v("按日志大小")]),a(g,{attrs:{label:"0"},model:{value:t.splitForm.type,callback:function(a){e.$set(t.splitForm,"type",a)},expression:"splitForm.type"}},[e._v("按执行周期")])],1),"0"==t.splitForm.type?a(d,{attrs:{label:"执行时间"}},[a("div",{staticClass:"flex items-center"},[a(v,{attrs:{"prepend-text":"每天",type:"number",width:"18.6rem","text-type":"时"},model:{value:t.splitForm.hour,callback:function(a){e.$set(t.splitForm,"hour",a)},expression:"splitForm.hour"}}),a(v,{attrs:{type:"number",width:"12rem","text-type":"分"},model:{value:t.splitForm.minute,callback:function(a){e.$set(t.splitForm,"minute",a)},expression:"splitForm.minute"}})],1)]):e._e(),"1"==t.splitForm.type?a(d,{attrs:{label:"日志大小",prop:"log_size"}},[a(v,{attrs:{type:"number",width:"16rem","text-type":"MB"},model:{value:t.splitForm.log_size,callback:function(a){e.$set(t.splitForm,"log_size",a)},expression:"splitForm.log_size"}})],1):e._e(),a(d,{attrs:{label:"保留最新",prop:"num"}},[a(v,{attrs:{type:"number","text-type":"份",min:1},model:{value:t.splitForm.num,callback:function(a){e.$set(t.splitForm,"num",a)},expression:"splitForm.num"}})],1),t.isRelease?e._e():a(d,{attrs:{label:" "}},[a(r,{model:{value:t.splitForm.compress,callback:function(a){e.$set(t.splitForm,"compress",a)},expression:"splitForm.compress"}},[e._v("切割后压缩日志")])],1)],1),a("ul",{staticClass:"mt-8x leading-8 text-[1.2rem] list-disc ml-20x"},[a("li",{directives:[{name:"show",rawName:"v-show",value:"1"===t.splitForm.type,expression:"splitForm.type === '1'"}]},[e._v("每5分钟执行一次")]),a("li",{directives:[{name:"show",rawName:"v-show",value:"1"===t.splitForm.type,expression:"splitForm.type === '1'"}]},[e._v(" 【日志大小】：日志文件大小超过指定大小时进行切割日志文件 ")]),a("li",[e._v("【保留最新】：保留最新的日志文件，超过指定数量时，将自动删除旧的日志文件")])])],1)])],1)}),[],!1,null,"0f314faf",null,null).exports;export{S as default};
