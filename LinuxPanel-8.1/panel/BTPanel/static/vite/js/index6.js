import{bB as e,n as t,q as l,g as a,bC as i,m as r,f as s,be as n}from"./main.js?v=1714377894636";import{_ as c}from"./index39.js?v=1714377894636";import{_ as o}from"./index57.js?v=1714377894636";import{_ as u}from"./index85.js?v=1714377894636";import{e as p,b as v,j as f,c as d,x as m,H as h,h as y}from"./vue-lib.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./element-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";const x=t(p({__name:"CreateFile",props:{type:{default:"Dir"},path:null,filelist:null},emits:["createStatus"],setup(t,{emit:l}){const a=t,{proxy:i}=f();let r=v("");const s=v(),n=(e=!1)=>{l("createStatus",e)};return{__sfc:!0,vm:i,emit:l,props:a,fileName:r,createfile:s,createContent:async()=>{const t=s.value;if(!r.value)return void i.$message.error("".concat("Dir"===a.type?"文件夹":"文件","名称不能为空"));const{data:l}=await e({type:a.type,path:a.path.value+"/"+r.value});l.status?n():(i.$message.error(l.msg),t.$el.querySelector("input").focus())},cancelCreate:n,handleInput:e=>{r.value=e,/(\\|\/|\<|\>|\"|\&|\;)/g.test(e)&&(i.$message.error('名称不能含有 /\\<>"&;符号'),r.value=e.replace(/(\\|\/|\<|\>|\"|\&|\;)/g,""))}}}}),(function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("div",{staticClass:"create-file-view flex"},[t("div",{staticClass:"flex",class:"".concat("Dir"===e.type?"bt-open-dir folder-open-icon":"bt-open-dir file-text-icon")},[t("i",{staticClass:"icon"}),t("div",{staticClass:"flex-1 flex items-center"},[t(u,{directives:[{name:"focus",rawName:"v-focus"}],ref:"createfile",staticClass:"w-[22rem] mr-[1.6rem]",attrs:{clearable:""},on:{input:a.handleInput},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.target.blur()}},model:{value:a.fileName,callback:function(e){a.fileName=e},expression:"fileName"}}),t(l,{staticClass:"mr-[.8rem]",on:{click:a.createContent}},[e._v("创建")]),t(l,{attrs:{type:"default"},on:{click:function(e){return a.cancelCreate(!0)}}},[e._v("取消")])],1)])])}),[],!1,null,"0ddc6215",null,null).exports;const C=t(p({__name:"index",props:{compData:{default:()=>({type:"all",path:"/www/wwwroot",change:()=>{}})}},setup(e){const t=e,{proxy:l}=f(),c=v(),o=v(),u=v(0),p=v(0),{type:C,path:g,change:b}=t.compData,{refs:{sitePath:k,fileSelectionPath:_}}=a(),w=v(l.$t("backUp")),S=v(l.$t("refresh")),P=v(),$=v(C||"all"),j=v(!1),D=v(!0),T=v(!1),I=v(g||k),R=v(""),F=v([]),B=v([]),E=v([]),L=v(""),N=v(),A=v(),H=d((()=>"file"===$.value?"文件":"dir"===$.value?"文件夹":"文件/文件夹"));m(o,(e=>{const t=null==e?void 0:e[0],{width:l}=t.contentRect;u.value=l})),m(c,(e=>{const t=null==e?void 0:e[0],{width:l}=t.contentRect;p.value=l,p.value>u.value&&(B.value=F.value.slice(-4))}));const M=v([{label:"名称",prop:"name",showOverflowTooltip:!1,render:e=>e.create&&O?h(x,{attrs:{type:e.type,path:I,filelist:A},on:{createStatus:e=>{q(e)}}}):h("span",{class:"dir"===e.type?"bt-open-dir folder-open-icon":"bt-open-dir file-text-icon"},[h("i",{class:"icon"}),h("span",{on:{click:t=>{"dir"===e.type&&W(e,t)}},attrs:{title:e.title}},[e.name])])},{label:"修改时间",width:140,prop:"mtime"},{label:"权限/所有者",width:125,prop:"accept"}]);let O=v(!1);const q=e=>{var t;O.value=!1,e?null==(t=A.value)||t.shift():J()},J=async e=>{var t;j.value=!0;try{const a=await i({path:I.value,disk:!0,search:e?L.value:""});if(N.value&&(N.value.path=I.value,N.value.title=null==(t=I.value)?void 0:t.split("/")[I.value.split("/").length-1],N.value.type="dir"),r(a.status,"boolean"))return N.value=void 0,l.$message.request(a),!1;const{DIR:s,FILES:n,DISK:c,PATH:o}=a;U(o),E.value=c,A.value=[...z(s,"dir"),...z(n)],K()}catch(a){}finally{j.value=!1}},U=e=>{let t="";if(I.value=e,F.value=[],"/"===e)return F.value.push({title:l.$t("directory"),path:"/",type:"dir"}),void(B.value=F.value);e.split("/").forEach(((e,a)=>{t+="".concat(1===a?"":"/").concat(e),F.value.push({title:""===e&&0==a?l.$t("directory"):e,path:t,type:"dir"})})),B.value=F.value},z=(e,t)=>{let l=[];return e.forEach((e=>{const a=e.split(";");let i=null==a?void 0:a[0];i.length>30&&(i=i.slice(0,30)+"..."),/[\u4E00-\u9FA5\uF900-\uFA2D]/.test(i)&&i.length>20&&(i=i.slice(0,20)+"..."),l.push({title:null==a?void 0:a[0],name:i,mtime:s(1e3*a[2],"yyyy/MM/dd HH:mm:ss"),accept:"".concat(a[3]," / ").concat(a[4]),type:t||"file",path:I.value+"/"+(null==a?void 0:a[0])})})),l},W=(e,t)=>{"dir"!==e.type||e.create||(I.value=e.path,J(),t.stopPropagation&&t.stopPropagation())},K=()=>{"file"==$.value&&(N.value=void 0,T.value=!1),O.value=!1},G=async()=>{await J(),"file"!=$.value&&(N.value=F.value[F.value.length-1],T.value=!0)},Q=()=>{l.$emit("open"),G()};return y((()=>{Q()})),{__sfc:!0,vm:l,props:t,pathUl:c,pathInput:o,inputWidth:u,ulWidth:p,type:C,currentPath:g,change:b,sitePath:k,fileSelectionPath:_,tBack:w,tRefresh:S,fileSelectorTable:P,pathType:$,loading:j,isTagMode:D,isAction:T,filePath:I,temporaryPath:R,pathList:F,showPathList:B,diskList:E,fileSerachText:L,fileSelectedItem:N,fileSelectorData:A,selectType:H,fileSelectorColumn:M,arraySpanMethod:({row:e,column:t,rowIndex:l,columnIndex:a})=>{if(0===l&&e.create&&O)return[1,3]},goBack:()=>{var e;1!==F.value.length&&(I.value=(null==(e=F.value[F.value.length-2])?void 0:e.path)||"/",J())},temporaryFocus:()=>{D.value=!1,R.value=I.value},temporaryBlur:()=>{D.value=!0,R.value=""},temporaryEnter:e=>{var t;let l=null==(t=e.target)?void 0:t.value;l=l.replace(/\/+/g,"/"),"/"!==l&&(l=l.replace(/\/+$/g,"")),l!==R.value&&(I.value=l,J()),e.target.blur()},filePathJump:e=>{I.value!==e&&(I.value=e,J())},fileSearch:e=>{e||(e=""),L.value=e,J(!0)},isCreateStatus:O,createDiskStructure:e=>{var t;if(O.value)return!1;O.value=!0,null==(t=A.value)||t.unshift({title:"",name:"",mtime:"",accept:"",type:e,path:"",create:!0})},cancelCreateStatus:q,diskPathJump:e=>{I.value=e,J()},getDirList:J,fileNavHead:U,fileRegroup:z,handleCurrentChange:e=>{if(e&&!e.create){if("all"==$.value)N.value=e;else{if("dir"===$.value&&"dir"!==(null==e?void 0:e.type))return n(P.value).setCurrentRow(),l.$message.error("请选择文件夹，否则将无法选择");if("file"===$.value&&"file"!==(null==e?void 0:e.type))return n(P.value).setCurrentRow();N.value=e}T.value=!0}},handleRowDBClick:W,selectorTypeEstimate:K,createRefresh:()=>{J()},onConfirm:()=>{var e,t,a;b&&b(null==(e=N.value)?void 0:e.path,null==(t=N.value)?void 0:t.type),_.value=(null==(a=N.value)?void 0:a.path)||I.value,l.$emit("close")},init:G,onOpen:Q}}}),(function(){var e,t=this,a=t._self._c,i=t._self._setupProxy;return a("section",[a("div",{staticClass:"text-black text-1.4rem pl-16x pt-16x"},[t._v("选择"+t._s(i.selectType))]),a("div",{staticClass:"p-16x flex justify-between"},[a("div",{staticClass:"file-selector-head"},[a("i",{staticClass:"bt-open-icon el-icon-back",attrs:{title:i.tBack},on:{click:i.goBack}}),a("div",{ref:"pathInput",staticClass:"file-selector-input overflow-hidden"},[i.isTagMode?a("ul",{ref:"pathUl",staticClass:"absolute h-[2.8rem] z-1 flex"},t._l(i.showPathList,(function(e,l){return a("li",{key:l,staticClass:"flex h-full items-center px-4x",on:{click:function(t){return i.filePathJump(e.path)}}},[a("span",{staticClass:"truncate max-w-[8rem]"},[t._v(t._s(e.title))]),a("i",{staticClass:"el-icon-arrow-right ml-4x"})])})),0):t._e(),a(u,{attrs:{width:"40rem",value:i.temporaryPath},on:{focus:i.temporaryFocus,blur:i.temporaryBlur},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:i.temporaryEnter(e)}}})],1),a("i",{staticClass:"bt-open-icon el-icon-refresh-right",attrs:{title:i.tRefresh},on:{click:function(e){return i.getDirList()}}})]),a(o,{attrs:{placeholder:t.$t("fileSearchPlaceholder"),width:"20rem"},on:{clear:i.fileSearch,search:i.fileSearch},model:{value:i.fileSerachText,callback:function(e){i.fileSerachText=e},expression:"fileSerachText"}})],1),a("div",{staticClass:"ml-16x h-[2.6rem]"},[a("span",{staticClass:"mr-8x create-file-btn",on:{click:function(e){return i.createDiskStructure("File")}}},[t._v(t._s(t.$t("newFile")))]),a("span",{staticClass:"create-file-btn",on:{click:function(e){return i.createDiskStructure("Dir")}}},[t._v(t._s(t.$t("newFolder")))])]),a("div",{staticClass:"flex flex-e h-[48rem] file-selector-main"},[a("div",{staticClass:"w-[16rem] h-full pt-12x text-xl inline-block overflow-auto disk-list"},[a("ul",{staticClass:"flex items-center flex-col"},t._l(i.diskList,(function(e,l){return a("li",{key:l,staticClass:"flex p-8x pl-16x items-center w-full",on:{click:function(t){return i.diskPathJump(e.path)}}},[a("i",{staticClass:"file-disk-icon mr-8x text-2xl"}),a("span",{staticClass:"w-full truncate",attrs:{title:"/"===e.path?"".concat(t.$t("directory")):e.path}},[t._v(t._s("/"===e.path?t.$t("directory"):e.path)+" ("+t._s(e.size[2])+")")])])})),0)]),a("div",{staticClass:"h-full w-full inline-block flex w-[59rem]"},[a(c,{directives:[{name:"loading",rawName:"v-loading",value:i.loading,expression:"loading"}],ref:"fileSelectorTable",attrs:{column:i.fileSelectorColumn,data:i.fileSelectorData,"span-method":i.arraySpanMethod,"highlight-current-row":"",border:!1,"element-loading-text":"正在加载文件列表，请稍后...","empty-text":"(空)","max-height":"480"},on:{"current-change":i.handleCurrentChange,"row-dblclick":i.handleRowDBClick}})],1)]),a("div",{staticClass:"flex justify-between bg-[#f6f8f8] p-12x pr-16x rounded-md"},[a("div",{staticClass:"ml-[9.6rem]"},[i.isAction?a("div",{staticClass:"flex align-middle items-center"},[a("span",[t._v("当前选中"+t._s(i.selectType)+"：")]),a("span",{staticClass:"bg-white px-4 h-12 leading-[2.8rem] w-[30rem] inline-block border-light border-1 border-opacity-20 truncate"},[t._v(t._s(null==(e=i.fileSelectedItem)?void 0:e.title))])]):t._e()]),a("span",{staticClass:"flex"},[a(l,{staticClass:"el-button--cancel",attrs:{type:"default"},on:{click:function(e){return t.$emit("close")}}},[t._v("取消")]),a(l,{attrs:{disabled:!i.isAction},on:{click:function(e){return i.onConfirm()}}},[t._v(" 确认 ")])],1)])])}),[],!1,null,null,null,null).exports;export{C as default};
