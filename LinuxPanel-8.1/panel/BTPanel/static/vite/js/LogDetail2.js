import{o as e,n as t,q as s,r as a,b as r,aZ as o}from"./main.js?v=1714377894636";import{_ as i}from"./index118.js?v=1714377894636";import{F as l,w as n,x as m,_ as c,L as u}from"./element-lib.js?v=1714377894636";import"./index45.js?v=1714377894636";import{_ as p}from"./index85.js?v=1714377894636";import{_ as v}from"./index46.js?v=1714377894636";import{e as d,b as f,v as g,f as h,h as x,I as _,j as b}from"./vue-lib.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{J as y,K as w,h as C,L as j}from"./crontab.api.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./index.vue_vue_type_style_index_0_lang.js?v=1714377894636";const D=t(d({__name:"LogDetail",props:{compData:{default:{}}},setup(t){const s=t,{proxy:a}=b(),{id:r}=s.compData,o=f("正在获取中...."),i=f(null),l=g({status:!1,time:3}),n=f(l.time),m=f(100),c={time:[{validator:(e,t,s)=>{t<3?s(new Error("时间间隔必须大于3秒")):s()},trigger:["blur","change"]}]},u=f(!1),p=f(""),v=f([]),d=f(),D=async e=>{try{e&&(n.value=k(l.time));const t=await w({id:r});o.value=t.data.msg,T(),e&&a.$message.request({status:t.status,msg:t.status?"刷新成功":"刷新失败"})}catch(t){}},T=()=>{a.$nextTick((()=>{const e=document.querySelector(".pre-box");e instanceof HTMLElement&&(e.scrollTop=e.scrollHeight)}))},k=e=>{let t=Number(e);return t=t<3?3:t,t};h((()=>s.compData),(()=>{D()}),{immediate:!0}),h((()=>n.value),(async e=>{0===e&&await D(),m.value=e/k(l.time)*100}));const F=(e=!1)=>{if(l.status){const t=k(l.time);e&&a.$message.success("定时刷新已开启"),clearInterval(i.value),i.value=setInterval((async()=>{0===n.value&&(n.value=t+1),n.value--}),1e3*t)}else clearInterval(i.value),e&&a.$message.success("定时刷新已关闭");E()},E=()=>{d.value[s.compData.id]=l,sessionStorage.setItem("CRONTAB-LOGS",JSON.stringify(d.value))};return x((()=>{const e=sessionStorage.getItem("CRONTAB-LOGS");d.value=e?JSON.parse(e):{},d.value&&d.value[s.compData.id]&&(l.status=d.value[s.compData.id].status,l.time=d.value[s.compData.id].time),F()})),_((()=>{clearInterval(i.value)})),{__sfc:!0,vm:a,props:s,id:r,logMsg:o,setTimer:i,list:[{text:"若您发现任务无法定时执行，可尝试点击【重装Crontab】进行重新安装"}],refreshForm:l,refreshNum:n,percentage:m,rules:c,logDialog:u,logContent:p,logsData:v,storageData:d,format:e=>n,logEvent:async()=>{try{await a.$confirm({title:"提示",message:"确定清空日志吗？",iconType:"warning",type:"warning"});const e=await y({id:r});a.$message.request(e),D()}catch(e){}},getLog:D,scrollToBottom:T,getTimes:k,startTaskEvent:async()=>{try{const e=await C({id:s.compData.id});a.$message.request(e)}catch(e){}},inputEvent:e=>{""===e||Number(e)<3||(n.value=Number(e),E())},refreshEvent:F,executeScript:async()=>{try{u.value=!0,p.value="",v.value=[],await j((e=>{!0!==e&&"successful"!==e&&(v.value.push(e),p.value=v.value.join("\n"))}))}catch(e){}},setSessionData:E,isRelease:e}}}),(function(){var e=this,t=e._self._c,d=e._self._setupProxy;return t("div",{staticClass:"p-20x"},[t("div",{staticClass:"flex items-center"},[t("div",{staticClass:"flex refresh-btn"},[t(s,{staticClass:"!rounded-r-[0]",attrs:{type:"default"},on:{click:function(e){return d.getLog(!0)}}},[t("div",{staticClass:"flex items-center"},[d.refreshForm.status?t(l,{staticClass:"mr-8x",attrs:{width:18,"show-text":!0,"stroke-width":1,type:"circle",color:"#20a53a","text-color":"#20a53a",percentage:d.percentage,format:d.format}}):e._e(),t("span",[e._v("刷新日志")])],1)]),t(a,{attrs:{"popper-class":"white-tips-popover",placement:"bottom",width:"230",trigger:"click"}},[t(n,{staticClass:"p-1.6rem pl-0",attrs:{model:d.refreshForm,rules:d.rules}},[t(m,{attrs:{label:"定时刷新"}},[t(v,{attrs:{width:36},on:{change:function(e){return d.refreshEvent(!0)}},model:{value:d.refreshForm.status,callback:function(t){e.$set(d.refreshForm,"status",t)},expression:"refreshForm.status"}})],1),d.refreshForm.status?t(m,{attrs:{label:"时间间隔",prop:"time"}},[t(p,{attrs:{type:"number",textType:"秒",width:"11rem",min:"3"},on:{input:d.inputEvent},model:{value:d.refreshForm.time,callback:function(t){e.$set(d.refreshForm,"time",t)},expression:"refreshForm.time"}})],1):e._e()],1),t(c,{staticClass:"!rounded-l-[0] h-[3.6rem] !border-l-[0]",attrs:{slot:"reference",icon:"el-icon-arrow-down"},slot:"reference"})],1)],1),t(s,{staticClass:"!ml-1rem h-[3.6rem]",attrs:{type:"default"},on:{click:d.logEvent}},[e._v(" 清空日志 ")]),t(u,{staticClass:"!h-[2rem] !mx-1rem",attrs:{direction:"vertical"}}),t(s,{staticClass:"h-[3.6rem]",attrs:{type:"default"},on:{click:d.startTaskEvent}},[e._v("执行任务")]),d.isRelease?e._e():t(s,{staticClass:"h-[3.6rem]",attrs:{type:"default"},on:{click:d.executeScript}},[e._v("重装Crontab")])],1),t("div",{staticClass:"pre-box bg-[#333] mt-12x text-white h-[48rem] overflow-auto p-20x"},[t("pre",{staticClass:"whitespace-pre-wrap",domProps:{innerHTML:e._s(d.logMsg)}})]),d.isRelease?e._e():t(i,{staticClass:"mt-[1rem] mx-[1rem]",attrs:{list:d.list,"list-style":"disc"}}),t(r,{attrs:{title:"正在检查Crontab，请耐心等候",visible:d.logDialog,area:[60]},on:{"update:visible":function(e){d.logDialog=e}}},[t("div",{staticClass:"flex-wrap"},[t(o,{staticClass:"h-[40rem] !rounded-none",attrs:{content:d.logContent}})],1)])],1)}),[],!1,null,"9e881202",null,null).exports;export{D as default};
