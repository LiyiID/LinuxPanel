import{aS as fileSelectionDialog,n as normalizeComponent,D as __unplugin_components_8,a as __unplugin_components_3,r as __unplugin_components_4,q as __unplugin_components_6,o as isRelease}from"./main.js?v=1714377894636";import{w as __unplugin_components_0,x as __unplugin_components_1,j as __unplugin_components_13,q as __unplugin_components_11,s as __unplugin_components_12,L as __unplugin_components_1$1,y as __unplugin_components_5,ab as __unplugin_components_9}from"./element-lib.js?v=1714377894636";import"./radio-button.js?v=1714377894636";import{e as defineComponent,b as ref$1,v as reactive,f as watch,j as getCurrentInstance,h as onMounted}from"./vue-lib.js?v=1714377894636";import{_ as __unplugin_components_2}from"./index85.js?v=1714377894636";import"./index45.js?v=1714377894636";import{o as onDefaultFormSubmit}from"./confirm.js?v=1714377894636";import{g as getSiteStore,b3 as returnCmd,b4 as modifyProject,b5 as createProject,b6 as advanceCheckPort,b7 as getSystemUserList,a_ as getSystemInfo}from"./site.store.js?v=1714377894636";import{m as javaMangerDialog}from"./site.popup.js?v=1714377894636";import{r as rules}from"./site.rules.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./config.js?v=1714377894636";import"./check.js?v=1714377894636";import"./index38.js?v=1714377894636";import"./element-ui.common.js?v=1714377894636";import"./date-util.js?v=1714377894636";import"./vdom.js?v=1714377894636";import"./index62.js?v=1714377894636";import"./cascader-panel.js?v=1714377894636";const _sfc_main$3=defineComponent({__name:"SpringbootForm",props:{projectData:{default:{}},editForm:null},emits:["updateForm"],setup(__props,{expose:expose,emit:emits}){const props=__props,{proxy:vm}=getCurrentInstance(),{getModulesList:getModulesList}=getSiteStore(),springRef=ref$1(),formDisabled=ref$1(!1),javaAddForm=ref$1({project_type:3,project_jar:"/www/wwwroot",project_name:"",port:"",project_jdk:"",project_cmd:"",nohup_log:!0,jmx_status:!1,run_user:"www",use_project_watch:!1,auth:!1,project_ps:"",domains:"",jmx_port:"",debug:!1,is_separation:!1,release_firewall:!1,api_url:"",host_url:"http://127.0.0.1",static_path:""}),otherSetting=ref$1(!1),projectData=reactive(props.projectData),check_domain_list=async(e,t)=>{let a=e.trim().replace(" ","").split("\n");for(var o=0;o<a.length;o++){var n=a[o];if(t&&!check_domain_port(n))return vm.$message.error("第"+(o+1)+"行【"+n+"】域名格式错误"),!1;if(!t&&!check_domain(n))return vm.$message.error("第"+(o+1)+"行【"+n+"】域名格式错误"),!1}return a},check_domain_port=e=>/^([\w\u4e00-\u9fa5\-\*]{1,100}\.){1,10}([\w\u4e00-\u9fa5\-]{1,24}|[\w\u4e00-\u9fa5\-]{1,24}\.[\w\u4e00-\u9fa5\-]{1,24})(:([1-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5]))?$/.test(strim(e)),check_domain=e=>/^([\w\u4e00-\u9fa5\-\*]{1,100}\.){1,10}([\w\u4e00-\u9fa5\-]{1,24}|[\w\u4e00-\u9fa5\-]{1,24}\.[\w\u4e00-\u9fa5\-]{1,24})$/.test(strim(e)),strim=str=>{let reg_str="/ /g",reg=eval(reg_str);return str=str.replace(reg,""),str},onPathChange=()=>{fileSelectionDialog({type:"file",path:javaAddForm.value.project_jar,change:e=>{var t;javaAddForm.value.project_jar=e;let a=null==(t=e.substring(e.lastIndexOf("/")+1))?void 0:t.replace(/\./g,"_");javaAddForm.value.project_name=a,javaAddForm.value.project_ps=a;let o=e.substring(0,e.lastIndexOf("/"));javaAddForm.value.static_path=o,returnCmdEvent(0)}})},changeDebug=e=>{javaAddForm.value.debug=!1,e?(vm.$confirm({title:"警告",message:"此功能为远程调试配合IDEA使用，不建议在生产环境使用，调试端口随机生成，端口号请查看生成的命令,默认不开放此端口,需自行开放。",icon:"warning"}),javaAddForm.value.debug=!0,returnCmdEvent(3)):javaAddForm.value.debug=!1},changeName=e=>{javaAddForm.value.project_ps=e},changeJdk=e=>{javaAddForm.value.project_jdk=e,e&&returnCmdEvent(2)},onStaticPathChange=()=>{fileSelectionDialog({type:"dir",path:javaAddForm.value.static_path,change:e=>{javaAddForm.value.static_path=e}})},changeCmdValue=()=>{var e;let t=null==(e=javaAddForm.value.project_cmd)?void 0:e.match(/--server.port=(\d+)/);t&&(javaAddForm.value.port=t[1])},returnCmdEvent=async e=>{if(javaAddForm.value.debug=!1,3===e&&(vm.$confirm({title:"警告",message:"此功能为远程调试配合IDEA使用，不建议在生产环境使用，调试端口随机生成，端口号请查看生成的命令,默认不开放此端口,需自行开放。",icon:"warning"}),javaAddForm.value.debug=!0),1!==e||"/www/wwwroot"!==javaAddForm.value.project_jar)try{let t={type:e,project_name:javaAddForm.value.project_name,project_cmd:javaAddForm.value.project_cmd,project_jar:javaAddForm.value.project_jar,project_jdk:javaAddForm.value.project_jdk,jmx_status:javaAddForm.value.jmx_status,debug:javaAddForm.value.debug,port:javaAddForm.value.port};const a=await returnCmd({data:JSON.stringify(t)});if(!a.status)return vm.$message.request(a);javaAddForm.value.project_cmd=a.data.msg,javaAddForm.value.port=a.data.msg.match(/--server.port=(\d+)/)[1],javaAddForm.value.host_url="http://127.0.0.1:".concat(javaAddForm.value.port);let o="Dcom.sun.management.jmxremote.port";javaAddForm.value.jmx_port=a.data.msg.substr(a.data.msg.indexOf(o)+o.length+1,4)}catch(t){}},onConfirm=async()=>{var e,t,a;if((null==(e=props.editForm)?void 0:e.isEdit)&&(javaAddForm.value.project_type=3,javaAddForm.value.domains=props.editForm.name,javaAddForm.value.project_path="",javaAddForm.value.tomcat_version=0,javaAddForm.value.release_firewall=!1,javaAddForm.value.debug=javaAddForm.value.debug?1:0,delete javaAddForm.value.jmx_info,javaAddForm.value.log_conf,delete javaAddForm.value.logs,javaAddForm.value.scripts),javaAddForm.value.domains&&!(null==(t=props.editForm)?void 0:t.isEdit)){const e=await check_domain_list(javaAddForm.value.domains);if(!e)return e}let o;(null==(a=props.editForm)?void 0:a.isEdit)&&(o=vm.$load("正在修改项目中，请稍后...")),onDefaultFormSubmit({$refs:springRef.value,loading:{disable:formDisabled},request:async()=>{var e,t;if(null==(e=props.editForm)?void 0:e.isEdit){const e=await modifyProject({data:JSON.stringify(javaAddForm.value)},"java");return vm.$message.request(e),null==o||o.close(),null}const a=await createProject({data:JSON.stringify({...javaAddForm.value,domains:javaAddForm.value.domains?null==(t=javaAddForm.value.domains)?void 0:t.split("\n"):[]})},"java");return{status:a.data.status,msg:a.data.status?a.data.data||a.data.msg:a.data.error_msg}},async complete(){getModulesList("java")}})};return watch((()=>props.projectData.jdk_info.length),(()=>{var e;javaAddForm.value.project_jdk=null==(e=props.projectData.jdk_info[0])?void 0:e.path}),{immediate:!0,deep:!0}),watch((()=>props.editForm),(()=>{props.editForm&&(javaAddForm.value={...props.editForm.project_config,nohup_log:1===props.editForm.project_config.nohup_log,is_separation:1===props.editForm.project_config.is_separation,project_ps:props.editForm.ps,debug:props.editForm.debug,use_project_watch:props.editForm.use_project_watch,api_url:props.editForm.project_config.api_url},otherSetting.value=!0)}),{immediate:!0,deep:!0}),expose({onConfirm:onConfirm}),{__sfc:!0,props:props,vm:vm,getModulesList:getModulesList,springRef:springRef,formDisabled:formDisabled,javaAddForm:javaAddForm,otherSetting:otherSetting,projectData:projectData,emits:emits,check_domain_list:check_domain_list,check_domain_port:check_domain_port,check_domain:check_domain,strim:strim,onPathChange:onPathChange,changeDebug:changeDebug,changeName:changeName,changeJdk:changeJdk,onStaticPathChange:onStaticPathChange,changeCmdValue:changeCmdValue,returnCmdEvent:returnCmdEvent,onConfirm:onConfirm,javaMangerDialog:javaMangerDialog,rules:rules}}});var _sfc_render$3=function(){var e,t,a,o,n,r,s,i,l,d,_,c,p=this,m=p._self._c,u=p._self._setupProxy;return m("div",{staticClass:"mt-20x"},[m(__unplugin_components_0,{ref:"springRef",attrs:{model:u.javaAddForm,disabled:u.formDisabled,"label-width":"100px",rules:u.rules}},[m(__unplugin_components_1,{attrs:{label:"项目jar路径",prop:"project_jar"}},[m(__unplugin_components_2,{attrs:{width:"32rem",disabled:null==(e=p.editForm)?void 0:e.isEdit,"icon-type":!(null==(t=p.editForm)?void 0:t.isEdit)&&"folder"},on:{folder:u.onPathChange},model:{value:u.javaAddForm.project_jar,callback:function(e){p.$set(u.javaAddForm,"project_jar",e)},expression:"javaAddForm.project_jar"}})],1),m(__unplugin_components_1,{attrs:{label:"项目名称",prop:"project_name"}},[m(__unplugin_components_2,{attrs:{disabled:null==(a=p.editForm)?void 0:a.isEdit,width:"32rem",placeholder:"选择项目文件，自动获取名称"},on:{change:u.changeName},model:{value:u.javaAddForm.project_name,callback:function(e){p.$set(u.javaAddForm,"project_name",e)},expression:"javaAddForm.project_name"}})],1),m(__unplugin_components_1,{attrs:{label:"项目端口",prop:"port"}},[m("div",{staticClass:"flex items-center"},[m(__unplugin_components_2,{staticClass:"mr-12x",attrs:{width:"20rem",type:"number",placeholder:"选择项目文件，自动获取端口"},on:{change:function(e){return u.returnCmdEvent(1)}},model:{value:u.javaAddForm.port,callback:function(e){p.$set(u.javaAddForm,"port",e)},expression:"javaAddForm.port"}}),(null==(o=p.editForm)?void 0:o.isEdit)?p._e():m(__unplugin_components_8,{model:{value:u.javaAddForm.release_firewall,callback:function(e){p.$set(u.javaAddForm,"release_firewall",e)},expression:"javaAddForm.release_firewall"}},[p._v(" 放行端口 "),m(__unplugin_components_13,{staticClass:"item",attrs:{effect:"dark",content:"选中将在防火墙安全组放行监听端口，放行后该项目可在外网访问",placement:"right"}},[m("i",{staticClass:"el-icon-question text-warning"})])],1)],1)]),m(__unplugin_components_1,{attrs:{label:"项目JDK",prop:"project_jdk"}},[m("div",{staticClass:"flex items-center"},[m(__unplugin_components_11,{staticClass:"w-[32rem]",attrs:{disabled:!u.projectData.jdk_info},on:{change:u.changeJdk},model:{value:u.javaAddForm.project_jdk,callback:function(e){p.$set(u.javaAddForm,"project_jdk",e)},expression:"javaAddForm.project_jdk"}},p._l(u.projectData.jdk_info,(function(e,t){return m(__unplugin_components_12,{key:t,attrs:{value:e.path,label:e.name+"["+e.path+"]"}})})),1),m(__unplugin_components_3,{staticClass:"ml-8x",on:{click:function(e){return u.javaMangerDialog("")}}},[p._v("添加JDK信息")])],1)]),m(__unplugin_components_1,{attrs:{label:"项目执行命令",prop:"project_cmd"}},[m(__unplugin_components_2,{attrs:{width:"40rem",type:"textarea",rows:4,resize:"none",placeholder:"选择项目jar文件，自动获取项目执行命令"},on:{blur:u.changeCmdValue},model:{value:u.javaAddForm.project_cmd,callback:function(e){p.$set(u.javaAddForm,"project_cmd",e)},expression:"javaAddForm.project_cmd"}})],1),m(__unplugin_components_1,{attrs:{label:"jmx监控"}},[m(__unplugin_components_8,{attrs:{disabled:!u.javaAddForm.project_cmd},on:{change:function(e){return u.returnCmdEvent(4)}},model:{value:u.javaAddForm.jmx_status,callback:function(e){p.$set(u.javaAddForm,"jmx_status",e)},expression:"javaAddForm.jmx_status"}},[p._v(" 设置jmx后可在性能监控中查询项目性能信息 ")])],1),m(__unplugin_components_1,{attrs:{label:"项目用户"}},[m("div",{staticClass:"flex items-center"},[m(__unplugin_components_11,{staticClass:"mr-8x w-[16rem]",model:{value:u.javaAddForm.run_user,callback:function(e){p.$set(u.javaAddForm,"run_user",e)},expression:"javaAddForm.run_user"}},p._l(u.projectData.userList,(function(e){return m(__unplugin_components_12,{key:e,attrs:{value:e,label:e}})})),1),m("span",{staticClass:"text-[1.2rem] text-[#666]"},[p._v("* 无特殊需求请选择www用户")])],1)]),m(__unplugin_components_1,{attrs:{label:"开机启动"}},[m(__unplugin_components_8,{model:{value:u.javaAddForm.auth,callback:function(e){p.$set(u.javaAddForm,"auth",e)},expression:"javaAddForm.auth"}},[p._v("是否设置开机自动启动（默认自带守护进程每120秒检测一次）")])],1),m(__unplugin_components_1,{attrs:{label:"项目备注"}},[m(__unplugin_components_2,{attrs:{width:"32rem",placeholder:"输入项目备注，非必填"},model:{value:u.javaAddForm.project_ps,callback:function(e){p.$set(u.javaAddForm,"project_ps",e)},expression:"javaAddForm.project_ps"}})],1),(null==(n=p.editForm)?void 0:n.isEdit)?p._e():m(__unplugin_components_1$1,{staticClass:"!mb-[1rem]"}),(null==(r=p.editForm)?void 0:r.isEdit)?p._e():m(__unplugin_components_3,{staticClass:"w-full text-center cursor-pointer flex items-center",class:"".concat(u.otherSetting?"":"pb-2rem"),on:{click:function(e){u.otherSetting=!u.otherSetting}}},[p._v("点击"+p._s(u.otherSetting?"收起":"查看")+"，更多配置 "),m("i",{class:" el-icon-arrow-".concat(u.otherSetting?"up":"down")})]),u.otherSetting?m("div",{staticClass:"mt-20x"},[(null==(s=p.editForm)?void 0:s.isEdit)||0==u.javaAddForm.bind_extranet?p._e():m(__unplugin_components_1,{attrs:{label:"绑定域名"}},[m(__unplugin_components_4,{ref:"popover",attrs:{placement:"top-start","popper-class":"green-tips-popover",title:"",width:"400",trigger:"focus"}},[m("div",{staticClass:"!p-12x bg-[#20a53a] text-white"},[p._v(" 如果需要绑定外网，请输入需要绑定的域名，该选项可为空"),m("br"),p._v("如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),m("br"),p._v("泛解析添加方法 *.domain.com"),m("br"),p._v("暂不支持添加端口格式的域名 *.domain.com:88 ")]),m(__unplugin_components_2,{directives:[{name:"popover",rawName:"v-popover:popover",arg:"popover"}],attrs:{slot:"reference",rows:6,resize:"none",width:"40rem",type:"textarea",placeholder:"如果需要绑定外网，请输入需要绑定的域名，该选项可为空\n如需填写多个域名，请换行填写，每行一个域名，默认为80端口\n泛解析添加方法 *.domain.com\n暂不支持添加端口格式的域名"},slot:"reference",model:{value:u.javaAddForm.domains,callback:function(e){p.$set(u.javaAddForm,"domains",e)},expression:"javaAddForm.domains"}})],1)],1),m(__unplugin_components_1,{attrs:{label:"远程调试开启"}},[m(__unplugin_components_8,{attrs:{disabled:!u.javaAddForm.project_cmd},on:{change:u.changeDebug},model:{value:u.javaAddForm.debug,callback:function(e){p.$set(u.javaAddForm,"debug",e)},expression:"javaAddForm.debug"}},[p._v("设置远程调试，配合IDEA使用，生产环境慎用")]),m(__unplugin_components_13,{staticClass:"item",attrs:{effect:"dark",content:"",placement:"top"}},[m("div",{staticClass:"leading-8",attrs:{slot:"content"},slot:"content"},[p._v(" 在Java中，JVM远程调试是一种在运行时检查和调试Java应用程序的方法。"),m("br"),p._v("这种方法允许开发者在不同的机器上运行和调试应用程序，"),m("br"),p._v("这对于在开发环境中重现和解决生产环境中的问题非常有用. ")]),m("i",{staticClass:"el-icon-question text-warning"})])],1),m(__unplugin_components_1,{attrs:{label:"前后端分离"}},[m("div",{class:{"!mb-20x":!u.javaAddForm.is_separation}},[m(__unplugin_components_8,{attrs:{disabled:!u.javaAddForm.project_cmd||(null==(i=p.editForm)?void 0:i.isEdit)},model:{value:u.javaAddForm.is_separation,callback:function(e){p.$set(u.javaAddForm,"is_separation",e)},expression:"javaAddForm.is_separation"}},[p._v("是否设置前后端分离")]),m(__unplugin_components_13,{staticClass:"item",attrs:{effect:"dark",content:"",placement:"top"}},[m("div",{staticClass:"leading-8",attrs:{slot:"content"},slot:"content"},[p._v(" 前后端文件分别部署，并通过反向代理技术实现通信。"),m("br")]),m("i",{staticClass:"el-icon-question text-warning"})])],1)]),u.javaAddForm.is_separation?m("div",{staticClass:"!mt-16x"},[m(__unplugin_components_1,{attrs:{label:"后端url"}},[m(__unplugin_components_2,{attrs:{disabled:null==(l=p.editForm)?void 0:l.isEdit},model:{value:u.javaAddForm.api_url,callback:function(e){p.$set(u.javaAddForm,"api_url",e)},expression:"javaAddForm.api_url"}})],1),m(__unplugin_components_1,{attrs:{label:"前端url"}},[m(__unplugin_components_2,{attrs:{disabled:null==(d=p.editForm)?void 0:d.isEdit},model:{value:u.javaAddForm.host_url,callback:function(e){p.$set(u.javaAddForm,"host_url",e)},expression:"javaAddForm.host_url"}})],1),m(__unplugin_components_1,{attrs:{label:"前端根目录"}},[m(__unplugin_components_2,{staticClass:"mb-20x",attrs:{disabled:null==(_=p.editForm)?void 0:_.isEdit,"icon-type":"folder"},on:{folder:u.onStaticPathChange},model:{value:u.javaAddForm.static_path,callback:function(e){p.$set(u.javaAddForm,"static_path",e)},expression:"javaAddForm.static_path"}})],1)],1):p._e(),(null==(c=p.editForm)?void 0:c.isEdit)?m(__unplugin_components_1,{attrs:{label:" "}},[m(__unplugin_components_6,{on:{click:u.onConfirm}},[p._v("保存当前配置")])],1):p._e()],1):p._e()],1)],1)},_sfc_staticRenderFns$3=[],__component__$3=normalizeComponent(_sfc_main$3,_sfc_render$3,_sfc_staticRenderFns$3,!1,null,"46536147",null,null);const SpringBootForm=__component__$3.exports,_sfc_main$2=defineComponent({__name:"BuiltinProjectForm",props:{projectData:{default:{}},editForm:null},setup(e,{expose:t}){const a=e,{getModulesList:o}=getSiteStore(),{proxy:n}=getCurrentInstance(),r=ref$1(null),s=ref$1(!1),i=ref$1({project_type:1,project_path:"/www/wwwroot/",tomcat_version:"",project_ps:"",domain:"",use_project_watch:!1,run_user:"www"}),l=async()=>{var e;(null==(e=a.editForm)?void 0:e.isEdit)&&(i.value.project_jar="",i.value.project_cmd="",i.value.project_jdk="",delete i.value.jmx_info,i.value.log_conf,delete i.value.logs,i.value.scripts),onDefaultFormSubmit({$refs:r.value,loading:{disable:s},request:async()=>{var e;return(null==(e=a.editForm)?void 0:e.isEdit)?await modifyProject({data:JSON.stringify(i.value)},"java"):await createProject({data:JSON.stringify(i.value)},"java")},async complete(){o("java")}})};watch((()=>a.projectData.tomcat_list.length),(()=>{var e;i.value.tomcat_version=null==(e=a.projectData.tomcat_list[0])?void 0:e.version}),{immediate:!0,deep:!0}),watch((()=>a.editForm),(()=>{a.editForm&&(i.value={...a.editForm.project_config,domain:a.editForm.project_config.project_name,project_path:a.editForm.project_config.project_cwd,is_separation:1===a.editForm.project_config.is_separation,project_ps:a.editForm.ps,debug:0,use_project_watch:a.editForm.use_project_watch,run_user:"www",release_firewall:!1,project_type:1,jmx_status:!1})}),{immediate:!0,deep:!0});const d=()=>{var e;const t=JSON.parse(null!=(e=sessionStorage.getItem("BT-CONFIG"))?e:"{}").sites_path;t&&(i.value.project_path=t)};return onMounted((()=>{d()})),t({onConfirm:l}),{__sfc:!0,props:a,getModulesList:o,vm:n,buildForm:r,formDisabled:s,javaAddForm:i,onPathChange:()=>{fileSelectionDialog({type:"dir",path:i.value.project_path,change:e=>{var t;i.value.project_path=e;let a=null==(t=e.substring(e.lastIndexOf("/")+1))?void 0:t.replace(/\./g,"_");i.value.domain=a,i.value.project_ps=a}})},changeName:e=>{i.value.project_ps=e,i.value.project_path="/www/wwwroot/".concat(e)},onConfirm:l,onOpen:d,javaMangerDialog:javaMangerDialog,rules:rules}}});var _sfc_render$2=function(){var e,t,a,o,n=this,r=n._self._c,s=n._self._setupProxy;return r("div",{staticClass:"mt-20x"},[r(__unplugin_components_0,{ref:"buildForm",attrs:{model:s.javaAddForm,disabled:s.formDisabled,"label-width":"100px",rules:s.rules}},[r(__unplugin_components_1,{attrs:{label:"项目域名",prop:"domain"}},[r(__unplugin_components_2,{attrs:{disabled:null==(e=n.editForm)?void 0:e.isEdit,width:"32rem",placeholder:"请输入项目域名"},on:{input:s.changeName},model:{value:s.javaAddForm.domain,callback:function(e){n.$set(s.javaAddForm,"domain",e)},expression:"javaAddForm.domain"}})],1),r(__unplugin_components_1,{attrs:{label:"项目路径",prop:"project_path"}},[r(__unplugin_components_2,{attrs:{width:"32rem","icon-type":"folder"},on:{folder:s.onPathChange},model:{value:s.javaAddForm.project_path,callback:function(e){n.$set(s.javaAddForm,"project_path",e)},expression:"javaAddForm.project_path"}})],1),r(__unplugin_components_1,{attrs:{label:"Tomcat版本",prop:"tomcat_version"}},[r("div",{staticClass:"flex items-center"},[r(__unplugin_components_11,{staticClass:"mr-8x w-[16rem]",attrs:{disabled:!n.projectData.tomcat_list.length||(null==(t=n.editForm)?void 0:t.isEdit)},model:{value:s.javaAddForm.tomcat_version,callback:function(e){n.$set(s.javaAddForm,"tomcat_version",e)},expression:"javaAddForm.tomcat_version"}},n._l(n.projectData.tomcat_list,(function(e,t){return r(__unplugin_components_12,{key:t,attrs:{value:e.version,label:e.name}})})),1),(null==(a=n.editForm)?void 0:a.isEdit)?n._e():r(__unplugin_components_3,{on:{click:function(e){return s.javaMangerDialog("tomcatSettings")}}},[n._v("安装Tomcat其他版本")])],1)]),r(__unplugin_components_1,{attrs:{label:"项目备注"}},[r(__unplugin_components_2,{attrs:{width:"32rem",placeholder:"输入项目备注，非必填"},model:{value:s.javaAddForm.project_ps,callback:function(e){n.$set(s.javaAddForm,"project_ps",e)},expression:"javaAddForm.project_ps"}})],1),(null==(o=n.editForm)?void 0:o.isEdit)?r(__unplugin_components_1,{attrs:{label:" "}},[r(__unplugin_components_6,{on:{click:s.onConfirm}},[n._v("保存当前配置")])],1):n._e()],1)],1)},_sfc_staticRenderFns$2=[],__component__$2=normalizeComponent(_sfc_main$2,_sfc_render$2,_sfc_staticRenderFns$2,!1,null,"eafb14d8",null,null);const BuiltinProjectForm=__component__$2.exports,_sfc_main$1=defineComponent({__name:"IndependentProject",props:{projectData:{default:{}},editForm:null},setup(e,{expose:t}){const a=e,{proxy:o}=getCurrentInstance(),{getModulesList:n}=getSiteStore(),r=ref$1(),s=ref$1(!1),i=ref$1({project_path:"/www/wwwroot",project_jdk:"",use_project_watch:!1,project_ps:"",domain:"",release_firewall:!1,tomcat_version:"",port:"",run_user:"www",auth:!1}),l=async()=>{var e;i.value.project_type=2,(null==(e=a.editForm)?void 0:e.isEdit)&&(i.value.project_jar="",i.value.debug=i.value.debug?1:0,delete i.value.jmx_info,i.value.log_conf,delete i.value.logs,i.value.scripts),onDefaultFormSubmit({$refs:r.value,loading:{disable:s},request:async()=>{var e;if(null==(e=a.editForm)?void 0:e.isEdit){const e=await modifyProject({data:JSON.stringify({...i.value,domain:i.value.domain.split("\n")})},"java");return o.$message.request(e),n("java"),null}return await createProject({data:JSON.stringify(i.value)},"java")},async complete(){n("java")}})};watch((()=>a.projectData.tomcat_list.length),(()=>{var e;i.value.tomcat_version=null==(e=a.projectData.tomcat_list[0])?void 0:e.version}),{immediate:!0,deep:!0}),watch((()=>a.projectData.jdk_info.length),(()=>{var e;i.value.project_jdk=null==(e=a.projectData.jdk_info[0])?void 0:e.path}),{immediate:!0,deep:!0}),watch((()=>a.editForm),(()=>{a.editForm&&(i.value={...a.editForm.project_config,domain:a.editForm.project_config.project_name,project_path:a.editForm.project_config.project_cwd,project_jdk:a.editForm.project_config.jdk_path+"/bin/java",run_user:"www",is_separation:1===a.editForm.project_config.is_separation,debug:0,use_project_watch:a.editForm.use_project_watch,release_firewall:!1,project_ps:a.editForm.ps,host_url:"http://127.0.0.1:"+a.editForm.project_config.port,jmx_status:!1})}),{immediate:!0,deep:!0});const d=()=>{var e;const t=JSON.parse(null!=(e=sessionStorage.getItem("BT-CONFIG"))?e:"{}").sites_path;t&&(i.value.project_path=t)};return onMounted((()=>{d()})),t({onConfirm:l}),{__sfc:!0,props:a,vm:o,getModulesList:n,independFormRef:r,formDisabled:s,javaAddForm:i,checkPortUse:async()=>{if(i.value.port)try{const e=await advanceCheckPort({port:i.value.port},"java");e.status||(o.$message.request(e),i.value.port="")}catch(e){}},onPathChange:()=>{fileSelectionDialog({type:"dir",path:i.value.project_path,change:e=>{var t;i.value.project_path=e;let a=null==(t=e.substring(e.lastIndexOf("/")+1))?void 0:t.replace(/\./g,"_");i.value.domain=a,i.value.project_ps=a}})},changeName:e=>{var t;(null==(t=a.editForm)?void 0:t.isEdit)||(i.value.project_ps=e)},onConfirm:l,onOpen:d,javaMangerDialog:javaMangerDialog,rules:rules,isRelease:isRelease}}});var _sfc_render$1=function(){var e,t,a,o,n,r,s,i=this,l=i._self._c,d=i._self._setupProxy;return l("div",{staticClass:"mt-20x"},[l(__unplugin_components_0,{ref:"independFormRef",attrs:{model:d.javaAddForm,disabled:d.formDisabled,"label-width":"100px",rules:d.rules}},[l(__unplugin_components_1,{attrs:{label:"项目域名",prop:"domain"}},[l(__unplugin_components_2,{attrs:{disabled:null==(e=i.editForm)?void 0:e.isEdit,width:"32rem",placeholder:"请输入项目域名"},on:{input:d.changeName},model:{value:d.javaAddForm.domain,callback:function(e){i.$set(d.javaAddForm,"domain",e)},expression:"javaAddForm.domain"}})],1),l(__unplugin_components_1,{attrs:{label:"项目路径",prop:"project_path"}},[l(__unplugin_components_2,{attrs:{width:"32rem",disabled:null==(t=i.editForm)?void 0:t.isEdit,"icon-type":"".concat(!(null==(a=i.editForm)?void 0:a.isEdit)&&"folder")},on:{folder:d.onPathChange},model:{value:d.javaAddForm.project_path,callback:function(e){i.$set(d.javaAddForm,"project_path",e)},expression:"javaAddForm.project_path"}})],1),l(__unplugin_components_1,{attrs:{label:"Tomcat版本"}},[l("div",{staticClass:"flex items-center"},[l(__unplugin_components_11,{staticClass:"mr-8x w-[16rem]",attrs:{disabled:!i.projectData.tomcat_list.length&&(null==(o=i.editForm)?void 0:o.isEdit)},model:{value:d.javaAddForm.tomcat_version,callback:function(e){i.$set(d.javaAddForm,"tomcat_version",e)},expression:"javaAddForm.tomcat_version"}},i._l(i.projectData.tomcat_list,(function(e,t){return l(__unplugin_components_12,{key:t,attrs:{value:e.version,label:e.name}})})),1),(null==(n=i.editForm)?void 0:n.isEdit)?i._e():l(__unplugin_components_3,{on:{click:function(e){return d.javaMangerDialog("tomcatSettings")}}},[i._v("安装Tomcat其他版本")])],1)]),l(__unplugin_components_1,{attrs:{label:"项目端口",prop:"port"}},[l("div",{staticClass:"flex items-center"},[l(__unplugin_components_2,{staticClass:"mr-12x",attrs:{width:"20rem",type:"number",placeholder:"选择项目文件，自动获取端口"},on:{blur:d.checkPortUse},model:{value:d.javaAddForm.port,callback:function(e){i.$set(d.javaAddForm,"port",e)},expression:"javaAddForm.port"}}),(null==(r=i.editForm)?void 0:r.isEdit)?i._e():l(__unplugin_components_8,{model:{value:d.javaAddForm.release_firewall,callback:function(e){i.$set(d.javaAddForm,"release_firewall",e)},expression:"javaAddForm.release_firewall"}},[i._v(" 放行端口 "),l(__unplugin_components_13,{staticClass:"item",attrs:{effect:"dark",content:"选中将在防火墙安全组放行监听端口，放行后该项目可在外网访问",placement:"right"}},[l("i",{staticClass:"el-icon-question text-warning"})])],1)],1)]),d.isRelease?i._e():l(__unplugin_components_1,{attrs:{label:"项目用户"}},[l("div",{staticClass:"flex items-center"},[l(__unplugin_components_11,{staticClass:"mr-8x w-[16rem]",model:{value:d.javaAddForm.run_user,callback:function(e){i.$set(d.javaAddForm,"run_user",e)},expression:"javaAddForm.run_user"}},i._l(i.projectData.userList,(function(e){return l(__unplugin_components_12,{key:e,attrs:{value:e,label:e}})})),1),l("span",{staticClass:"text-[1.2rem] text-[#666]"},[i._v("* 无特殊需求请选择www用户")])],1)]),d.isRelease?i._e():l(__unplugin_components_1,{attrs:{label:"项目JDK",prop:"project_jdk"}},[l(__unplugin_components_11,{staticClass:"w-[32rem]",model:{value:d.javaAddForm.project_jdk,callback:function(e){i.$set(d.javaAddForm,"project_jdk",e)},expression:"javaAddForm.project_jdk"}},i._l(i.projectData.jdk_info,(function(e,t){return l(__unplugin_components_12,{key:t,attrs:{value:e.path,label:e.name+"["+e.path+"]"}})})),1)],1),l(__unplugin_components_1,{attrs:{label:"开机启动"}},[l(__unplugin_components_8,{model:{value:d.javaAddForm.auth,callback:function(e){i.$set(d.javaAddForm,"auth",e)},expression:"javaAddForm.auth"}},[i._v("是否设置开机自动启动（默认自带守护进程每120秒检测一次）")])],1),l(__unplugin_components_1,{attrs:{label:"项目备注"}},[l(__unplugin_components_2,{attrs:{width:"32rem",placeholder:"输入项目备注，非必填"},model:{value:d.javaAddForm.project_ps,callback:function(e){i.$set(d.javaAddForm,"project_ps",e)},expression:"javaAddForm.project_ps"}})],1),(null==(s=i.editForm)?void 0:s.isEdit)?l(__unplugin_components_1,{attrs:{label:" "}},[l(__unplugin_components_6,{on:{click:d.onConfirm}},[i._v("保存当前配置")])],1):i._e()],1)],1)},_sfc_staticRenderFns$1=[],__component__$1=normalizeComponent(_sfc_main$1,_sfc_render$1,_sfc_staticRenderFns$1,!1,null,"d585afef",null,null);const IndependentProject=__component__$1.exports,_sfc_main=defineComponent({__name:"index",props:{compData:{default:{rowData:{},isEdit:!1}}},setup(e,{expose:t}){const a=e,{proxy:o}=getCurrentInstance(),n=ref$1("SpringBoot");let r=reactive({project_type:3});const s=ref$1(),i=ref$1(),l=ref$1(),d=reactive({userList:[],jdk_info:[],tomcat_list:[]}),_=ref$1(),c=ref$1(!1),p=async()=>{try{const e=await getSystemUserList();d.userList=e.data}catch(e){}},m=async()=>{try{const e=await getSystemInfo();d.jdk_info=e.data.jdk_info.filter((e=>0!==e.operation)),d.tomcat_list=[],Object.keys(e.data.tomcat_info).forEach((t=>{let a=t.replace("tomcat","");e.data.tomcat_info[t].status&&d.tomcat_list.push({name:t,version:a,...e.data.tomcat_info[t]})}))}catch(e){}},u=async e=>{("SpringBoot"===n.value?s.value:"内置项目"===n.value?i.value:l.value).onConfirm()};return onMounted((async()=>{c.value=!0;try{await p(),await m()}catch(e){}finally{c.value=!1}a.compData.rowData&&(_.value=a.compData.rowData,_.value.isEdit=!0,n.value="springboot"===a.compData.rowData.project_config.java_type?"SpringBoot":"duli"===a.compData.rowData.project_config.java_type?"独立项目":"内置项目")})),t({onConfirm:u}),{__sfc:!0,props:a,vm:o,radioType:n,javaAddForm:r,SpringBootFormRef:s,BuiltinProjectFormRef:i,IndependentProjectRef:l,projectData:d,editForm:_,viewLoading:c,getRootUser:p,getSystemInfoEvent:m,onConfirm:u,SpringBootForm:SpringBootForm,BuiltinProjectForm:BuiltinProjectForm,IndependentProject:IndependentProject}}});var _sfc_render=function(){var e,t=this,a=t._self._c,o=t._self._setupProxy;return a("div",{staticClass:"p-20x"},[a(__unplugin_components_0,{directives:[{name:"loading",rawName:"v-loading",value:o.viewLoading,expression:"viewLoading"}],ref:"javaAddFormRef",attrs:{model:o.javaAddForm,"label-width":"100px"}},[a(__unplugin_components_1,{attrs:{label:"项目类型"}},[a("div",{staticClass:"flex items-center"},[a(__unplugin_components_5,{attrs:{size:"small",disabled:null==(e=o.editForm)?void 0:e.isEdit},model:{value:o.radioType,callback:function(e){o.radioType=e},expression:"radioType"}},[a(__unplugin_components_9,{attrs:{label:"SpringBoot"}}),a(__unplugin_components_9,{attrs:{label:"内置项目"}}),a(__unplugin_components_9,{attrs:{label:"独立项目"}})],1),a("div",{staticClass:"flex items-center ml-12x"},[a(__unplugin_components_3,{attrs:{href:"https://www.bt.cn/bbs/thread-76217-1-1.html"}},[t._v("Java项目教程")]),a("i",{staticClass:"el-icon-link text-primary text-[1.6rem] ml-4x"})],1)],1)]),a(o.SpringBootForm,{directives:[{name:"show",rawName:"v-show",value:"SpringBoot"==o.radioType,expression:"radioType == 'SpringBoot'"}],ref:"SpringBootFormRef",attrs:{editForm:o.editForm,projectData:o.projectData}}),a(o.BuiltinProjectForm,{directives:[{name:"show",rawName:"v-show",value:"内置项目"==o.radioType,expression:"radioType == '内置项目'"}],ref:"BuiltinProjectFormRef",attrs:{editForm:o.editForm,projectData:o.projectData}}),a(o.IndependentProject,{directives:[{name:"show",rawName:"v-show",value:"独立项目"==o.radioType,expression:"radioType == '独立项目'"}],ref:"IndependentProjectRef",attrs:{editForm:o.editForm,projectData:o.projectData}})],1)],1)},_sfc_staticRenderFns=[],__component__=normalizeComponent(_sfc_main,_sfc_render,_sfc_staticRenderFns,!1,null,"bfb5f9d0",null,null);const ProjectIndex=__component__.exports;export{ProjectIndex as default};
