import{F as e,q as a,s as t}from"./element-lib.js?v=1714377894636";import{n as l,b as s,r as c,D as i,q as n}from"./main.js?v=1714377894636";import{_ as r}from"./index39.js?v=1714377894636";import{e as u,H as o,b as p,f as b,w as h,c as d,v,h as m,l as f,j as x}from"./vue-lib.js?v=1714377894636";const g=l(u({__name:"index",props:{batchStatus:{default:0},describe:{default:()=>({title:"",th:"",message:"",propsValue:""})},isRecurrence:{type:Boolean,default:!1},visible:{type:Boolean,default:!1},type:{default:""},data:{default:()=>[]},batch:{default:()=>({})},tableDisplayConfig:{default:()=>({label:"操作结果",prop:"status",render:e=>o("span",{class:e.status?1===e.status?"text-primary":"text-danger":"text-warning"},(()=>{switch(e.status){case 0:return"等待执行";case 1:return"已完成";case 2:return"操作失败"}return"-"})())})}},emits:["update:visible","confirm","cancel","complete"],setup(e,{emit:a}){const t=e,l=p(),s=p(t.visible),c=p(!0),i=p(JSON.parse(JSON.stringify(t.data))),n=p(t.describe.title),r=p(t.describe.message),u=p(t.describe.th),o=p(t.describe.propsValue),v=p(t.type),m=p(0),f=p(0),x=p(t.data.length),g=p([{label:u,prop:o,width:250},t.tableDisplayConfig]),C=p(!1);b((()=>s.value),(e=>{a("update:visible",e)})),b((()=>m.value),(e=>{0===e?l.value.showFooterFun(!0):l.value.showFooterFun(!1)})),h((()=>{if(t.data.length&&(i.value=JSON.parse(JSON.stringify(t.data)),x.value=t.data.length,2===m.value&&C.value)){f.value=0;for(let e=0;e<i.value.length;e++)1===i.value[e].status&&f.value++;r.value="".concat(n.value,"已完成，共").concat(x.value,"个任务，成功").concat(f.value,"个，失败").concat(x.value-f.value,"个。")}})),b((()=>t.visible),(e=>{s.value=e,e&&(n.value=t.describe.title,r.value=t.describe.message,u.value=t.describe.th,o.value=t.describe.propsValue?t.describe.propsValue:"name",v.value=t.type)}));const y=d((()=>{const e=Number(f.value/x.value)||0;return Number((100*e).toFixed(0))})),_=async(e=0)=>{let l=null;if(t.isRecurrence){if(e===i.value.length)return m.value=2,r.value="".concat(n.value,"已完成，共").concat(x.value,"个任务，成功").concat(f.value,"个，失败").concat(x.value-f.value,"个。"),void a("complete",i.value);try{l=await t.batch(v.value,i.value[e]),f.value++}catch(s){l=!1}finally{i.value.splice(e,1,{...i.value[e],status:l?1:2}),await _(e+1)}}else await t.batch(v.value,i.value),m.value=2};return{__sfc:!0,props:t,emits:a,popup:l,show:s,showFooter:c,list:i,batchTitle:n,batchMsg:r,batchTh:u,batchProps:o,batchType:v,batchStatus:m,batchCompletedTaskNumber:f,batchTaskNumber:x,tableColumn:g,isResult:C,bathRate:y,onConfirm:()=>{2===m.value?l.value.close():(m.value=1,_())},onCancel:()=>{a("cancel")},onOpen:()=>{m.value=0!==t.batchStatus?t.batchStatus:0,f.value=0,2===m.value&&(C.value=!0)},batchRequest:_}}}),(function(){var a=this,t=a._self._c,l=a._self._setupProxy;return t(s,{ref:"popup",attrs:{title:l.batchTitle,area:40,visible:l.show,"show-footer":!0},on:{"update:visible":function(e){l.show=e},open:l.onOpen,confirm:l.onConfirm,cancel:l.onCancel}},[1!==l.batchStatus?[t("div",{staticClass:"flex py-[3.2rem] px-[2.4rem] flex-col"},[t("div",{staticClass:"flex items-center mb-20x"},[t("i",{staticClass:"text-[4rem]",class:0===l.batchStatus?"el-icon-warning text-warning":"el-icon-success text-primary"}),t("div",{staticClass:"pl-2x text-[1.5rem] leading-8 ml-4x"},[a._v(" "+a._s(l.batchMsg)+" ")])]),t(r,{ref:"batchTable",attrs:{column:l.tableColumn,data:l.list,"max-height":170}})],1)]:[t("div",{staticClass:"fle flex-col p-[3rem]"},[t("div",{staticClass:"mb-16x text-[1.4rem]"},[t("span",{staticClass:"mr-4x"},[a._v("正在"+a._s(l.props.describe.title)+"，当前进度:")]),t("span",[a._v(a._s(l.batchCompletedTaskNumber)+"/"+a._s(l.batchTaskNumber))])]),t(e,{staticClass:"bath-progress",attrs:{"text-inside":!0,"stroke-width":24,percentage:l.bathRate,status:"success"}})],1)]],2)}),[],!1,null,null,null,null).exports;const C=l(u({__name:"index",props:{data:{default:()=>[]},batchFn:null,config:{default:()=>({isRecurrence:!1,describe:{th:"表头",title:"批量操作",message:"确定要批量操作吗？"},tableDisplayConfig:{label:"表头",prop:"prop",render:e=>o("span",{class:e.status?1===e.status?"text-primary":"text-danger":"text-warning"},(()=>{switch(!0===e.status&&(e.status=1),e.status){case 0:return"等待执行";case 1:return"已完成";case 2:return"操作失败"}return"-"})())}})}},emits:["handle-select","handle-change","handle-batch","handle-complete","batch"],setup(e,{emit:a}){const t=e,{proxy:l}=x(),s=v({list:[],num:0,limit:0}),c=p({tableSelectNumber:0}),i=p(""),n=p(!(s.num>0)),r=p(!1),u=p(!1),o=p(!1),h=p(!1),d=p(0),g=p(!1);b((()=>c.value.tableSelectNumber),(e=>{s.num=e,s.list=c.value.tableSelectList,s.limit=c.value.tablselimit,0===e?(u.value=!1,r.value=!1,i.value=""):e===s.limit?(u.value=!0,r.value=!1):r.value=e>0&&e<s.limit,n.value=!(e>0)}));const C=()=>{clearTimeout(d.value),o.value=!0,d.value=setTimeout((()=>{o.value=!1}),2e3)},y=()=>new Promise((e=>{l.$parent.$children.length>0&&l.$parent.$children.forEach((a=>{(null==a?void 0:a._vnode.tag.indexOf("ElTable"))>-1&&e(a)}))}));return m((()=>{f((async()=>{c.value=await y()}))})),{__sfc:!0,props:t,vm:l,emits:a,tableSelect:s,table:c,batchSelect:i,disabled:n,isIndeterminate:r,checkbox:u,batchTips:o,batchCheckboxTips:h,batchTipsTimeout:d,batchVisible:g,showCheckboxTips:C,showBatchTips:()=>{n.value&&(clearTimeout(d.value),h.value=!0,d.value=setTimeout((()=>{h.value=!1}),2e3))},getTableData:y,handleChange:async e=>{const a=(await y()).$children[0];e?a.toggleAllSelection():a.clearSelection(),e||(i.value="")},handleSelect:e=>{a("handle-select",e),e||(i.value="")},handleBatch:()=>{""!==i.value?(t.data.forEach((e=>{if(e.value===i.value){if(e.diyBatch)return a("handle-batch",i.value),void e.diyBatch();g.value=!e.isRefBatch&&!g.value}})),a("handle-batch",i.value)):C()},handleComplete:e=>{a("handle-complete",e,e.length)}}}}),(function(){var e=this,l=e._self._c,s=e._self._setupProxy;return l("div",{staticClass:"flex items-center"},[l(c,{attrs:{trigger:"manual","popper-class":"popper-danger",placement:"top-start",content:"请选择需要批量操作的数据!"},scopedSlots:e._u([{key:"reference",fn:function(){return[l(i,{staticClass:"px-[1.1rem]",attrs:{indeterminate:s.isIndeterminate},on:{change:s.handleChange},model:{value:s.checkbox,callback:function(e){s.checkbox=e},expression:"checkbox"}})]},proxy:!0}]),model:{value:s.batchCheckboxTips,callback:function(e){s.batchCheckboxTips=e},expression:"batchCheckboxTips"}}),l("div",{staticClass:"flex relative items-center",on:{click:s.showBatchTips}},[l("div",{staticClass:"absolute w-full h-full z-999 cursor-not-allowed",class:s.disabled?"":"hidden"}),l(c,{attrs:{trigger:"manual","popper-class":"popper-danger",placement:"top-start",content:"请选择需要批量操作的类型!"},scopedSlots:e._u([{key:"reference",fn:function(){return[l(a,{staticClass:"mr-2 w-52",attrs:{placeholder:"请选择批量操作",disabled:s.disabled},on:{change:s.handleSelect},model:{value:s.batchSelect,callback:function(e){s.batchSelect=e},expression:"batchSelect"}},e._l(e.data,(function(e){return l(t,{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]},proxy:!0}]),model:{value:s.batchTips,callback:function(e){s.batchTips=e},expression:"batchTips"}}),l(n,{staticClass:"h-[3rem]",attrs:{disabled:s.disabled},on:{click:s.handleBatch}},[e._v(" 批量操作 "+e._s(s.disabled?"":"(已选中"+s.tableSelect.num+"项)")+" ")])],1),l(g,{attrs:{"is-recurrence":s.props.config.isRecurrence,visible:s.batchVisible,describe:s.props.config.describe,data:s.tableSelect.list,type:s.batchSelect,"table-display-config":s.props.config.tableDisplayConfig,batch:s.props.batchFn},on:{"update:visible":function(e){s.batchVisible=e},complete:s.handleComplete}})],1)}),[],!1,null,null,null,null).exports;export{C as _,g as a};
