import{_ as e,H as t,I as s,F as o,P as a}from"./element-lib.js?v=1714377894636";import{c as r,n as l}from"./main.js?v=1714377894636";import"./index39.js?v=1714377894636";import{_ as i}from"./upload.js?v=1714377894636";import{e as p,b as u,v as n,f as c,j as d}from"./vue-lib.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{g as m}from"./index28.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./index62.js?v=1714377894636";import"./index77.js?v=1714377894636";import"./index42.js?v=1714377894636";import"./check.js?v=1714377894636";import"./mysql.store.js?v=1714377894636";const f=l(p({__name:"UploadFile",props:{compData:{default:{}}},setup(e,{expose:t}){var s,o;const a=e,{refs:{tabActive:l}}=m(),{proxy:i}=d(),p=u(JSON.parse(null!=(s=sessionStorage.getItem("BT-CONFIG"))?s:"{}").backup_path),f=window.location.protocol+"//"+window.location.host+"/files?action=upload",v=n({f_size:0,f_path:null==(o=p.value?p.value+"/database":"/www/backup/database"+l.value)?void 0:o.replace(/\/\//g,"/"),f_name:"",f_start:0}),_=u([]),h=[".sql",".zip",".bak",".gz"].join(","),w={"x-http-token":window.vite_public_request_token};let b=!0;c((()=>_.value),(()=>{if(0===_.value.length)return void i.$root.showFooterFun(!1);const e=["success","fail","ready"];for(let t=0;t<_.value.length;t++)if(!e.includes(_.value[t].status))return void i.$root.showFooterFun(!1);_.value.some((e=>"success"!==e.status))&&(i.$root.confirmText=b?"开始上传":"重新上传",i.$root.showFooterFun(!0))}),{immediate:!0});const g=()=>{_.value.map((e=>{"success"!==e.status&&(e.status="ready")})),b=!1,i.$refs.upload.submit(),i.$root.showFooterFun(!1)};return t({onConfirm:g}),{__sfc:!0,props:a,tabActive:l,vm:i,backPath:p,uploadUrl:f,fileData:v,uploadFilesList:_,accept:h,header:w,first:b,uploadSuccess:()=>{i.$message.success("导入成功"),a.compData.refreshEvent()},uploadError:(e,t,s)=>{s.push(t),i.$message.error("导入失败")},uploadBefore:e=>{v.f_size=e.size,v.f_name=e.name,v.f_start=0},uploadChange:(e,t)=>{_.value=t||[]},uploadProgress:(e,t,s)=>{v.f_start=e.percent,_.value=s.map((s=>(s.uid===t.uid&&(s.percentage=e.percent),s)))},removeFile:e=>{_.value=_.value.filter((t=>t.name!==e.name))},onConfirm:g,getByteUnit:r}}}),(function(){var r=this,l=r._self._c,p=r._self._setupProxy;return l("div",{staticClass:"p-[2rem]"},[l(i,{ref:"upload",staticClass:"upload-demo",attrs:{name:"blob",data:p.fileData,action:p.uploadUrl,headers:p.header,accept:p.accept,"on-error":p.uploadError,multiple:!0,"show-file-list":!1,"auto-upload":!1,"on-success":p.uploadSuccess,"on-progress":p.uploadProgress,"file-list":p.uploadFilesList,"on-change":p.uploadChange,"before-upload":p.uploadBefore}},[l(e,{attrs:{size:"small",type:"primary"}},[r._v("导入")])],1),l("div",{staticClass:"h-[40rem] border border-[#EBEEF5] mt-[1rem]"},[l(t,{staticStyle:{width:"100%"},attrs:{height:"400",data:p.uploadFilesList}},[l(s,{attrs:{prop:"name","show-overflow-tooltip":!0,label:"名称"},scopedSlots:r._u([{key:"default",fn:function(e){return[l("i",{staticClass:"el-icon-document",staticStyle:{color:"#409eff"}}),l("span",{staticClass:"ml-[0.5rem]"},[r._v(r._s(e.row.name))])]}}])}),l(s,{attrs:{prop:"name",label:"是否成功",width:"300"},scopedSlots:r._u([{key:"default",fn:function(e){return["success"===e.row.status?[r._v("上传成功！")]:"fail"===e.row.status?[r._v("上传失败!")]:"ready"===e.row.status?[r._v("等待上传")]:l(o,{attrs:{percentage:Math.floor(e.row.percentage)}})]}}])}),l(s,{attrs:{width:"120",prop:"size",label:"大小"},scopedSlots:r._u([{key:"default",fn:function(e){return[r._v(" "+r._s(p.getByteUnit(e.row.size))+" ")]}}])}),l(s,{attrs:{prop:"name",width:"180",align:"right","show-overflow-tooltip":!0,label:"操作"},scopedSlots:r._u([{key:"default",fn:function(t){return[l(e,{directives:[{name:"show",rawName:"v-show",value:"ready"===t.row.status||"fail"===t.row.status,expression:"scope.row.status === 'ready' || scope.row.status === 'fail'"}],attrs:{type:"default",size:"mini"},on:{click:function(e){return p.removeFile(t.row)}}},[r._v("删除")])]}}])}),l("div",{staticStyle:{"text-align":"left"},attrs:{slot:"empty"},slot:"empty"},[l(a,{attrs:{description:"只支持'.sql', '.zip', '.bak', '.gz'文件格式导入"}})],1)],1)],1)],1)}),[],!1,null,"5c515401",null,null).exports;export{f as default};
