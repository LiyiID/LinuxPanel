import{a as e,Q as a,n as t,q as s,b as o}from"./main.js?v=1714377894636";import{_ as l}from"./index39.js?v=1714377894636";import{L as n,y as i,ab as r}from"./element-lib.js?v=1714377894636";import"./radio-button.js?v=1714377894636";import{_ as c}from"./index59.js?v=1714377894636";import"./index45.js?v=1714377894636";import{e as p,b as u,H as d,h as m,i as v,j as g}from"./vue-lib.js?v=1714377894636";import{a as y}from"./confirm.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{aP as f,aQ as b,aR as h,aS as _,A as j,aT as w}from"./site.store.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./config.js?v=1714377894636";import"./check.js?v=1714377894636";const k=t(p({__name:"SdkVersions",props:{compData:{default:{}}},setup(t){const s=t,o=u(""),{proxy:l}=g(),i=u(!1),r=u("正在请求安装...");let c=[];const p=u([{label:"版本号",width:200,render:e=>d("div",[e.version.replace(s.compData.type,"")," ","stable"===e.type&&"go"===s.compData.type?"(稳定版)":"",e.version===o.value?d("span",{class:"font-bold text-[#333]"},["【正在使用】"]):""])},{label:"安装状态",render:e=>("string"==typeof e.installed&&(e.installed="1"===e.installed),d("div",[e.installed?d("span",{class:"text-primary"},["已安装"]):d("span",{class:"text-danger"},["未安装"])]))},{label:"操作",align:"right",render:a=>(a.version.replace(s.compData.type,""),d("div",[d("div",{directives:[{name:"show",value:"go"===s.compData.type}],class:"inline-block"},[a.installed&&a.version!==o.value&&"go"===s.compData.type?d(e,{on:{click:()=>{T(a.version)}}},["设置默认"]):d("span",["--"]),d(n,{attrs:{direction:"vertical"}})]),a.installed?d(e,{class:"!text-danger",on:{click:()=>{C(a.version)}}},["卸载"]):d(e,{on:{click:()=>{q(a.version)}}},["安装"])]))}]),k=u([]),x=u(!1),D=u(""),L=u([]),M=u("所有版本"),S=async e=>{var a;let t="all";"常用版本"===M.value&&(t="streamline");try{let n;if("py"===s.compData.type){!0===e&&await l.$confirm({title:"提示",width:"35rem",icon:"warning",iconColor:"#E6A23C",message:"将从镜像源获取版本列表，是否继续？"});let s={force:!0===e?"true":"false"};x.value=!0,n=await j(s),k.value=n.data.sdk[t],o.value=(null==(a=n.data.command_path.find((e=>e.python_path===n.data.use)))?void 0:a.version)||""}else x.value=!0,n=await w(s.compData.type),L.value=n.data,n.data.sdk[t].sort(((e,a)=>a.installed-e.installed)),o.value=n.data.use,k.value=n.data.sdk[t]}catch(n){}finally{x.value=!1}},T=async e=>{try{const a=await f({name:e});l.$message.request(a),S()}catch(a){}},q=async e=>{y({confirm:{title:"安装",message:"是否安装[".concat(e,"]版本？"),icon:"warning"},loading:"正在安装，请稍后...",request:async()=>(c=[],"py"===s.compData.type?(V(),null==E||E.send({"x-http-token":window.vite_public_request_token}),null==E||E.send("tail -f /www/server/python_project/vhost/logs/py.log"),i.value=!0,await b({data:JSON.stringify({version:e})})):await h({version:e},s.compData.type)),async complete(){var e;s.compData&&"function"==typeof(null==(e=s.compData)?void 0:e.refresh)&&s.compData.refresh(),S(),null==E||E.close()}})},C=async e=>{y({confirm:{title:"卸载sdk",message:"卸载[".concat(e,"]版本后，相关项目将无法启动，是否继续？"),icon:"warning"},loading:"正在卸载，请稍后...",request:async()=>await _({version:e},s.compData.type),complete:S})};let E=null;const V=()=>{E=a({route:"/sock_shell",onMessage:H})},P=()=>{const e=document.querySelector(".logMsg");l.$nextTick((()=>{e&&(e.scrollTop=e.scrollHeight)}))},H=(e,a)=>{const t=a.data;c.push(t),c.length>50?r.value=c.slice(c.length-50).join("\n"):r.value=c.join("\n"),P(),t.includes("Done")&&(i.value=!1,null==E||E.close(),r.value="正在请求安装...",S())};return m((()=>{S()})),v((()=>{c=[],null==E||E.close()})),{__sfc:!0,props:s,versionUsed:o,vm:l,logPopup:i,logsMsg:r,dataArr:c,tableColumns:p,tableData:k,tableLoading:x,installMessage:D,allData:L,versionType:M,getVersionListEvent:S,setDefaultVersion:T,installVersionEvent:q,uninstallVersionEvent:C,useSocket:E,createWebSocket:V,scrollEnd:P,onWSReceive:H}}}),(function(){var e=this,a=e._self._c,t=e._self._setupProxy;return a("div",{staticClass:"p-20x"},[a(c,{scopedSlots:e._u([{key:"header-left",fn:function(){return[a(i,{attrs:{size:"small"},on:{change:t.getVersionListEvent},model:{value:t.versionType,callback:function(e){t.versionType=e},expression:"versionType"}},[a(r,{attrs:{label:"所有版本"}}),a(r,{attrs:{label:"常用版本"}}),e._v(" > ")],1)]},proxy:!0},{key:"header-right",fn:function(){return[a(s,{attrs:{type:"default"},on:{click:function(e){return t.getVersionListEvent(!0)}}},[e._v("更新版本列表")])]},proxy:!0},{key:"content",fn:function(){return[a(l,{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],attrs:{height:"400",column:t.tableColumns,data:t.tableData}})]},proxy:!0},{key:"popup",fn:function(){return[a(o,{attrs:{title:"安装信息",visible:t.logPopup,area:[50,36]},on:{"update:visible":function(e){t.logPopup=e},cancel:()=>t.logsMsg="正在请求安装..."}},[a("div",{staticClass:"bg-[#333] p-12x h-full text-white overflow-auto logMsg"},[a("pre",{staticClass:"whitespace-pre-wrap",domProps:{innerHTML:e._s(t.logsMsg)}})])])]},proxy:!0}])})],1)}),[],!1,null,"85b93185",null,null).exports;export{k as default};
