import{J as a,bI as t,n as e,_ as s,q as l}from"./main.js?v=1714377894636";import{_ as i}from"./index120.js?v=1714377894636";import{_ as r}from"./index52.js?v=1714377894636";import{_ as n}from"./index53.js?v=1714377894636";import{_ as c}from"./index39.js?v=1714377894636";import{_ as o,P as u}from"./element-lib.js?v=1714377894636";import{_ as m}from"./index57.js?v=1714377894636";import{_ as p}from"./index59.js?v=1714377894636";import{e as d,A as h,b as v,v as f,h as b,j as g}from"./vue-lib.js?v=1714377894636";import{u as _}from"./index28.js?v=1714377894636";import{J as y,K as C,L as x,N as j,O as k}from"./mysql.store.js?v=1714377894636";import{g as q,e as w}from"./index38.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{h as P}from"./database.popup.js?v=1714377894636";import{a as T}from"./confirm.js?v=1714377894636";import{o as S}from"./index61.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./index77.js?v=1714377894636";import"./index42.js?v=1714377894636";import"./check.js?v=1714377894636";import"./index45.js?v=1714377894636";import"./config.js?v=1714377894636";const D=e(d({__name:"index",props:{compData:{default:{}}},setup(e){const s=e,l=_(),{sqliteParam:i}=h(l),{proxy:r}=g(),n=v(),c=v(!0),o=v(0),u=v(""),m=v(!1),p=v(!0),d=v({p:1,total:0,search:"",serverList:[],data:[],path:"",table:"",emptyText:"暂无数据，您可以添加数据"});let D=v({});const L=v([]),O=v([]),J=v([]),N=v({mode:"ace/mode/nginx",theme:"ace/theme/chrome",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!1,fontSize:"12px"}),$=v([{label:"删除数据",value:"delete",diyBatch:()=>{const a=O.value.find((a=>1===a.pk)).name;S({title:"批量删除选中表【"+d.value.table+"】的数据后，该条数据将彻底消失，是否继续操作？",dataList:J.value,titleType:"批量删除表数据",requestFun:async a=>await z(a,!0),isRecurrence:!0,tableColumn:[{prop:a,label:a},{prop:"status",label:"状态"}],callback:()=>{V()}})}}]),E=f({isRecurrence:!0,describe:{title:"批量删除表数据",th:"表数据",message:"批量删除选中表【"+d.value.table+"】的数据后，该条数据将彻底消失，是否继续操作？",propsValue:""}}),I=a=>{P("更改数据【"+a.id+"】",{keys:O.value,row:a,path:d.value.path,table:d.value.table},(()=>{V()}))},z=async(a,t)=>{if(t){const{data:t}=await y({data:JSON.stringify({path:d.value.path,table:d.value.table,where_data:a})});return t}{const t=O.value.find((a=>1===a.pk)).name;T({confirm:{icon:"warning",title:"删除表数据 [ "+a[t]+" ]",message:"删除选中表【"+d.value.table+"】的数据后，该条数据将彻底消失，是否继续操作？"},loading:"正在删除表数据，请稍后...",request:async()=>await y({data:JSON.stringify({path:d.value.path,table:d.value.table,where_data:a})}),complete:V})}},H=v(),F=async(a,t)=>{var e;try{if(!D.value[a]||t){const{data:e}=await x({data:JSON.stringify({path:a})});D.value={...D.value,[a]:e},!t&&e.length>0&&G({path:a,name:e[0].name})}else(null==(e=D.value[a])?void 0:e.length)>0&&G({path:a,name:D.value[a][0].name})}catch(s){}},G=a=>{if(c.value=!1,"sql"===a.name){const e=t(8);return p.value=!1,L.value.push({name:"新建查询",path:"nq_con_"+e,sql:"",status:0,queryPath:a.path}),void(u.value="nq_con_"+e)}p.value=!0,L.value.find((t=>t.path===a.path&&t.name===a.name))||L.value.push({name:a.name,path:a.path}),K(a)},K=a=>{c.value=!1,"新建查询"===a.name?(p.value=!1,u.value=a.path):(p.value=!0,R(a))},R=async a=>{try{const{data:t}=await j({data:JSON.stringify({path:a.path,table:a.name})});O.value=t;let e=[];t.forEach((a=>{e.push({label:a.name,prop:a.name})})),H.value=[q(),...e,w([{onClick:I,title:"更改"},{onClick:a=>{z(a)},title:"删除"}])],d.value.path=a.path,d.value.table=a.name,V(),E.describe.propsValue=O.value.find((a=>1===a.pk)).name}catch(t){}},V=async()=>{try{u.value=d.value.table,m.value=!0;const{data:t}=await C({data:JSON.stringify({path:d.value.path,table:d.value.table,p:d.value.p,search:d.value.search})});m.value=!1,d.value.data="string"==typeof t.data?[]:t.data,d.value.emptyText="string"==typeof t.data?t.data:"暂无数据，您可以添加数据",d.value.total=a(t.page)}catch(t){}};return b((()=>{o.value=i.value.dbList.findIndex((a=>a.path===s.compData.path))||0,F(s.compData.path)})),{__sfc:!0,props:s,store:l,sqliteParam:i,vm:r,scrollDiv:n,isEmpty:c,active:o,activeChild:u,tableLoad:m,isTable:p,tableParam:d,dbObj:D,rightHeader:L,tableKeys:O,checkedList:J,config:N,batchGroup:$,handleSelectionChange:a=>{J.value=a},batchConfig:E,updateEvent:I,delEvent:z,tableColumn:H,insertData:()=>{P("添加数据",{keys:O.value,path:d.value.path,table:d.value.table},(()=>{V(),F(s.compData.path,!0)}))},getTableList:F,leftTableClick:G,removeItem:a=>{L.value.splice(a,1),L.value.length?K(L.value[a]||L.value[a-1]):c.value=!0},rightTableClick:K,renderTable:R,onChangePage:a=>{d.value.p=a,V()},getTableData:V,runSql:async a=>{try{if(a.status=1,a.sql){const{data:t}=await k({data:JSON.stringify({path:a.queryPath,sql_shell:a.sql})});a.result=t.status?t.list:t.msg,a.status=2}else a.result="请输入sql语句查询",a.status=2}catch(t){}},handleScroll:a=>{a.deltaY>0?n.value.scrollLeft+=100:n.value.scrollLeft-=100},refreshDb:async()=>{await F(s.compData.path,!0),r.$message.success("刷新成功")},refreshTable:async()=>{await V(),r.$message.success("刷新成功")}}}}),(function(){var a=this,t=a._self._c,e=a._self._setupProxy;return t("div",{staticClass:"flex w-full h-full"},[t("div",{staticClass:"man_l"},[t("ul",{staticClass:"man_db"},[a._l(e.sqliteParam.dbList,(function(l,i){return[l.path===a.compData.path?t("li",{key:i,class:i===e.active?"active":""},[t("div",{staticClass:"man_db_li"},[t("div",{staticClass:"man_db_li_left"},[t(s,{staticClass:"w-[1.4rem] h-[1.4rem] mr-4x ml-8x align-text-bottom",attrs:{src:"/database/database-icon.png"}}),t("span",{attrs:{title:l.name}},[a._v(a._s(l.name))])],1),t("div",{staticClass:"cursor-pointer ml-8x"},[t(o,{attrs:{size:"mini",icon:"el-icon-refresh-right"},on:{click:e.refreshDb}},[a._v("刷新")])],1)]),t("ul",{staticClass:"man_t"},[t("li",{staticClass:"new_query",class:-1!==e.activeChild.indexOf("nq_con_")?"active":"",on:{click:function(a){return e.leftTableClick({path:l.path,name:"sql"})}}},[t(s,{staticClass:"w-[1.4rem] mr-4x align-text-bottom",attrs:{src:"/database/select-icon.png"}}),t("span",[a._v("新建查询")])],1),a._l(e.dbObj[l.path],(function(i,r){return t("li",{key:r,class:i.name===e.activeChild?"active":"",on:{click:function(a){return e.leftTableClick({path:l.path,name:i.name})}}},[t(s,{staticClass:"w-[1.4rem] mr-4x align-text-bottom",attrs:{src:"/database/table-icon.png"}}),t("span",[a._v(a._s(i.name+"（"+i.count+"）"))])],1)}))],2)]):a._e()]}))],2)]),t("div",{staticClass:"man_r"},[e.isEmpty?[t("div",{staticClass:"flex items-center justify-center h-full"},[t(u,{attrs:{description:"请点击左侧表查看数据"}})],1)]:[t("div",{ref:"scrollDiv",staticClass:"ul_scroll",on:{wheel:e.handleScroll}},[t("ul",a._l(e.rightHeader,(function(l,i){return t("li",{class:l.name===e.activeChild||l.path===e.activeChild?"active":"",on:{click:function(a){return e.rightTableClick(l)}}},[t("div",{staticClass:"ul-item"},[t("div",{staticClass:"flex-1"},[t(s,{staticClass:"w-[1.4rem] h-[1.4rem] mr-4x align-middle text-[1.2rem]",attrs:{src:"新建查询"===l.name?"/database/select-icon.png":"/database/table-icon.png"}}),t("span",[a._v(a._s(l.name))])],1),t("i",{staticClass:"el-icon-close ml-4x",on:{click:function(a){return e.removeItem(i)}}})])])})),0)]),e.isTable?t(p,{staticClass:"p-[1.5rem]",scopedSlots:a._u([{key:"header-left",fn:function(){return[t(l,{on:{click:e.insertData}},[a._v("添加数据")])]},proxy:!0},{key:"header-right",fn:function(){return[t(m,{staticClass:"float-right",attrs:{placeholder:"搜索所有字段"},on:{clear:e.getTableData,search:e.getTableData},model:{value:e.tableParam.search,callback:function(t){a.$set(e.tableParam,"search",t)},expression:"tableParam.search"}}),t(o,{staticClass:"!ml-[1rem]",attrs:{icon:"el-icon-refresh-right"},on:{click:e.refreshTable}})]},proxy:!0},{key:"content",fn:function(){return[t(c,{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoad,expression:"tableLoad"}],ref:"redisTable",attrs:{"max-height":480,column:e.tableColumn,data:e.tableParam.data,description:e.tableParam.emptyText},on:{"selection-change":e.handleSelectionChange}})]},proxy:!0},{key:"footer-left",fn:function(){return[t(n,{attrs:{data:e.batchGroup,config:e.batchConfig,"batch-fn":()=>{}}})]},proxy:!0},{key:"footer-right",fn:function(){return[t(r,{attrs:{total:e.tableParam.total,"current-page":e.tableParam.p,pageSize:20,layout:"prev, pager, next, total, jumper"},on:{"update:currentPage":function(t){return a.$set(e.tableParam,"p",t)},"update:current-page":function(t){return a.$set(e.tableParam,"p",t)},"current-change":e.onChangePage}})]},proxy:!0}],null,!1,1817386197)}):t("div",{staticClass:"nq_con"},[a._l(e.rightHeader,(function(s,r){return["新建查询"===s.name?t("div",{key:r,class:s.path===e.activeChild?"":"hidden"},[t("div",{staticClass:"p-[1.5rem]"},[t(i,{staticClass:"!h-[21rem]",attrs:{config:e.config},model:{value:s.sql,callback:function(t){a.$set(s,"sql",t)},expression:"item.sql"}}),t(l,{staticClass:"!mt-[1rem]",attrs:{type:"default",disabled:1===s.status},on:{click:function(a){return e.runSql(s)}}},[a._v(" "+a._s(1===s.status?"正在查询...":"运行")+" ")])],1),t("div",{staticClass:"run_result p-[1.5rem]",class:s.status?"":"hidden"},[t("span",{staticClass:"text-[1.4rem]"},[a._v("查询结果：")]),t("div",{staticClass:"mt-[1rem]"},["string"!=typeof s.result?t("table",{staticClass:"result_table table",attrs:{border:"1"}},[t("tbody",a._l(s.result,(function(e,s){return t("tr",{key:s},a._l(e,(function(e,s){return t("td",{key:r},[a._v(a._s(e))])})),0)})),0)]):t("div",{staticClass:"text-danger"},[a._v(a._s(s.result))])])])]):a._e()]}))],2)]],2)])}),[],!1,null,"11f108a6",null,null).exports;export{D as default};
