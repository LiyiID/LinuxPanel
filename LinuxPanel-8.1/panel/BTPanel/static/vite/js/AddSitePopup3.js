import{aS as e,n as o,D as t,r as a,q as r,a as s}from"./main.js?v=1714377894636";import{w as l,x as i,j as d,q as n,s as c}from"./element-lib.js?v=1714377894636";import{_ as p}from"./index85.js?v=1714377894636";import{e as m,b as u,h as _,j as g}from"./vue-lib.js?v=1714377894636";import{g as f,b7 as v,b6 as b,b4 as j,b5 as w,B as x}from"./site.store.js?v=1714377894636";import{r as h}from"./site.rules.js?v=1714377894636";import{o as A}from"./confirm.js?v=1714377894636";import{c as F}from"./check.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./config.js?v=1714377894636";const y=o(m({__name:"AddSitePopup",props:{compData:{default:{rowData:{},isEdit:!1}}},setup(o,{expose:t}){const a=o,{getModulesList:r}=f(),{proxy:s}=g(),l=u({project_exe:"",project_name:"",port:"",project_cmd:"",run_user:"www",project_ps:"",domains:"",release_firewall:!1,is_power_on:!1,bind_extranet:!1}),i=u(!1),d=u(),n=u(!1),c=u([]),p=async()=>{try{const e=await v();c.value=e.data}catch(e){}},m=async e=>{let o=Object.assign({},l.value);if(""!==o.domains){o.bind_extranet=1;const e=F(o.domains,"string","");o.domains=e.split("\n")}else o.bind_extranet=0,delete o.domains;A({$refs:d.value,loading:{disable:i},request:async()=>{let t;return a.compData.isEdit?t=await j({data:JSON.stringify(o)},"go"):(t=await w({data:JSON.stringify(o)},"go"),e()),t.data.status?s.$message.success(t.data.data):s.$message.error(t.data.error_msg),r("go"),null}})},y=async()=>{var e;try{let o=(await x({data:JSON.stringify({project_name:null==(e=a.compData)?void 0:e.rowData.name})},"go")).data;o.isEdit=!0,l.value={...null==o?void 0:o.project_config,project_ps:null==o?void 0:o.ps,is_power_on:!!(null==o?void 0:o.project_config.is_power_on),not_install_pkg:!!(null==o?void 0:o.project_config.not_install_pkg)}}catch(o){}};return _((async()=>{n.value=!0,await p(),a.compData.isEdit&&y(),n.value=!1})),t({onConfirm:m}),{__sfc:!0,props:a,getModulesList:r,vm:s,goAddForm:l,formDisabled:i,goAddFormRef:d,formLoading:n,userList:c,getRootUser:p,changeName:e=>{l.value.project_ps=e},checkPortUse:async()=>{if(l.value.port)try{const e=await b({port:l.value.port},"go");e.status||(s.$message.request(e),l.value.port="")}catch(e){}},onPathChange:()=>{e({type:"file",path:l.value.project_exe,change:e=>{var o;l.value.project_exe=e,l.value.project_cmd=null==e?void 0:e.replace(/\/\//g,"/");let t=null==(o=e.substring(e.lastIndexOf("/")+1))?void 0:o.replace(/\./g,"_");l.value.project_name=t,l.value.project_ps=t}})},onConfirm:m,getInfo:y,rules:h}}}),(function(){var e=this,o=e._self._c,m=e._self._setupProxy;return o("div",{staticClass:"p-20x"},[o(l,{directives:[{name:"loading",rawName:"v-loading",value:m.formLoading,expression:"formLoading"}],ref:"goAddFormRef",attrs:{model:m.goAddForm,"label-width":"100px",rules:m.rules,disabled:m.formDisabled}},[o(i,{attrs:{label:"项目执行文件",prop:"project_exe"}},[o(p,{attrs:{width:"32rem","icon-type":"folder",placeholder:"请选择项目可执行文件"},on:{folder:m.onPathChange},model:{value:m.goAddForm.project_exe,callback:function(o){e.$set(m.goAddForm,"project_exe",o)},expression:"goAddForm.project_exe"}})],1),o(i,{attrs:{label:"项目名称",prop:"project_name"}},[o(p,{attrs:{width:"32rem",disabled:e.compData.isEdit,placeholder:"请输入GO项目名称"},on:{input:m.changeName},model:{value:m.goAddForm.project_name,callback:function(o){e.$set(m.goAddForm,"project_name",o)},expression:"goAddForm.project_name"}})],1),o(i,{attrs:{label:"项目端口",prop:"port"}},[o("div",{staticClass:"flex items-center"},[o(p,{staticClass:"mr-12x",attrs:{width:"20rem",type:"number",placeholder:"请输入项目的真实端口"},on:{blur:m.checkPortUse},model:{value:m.goAddForm.port,callback:function(o){e.$set(m.goAddForm,"port",o)},expression:"goAddForm.port"}}),e.compData.isEdit?e._e():o(t,{model:{value:m.goAddForm.release_firewall,callback:function(o){e.$set(m.goAddForm,"release_firewall",o)},expression:"goAddForm.release_firewall"}},[e._v(" 放行端口 "),o(d,{staticClass:"item",attrs:{effect:"dark",content:"选中将在防火墙安全组放行监听端口，放行后该项目可在外网访问",placement:"right"}},[o("i",{staticClass:"el-icon-question text-warning"})])],1)],1)]),o(i,{attrs:{label:"执行命令",prop:"project_cmd"}},[o(p,{attrs:{placeholder:"请输入项目的执行命令",width:"32rem"},model:{value:m.goAddForm.project_cmd,callback:function(o){e.$set(m.goAddForm,"project_cmd",o)},expression:"goAddForm.project_cmd"}})],1),o(i,{attrs:{label:"运行用户"}},[o("div",{staticClass:"flex items-center"},[o(n,{staticClass:"mr-8x w-[16rem]",model:{value:m.goAddForm.run_user,callback:function(o){e.$set(m.goAddForm,"run_user",o)},expression:"goAddForm.run_user"}},e._l(m.userList,(function(e){return o(c,{key:e,attrs:{value:e,label:e}})})),1),o("span",{staticClass:"text-[1.2rem] text-[#666]"},[e._v("* 无特殊需求请选择www用户")])],1)]),o(i,{attrs:{label:"开机启动"}},[o(t,{model:{value:m.goAddForm.is_power_on,callback:function(o){e.$set(m.goAddForm,"is_power_on",o)},expression:"goAddForm.is_power_on"}},[e._v("是否设置开机自动启动（默认自带守护进程每120秒检测一次）")])],1),o(i,{attrs:{label:"项目备注"}},[o(p,{attrs:{width:"32rem",placeholder:"输入项目备注，非必填"},model:{value:m.goAddForm.project_ps,callback:function(o){e.$set(m.goAddForm,"project_ps",o)},expression:"goAddForm.project_ps"}})],1),e.compData.isEdit?e._e():o(i,{attrs:{label:"绑定域名"}},[o(a,{ref:"popover",attrs:{placement:"top-start","popper-class":"green-tips-popover",title:"",width:"400",trigger:"focus"}},[o("div",{staticClass:"!p-12x bg-[#20a53a] text-white"},[e._v(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),o("br"),e._v(" IP地址格式：192.168.1.199"),o("br"),e._v(" 泛解析添加方法 *.domain.com"),o("br"),e._v(" 如另加端口格式为 www.domain.com:88 ")]),o(p,{directives:[{name:"popover",rawName:"v-popover:popover",arg:"popover"}],attrs:{slot:"reference",rows:6,resize:"none",width:"40rem",type:"textarea",placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},slot:"reference",model:{value:m.goAddForm.domains,callback:function(o){e.$set(m.goAddForm,"domains",o)},expression:"goAddForm.domains"}})],1)],1),e.compData.isEdit?o(i,{attrs:{label:" "}},[o(r,{on:{click:m.onConfirm}},[e._v("保存配置")])],1):e._e()],1),e.compData.isEdit?e._e():o("ul",{staticClass:"mt-20x leading-8 text-[1.2rem] list-disc ml-20x"},[o("li",[e._v("执行命令：请输入项目需要携带的参数，默认请输入执行文件名")]),o("li",[e._v(" 项目教程可参考: "),o(s,{attrs:{href:"https://www.bt.cn/bbs/thread-93034-1-1.html"}},[e._v("https://www.bt.cn/bbs/thread-93034-1-1.html "),o("i",{staticClass:"el-icon-link"})])],1)])],1)}),[],!1,null,"2dc741e0",null,null).exports;export{y as default};
