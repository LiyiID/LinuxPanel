import{s as e,n as t,f as s,l as a,q as i,aZ as o}from"./main.js?v=1714377894636";import{_ as l}from"./date-picker.js?v=1714377894636";import{_ as r}from"./index117.js?v=1714377894636";import{_ as n}from"./index46.js?v=1714377894636";import{e as p,b as c,v as m,h as u,j as d,A as f,f as _}from"./vue-lib.js?v=1714377894636";import{i as v}from"./locales-lib.js?v=1714377894636";import{u as g}from"./docker.store.js?v=1714377894636";import{_ as y}from"./index85.js?v=1714377894636";import{w as h,x as b}from"./element-lib.js?v=1714377894636";import{U as x,V as w,W as C}from"./docker.api.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./date-util.js?v=1714377894636";import"./radio-button.js?v=1714377894636";import"./index.vue_vue_type_style_index_0_lang.js?v=1714377894636";import"./check.js?v=1714377894636";const k=t(p({__name:"LogCutConfig",props:{compData:{default:()=>({})}},setup(t,{expose:s}){const a=t,{proxy:i}=d(),o=c({}),l=m({split_type:"size",split_hour:2,split_minute:0,save:"180",split_size:"10.00"}),r=c(!1),n=c(),p={template_id:[{validator:(e,t,s)=>{""===t?s(new Error("请选择Compose模板")):s()},trigger:["blur"]}]};u((()=>{o.value=a.compData.data,l.split_type=o.value.split_type,l.split_size=o.value.split_size,l.split_hour=o.value.split_hour,l.split_minute=o.value.split_minute,l.save=o.value.save}));const f=async()=>{try{if("size"===l.split_type){if(Number(l.split_hour)<0)return void i.$message.error("请填写正确的大小")}else{if(Number(l.split_hour)>23||Number(l.split_hour)<0)return void i.$message.error("请填写正确的小时");if(Number(l.split_minute)>59||Number(l.split_minute)<0)return void i.$message.error("请填写正确的分钟")}if(Number(l.save)>1800||Number(l.save)<0)return void i.$message.error("请填写正确的保留份数（1-1800）");n.value.$root.loading(r,"正在设置...");const e=await x({data:JSON.stringify({pid:a.compData.id,type:"add",log_path:a.compData.path,split_type:l.split_type,split_size:l.split_size,split_hour:l.split_hour,split_minute:l.split_minute,save:l.save})});e.status?(i.$emit("close"),i.$message.success(e.msg)):i.$message.error(e.msg)}catch(e){}};return s({onConfirm:f}),{__sfc:!0,vm:i,props:a,config:o,configForm:l,disabled:r,manualFormRef:n,manualRules:p,options:[{value:"size",title:"按日志大小"},{value:"day",title:"按执行时间"}],dirEvent:async t=>{e("Path","/var/lib/docker/containers/history_logs"),window.location.href=window.location.origin+"/files"},onConfirm:f}}}),(function(){var e=this,t=e._self._c,s=e._self._setupProxy;return t("div",{staticClass:"container-dialog"},[t(h,{ref:"manualFormRef",staticClass:"relative w-full",attrs:{size:"small",model:s.configForm,rules:s.manualRules,disabled:s.disabled,"label-position":"right"},nativeOn:{submit:function(e){e.preventDefault()}}},[t(b,{attrs:{prop:"name",label:"切割路径"}},[e._v(" /var/lib/docker/containers/history_logs "),t("span",{staticClass:"text-[#20a53a] text-[1.2rem] ml-[1rem] hover:text-[#1d9534] cursor-pointer",on:{click:s.dirEvent}},[e._v("打开目录")])]),t(b,{attrs:{prop:"split_type",label:"切割方式"}},[t(r,{attrs:{options:s.options},model:{value:s.configForm.split_type,callback:function(t){e.$set(s.configForm,"split_type",t)},expression:"configForm.split_type"}})],1),t(b,{directives:[{name:"show",rawName:"v-show",value:"day"===s.configForm.split_type,expression:"configForm.split_type === 'day'"}],attrs:{prop:"port",label:"执行时间"}},[t("div",{staticClass:"flex items-center"},[t("span",{staticClass:"inline-block bg-[#f5f7fa] text-[#909399] align-middle border-[#dcdfe6] border rounded-[.4rem] px-[.8rem] mr-[1rem]"},[e._v("每天")]),t(y,{staticClass:"w-[12rem] mr-[1rem]",attrs:{textType:"时"},model:{value:s.configForm.split_hour,callback:function(t){e.$set(s.configForm,"split_hour",t)},expression:"configForm.split_hour"}}),t(y,{staticClass:"w-[12rem]",attrs:{textType:"分"},model:{value:s.configForm.split_minute,callback:function(t){e.$set(s.configForm,"split_minute",t)},expression:"configForm.split_minute"}})],1)]),t(b,{directives:[{name:"show",rawName:"v-show",value:"size"===s.configForm.split_type,expression:"configForm.split_type === 'size'"}],attrs:{prop:"name",label:"日志大小"}},[t(y,{staticClass:"w-[15rem]",attrs:{textType:"MB"},model:{value:s.configForm.split_size,callback:function(t){e.$set(s.configForm,"split_size",t)},expression:"configForm.split_size"}})],1),t(b,{attrs:{prop:"name",label:"保留最新"}},[t(y,{staticClass:"w-[12rem]",attrs:{textType:"份"},model:{value:s.configForm.save,callback:function(t){e.$set(s.configForm,"save",t)},expression:"configForm.save"}})],1)],1),t("ul",{staticClass:"tips mt-[1.6rem] list-square ml-[2rem]"},[t("li",{directives:[{name:"show",rawName:"v-show",value:"day"===s.configForm.split_type,expression:"configForm.split_type === 'day'"}]},[e._v("每5分钟执行一次")]),t("li",{directives:[{name:"show",rawName:"v-show",value:"size"===s.configForm.split_type,expression:"configForm.split_type === 'size'"}],staticClass:"mt-[.5rem]"},[e._v(" 【日志大小】：日志文件大小超过指定大小时进行切割日志文件 ")]),t("li",{staticClass:"mt-[.5rem]"},[e._v(" 【保留最新】：保留最新的日志文件，超过指定数量时，将自动删除旧的日志文件 ")])])],1)}),[],!1,null,"a34478dc",null,null).exports;const j=t(p({__name:"ConLog",props:{compData:{default:()=>({})}},setup(e){const t=e,{proxy:i}=d(),{containerLogTab:o}=f(g()),l=c({logs:"",split_status:!0,split_type:"size",split_size:1388444647424,split_hour:2,split_minute:0,save:180,logs_path:""}),r=c(!1),n=c("all"),p=c([]),y=c(),h=c(!1),b=m({date:[]}),j=c([{title:"全部",value:"all"},{title:"最近7天",value:"7"},{title:"最近30天",value:"30"}]),F=m({disabledDate:e=>{const t=new Date;t.setHours(23,59,59,999);const s=t.getTime();return e.getTime()>s}}),D=async()=>{try{const e={id:t.compData.id};if("all"!=n.value)if(b.date.length>0)e.time_search=b.date;else{const t=Math.floor(Date.now()/1e3);let s=0;"7"==n.value?s=t-604800:"30"==n.value&&(s=t-2592e3),e.time_search=[s,t]}const s=await w({data:JSON.stringify(e)});l.value=s,r.value=s.split_status}catch(e){}};return _((()=>o.value),(()=>{o.value==t.compData.id&&D()}),{immediate:!0}),u((()=>{})),{__sfc:!0,vm:i,props:t,containerLogTab:o,log:l,logCut:r,day:n,datePicker:p,datePickerRef:y,isDate:h,dateData:b,options:j,setQuick:e=>{p.value=[],b.date=[],n.value=e,h.value=!1,D()},setDate:()=>{y.value.showPicker()},pickerOptions:F,changeDate:e=>{n.value="",e.forEach(((e,t)=>{b.date[t]=e/1e3})),h.value=!0,D()},toggleCutLog:async e=>{let s=null;try{await i.$confirm({icon:"warning",title:"".concat(e?"开启":"关闭","日志切割"),width:"35rem",message:"".concat(e?"开启后":"关闭后将无法","对该容器日志进行切割，是否继续操作？")});const a={pid:t.compData.id,type:e?"add":"del"};e&&(a.log_path=l.value.logs_path,a.split_type=l.value.split_type,a.split_size=l.value.split_size,a.split_hour=l.value.split_hour,a.split_minute=l.value.split_minute,a.save=l.value.save),s=i.$load("正在设置日志切割状态，请稍候...");const o=await x({data:JSON.stringify(a)});i.$message.request(o)}catch(a){"cancel"===a&&(r.value=!e)}finally{s&&(null==s||s.close())}},editConfig:()=>{a({title:v.t("Docker.logCutConfig"),area:50,btn:["提交","取消"],component:k,compData:{data:l,id:t.compData.id,path:l.value.logs_path},showClose:!0,close(){D()}})},getLog:D,downloadLog:async()=>{window.open("/download?filename=".concat(l.value.logs_path))},clearLog:async()=>{const e=await C({log_path:l.value.logs_path});e.status?(i.$message.success(e.msg),D()):i.$message.error(e.msg)},formatTime:s}}}),(function(){var e=this,t=e._self._c,s=e._self._setupProxy;return t("div",{staticClass:"flex flex-col lib-box"},[t("div",{staticClass:"flex items-center border-[#ececec] border-b py-[1rem]"},[t("span",[e._v("日志切割")]),t(n,{staticClass:"ml-[.7rem]",attrs:{change:s.toggleCutLog},model:{value:s.logCut,callback:function(e){s.logCut=e},expression:"logCut"}}),t("span",{staticClass:"ml-[2rem]"},[t("span",[e._v("开启后每天2点0分进行切割日志文件，如需修改请点击")]),t("span",{staticClass:"cursor-pointer text-[#20a53a] hover:text-[#1d9534]",on:{click:s.editConfig}},[e._v(" 编辑配置 ")])])],1),t("div",{staticClass:"con"},[t("div",{staticClass:"logTop flex items-center justify-between"},[t("div",{staticClass:"btnGroup flex my-[1.6rem] items-center"},[t(i,{attrs:{type:"default",size:"small"},on:{click:s.getLog}},[e._v("刷新日志")]),t("div",{staticClass:"line mx-[1rem] w-[.1rem] h-[2rem] bg-[#ccc] align-middle"}),t(i,{attrs:{type:"default",size:"small"},on:{click:s.downloadLog}},[e._v("下载日志")]),t(i,{attrs:{type:"default",size:"small"},on:{click:s.clearLog}},[e._v("清空日志")])],1),t("div",{staticClass:"action flex items-center relative"},[t(r,{attrs:{type:"button",options:s.options},on:{change:s.setQuick},model:{value:s.day,callback:function(e){s.day=e},expression:"day"}}),t(i,{style:s.isDate?"background:#20a53a; color:#fff;margin: 0 0 0 1rem;":"margin: 0 0 0 1rem;",attrs:{type:"default"},on:{click:s.setDate}},[e._v(" "+e._s(s.isDate?"".concat(s.formatTime(s.dateData.date[0],"yyyy-MM-dd")," - ").concat(s.formatTime(s.dateData.date[1],"yyyy-MM-dd")):"自定义时间")+" ")]),t(l,{ref:"datePickerRef",staticClass:"!absolute left-[21.9rem]",attrs:{type:"daterange","range-separator":"","start-placeholder":"自定义时间","end-placeholder":"","value-format":"timestamp","default-time":["00:00:00","23:59:59"],"picker-options":s.pickerOptions},on:{change:s.changeDate},model:{value:s.datePicker,callback:function(e){s.datePicker=e},expression:"datePicker"}})],1)]),t("div",{staticClass:"h-[50rem] overflow-y-auto"},[t(o,{staticClass:"h-full",attrs:{content:s.log.logs}})],1)])])}),[],!1,null,"388b4133",null,null).exports;export{j as default};
