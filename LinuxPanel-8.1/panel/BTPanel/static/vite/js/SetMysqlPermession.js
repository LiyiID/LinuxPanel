import{_ as e}from"./index85.js?v=1714377894636";import{w as s,x as r}from"./element-lib.js?v=1714377894636";import{l as t,n as a}from"./main.js?v=1714377894636";import{_ as o}from"./index41.js?v=1714377894636";import{_ as i}from"./preload-helper.js?v=1714377894636";import{e as m,b as p,v as l,h as n,j as u}from"./vue-lib.js?v=1714377894636";import{C as c,E as d}from"./mysql.store.js?v=1714377894636";import{o as f}from"./confirm.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./check.js?v=1714377894636";import"./config.js?v=1714377894636";const j=a(m({__name:"SetMysqlPermession",props:{compData:{default:{}}},setup(e,{expose:s}){const r=e,{proxy:a}=u(),o=p(),m=p(!1),j=l({permission:"",ip:""}),_=p([{title:"所有人",key:"%"},{title:"本地服务器",key:"127.0.0.1"},{title:"指定ip",key:"ip"}]),b={ip:[{validator:(e,s,r)=>{s.length?r():r(new Error("ip地址不可为空！"))},trigger:["blur","change"]}]},g=async e=>{var s;const{permission:p,ip:l}=j;"%"===p&&await a.$confirm({title:"提示",message:"设置权限为所有人后，将会导致数据库安全性降低，他人可以随意访问数据库，是否继续操作？",icon:"warning",iconColor:"#E6A23C"});let n={name:r.compData.username,dataAccess:p,access:"ip"===p?l:p,address:"ip"===p?l:""};"multlples"==r.compData.type&&(n.name=null==(s=r.compData.data)?void 0:s.map((e=>e.username)).join(","),"ip"!==p&&delete n.ip),f({$refs:o.value,loading:m,request:async()=>{var s,a;if("multlples"!==r.compData.type)return await c(n);{const o=await c(n);1===r.compData.data.length&&(o.error={},o.success=[],o.data.status&&(o.success=[r.compData.data[0].name]),!o.data.status&&(o.error={[r.compData.data[0].name]:o.data.msg}));let m=null==(s=o.success)?void 0:s.map((e=>({name:e,status:!0}))),p=null==(a=Object.keys(o.error))?void 0:a.map((e=>({name:e,status:!1})));e(),t({title:"批量修改权限结果",area:42,component:()=>i((()=>import("./index63.js?v=1714377894636")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url),compData:{resultData:[...m,...p],resultTitle:"修改权限"}})}}})},D=async()=>{if("multlples"==r.compData.type)return void(j.permission="127.0.0.1");const{data:e}=await d({name:r.compData.username});if(!e.status)return a.$message.error(e.msg);"127.0.0.1"==e.msg?j.permission="127.0.0.1":"%"==e.msg?j.permission="%":(j.permission="ip",j.ip=e.msg)};return n((()=>{D()})),s({onConfirm:g}),{__sfc:!0,vm:a,props:r,permissionForm:o,formDisabled:m,ruleForm:j,permissionOptions:_,rules:b,onSubmit:g,checkIpAddress:(e,s,r)=>{let t=/^((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})(\.((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})){3}$/,a=s.split("\n"),o=!0;if(a.length)for(let i=0;i<a.length;i++)0==t.test(a[i])&&(o=!1);if(""==s)return r(new Error("ip地址不可为空"));o?r():r(new Error("请输入正确的ip地址"))},onOpen:D}}}),(function(){var t=this,a=t._self._c,i=t._self._setupProxy;return a("div",{staticClass:"p-20x"},[a(s,{ref:"permissionForm",attrs:{disabled:i.formDisabled,model:i.ruleForm,rules:i.rules,"label-width":"5rem"}},[a(r,{attrs:{label:t.$t("DataBase.VisitPermission"),prop:"permission"}},[a(o,{staticClass:"w-[22rem]",attrs:{value:i.ruleForm.permission,options:i.permissionOptions},on:{"update:value":function(e){return t.$set(i.ruleForm,"permission",e)}}})],1),"ip"===i.ruleForm.permission?a(r,{attrs:{prop:"ip",label:t.$t("DataBase.IpAddress")}},[a(e,{attrs:{type:"textarea",rows:"4",width:"22rem",placeholder:"如果要允许IP段访问，可以使用%作为通配符，如127.17.%.%，如需要填写多个IP，请换行填写，每行一个IP"},model:{value:i.ruleForm.ip,callback:function(e){t.$set(i.ruleForm,"ip",e)},expression:"ruleForm.ip"}})],1):t._e()],1)],1)}),[],!1,null,null,null,null).exports;export{j as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./index63.js?v=1714377894636","./index39.js?v=1714377894636","./element-lib.js?v=1714377894636","./__commonjsHelpers__.js?v=1714377894636","./vue-lib.js?v=1714377894636","./public-lib.js?v=1714377894636","./main.js?v=1714377894636","./modulepreload-polyfill.js?v=1714377894636","./preload-helper.js?v=1714377894636","./request-lib.js?v=1714377894636","./locales-lib.js?v=1714377894636","./element-lib.js?v=1714377894636"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
