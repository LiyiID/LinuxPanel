import{n as e,q as s}from"./main.js?v=1714377894636";import{a9 as a,w as r,x as l,q as o,s as t}from"./element-lib.js?v=1714377894636";import{_ as n}from"./index130.js?v=1714377894636";import{e as i,b as p,h as m,j as g}from"./vue-lib.js?v=1714377894636";import{g as c,by as d,bz as u,bA as f,bB as y}from"./site.store.js?v=1714377894636";import{e as b}from"./check.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";const S=e(i({__name:"ApplyBtSsl",setup(e){var s,a;const{refs:{domainAllList:r,siteInfo:l},getDomainAllList:o,getSslInfoConfig:t,getTrustAsiaDataList:n,getPhpModulesList:i,getModulesList:S}=c(),{proxy:h}=g(),v=p(),I=p({domain:l.value.name||(null==(a=null==(s=r.value)?void 0:s.data[0])?void 0:a.name),orgName:"",orgRegion:"",orgCity:"",orgAddress:"",orgPhone:"",orgPostalCode:"",orgDivision:"总务",path:l.value.path}),C=p({orgName:[{required:!0,message:"请输入个人/公司名称",trigger:["bulr","change"]}],orgRegion:[{required:!0,message:"请输入所在省份",trigger:["bulr","change"]}],orgCity:[{required:!0,message:"请输入所在市/县",trigger:["bulr","change"]}],orgAddress:[{required:!0,message:"请输入个人/公司地址",trigger:["bulr","change"]}],orgPhone:[{required:!0,message:"请输入手机号码",validator:(e,s,a)=>{b(s)?a():a(new Error("请输入正确的手机号码"))},trigger:["bulr","change"]}],orgPostalCode:[{required:!0,message:"请输入邮政编码",validator:(e,s,a)=>{6===s.length?a():a(new Error("请输入正确的邮政编码"))},trigger:["bulr","change"]}]}),x=async e=>{var s;let a=null;try{a=h.$load("正在部署证书，请稍后...");const{data:r}="proxy"==l.value.project_type||"nginx"==l.value.project_type?await f({site_name:l.value.name,partnerOrderId:e.partnerOrderId}):await y({partnerOrderId:e.partnerOrderId,siteName:l.value.name});if(r.status)if(h.$message.request(r),await n(),t(),"PHP"===l.value.project_type)i();else{let e=null==(s=l.value.project_type)?void 0:s.toLowerCase();"node"===e&&(e="nodejs"),S(e)}else h.$message.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:"当前证书已成功申请并验证，自动部署失败，请尝试手动部署证书！\n"+r.msg,type:res.status?"success":"error",showClose:!res.status})}catch(r){}finally{a&&a.close()}};return m((()=>{})),{__sfc:!0,domainAllList:r,siteInfo:l,getDomainAllList:o,getSslInfoConfig:t,getTrustAsiaDataList:n,getPhpModulesList:i,getModulesList:S,vm:h,applySslInfoForm:v,applySslInfo:I,rules:C,onConfirm:async()=>{let e=null;h.$refs.applySslInfoForm.validate((async s=>{if(s)try{e=h.$load("正在提交证书申请资料，请稍后...");const{data:s,msg:a,status:r}=await d(I.value);if(r){h.$emit("close"),h.$message.success(s.msg||a||"申请成功"),e&&e.close(),e=h.$load("正在验证证书申请状态，请稍后...");const{data:r,status:o,msg:t}=await u({partnerOrderId:s.partnerOrderId,siteName:l.value.name});o?"COMPLETED"==r.stateCode?(h.$message.success("验证成功！即将开始证书部署！"),x(s)):h.$message.success("等待CA验证中，若长时间未能成功验证，请登录官网使用DNS方式重新申请..."):h.$message.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:t,type:"error",duration:0,showClose:!0})}else h.$message.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:s.msg||a,type:"error",duration:0,showClose:!0})}catch(a){}finally{e&&e.close(),await n()}}))},deployCert:x}}}),(function(){var e,i=this,p=i._self._c,m=i._self._setupProxy;return p("div",{staticClass:"p-16x"},[p(a,{attrs:{type:"error",closable:!1},scopedSlots:i._u([{key:"title",fn:function(){return[p("span",{staticClass:"text-[1.2rem]"},[p("i",{attrs:{calss:"el-icon-warning-outline text-[1.2rem]"}}),p("span",[i._v(" 禁止含有诈骗、赌博、色情、木马、病毒等违法违规业务信息的站点申请SSL证书，如有违反，撤销申请，停用账号。 ")])])]},proxy:!0}])}),p(r,{ref:"applySslInfoForm",staticClass:"mt-16x pb-16x",attrs:{rules:m.rules,model:m.applySslInfo,"label-width":"100px"}},[p(l,{attrs:{label:"证书信息"}},[p("span",{staticClass:"text-primary"},[i._v(" TrustAsia TLS RSA CA(免费版)")])]),p(l,{attrs:{label:"域名",prop:"domain"}},[p(o,{attrs:{placeholder:"请选择"},model:{value:m.applySslInfo.domain,callback:function(e){i.$set(m.applySslInfo,"domain",e)},expression:"applySslInfo.domain"}},i._l(null==(e=m.domainAllList)?void 0:e.data,(function(e){return p(t,{key:e.id,attrs:{label:e.name,value:e.name}})})),1)],1),p(l,{attrs:{label:"个人/公司名称",prop:"orgName"}},[p(n,{attrs:{"custom-class":"!w-[36rem]","placeholder-tips":"请输入个人/公司名称，必填项"},model:{value:m.applySslInfo.orgName,callback:function(e){i.$set(m.applySslInfo,"orgName",e)},expression:"applySslInfo.orgName"}})],1),p(l,{attrs:{label:"所在地区",prop:"orgRegion"}},[p("div",{staticClass:"flex flex-row"},[p(n,{attrs:{"custom-class":"mr-16x !w-[17rem]","placeholder-tips":"请输入所在省份，必填项"},model:{value:m.applySslInfo.orgRegion,callback:function(e){i.$set(m.applySslInfo,"orgRegion",e)},expression:"applySslInfo.orgRegion"}}),p(n,{attrs:{"custom-class":"!w-[17.4rem]","placeholder-tips":"请输入所在市/县，必填项"},model:{value:m.applySslInfo.orgCity,callback:function(e){i.$set(m.applySslInfo,"orgCity",e)},expression:"applySslInfo.orgCity"}})],1)]),p(l,{attrs:{label:"地址",prop:"orgAddress"}},[p(n,{attrs:{"custom-class":"!w-[36rem]","placeholder-tips":"请输入个人/公司地址，必填项"},model:{value:m.applySslInfo.orgAddress,callback:function(e){i.$set(m.applySslInfo,"orgAddress",e)},expression:"applySslInfo.orgAddress"}})],1),p(l,{attrs:{label:"手机",prop:"orgPhone"}},[p(n,{attrs:{"custom-class":"!w-[36rem]","placeholder-tips":"请输入手机号码，必填项"},model:{value:m.applySslInfo.orgPhone,callback:function(e){i.$set(m.applySslInfo,"orgPhone",e)},expression:"applySslInfo.orgPhone"}})],1),p(l,{attrs:{label:"邮政编码",prop:"orgPostalCode"}},[p(n,{attrs:{"custom-class":"!w-[36rem]","placeholder-tips":"请输入邮政编码，必填项"},model:{value:m.applySslInfo.orgPostalCode,callback:function(e){i.$set(m.applySslInfo,"orgPostalCode",e)},expression:"applySslInfo.orgPostalCode"}})],1),p(l,{attrs:{label:" "}},[p(s,{on:{click:m.onConfirm}},[i._v("申请证书")])],1)],1)],1)}),[],!1,null,"5f0dc5a7",null,null).exports;export{S as default};
