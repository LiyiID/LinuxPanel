import{_ as e}from"./index118.js?v=1714377894636";import{y as a,z as t}from"./element-lib.js?v=1714377894636";import{n as l}from"./main.js?v=1714377894636";import{_ as s}from"./index39.js?v=1714377894636";import{_ as o}from"./index59.js?v=1714377894636";import{e as n,b as r,v as i,c as m,h as p,j as c}from"./vue-lib.js?v=1714377894636";import{c as u}from"./check.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{g as d}from"./index28.js?v=1714377894636";import{B as b,f as _,t as v,u as f}from"./mysql.store.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./index77.js?v=1714377894636";import"./index42.js?v=1714377894636";const g=l(n({__name:"OwnBackup",props:{compData:{default:{}}},setup(e,{expose:a}){const t=e,{proxy:l}=c(),{refs:{tabActive:s}}=d(),{name:o,id:n}=t.compData,g=r("mongodb"==s.value?"bson":"db"),y=r(!1),x=r([]),j=r([]),w=i({id:n,table_list:j.value,storage_type:g.value,password:""}),h=m((()=>{let e=[{text:"分表导出：一张表存储为一个SQL文件。"},{text:"合并导出：将选中的表导出到一个SQL文件内"},{text:"备份格式：打包后压缩包内的文件格式"}];return"mysql"==s.value&&e.push({text:"压缩密码：设置备份压缩密码后请注意保存好密码！",color:"text-warning"}),e})),k=r([{type:"selection",width:50},{prop:"mongodb"==s.value?"collection_name":"table_name",label:"表名"},{prop:"mongodb"==s.value?"count":"rows_count",label:"行数"},{prop:"mongodb"===s.value?"size":"pgsql"===s.value?"table_size":"data_size",label:"大小"}]),C=async e=>{try{if(0===j.value.length)return void l.$message.error("请至少选择一项要备份的表");if("mysql"==s.value){let e=j.value.map((e=>e.table_name));const a=await b({...w,table_list:JSON.stringify(e)});l.$message.request(a)}else{let e=j.value.map((e=>e.table_name||e.collection_name)),a={...w,table_list:e};"mongodb"===s.value&&(a.collection_list=e,a.file_type=w.storage_type,a.storage_type="table"),delete a.password;const t=await _({data:JSON.stringify(a)},s.value);l.$message.request(t)}e()}catch(a){}},B=async()=>{try{if(y.value=!0,"mysql"==s.value){const e=await v({db_name:o});x.value=e.tables}else{const e=await f({data:JSON.stringify({db_name:o})},s.value);x.value=u(e.data.table_list,"array",[]),"mongodb"===s.value&&(x.value=u(e.data.collection_list,"array",[]))}y.value=!1}catch(e){}finally{y.value=!1}},S=()=>{w.password=""};return a({onConfirm:C,onCanel:S}),p((()=>{B()})),{__sfc:!0,vm:l,props:t,tabActive:s,name:o,id:n,radioValue:g,loading:y,tableData:x,tableSelected:j,ownBackParam:w,tipList:h,tableColumn:k,handleSelection:e=>{j.value=e},onConfirm:C,onOpen:B,onCanel:S}}}),(function(){var l=this,n=l._self._c,r=l._self._setupProxy;return n("div",{staticClass:"p-20x"},[n(o,{scopedSlots:l._u([{key:"content",fn:function(){return[n(s,{directives:[{name:"loading",rawName:"v-loading",value:r.loading,expression:"loading"}],attrs:{"max-height":"260",column:r.tableColumn,"element-loading-text":"正在加载列表，请稍后...",data:r.tableData},on:{"selection-change":r.handleSelection}})]},proxy:!0},{key:"footer-left",fn:function(){return[n("div",[n("div",{staticClass:"flex items-center mt-16x leading-[3rem]"},[n("span",{staticClass:"mr-16x"},[l._v("备份方式")]),"mongodb"!=r.tabActive?n(a,{model:{value:r.ownBackParam.storage_type,callback:function(e){l.$set(r.ownBackParam,"storage_type",e)},expression:"ownBackParam.storage_type"}},[n(t,{attrs:{label:"db"}},[l._v("合并导出")]),n(t,{attrs:{label:"table"}},[l._v("分表导出")])],1):l._e(),"mongodb"==r.tabActive?n(a,{model:{value:r.ownBackParam.storage_type,callback:function(e){l.$set(r.ownBackParam,"storage_type",e)},expression:"ownBackParam.storage_type"}},[n(t,{attrs:{label:"bson"}},[l._v("bson")]),n(t,{attrs:{label:"json"}},[l._v("json")])],1):l._e()],1)])]},proxy:!0}])}),n(e,{staticClass:"ml-20x mt-36x",attrs:{list:r.tipList,"list-style":"disc"}})],1)}),[],!1,null,null,null,null).exports;export{g as default};
