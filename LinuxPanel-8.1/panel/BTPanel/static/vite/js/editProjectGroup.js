import{_ as e}from"./index85.js?v=1714377894636";import{j as t,w as a,x as o,q as s,s as r}from"./element-lib.js?v=1714377894636";import{n,q as i,b as c}from"./main.js?v=1714377894636";import{_ as l}from"./index53.js?v=1714377894636";import{_ as p}from"./index39.js?v=1714377894636";import{_ as d}from"./index58.js?v=1714377894636";import{_ as m}from"./index59.js?v=1714377894636";import{e as u,b as f,A as j,v as g,H as h,h as v,j as b}from"./vue-lib.js?v=1714377894636";import{S as y}from"./public-lib.js?v=1714377894636";import{i as _}from"./docker.table.js?v=1714377894636";import{A as x}from"./docker.popup.js?v=1714377894636";import{u as w}from"./docker.store.js?v=1714377894636";import{a7 as C,a8 as D,s as k,a9 as P,aa as F,ab as N}from"./docker.api.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./index45.js?v=1714377894636";import"./index38.js?v=1714377894636";import"./element-ui.common.js?v=1714377894636";import"./date-util.js?v=1714377894636";import"./vdom.js?v=1714377894636";import"./index62.js?v=1714377894636";import"./cascader-panel.js?v=1714377894636";import"./check.js?v=1714377894636";const $=n(u({__name:"editProjectGroup",props:{compData:null},setup(e){const t=e,{proxy:a}=b(),o=f(),s=w(),{projectGroupData:r,containerTableData:n}=j(s),{getProjectGroup:i,getCList:c}=s,l=g({list:[],loading:!1}),p=f(!1),d=f(),m=g({projectName:""}),u=g({projectName:[{required:!0,message:"请选择容器",trigger:"change"}]}),$=f(!1),G=f(),q=g({interval:t.compData.interval}),E=g({interval:[{validator:(e,t,a)=>{t<5||t>60||""===t||t%1!=0?a(new Error("请输入5-60之间的整数")):a()},trigger:["input","change"]}]}),R=f([{active:!0,content:"添加容器",event:()=>{p.value=!0}},{content:"启动间隔",event:async()=>{$.value=!0}}]),S=g({selectList:[]}),B=f(""),A=f([{label:"开启容器",value:"start",event:()=>{}},{label:"停止容器",value:"stop",event:()=>{}},{label:"删除容器",value:"delete",event:()=>{}}]);let T=[],L=!1,H=0;const I=g({isRecurrence:!1,describe:{title:"",th:"",message:"",propsValue:"project_name"},tableDisplayConfig:{label:"状态",prop:"status",render:e=>h("span",{class:0!==T.length||L?T.find((t=>t.id===e.project_id)).status?"text-primary":"text-danger":"text-warning"},(()=>{if(0!==T.length||L){let t=T.find((t=>t.id===e.project_id)).msg;return H++,t}return"等待执行"})())}}),J=async(e,t)=>{const o={id:e.project_id,status:t};r.value.loading=!0;const s=await k({data:JSON.stringify(o)});r.value.loading=!1,s.status?(M(),c(),a.$message.success(s.msg)):a.$message.error(s.msg)},O=async({project_name:e,project_id:a})=>{try{const{data:o}=await P({id:t.compData.id,project_name:e});return T.push({id:a,msg:o.msg,status:o.status}),o.status?o:Promise.reject(o)}catch(o){return Promise.reject(!1)}},V=async(e,t)=>{try{const{data:a}=await k({data:JSON.stringify({id:e.project_id,status:t})});return T.push({id:e.project_id,msg:a.msg,status:a.status}),a.status?a:Promise.reject(a)}catch(a){return Promise.reject(!1)}},z=async e=>{try{const o=await P({id:t.compData.id,project_name:e.project_name});a.$message.request(o),o.status&&M()}catch(o){}},K=_({changeStatusEvent:J,deleteGroupEvent:z}),M=async()=>{try{l.loading=!0;const{data:e}=await F({id:t.compData.id});l.list=e.value}catch(e){}finally{l.loading=!1}},Q=e=>{const o=document.querySelector(".project-table .el-table__body-wrapper tbody");y.create(o,{animation:500,onEnd:async e=>{const o=l.list.splice(e.oldIndex,1)[0];l.list.splice(e.newIndex,0,o);const s=l.list.map((e=>e.project_name)),r=await N({id:t.compData.id,order:s.join(",")});a.$message.request(r)}})};return v((async()=>{M(),Q()})),{__sfc:!0,props:t,vm:a,Table:o,store:s,projectGroupData:r,containerTableData:n,getProjectGroup:i,getCList:c,projectData:l,showAddPopup:p,addFromRef:d,addForm:m,addRules:u,showConfigPopup:$,configFormRef:G,configForm:q,configRules:E,tableBtnGroup:R,onConfirmAdd:async()=>{d.value.validate((async e=>{var o,s;if(e)try{const e=a.$load("正在添加容器，请稍后..."),r=await C({id:t.compData.id,project_name:m.projectName,project_id:null==(s=null==(o=n.value)?void 0:o.list)?void 0:s.find((e=>e.name===m.projectName)).id});e.close(),a.$message.request(r),r.status&&(p.value=!1,M(),m.projectName="")}catch(r){}}))},onConfirmConfig:async()=>{G.value.validate((async e=>{if(e)try{const e=a.$load("正在设置启动间隔，请稍后..."),o=await D({id:t.compData.id,interval:q.interval});e.close(),a.$message.request(o),o.status&&($.value=!1,i())}catch(o){}}))},select:S,batchType:B,tableBatchData:A,list:T,isComplete:L,index:H,batchConfig:I,batchEvent:(e,t,a)=>{switch(e){case"start":return V(t,"start");case"stop":return V(t,"stop");case"delete":return O(t)}},handleBathComplete:e=>{L=!0,M(),"delete"!==B.value&&c()},editDataEvent:e=>{x(e)},changeStatusEvent:J,deleteDataEvent:async e=>{await a.$confirm({type:"calc",title:"删除容器名称【".concat(e.name,"】"),width:"35rem",message:"您真的要删除容器名称【".concat(e.name,"】吗？")});const o=await P({id:t.compData.id,project_name:e.name});a.$message.request(o),o.status&&M()},batchDeleteData:O,batchStatusData:V,handleBatch:e=>{L=!1,T=[],H=0;let t=[];switch(e){case"start":t=["启动","启动已选的容器"];break;case"stop":t=["停止","停止已选的容器"];break;case"delete":t=["删除","彻底失去访问和操作权限"]}B.value=e,I.isRecurrence=!0,I.describe.th="容器名称",I.describe.title="批量".concat(t[0],"容器"),I.describe.message="批量".concat(t[0],"已选的容器，是否继续操作！")},handleSelectionChange:e=>{S.selectList=e},deleteGroupEvent:z,tableColumn:K,getGroupProject:M,rowDrop:Q}}}),(function(){var n=this,u=n._self._c,f=n._self._setupProxy;return u("div",{staticClass:"p-[2rem]"},[u(m,{scopedSlots:n._u([{key:"header-left",fn:function(){return[u("div",{staticClass:"flex items-center"},[u(d,{attrs:{group:f.tableBtnGroup}})],1)]},proxy:!0},{key:"header-right",fn:function(){return[u(t,{staticClass:"item",attrs:{effect:"dark",content:"点击刷新数据",placement:"top-start"}},[u(i,{attrs:{type:"default",icon:"el-icon-refresh"},on:{click:f.getGroupProject}})],1)]},proxy:!0},{key:"content",fn:function(){return[u(p,{directives:[{name:"loading",rawName:"v-loading",value:f.projectData.loading,expression:"projectData.loading"}],ref:"Table",staticClass:"project-table",attrs:{"row-key":"project_id",column:f.tableColumn,"max-height":340,data:f.projectData.list,description:"容器列表为空","element-loading-text":"正在加载容器列表，请稍后..."},on:{"selection-change":f.handleSelectionChange}})]},proxy:!0},{key:"footer-left",fn:function(){return[u(l,{attrs:{data:f.tableBatchData,config:f.batchConfig,"batch-fn":f.batchEvent},on:{"handle-batch":f.handleBatch,"handle-complete":f.handleBathComplete}})]},proxy:!0},{key:"popup",fn:function(){return[u(c,{staticClass:"overflow-hidden",attrs:{title:"添加容器",visible:f.showAddPopup,area:42,"show-footer":!0},on:{"update:visible":function(e){f.showAddPopup=e},confirm:f.onConfirmAdd}},[u("div",{staticClass:"p-20x"},[u(a,{ref:"addFromRef",attrs:{model:f.addForm,rules:f.addRules}},[u(o,{attrs:{label:"容器",prop:"projectName"}},[u(s,{staticClass:"w-[20rem]",attrs:{placeholder:"请选择容器"},model:{value:f.addForm.projectName,callback:function(e){n.$set(f.addForm,"projectName",e)},expression:"addForm.projectName"}},n._l(f.containerTableData.list,(function(e,t){return u(r,{key:t,attrs:{label:e.name,value:e.name}})})),1)],1)],1)],1)]),u(c,{staticClass:"overflow-hidden",attrs:{title:"设置启动间隔",visible:f.showConfigPopup,area:42,"show-footer":!0},on:{"update:visible":function(e){f.showConfigPopup=e},confirm:f.onConfirmConfig}},[u("div",{staticClass:"p-20x"},[u(a,{ref:"configFormRef",attrs:{model:f.configForm,rules:f.configRules}},[u(o,{attrs:{label:"容器启动间隔",prop:"interval"}},[u(e,{attrs:{placeholder:"请输入容器启动时间间隔",textType:"秒",max:"60",min:"5",type:"number"},model:{value:f.configForm.interval,callback:function(e){n.$set(f.configForm,"interval",e)},expression:"configForm.interval"}})],1)],1)],1)])]},proxy:!0}])})],1)}),[],!1,null,"40d8fe1f",null,null).exports;export{$ as default};
