import{e as t,aS as a,n as e,q as r,a as o}from"./main.js?v=1714377894636";import{L as s,w as i,x as l,q as n,s as p}from"./element-lib.js?v=1714377894636";import{_ as c}from"./index85.js?v=1714377894636";import{_ as m}from"./index46.js?v=1714377894636";import"./index45.js?v=1714377894636";import{_ as u}from"./ServiceStatus.js?v=1714377894636";import{e as _,b as d,h as v,j as w}from"./vue-lib.js?v=1714377894636";import{a as f}from"./confirm.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{i as h,G as j,D,e0 as y,e1 as b}from"./site.store.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./index.vue_vue_type_style_index_0_lang.js?v=1714377894636";import"./config.js?v=1714377894636";import"./check.js?v=1714377894636";const g=e(_({__name:"ProjectManage",props:{compData:{default:{}}},setup(e){const r=e,{proxy:o}=w(),s=d(!1),i=d(r.compData),l=d(),n={project_port:[{validator:(t,a,e)=>{""===a?e(new Error("请输入端口")):/^\d+$/.test(a)?a<1||a>65535?e(new Error("端口范围为1-65535")):e():e(new Error("端口只能为数字"))},trigger:["blur","input"]}]},p=d([]),c=async()=>{try{const t=await j();p.value=t.data.filter((t=>"纯静态"!==t.name))}catch(t){}},m=async()=>{s.value=!0;try{const t=await y({sitename:r.compData.name});i.value=t.data,i.value.is_power_on=1===t.data.is_power_on}catch(t){}finally{s.value=!1}};return v((async()=>{await c(),await m()})),{__sfc:!0,props:r,vm:o,viewLoading:s,rowData:i,projectForm:l,projectFormRules:n,versionOptions:p,installOtherPhp:async()=>{try{const{data:a}=await h({sName:"php-8.2"});t({name:"php-8.2",type:a.type,softData:a})}catch(a){}},getPHPVersion:c,openPathDialog:(t,e)=>{t&&"/"===t[t.length-1]&&(t=t.slice(0,-1)),a({type:"all",path:t||"/www/wwwroot",change:t=>{i.value[e]=t}})},serviceManageEvent:async t=>{f({confirm:{title:"设置项目状态",message:"确定要"+("restart"===t?"重启":"stop"===t?"停止":"启动")+"项目吗？",icon:"warning"},loading:"正在设置状态，请稍后...",request:async()=>await D({sitename:r.compData.name,project_action:t}),complete:m})},getInfoEvent:m,onSubmit:async()=>{l.value.validate((async t=>{if(!t)return;let a=o.$load("正在保存，请稍后...");try{let t={sitename:r.compData.name,...i.value,is_power_on:i.value.is_power_on?1:0};delete t.status,delete t.ps;const a=await b(t);o.$message.request(a),m()}catch(e){}finally{a.close()}}))}}}}),(function(){var t,a,e,_=this,d=_._self._c,v=_._self._setupProxy;return d("div",{directives:[{name:"loading",rawName:"v-loading",value:v.viewLoading,expression:"viewLoading"}]},[d("div",{staticClass:"flex flex-col text-[#666]"},[d("span",{staticClass:"mb-12x flex items-center"},[_._v("当前状态："),d(u,{attrs:{status:null==(t=v.rowData)?void 0:t.status}})],1),d("div",{staticClass:"flex items-center"},[(null==(a=v.rowData)?void 0:a.status)?_._e():d(r,{attrs:{type:"default"},on:{click:function(t){return v.serviceManageEvent("start")}}},[_._v("启动")]),(null==(e=v.rowData)?void 0:e.status)?d(r,{attrs:{type:"default"},on:{click:function(t){return v.serviceManageEvent("stop")}}},[_._v("停止")]):_._e(),d(r,{attrs:{type:"default"},on:{click:function(t){return v.serviceManageEvent("restart")}}},[_._v("重启")])],1)]),d(s),d("div",{staticClass:"relative -left-[3rem]"},[d(i,{ref:"projectForm",attrs:{model:v.rowData,rules:v.projectFormRules,"label-width":"80px"}},[d(l,{attrs:{label:"开机启动"}},[d(m,{model:{value:v.rowData.is_power_on,callback:function(t){_.$set(v.rowData,"is_power_on",t)},expression:"rowData.is_power_on"}})],1),d(l,{attrs:{label:"启动命令"}},[d(c,{attrs:{placeholder:"请输入代理名称",width:"34rem"},model:{value:v.rowData.project_cmd,callback:function(t){_.$set(v.rowData,"project_cmd",t)},expression:"rowData.project_cmd"}})],1),d(l,{attrs:{label:"项目端口",prop:"project_port"}},[d(c,{attrs:{placeholder:"请输入项目端口",width:"34rem"},model:{value:v.rowData.project_port,callback:function(t){_.$set(v.rowData,"project_port",t)},expression:"rowData.project_port"}})],1),d(l,{attrs:{label:"项目目录"}},[d(c,{attrs:{placeholder:"请输入项目目录",width:"34rem",iconType:"folder"},on:{folder:function(t){return v.openPathDialog(v.rowData.project_path,"project_path")}},model:{value:v.rowData.project_path,callback:function(t){_.$set(v.rowData,"project_path",t)},expression:"rowData.project_path"}})],1),d(l,{attrs:{label:"前端目录"}},[d(c,{attrs:{placeholder:"请输入前端目录",width:"34rem",iconType:"folder"},on:{folder:function(t){return v.openPathDialog(v.rowData.site_run_path,"site_run_path")}},model:{value:v.rowData.site_run_path,callback:function(t){_.$set(v.rowData,"site_run_path",t)},expression:"rowData.site_run_path"}})],1),d(l,{attrs:{label:"PHP版本"}},[d(n,{model:{value:v.rowData.php_version,callback:function(t){_.$set(v.rowData,"php_version",t)},expression:"rowData.php_version"}},_._l(v.versionOptions,(function(t){return d(p,{key:t.value,attrs:{label:t.name,value:t.version}})})),1),d(o,{staticClass:"ml-8x",on:{click:v.installOtherPhp}},[_._v("安装其他版本")])],1),d(l,{attrs:{label:" "}},[d(r,{attrs:{type:"primary"},on:{click:v.onSubmit}},[_._v("保存")])],1)],1)],1)],1)}),[],!1,null,"015d0ec9",null,null).exports;export{g as default};
