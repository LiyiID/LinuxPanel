import{z as e,A as a,b as t,j as s}from"./vue-lib.js?v=1714377894636";import{a1 as i,K as l,aW as o,H as n,J as u}from"./main.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{a1 as c,a2 as r,a3 as p,a4 as d,J as m,t as v,a5 as y,a6 as h,a7 as _,a8 as g,a9 as f,aa as w,ab as b,ac as C}from"./config.api.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./element-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";const k=e("CONFIG-STORE",(()=>{const{proxy:e}=s(),a=t(!1),k=t(!1),S=t(!1),A=t("all"),j=t({panelClose:!1,listenIpv6:!1,offlineMode:!1,debugMode:!1,apiInterface:!1,onlineService:!1,improvement:!1,webname:"",leftTitle:"",session_timeout:"1天",session_timeout_source:86400,sites_path:"",backup_path:"",serverIp:"",systemdate:"",username:"",account:"",menuHide:"",requestType:"",requestLine:"",panelNode:"",panelNodeId:0}),q=t({panelAlarm:!1,panelSSl:!1,basicAuth:!1,checkTwoStep:!1,sslVerify:!1,pawComplexity:!1,uaAstrict:!1,domain:"",limitip:"",port:8888,admin_path:"/",statusCode:0,pawExpireTime:""}),I=t({addr:"",cert:"",key:"",proxy_stats:!1,domain:""}),x=t(""),T=t([]),P=t([]),L=t([]),N=t({loading:!1,list:[]});t([]);const E=async()=>{const{data:e}=await r();l(e)&&(T.value=e,j.value.menuHide=e.filter((e=>!e.show)).map((e=>e.title)).join("、"))},D=async()=>{const{data:e}=await p();if(l(e)){P.value=e;const a=e.filter((e=>1===e.status))[0];j.value.panelNode=(null==a?void 0:a.node_name)||"",j.value.panelNodeId=(null==a?void 0:a.node_id)||0}},O=e=>{var a;const{panel:t,SSL:s}=e;q.value.panelSSl=s||location.protocol.indexOf("https:")>-1,q.value.basicAuth=(null==(a=e.basic_auth)?void 0:a.open)||!1,q.value.statusCode=e.status_code||404,o(t)&&(q.value.domain=t.domain||"",q.value.limitip=t.limitip||"",q.value.port=t.port||"",q.value.admin_path=t.admin_path||"/")},H=async()=>{const{data:e}=await d();q.value.checkTwoStep=e.status},M=t([]),$=t(!1);let G=["wx_account","mail","dingding","feishu","weixin","sms"];const R=t([]),J=async()=>{try{const e=await y();I.value={addr:(null==e?void 0:e.addr)||"",cert:(null==e?void 0:e.cert)||"",key:(null==e?void 0:e.key)||"",proxy_stats:(null==e?void 0:e.proxy_stats)||!1,domain:(null==e?void 0:e.domain)||""}}catch(e){}},z=t({loading:!1,list:[]}),F=t(),K=async()=>{try{const e=await f({id:"panel_safe_push",name:"site_push"});F.value=e,q.value.panelAlarm=e.status}catch(e){}},U=t({}),V=t({status:!0,list:[],total:0});return{openSSLPopup:a,openNamePopup:k,openPortPopup:S,tabActive:A,settingSearch:x,tempAuthData:V,processConfig:L,panelConfig:j,safeConfig:q,nodeConfig:P,alarmSettings:M,alarmSettingLoading:$,template:R,noPortConfig:I,certTableData:z,panelAlarmConfig:F,uaTableData:N,limitArea:U,getLimitArea:async()=>{try{const e=await w();U.value=e}catch(e){}},getLimitUaInfo:async()=>{try{N.value.loading=!0;const{data:e}=await c();q.value.uaAstrict="0"!==e.status,N.value.list=e.ua_list}catch(e){}finally{N.value.loading=!1}},getConfig:async()=>{const{getPublicConfigInfo:e}=i();await e(),E(),D(),H(),J(),K()},getNode:D,setConfig:e=>{j.value.listenIpv6="checked"===e.ipv6,j.value.offlineMode="checked"===e.is_local,j.value.debugMode="checked"===e.debug,j.value.apiInterface="checked"===e.api,j.value.onlineService=e.show_workorder,j.value.improvement=e.improvement,j.value.webname=e.webname||"宝塔Linux面板",j.value.leftTitle=e.left_title||"",j.value.session_timeout=e.session_timeout||"1天",j.value.session_timeout_source=e.session_timeout_source||86400,j.value.sites_path=e.sites_path||"",j.value.backup_path=e.backup_path||"",j.value.systemdate=e.systemdate||"",j.value.username=e.username||"",j.value.requestType=e.request_type||"",j.value.requestLine=e.request_iptype||"";const{panel:a,user_info:t}=e;o(a)&&(j.value.serverIp=a.address||""),o(t)&&(j.value.account=t.data.username),O(e)},saveConfig:async(e,a)=>{const t=n.load(e);try{const e=a&&a.session_timeout?a.session_timeout:j.value.session_timeout_source,{data:t}=await m({webname:j.value.webname,session_timeout:e||86400,domain:q.value.domain,limitip:q.value.limitip,sites_path:j.value.sites_path,backup_path:j.value.backup_path,address:j.value.serverIp,systemdate:j.value.systemdate});if(!(!a||void 0===a.isReturn)&&a.isReturn)return t;n.request(t),setTimeout((()=>{window.location.reload()}),1e3)}finally{t.close()}},getAlarmSettings:async(e={})=>{e.idDel&&(G=G.filter((a=>a!==e.name)));try{$.value=!0;const{data:e}=await v();o(e)&&(Object.keys(e).forEach((e=>{G.includes(e)||G.push(e)})),M.value=G.map((a=>e[a])))}finally{$.value=!1}},msgInstallComputed:e=>0===Object.keys(e.data).length?"未配置":"",getPanelGenerationEvent:J,setPanelGenerationEvent:async a=>{try{await e.$confirm({title:"提示",icon:"question",iconColor:"#E6A23C",message:"基于Nginx/Apache，如果环境运行异常会导致无法访问，是否继续操作？"});const t=n.load("正在设置免端口访问配置，请稍候..."),{data:s}=await h(a);t.close(),n.request(s),J(),e.$emit("close")}catch(t){}},getCertListData:async()=>{z.value.loading=!0;try{const{data:e}=await _();z.value.list=e}catch(e){}finally{z.value.loading=!1}},selectCert:async a=>{try{const t=n.load("正在选择证书，请稍候..."),s=await g({ssl_id:a.id,ssl_hash:a.hash});return t.close(),s.msg?(e.$message.request(s),!1):(I.value.domain=(null==s?void 0:s.dns[0].replace(/^\*\./,"panel."))||"",I.value.cert=(null==s?void 0:s.fullchain)||"",I.value.key=(null==s?void 0:s.privkey)||"",n.request({status:!0,msg:"选择成功"}),!0)}catch(t){}},getPushConfigEvent:K,getProcessConfig:async e=>{try{const{data:a}=await b(e.value.items.url);L.value=a}catch(a){}},getTempAuthData:async(a,t)=>{try{const s=await C({p:a,rows:t});s.msg?(V.value.status=!1,e.$message.request(s)):(V.value.status=!0,V.value.list=s.data,V.value.total=u(s.page))}catch(s){}}}})),S=()=>{const e=k();return{refs:a(e),...e}};export{k as default,S as getConfigStore};
