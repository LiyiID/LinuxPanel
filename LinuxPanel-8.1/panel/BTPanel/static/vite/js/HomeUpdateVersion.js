import{g as e,bj as t,bO as s,bP as a,bQ as i,bR as o,T as r,bS as n,b1 as l,bF as p,n as c,_ as m,a as d,r as u,q as f}from"./main.js?v=1714377894636";import{j as v,o as x,w as g,x as w}from"./element-lib.js?v=1714377894636";import{_ as b}from"./index46.js?v=1714377894636";import{e as h,v as _,b as y,c as C,h as U,j as S}from"./vue-lib.js?v=1714377894636";import{e as $,f as P}from"./home.popup.js?v=1714377894636";import{g as V}from"./home.store.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./index.vue_vue_type_style_index_0_lang.js?v=1714377894636";const j=c(h({__name:"HomeUpdateVersion",setup(c,{expose:m}){const{proxy:d}=S(),{refs:{isBeta:u,isUpgrade:f,grayscale:v,betaInfo:x,officialInfo:g,versionType:w,updatePush:b},getUpdateInfo:h,getUpdatePushInfo:j}=V(),{refs:{isDebug:k,panelVersion:N}}=e(),H=_({phone:"",status:!1}),I={phone:[{validator:(e,t,s)=>{H.status?/^1[3456789]\d{9}$/.test(t)||/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/.test(t)?s():s(new Error("请输入正确的手机号码或邮箱")):s()}}]},T=e=>/^1[3456789]\d{9}$/.test(e)?"phone":/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/.test(e)?"email":"unknown",q=y(!1),O=y(!1),E=y(""),B=y(!1),D=C((()=>u.value?x.value:g.value)),R=async e=>{let t;try{const s=e?"升级Linux测试版":"切换到正式版",r=e?"请仔细阅读内测升级须知，是否升级Linux测试版？":"是否从测试版切换到正式版？";await d.$confirm({type:"calc",title:s,message:r}),t=d.$load("正在".concat(s,"，请稍候...")),localStorage.clear(),sessionStorage.clear(),k.value&&(await a(),O.value=!0);const n=e?await i():await o();if(!n.status)return d.$message.request(n)}catch(s){return!1}finally{d.$emit("close"),localStorage.clear(),sessionStorage.clear()}return t},z=async e=>{let t;await d.$confirm({icon:"warning",title:"升级面板",message:"温馨提示：升级面板，有助于面板的BUG修复和功能加强，但不会影响用户的数据，即使面板发生故障，用户数据也不会受到影响。请您放心进行升级。"});try{if("boolean"==typeof e){if(t=await R(e),!t)return}else t=d.$load("正在升级面板，请稍候..."),localStorage.clear(),sessionStorage.clear(),k.value&&(await a(),O.value=!0);await h({check:!0});const s=await r({toUpdate:"yes"});O.value&&(await a(),O.value=!1),s.status?(d.$message.success({msg:s.msg,onClose:()=>window.location.reload()}),setTimeout((()=>{window.location.reload()}),2e3)):d.$message.error(s.msg)}catch(s){t&&t.close()}finally{t&&t.close(),d.$emit("close"),localStorage.clear(),sessionStorage.clear()}},J=async()=>{try{q.value=!0;const e=await h({check:!0});"string"==typeof e&&(d.$emit("close"),d.$message.error(e))}catch(e){}finally{q.value=!1}};return U((async()=>{await j()})),m({onOpen:J}),{__sfc:!0,vm:d,isBeta:u,isUpgrade:f,grayscale:v,betaInfo:x,officialInfo:g,versionType:w,updatePush:b,getUpdateInfo:h,getUpdatePushInfo:j,isDebug:k,panelVersion:N,form:H,rules:I,checkString:T,loading:q,isSetDebug:O,questions:E,isNPSShow:B,tips:"如果您在使用过程中遇到任何问题或功能不完善，请将您的问题或需求详细描述给我们，我们将尽力为您解决或完善。",currentInfo:D,openUpdateReminder:async()=>{if(b.value)$(!b.value);else try{const e=await s({name:"site_push",id:"panel_update",data:JSON.stringify({status:b.value,type:"panel_update",title:"面板更新提醒",module:"wx_account",interval:600})});d.$message.request(e)}catch(e){}},cutUpdateType:()=>{u.value?z(!1):P(z)},cutPanelVersion:R,updateVersion:z,ignoreUpdatEVersion:async()=>{try{const e=await n({version:D.value.version});d.$message.request(e),e.status&&d.$emit("close")}catch(e){}},submit:async()=>{if(await d.$refs.formPhone.validate()){if(""===E.value)return d.$message.error("还有必填项没有填写哦~");let t=d.$load("正在提交问卷，请稍后..."),s={};try{s[22]=E.value;let e=T(H.phone);await l(H.status?{questions:JSON.stringify(s),product_type:18,software_name:1,rate:0,feedback:JSON.stringify("phone"===e?{phone:H.phone}:{email:H.phone})}:{questions:JSON.stringify(s),product_type:18,software_name:1,rate:0}),t.close(),p(),d.$listeners.close()}catch(e){}finally{t.close()}}},onOpen:J,updateReminderDialog:$,os:t}}}),(function(){var e,t,s,a,i=this,o=i._self._c,r=i._self._setupProxy;return o("div",{class:(r.isUpgrade?"update-back ":"")+"flex relative w-[100%] flex-col h-[100%] rounded-[.2rem] update-version-view"},[r.isUpgrade?[o("div",{staticClass:"w-[150px] absolute -top-96px right-30px"},[o(m,{attrs:{src:"/update/update_rocket.svg",alt:"rocket img"}})],1),o("div",{staticClass:"absolute top-15px left-15px text-white text-[1.4rem]"},[o("span",[i._v(i._s(i.$t("HomeUpdateVersion.UpdateTitle",{os:r.os,type:r.versionType})))])])]:[o("div",{staticClass:"w-full absolute h-140px absolute-image rounded-2x title-new-img"}),o("div",{staticClass:"absolute top-15px left-15px text-white text-[1.4rem]"},[o("span",[i._v("宝塔"+i._s(r.os)+"面板")])])],o("div",{directives:[{name:"bt-loading",rawName:"v-bt-loading",value:r.loading,expression:"loading"},{name:"bt-loading",rawName:"v-bt-loading:title",value:"正在加载更新信息，请稍后...",expression:"'正在加载更新信息，请稍后...'",arg:"title"}],class:r.isUpgrade?"relative mt-52 rounded-2x":"relative mt-25 bg-linear rounded-2x"},[r.isUpgrade?[o("div",{staticClass:"text-[2.1rem] flex font-bold items-center justify-center text-[#565656]"},[o("span",[i._v(i._s(i.$t("HomeUpdateVersion.UpdateVersion")))])]),o("div",{staticClass:"text-[1.5rem] mt-8 flex justify-between mb-16px mx-34px update-text"},[o("div",{},[o("span",[i._v("最新版本: ")]),o("span",[o(d,{attrs:{href:"https://www.bt.cn/bbs/forum-36-1.html"},domProps:{textContent:i._s(i.$t("HomeUpdateVersion.PanelVersion",{os:r.os,version:null==(e=r.currentInfo)?void 0:e.version}))}})],1),r.grayscale<1?o("span",{staticClass:"text-primary"},[o(v,{staticClass:"item",attrs:{effect:"dark",content:"提示：当前是正式版尝鲜阶段，为了验证新版本的稳定性和兼容性，确保全面推出之前，新功能能正常运行。",placement:"top"}},[o("span",[i._v("（尝鲜版"),o("i",{staticClass:"grayscale-icon"},[i._v("?")]),i._v("）")])])],1):i._e()]),o("div",{},[o("span",[i._v(i._s(i.$t("HomeUpdateVersion.UpdateTime",{time:null==(t=r.currentInfo)?void 0:t.uptime})))])])])]:[o("div",{staticClass:"text-[2.1rem] flex mt-3rem pb-8 font-bold items-center justify-center text-[#565656] bg-linear"},[o(m,{staticClass:"h-12 mr-2 mt-1",attrs:{src:"/update/update_icon.svg",alt:"icon"}}),o("span",{staticClass:"leading-10"},[i._v("当前已经是最新版本")])],1),o("div",{staticClass:"px-32px py-[1.6rem] text-[1.4rem] flex items-center justify-between update-text bg-[white]"},[o("span",[i._v(" "+i._s(i.$t("HomeUpdateVersion.CurrentVersion"))+" "),o(d,{attrs:{href:"https://www.bt.cn/bbs/forum-36-1.html"},domProps:{textContent:i._s(r.os+r.versionType+r.panelVersion)}}),r.grayscale<1?o("span",{staticClass:"text-primary"},[o(v,{staticClass:"item",attrs:{effect:"dark",content:"提示：当前是正式版尝鲜阶段，为了验证新版本的稳定性和兼容性，确保全面推出之前，新功能能正常运行。",placement:"top"}},[o("span",[i._v("（尝鲜版"),o("i",{staticClass:"grayscale-icon"},[i._v("?")]),i._v("）")])])],1):i._e()],1),o("span",[i._v(" "+i._s(i.$t("HomeUpdateVersion.ReleaseTime",{time:null==(s=r.currentInfo)?void 0:s.uptime}))+" ")])])],o("div",{class:r.isUpgrade?"mb-[3rem] mt-4 px-16px py-22px mx-34px bg-[rgba(33,165,59,0.04)] rounded-2x":"mb-[2.2rem] mt-2 px-16px py-14px mx-32px border-1 border-[#EEEFEC] bg-[rgb(247,252,248)] rounded-2x"},[[r.isUpgrade?o("div",{staticClass:"rounded-md update-content"},[o("div",{staticClass:"leading-10 mr-2 text-[1.2rem] text-medium overflow-auto",domProps:{innerHTML:i._s((null==(a=r.currentInfo)?void 0:a.updateMsg)||i.$t("HomeUpdateVersion.Getting"))}})]):i._e(),r.isUpgrade?o("hr"):i._e(),o("div",{staticClass:"flex flex-col justify-center leading-10 text-[1.2rem] text-medium"},[r.isBeta?o("span",[i._v(" "+i._s(i.$t("HomeUpdateVersion.SwitchOfficialDescribe"))+" "),o(d,{staticClass:"ml-2",domProps:{textContent:i._s(i.$t("HomeUpdateVersion.SwitchOfficialEdition"))},on:{click:r.cutUpdateType}})],1):i._e(),r.isBeta?i._e():o("span",[i._v(" "+i._s(i.$t("HomeUpdateVersion.SwitchBeta"))+" "),o(d,{staticClass:"ml-2",domProps:{textContent:i._s(i.$t("HomeUpdateVersion.ApplyBeta"))},on:{click:r.cutUpdateType}})],1),o("div",{staticClass:"mt-0.6rem"},[o("span",{staticClass:"mr-2"},[i._v("有更新时提醒我:")]),o(b,{staticClass:"mr-4 mb-1",attrs:{"active-color":"#13ce66"},on:{change:r.openUpdateReminder},model:{value:r.updatePush,callback:function(e){r.updatePush=e},expression:"updatePush"}}),o(d,{domProps:{textContent:i._s("提醒方式")},on:{click:function(e){return r.updateReminderDialog(r.updatePush)}}})],1)])]],2),r.isUpgrade?i._e():o("div",[o("div",{staticClass:"nps_survey_banner flex items-center justify-center",class:r.isNPSShow?"":"mb-[2rem]"},[o("span",{staticClass:"text-[14px] font-bold inline-block cursor-pointer text-[#20a53a] mr-[.4rem]",staticStyle:{"vertical-align":"4px"},on:{click:function(e){r.isNPSShow=!r.isNPSShow}}},[i._v(" 点击此处折叠需求反馈 ")]),o("i",{staticClass:"cursor-pointer text-[14px]",class:r.isNPSShow?"el-icon-arrow-up":"el-icon-arrow-down",on:{click:function(e){r.isNPSShow=!r.isNPSShow}}})]),o("div",{directives:[{name:"show",rawName:"v-show",value:r.isNPSShow,expression:"isNPSShow"}],staticClass:"pt-[1rem] pb-[3rem] pl-[3.1rem] pr-[3rem]"},[o(u,{attrs:{placement:"top-start",width:"400","popper-class":"tips bg-[#20a53a] text-white text-[1.2rem] w-[40.6rem]",trigger:"focus",content:"如果您在使用过程中遇到任何问题或功能不完善，请将您的问题或需求详细描述给我们，我们将尽力为您解决或完善。"}},[o(x,{attrs:{slot:"reference",type:"textarea",rows:5,placeholder:"如果您在使用过程中遇到任何问题或功能不完善，请将您的问题或需求详细描述给我们，我们将尽力为您解决或完善。"},slot:"reference",model:{value:r.questions,callback:function(e){r.questions=e},expression:"questions"}})],1),o("div",{staticClass:"mt-[1rem]"},[o("div",{staticClass:"my-[1rem] flex items-center"},[o("span",{staticClass:"text-[1.3rem] text-[#666]"},[i._v("是否愿意接受回访：")]),o(b,{attrs:{size:"mini"},model:{value:r.form.status,callback:function(e){i.$set(r.form,"status",e)},expression:"form.status"}})],1),o(g,{ref:"formPhone",attrs:{"label-position":"top",model:r.form,rules:r.rules}},[o(w,{directives:[{name:"show",rawName:"v-show",value:r.form.status,expression:"form.status"}],attrs:{label:"",prop:"phone"}},[o(x,{attrs:{placeholder:"请留下手机号码或邮箱"},model:{value:r.form.phone,callback:function(e){i.$set(r.form,"phone",e)},expression:"form.phone"}})],1)],1)],1),o("div",{staticClass:"mt-[.4rem] text-[1.2rem] text-primary leading-[3rem]"},[i._v(" 我们特别重视您的需求反馈，我们会每周进行需求评审，希望能更好的帮到您 ")]),o("div",{staticClass:"flex flex-col items-center p-[2rem]"},[o(f,{staticClass:"w-[12.5rem]",attrs:{size:"large"},on:{click:r.submit}},[i._v("提交反馈")])],1)],1)]),r.isUpgrade?[o("div",{staticClass:"flex align-middle justify-center pb-10"},[o(f,{directives:[{name:"t",rawName:"v-t",value:"HomeUpdateVersion.IgnoreVersion",expression:"`HomeUpdateVersion.IgnoreVersion`"}],staticClass:"ignore-renew text-[1.3rem] border-none h-38px mr-50px w-50 bg-[#f0f0f0]",staticStyle:{color:"#999"},attrs:{type:"default",size:"medium",round:""},on:{click:r.ignoreUpdatEVersion}}),o(f,{directives:[{name:"t",rawName:"v-t",value:"HomeUpdateVersion.UpdateNow",expression:"`HomeUpdateVersion.UpdateNow`"}],staticClass:"border-none text-[1.3rem] w-50 h-38px",attrs:{size:"medium",round:""},on:{click:function(e){return r.updateVersion()}}})],1)]:i._e()],2)],2)}),[],!1,null,"3981dace",null,null).exports;export{j as default};
