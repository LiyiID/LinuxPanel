import{I as e,aS as t,n as a,r as s,q as o}from"./main.js?v=1714377894636";import{_ as i}from"./index85.js?v=1714377894636";import{w as r,x as l,q as n,s as v}from"./element-lib.js?v=1714377894636";import{_ as m}from"./index45.js?v=1714377894636";import{_ as p}from"./index46.js?v=1714377894636";import{e as c,b as d,f as u,h as w,j as f,l as h}from"./vue-lib.js?v=1714377894636";import{g as _}from"./home.store.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./index.vue_vue_type_style_index_0_lang.js?v=1714377894636";const g=t=>e.post("panel/overview/AddOverview",{data:t,check:"msg",customType:"model"});const x=a(c({__name:"HomeCustomOverviewNew",setup(a){const{refs:{overviewShowList:s,overviewTemplateList:o},getOverviewTemplateData:i,getOverviewData:r}=_(),l=d([]),n=d(!1),v=d(0),{proxy:m}=f(),p=d({val0:0,val1:0,val2:0,val3:0}),c=()=>{let e={};l.value=[],s.value.forEach((t=>{e[t.name]=t})),o.value.forEach((t=>{const a=t.template;t.option.forEach((t=>{const s=e[t.name]||!1;l.value.push({...t,isShow:Boolean(s),showItem:s,template:a,overviewPopover:!1})}))}))};u(s.value,(()=>{c()}));const x=()=>{},y=(e,t=!1)=>{let a={...e},s=[],o=[];for(const i in p.value)e.params.length&&o.push(p.value[i]);if(0===o.length&&(o=[0]),"open_dir"===e.name){const t=p.value.val0||e.params[0].option[0].source;s=[{name:t,source:t}]}else s=a.params.map(((t,a)=>"select"===t.type?t.option[o[a]]:e.params?e.params[a]:void 0));return delete a.overviewPopover,t?(e.showItem.params=s,a={...e.showItem}):(delete a.showItem,a.params=s),a},C=async t=>{try{const o=Boolean(t.showItem);if(!o&&6===s.value.length)return t.overviewPopover=!1,h((()=>t.isShow=!1)),m.$message.warn("最多只能显示6个模块");const i=y(t,o),l=o?await(a={overview:JSON.stringify(i)},e.post("panel/overview/SetOverview",{data:a,check:"msg",customType:"model"})):await g({overview:JSON.stringify(i)});t.overviewPopover=!1,t.isShow=!0,b(),m.$message.request(l),l.status&&await r()}catch(o){}var a},b=()=>{p.value={val0:0,val1:0,val2:0,val3:0}};return w((async()=>{n.value=!0,await i(),c(),n.value=!1})),{__sfc:!0,supportConfig:["sites","databases","total","ssh_log"],supportPath:["open_dir"],overviewShowList:s,overviewTemplateList:o,getOverviewTemplateData:i,getOverviewData:r,overviewModelList:l,loading:n,active:v,vm:m,form:p,dataAlignment:c,setOverviewTemplateShow:async t=>{try{if(t.isShow&&6===s.value.length)return h((()=>t.isShow=!1)),m.$message.warn("最多只能显示6个模块");const o=y(t);t.isShow||void 0!==t.showItem.id||(await i(),await c(),(t=l.value.find((e=>e.name===t.name))).isShow=!t.isShow);let n=m.$load("正在"+(t.isShow?"删除":"添加")+"模块，请稍后...");const v=t.isShow?await g({overview:JSON.stringify(o)}):await(a={overview_id:t.showItem.id},e.post("panel/overview/DelOverview",{data:a,check:"msg",customType:"model"}));n.close(),m.$message.request(v),v.status&&(t.isShow&&(t.showItem=v.data.length?v.data[v.data.length-1]:t.showItem),await r(),x())}catch(o){}var a},openNps:x,getModelParams:y,addOverviewFun:C,initForm:b,onPathChange:e=>{t({type:"dir",change:t=>{p.value.val0=t,C(e)}})},setPopoverShow:(e,t)=>{v.value=t;const a=e.showItem.params,s=Object.entries(p.value);for(let o=0;o<s.length&&o<e.params.length;o++){const t=e.params[o];if("select"===t.type){const e=t.option.findIndex((e=>!a||(!a[o]||e.source===a[o].source)));p.value["val"+o]=e}else p.value["val"+o]=a?a[o].source:t.option[o].source}}}}}),(function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("div",{staticClass:"p-[2rem]"},[t("div",{staticClass:"warm-tips"},[t("i",{staticClass:"el-icon-warning-outline text-[#F0AD4E] mr-[0.8rem] text-[1.8rem]"}),t("span",{directives:[{name:"t",rawName:"v-t",value:"HomeOverview.WarmTip",expression:"`HomeOverview.WarmTip`"}],staticClass:"text-[#F0AD4E]"})]),t("div",{staticClass:"flex flex-col"},[t("div",{staticClass:"text-[1.4rem] mb-[1rem] font-bold leading-[2.2rem]"},[e._v("模板")]),t("div",{directives:[{name:"bt-loading",rawName:"v-bt-loading",value:a.loading,expression:"loading"}],staticClass:"overview-box min-h-[20rem]"},e._l(a.overviewModelList,(function(c,d){return t("div",{key:d,staticClass:"overview-item"},[t("div",{staticClass:"content"},[t("span",{staticClass:"model-title"},[e._v(" "+e._s(c.title))]),t("div",{staticClass:"model-content"},["browse"===c.template?[e._m(0,!0)]:[t("span",{staticClass:"font-bold mt-24x text-[1.5rem]"},[e._v("-")])]],2)]),t("div",{staticClass:"operate"},[t("div",{staticClass:"flex items-center"},[t("span",{staticClass:"mr-[.6rem]"},[e._v("显示")]),t(p,{attrs:{size:"mini",width:32},on:{change:function(e){return a.setOverviewTemplateShow(c)}},model:{value:c.isShow,callback:function(t){e.$set(c,"isShow",t)},expression:"item.isShow"}})],1),a.supportConfig.indexOf(c.name)>-1||a.supportPath.indexOf(c.name)>-1?[t(m),t(s,{attrs:{placement:"top",trigger:"click","popper-class":"el-tooltip-white overview-popover"},model:{value:c.overviewPopover,callback:function(t){e.$set(c,"overviewPopover",t)},expression:"item.overviewPopover"}},[t("div",{staticClass:"p-16x"},[t(r,{attrs:{model:a.form,"label-width":"1.4rem"}},[e._l(c.params,(function(s,o){return c.name?[t(l,{key:o,attrs:{label:s.name}},["select"===s.type?t(n,{attrs:{placeholder:"请选择"+s.name},model:{value:a.form["val"+o],callback:function(t){e.$set(a.form,"val"+o,t)},expression:"form['val' + indexs]"}},e._l(s.option,(function(e,a){return t(v,{key:a,attrs:{label:e.name,value:a}})})),1):t(i,{directives:[{name:"trim",rawName:"v-trim"}],attrs:{name:"path",iconType:"folder",width:"16rem"},on:{folder:function(e){return a.onPathChange(c)}},model:{value:a.form.val0,callback:function(t){e.$set(a.form,"val0",t)},expression:"form.val0"}})],1)]:e._e()}))],2),"open_dir"!==c.name?t("div",{staticClass:"flex w-full justify-end"},[t("div",{staticClass:"mt-16x"},[t(o,{attrs:{size:"small",type:"default"},on:{click:function(e){c.overviewPopover=!1}}},[e._v(" 取消 ")]),t(o,{attrs:{size:"small"},on:{click:function(e){return a.addOverviewFun(c)}}},[e._v("确认")])],1)]):e._e()],1),t("span",{staticClass:"cursor-pointer mr-16x",attrs:{slot:"reference"},on:{click:function(e){return a.setPopoverShow(c,d)}},slot:"reference"},[e._v(" 设置 ")])])]:[t("span"),t("span")]],2)])})),0)])])}),[function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"model mt-16x"},[t("div",{staticClass:"to-day"},[t("span",{},[e._v("今日")]),t("span",{staticClass:"font-bold"},[e._v("-")])]),t("div",{staticClass:"yester-day"},[t("span",[e._v("昨日")]),t("span",{staticClass:"font-bold"},[e._v("-")])])])}],!1,null,"133191eb",null,null).exports;export{x as default};
