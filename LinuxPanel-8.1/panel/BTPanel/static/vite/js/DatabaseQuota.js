import{g as t,n as a,a as s}from"./main.js?v=1714377894636";import{_ as e}from"./index40.js?v=1714377894636";import{w as r,x as o,B as u}from"./element-lib.js?v=1714377894636";import{_ as i}from"./index85.js?v=1714377894636";import{e as c,b as l,v as p,c as n,j as m}from"./vue-lib.js?v=1714377894636";import{m as _,au as h,av as d}from"./mysql.store.js?v=1714377894636";import{o as f}from"./confirm.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./config.js?v=1714377894636";import"./check.js?v=1714377894636";const y=a(c({__name:"DatabaseQuota",props:{compData:{default:{}}},setup(a,{expose:s}){const e=a,{proxy:r}=m(),{getDatabase:o}=_(),{getPushConfigInfo:u}=t(),i=l(),c=l(!1),{quota:y,name:b}=e.compData,{used:g,size:q,quota_push:v,quota_storage:x}=y,D=p({size:[{required:!0,message:"请输入容量大小",trigger:"blur"},{validator:(t,a,s)=>{Number.isInteger(1*a)?s():s(new Error("容量配额必须为整数"))},trigger:["blur","change"]}],"quota_push.size":[{validator:(t,a,s)=>{C.quota_push.status?Number.isInteger(1*a)?Number(a)<=0?s(new Error("触发告警大小必须大于0")):s():s(new Error("触发告警大小必须为整数")):s()},trigger:["blur","change"]}],"quota_push.push_count":[{validator:(t,a,s)=>{!C.quota_push.status||""!==a&&a?C.quota_push.status&&(Number(a)<=0||!Number.isInteger(1*a))?s(new Error("请输入正确的告警次数")):s():s(new Error("请输入触发告警次数"))},trigger:["blur","change"]}]}),C=p({used:g,size:q,quota_push:v,quota_storage:x,module:"string"==typeof v.module?new Array(v.module):v.module}),j=n((()=>Object.keys(x).includes("insert_accept")?x.insert_accept?"text-[#20a53a]":"text-danger":"text-warning")),z=n((()=>Object.keys(x).includes("insert_accept")?x.insert_accept?"正常":"已撤销":"未配置")),w=(t,a=2)=>{var s;if(0===t)return"0 Bytes";const e=a<0?0:a,r=Math.floor(Math.log(t)/Math.log(1024));return parseFloat(null==(s=t/Math.pow(1024,r))?void 0:s.toFixed(e))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][r]},k=n((()=>-1===C.used?"未配置容量大小":w(C.used))),B=async t=>{const a={db_name:b,quota_push:{module:C.module.join(","),status:C.quota_push.status,size:C.quota_push.size,push_count:Number(C.quota_push.push_count)||0},quota_storage:{size:C.size}};f({$refs:i.value,loading:c,request:async()=>await h(JSON.stringify(a)),complete:()=>o()})};return s({onConfirm:B}),{__sfc:!0,vm:r,props:e,getDatabase:o,getPushConfigInfo:u,quotaDBFormRef:i,formDisabled:c,quota:y,name:b,used:g,size:q,quota_push:v,quota_storage:x,rules:D,capacityData:C,insertAuthClass:j,insertAuth:z,formatBytes:w,useSize:k,checkSize:t=>{Number(t)<1&&(C.quota_push.status=!1)},checkStatus:t=>{t&&Number(C.size)<=0&&(r.$message.error("请输入容量配额"),C.quota_push.status=!1)},refresh:async()=>{await u(),r.$message.success("刷新成功")},onConfirm:B,recover:async()=>{const t=await d({db_name:b});r.$message.request(t),t.status&&(r.$root.close(),o())}}}}),(function(){var t=this,a=t._self._c,c=t._self._setupProxy;return a("div",{staticClass:"p-20x"},[a(r,{ref:"quotaDBFormRef",staticClass:"px-[2rem] flex justify-center flex-col justify-items-start addfrom",attrs:{model:c.capacityData,disabled:c.formDisabled,rules:c.rules}},[a(o,{attrs:{label:t.$t("FtpContent.CurrentlyUseCapacity"),prop:"used"}},[a(i,{staticClass:"mr-4",attrs:{width:"16rem",readonly:"",textType:c.useSize.split(" ")[1]},model:{value:c.useSize.split(" ")[0],callback:function(a){t.$set(c.useSize.split(" "),0,a)},expression:"useSize.split(' ')[0]"}})],1),a(o,{attrs:{label:t.$t("FtpContent.CurrentCapacityQuota"),prop:"size"}},[a(i,{staticClass:"mr-4",attrs:{width:"16rem",type:"number",textType:"MB"},on:{change:c.checkSize},model:{value:c.capacityData.size,callback:function(a){t.$set(c.capacityData,"size",a)},expression:"capacityData.size"}})],1),a(o,{attrs:{label:"写入权限状态："}},[a("span",{class:c.insertAuthClass},[t._v(t._s(c.insertAuth))]),"已撤销"===c.insertAuth?a("span",[t._v("【"),a(s,{on:{click:c.recover}},[t._v("恢复数据库写入权限")]),t._v("】")],1):t._e()]),a(o,{attrs:{label:"设置容量告警："}},[a(u,{on:{change:c.checkStatus},model:{value:c.capacityData.quota_push.status,callback:function(a){t.$set(c.capacityData.quota_push,"status",a)},expression:"capacityData.quota_push.status"}})],1),a(o,{directives:[{name:"show",rawName:"v-show",value:c.capacityData.quota_push.status,expression:"capacityData.quota_push.status"}]},[a(o,{attrs:{label:"触发告警大小：",prop:"quota_push.size"}},[a(i,{staticClass:"mr-4",attrs:{width:"16rem",type:"number",min:0,textType:"MB"},model:{value:c.capacityData.quota_push.size,callback:function(a){t.$set(c.capacityData.quota_push,"size",a)},expression:"capacityData.quota_push.size"}})],1),a(o,{attrs:{label:"告警次数：",prop:"quota_push.push_count"}},[a("div",{staticClass:"flex items-center"},[a("span",{staticClass:"text-[1.2rem] text-[#666666]"},[t._v("每日最多触发")]),a(i,{staticClass:"mx-4",attrs:{width:"10rem",type:"number"},model:{value:c.capacityData.quota_push.push_count,callback:function(a){t.$set(c.capacityData.quota_push,"push_count",a)},expression:"capacityData.quota_push.push_count"}}),a("span",{staticClass:"text-[1.2rem] text-[#666666]"},[t._v("次告警")])],1)]),a(o,{attrs:{label:"告警方式："}},[a(e,{model:{value:c.capacityData.module,callback:function(a){t.$set(c.capacityData,"module",a)},expression:"capacityData.module"}})],1)],1),a("ul",{staticClass:"mt-8 leading-10 list-disc"},[a("li",[t._v("点击配置后状态未更新，尝试点击【"),a(s,{on:{click:c.refresh}},[t._v("手动刷新")]),t._v("】")],1),a("li",[t._v(t._s(t.$t("FtpContent.WarmReminder")))]),a("li",{staticClass:"text-danger"},[t._v("到达限额容量后仅撤销当前数据库用户插入权限")]),a("li",{staticClass:"text-danger"},[t._v("使用面板导入或使用root账号导入，不受配额影响")]),a("li",[t._v(t._s(t.$t("FtpContent.CapacityTip")))])])],1)],1)}),[],!1,null,null,null,null).exports;export{y as default};
