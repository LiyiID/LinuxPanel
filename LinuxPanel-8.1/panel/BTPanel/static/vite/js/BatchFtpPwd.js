import{_ as t}from"./index85.js?v=1714377894636";import{w as e,x as s}from"./element-lib.js?v=1714377894636";import{c1 as a,ai as r,$ as l,aQ as o,n as i,q as p}from"./main.js?v=1714377894636";import{_ as n}from"./index39.js?v=1714377894636";import{_ as c}from"./index117.js?v=1714377894636";import{_ as m}from"./index76.js?v=1714377894636";import{e as d,b as f,H as u,v as w,j as h}from"./vue-lib.js?v=1714377894636";import{g as v,j as y}from"./ftp.store.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./radio-button.js?v=1714377894636";const b=i(d({__name:"BatchFtpPwd",props:{compData:{default:()=>{}}},setup(t,{expose:e}){const s=t,{getFtpList:i}=v(),{proxy:p}=h(),{loading:n}=a(p),c=f(!1),m=f(null),d=f(s.compData),b=[{label:p.$t("Username"),prop:"name",fixed:!0,minWidth:100},{label:"密码",fixed:!0,minWidth:200,isCustom:!0,render:t=>{const e={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};return t.password=t.password.replace(/&(lt|gt|nbsp|amp|quot);/gi,(function(t,s){return e[s]})),u("input",{attrs:{type:"text",placeholder:"点击编辑密码",title:"点击编辑密码"},domProps:{value:t.password},class:"bt-table-input w-full",on:{blur:e=>{if(e.target.value.length<6&&(p.$message.error("FTP密码长度不能少于6位！"),e.target.value=t.password),t.password===e.target.value)return!1;t.password=e.target.value}}})}}],g=w({type:"0",password:r(12)}),x=f([{title:"所有密码一致",value:"0"},{title:"所有密码不一致",value:"1"}]),F={password:[{validator:(t,e,s)=>{e.length>=6?s():s(new Error("FTP密码长度不能少于6位！"))},trigger:["blur"]}]},C=async t=>{p.$refs.updateFtpInfo.validate((async e=>{if(!e)return!1;{let e=null,a=null,r={},l=[];m.value.data.forEach((t=>{l.push({id:t.id,ftp_username:t.name,new_password:"0"==g.type?g.password:t.password})})),r.data=JSON.stringify(l);try{await p.$confirm({icon:"warning",title:"提示",width:"35rem",message:"修改FTP密码后，旧密码将无法登录FTP账号，是否继续操作？"}),e=n(c,"修改中..."),a=p.$load("修改中...");(await y(r)).status&&(i(),t(),p.$message.success("修改成功"))}catch(s){}finally{e&&e.close(),a&&a.close()}}}))},j=async()=>{o(p.$el,"password")};return e({onConfirm:C,onOpen:j}),{__sfc:!0,props:s,getFtpList:i,vm:p,loading:n,formDisabled:c,showFtpTableRef:m,selectList:d,tableColumn:b,ftpForm:g,typeOptions:x,rules:F,refresh:()=>{g.password=r(12)},copyPwd:()=>{l({value:g.password})},copyAll:()=>{if(m.value.data.length>0){let t="";m.value.data.forEach((e=>{t+="".concat(e.name,"--").concat(e.password,"\n")})),l({value:t})}},refreshAll:()=>{m.value.data.forEach((t=>{t.password=r(12)}));document.querySelector(".refreshAllBtn").blur()},onConfirm:C,getTableData:()=>new Promise((t=>{p.$parent.$children.length>0&&p.$parent.$children.forEach((e=>{(null==e?void 0:e._vnode.tag.indexOf("ElTable"))>-1&&t(e)}))})),onOpen:j}}}),(function(){var a=this,r=a._self._c,l=a._self._setupProxy;return r("div",{class:"1"==l.ftpForm.type?"pt-20x pr-20x pl-8x":"p-20x"},[r(m,{staticClass:"!w-full",class:"1"==l.ftpForm.type?"warn":"",attrs:{type:"warning",closable:!1},scopedSlots:a._u([{key:"title",fn:function(){return[r("span",[a._v("批量改密已选PTP用户，默认自动化改密，支持自定义 ")])]},proxy:!0}])}),r(e,{ref:"updateFtpInfo",staticClass:"bt-custom-form",attrs:{disabled:l.formDisabled,rules:l.rules,model:l.ftpForm}},[r(s,{staticClass:"typeClass",attrs:{label:"类型"}},[r(c,{staticClass:"!flex",attrs:{type:"button",options:l.typeOptions},model:{value:l.ftpForm.type,callback:function(t){a.$set(l.ftpForm,"type",t)},expression:"ftpForm.type"}})],1),r(s,{directives:[{name:"show",rawName:"v-show",value:"1"===l.ftpForm.type,expression:"ftpForm.type === '1'"}],staticClass:"typeClass",attrs:{label:" "}},[r(n,{ref:"showFtpTableRef",attrs:{maxHeight:"200",column:l.tableColumn,data:l.selectList,description:"FTP列表为空","element-loading-text":"正在加载FTP列表，请稍后..."}}),r("div",{staticClass:"mt-[1.6rem]"},[r(p,{staticClass:"h-full inline-block flex items-center",attrs:{slot:"reference",type:"default"},on:{click:l.copyAll},slot:"reference"},[r("i",{staticClass:"el-icon-document-copy"}),r("span",{staticClass:"mb-2x ml-4x"},[a._v("复制所有")])]),r(p,{staticClass:"refreshAllBtn",attrs:{slot:"refresh",type:"default"},on:{click:l.refreshAll},slot:"refresh"},[r("div",{staticClass:"h-full inline-block flex items-center"},[r("i",{staticClass:"el-icon-refresh"}),r("span",{staticClass:"mb-2x ml-4x"},[a._v("刷新所有")])])])],1)],1),r(s,{directives:[{name:"show",rawName:"v-show",value:"0"==l.ftpForm.type,expression:"ftpForm.type == '0'"}],staticClass:"relative mt-16x typeClass",attrs:{label:"密码",prop:"password"}},[r(t,{staticClass:"inputInlineBlock",attrs:{width:"24rem",name:"password",iconType:"refresh"},on:{refresh:l.refresh},model:{value:l.ftpForm.password,callback:function(t){a.$set(l.ftpForm,"password",t)},expression:"ftpForm.password"}}),r("img",{staticClass:"w-1.8rem h-1.8rem cursor-pointer absolute top-3 right-20",attrs:{src:"data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M11%203H3.154c-.319%200-.59.123-.816.367A1.258%201.258%200%200%200%202%204.25v9.5c0%20.69.518%201.25%201.154%201.25H11c.636%200%201.154-.56%201.154-1.25v-9.5C12.154%203.561%2011.636%203%2011%203zm.23%2010.75c0%20.137-.103.25-.23.25H3.154c-.154%200-.23-.083-.23-.25v-9.5c0-.167.076-.25.23-.25H11c.154%200%20.23.083.23.25v9.5zM12.847%201H5c-.308%200-.462.167-.462.5%200%20.333.154.5.462.5h7.846c.154%200%20.23.083.23.25v9.5c0%20.333.155.5.463.5.307%200%20.461-.167.461-.5v-9.5C14%201.561%2013.483%201%2012.846%201zM9.385%205.625H4.769c-.307%200-.461.167-.461.5%200%20.333.154.5.461.5h4.616c.307%200%20.461-.167.461-.5%200-.333-.154-.5-.461-.5zm0%202.5H4.769c-.307%200-.461.167-.461.5%200%20.333.154.5.461.5h4.616c.307%200%20.461-.167.461-.5%200-.333-.154-.5-.461-.5zm-1.847%202.479H4.77c-.307%200-.461.167-.461.5%200%20.333.154.5.461.5h2.77c.307%200%20.461-.167.461-.5%200-.333-.154-.5-.462-.5z'%20fill='%23666'/%3e%3c/svg%3e"},on:{click:l.copyPwd}})],1)],1)],1)}),[],!1,null,"5157d599",null,null).exports;export{b as default};
