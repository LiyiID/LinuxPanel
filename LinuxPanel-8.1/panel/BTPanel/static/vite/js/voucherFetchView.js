import{_ as e}from"./index41.js?v=1714377894636";import{e as t,b as s,T as o,f as a,c as i,j as r}from"./vue-lib.js?v=1714377894636";import{g as l,v as n,bv as c,p as m,n as u}from"./main.js?v=1714377894636";import"./element-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";const v=u(t({__name:"voucherFetchView",props:["compData"],setup(e,{expose:t}){const u=e,{proxy:v}=r(),{refs:{voucherOpenTime:p,isGetCoupon:d}}=l(),{is_coupon:_,useFirstCoupon:f,isHome:h}=u.compData,C=s(""),x=s(!1),g=o(),b=s(Math.floor(Date.now()/1e3));a((()=>g.value),(e=>{b.value=Math.floor(e/1e3)}));const w=i((()=>{let e,t,s,o=Number(sessionStorage.getItem("HOME-ENDTIME"));o||(o=b.value+86400,sessionStorage.setItem("HOME-ENDTIME",o.toString()));const a=o-b.value;return a>0?(e=j(Math.floor(a/3600)),t=j(Math.floor(a%3600/60)),s=j(a%60)):(e="00",t="00",s="00",0===a&&(sessionStorage.removeItem("HOME-ENDTIME"),k("week",!1))),{hour:e,minute:t,second:s}})),y=s([{title:"今日内不再提醒",key:"today"},{title:"近7天内不再提醒",key:"week"},{title:"永久不再提醒",key:"forver"}]),j=e=>e<10?"0".concat(e):"".concat(e),k=async(e,t=!0)=>{let s=0,o="";switch(C.value=e,C.value){case"today":s=new Date((new Date).toLocaleDateString()).getTime()+864e5-1,o="今日内不再通知";break;case"week":s=new Date((new Date).toLocaleDateString()).getTime()+6048e5-1,o="近7天内不再通知";break;case"forver":s=-100,o="永久不再通知"}if(s=Math.floor(s>0?s/1e3:s),t&&await v.$confirm({icon:"warning",title:"提示",message:o+",是否确认?"}),h)p.value=s;else try{const e=await n({limit_time:s});t&&v.$message.request(e)}catch(a){}v.$emit("close"),d.value=!0},D=()=>{x.value&&window.location.reload(),v.$emit("close")};return t({onCancel:D}),{__sfc:!0,vm:v,voucherOpenTime:p,isGetCoupon:d,props:u,is_coupon:_,useFirstCoupon:f,isHome:h,timeClose:C,closeAfterReload:x,timestamp:g,timeNow:b,countdown:w,siteList:y,addZero:j,changeVoucher:async()=>{try{const{data:e}=await c();if(d.value=!0,0===e.status)return v.$message.request({msg:e.msg,status:!1}),x.value=!0,!1;const t={100000011:"pro",100000032:"ltd",100000068:"dev"}[e.data[0].pid],s=e.data[0].id;if(v.$message.request({msg:e.msg,status:!0}),v.$emit("close"),h)return await m({disablePro:"pro"!=t,sourceId:176,isHomeBubble:{id:s,pro:t}}),!1;await f(s,t)}catch(e){}},changeCloseTime:k,onCancel:D}}}),(function(){var t=this,s=t._self._c,o=t._self._setupProxy;return s("section",{staticClass:"bg-voucher flex flex-col"},[s("div",{staticClass:"pt-2.6rem bottom-bg"},[s("div",{staticClass:"px-3.6rem"},[s("div",{staticClass:"text-2rem text-[#FFB04C]"},[t._v("免费限时领取【大额优惠券】")]),s("div",{staticClass:"voucher-list mt-2.6rem"},t._l(o.is_coupon,(function(e,a){var i;return s("div",{key:a,staticClass:"voucher-item flex items-center justify-between py-[1.6rem] rounded-4x",class:a===(null==(i=o.is_coupon)?void 0:i.length)-1?"mb-[1.4rem]":"mb-[2.4rem]"},[s("div",{staticClass:"voucher-amount inline-block px-1.6rem relative w-12rem"},[s("div",{staticClass:"font-bold text-[1.8rem]"},[t._v(" ￥"),s("span",{staticClass:"text-[3.4rem]"},[t._v(t._s(e.val2))])]),s("div",{staticClass:"text-[#999] mt-1rem"},[t._v("满"+t._s(e.val1)+"减"+t._s(e.val2))])]),s("div",{staticClass:"inline-block bg-[#FEFBF6] text-left mr-1rem text-[#666] voucher-instructions flex-1 pl-1.6rem"},[s("div",{staticClass:"text-[1.4rem] mb-1rem"},[t._v("仅限"+t._s(e.name))]),t._m(0,!0)])])})),0)])]),s("div",{staticClass:"px-[3.6rem] pb-1rem mt-1.4rem"},[s("div",{staticClass:"voucher-count-down text-center text-[1.6rem] leading-[3rem] mt-[2.6rem] text-[#666]"},[t._v(" 距结束"),s("span",[t._v(t._s(o.countdown.hour))]),t._v("时"),s("span",[t._v(t._s(o.countdown.minute))]),t._v("分"),s("span",[t._v(t._s(o.countdown.second))]),t._v("秒 ")]),s("div",{staticClass:"mt-[2rem] voucher-footer text-center"},[s("span",{staticClass:"text-[#fff] bg-[#FFB04C] hover:bg-[#F68900]",on:{click:function(e){return o.changeVoucher()}}},[t._v("一键领取")]),s(e,{staticClass:"reminder mt-1rem w-[13.5rem]",attrs:{options:o.siteList,placeholder:"选择不通知的时间",change:o.changeCloseTime},model:{value:o.timeClose,callback:function(e){o.timeClose=e},expression:"timeClose"}})],1)])])}),[function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"voucher-count-down mt-1.2rem text-left"},[e._v(" 领取后有效期 "),t("div",{staticClass:"text-[#EF0808] mlr-[1rem] inline-block text-[2rem]"},[e._v("7")]),e._v(" 天 ")])}],!1,null,"8128dd78",null,null).exports;export{v as default};
