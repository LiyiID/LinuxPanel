import{_ as a}from"./index85.js?v=1714377894636";import{w as r,x as s,q as t,s as e}from"./element-lib.js?v=1714377894636";import{g as o,n as i}from"./main.js?v=1714377894636";import{_ as l}from"./index120.js?v=1714377894636";import{_ as p}from"./cascader.js?v=1714377894636";import{_ as c}from"./AlertForm.js?v=1714377894636";import{e as m,b as n,v as d,w as _,h as g,j as u}from"./vue-lib.js?v=1714377894636";import{o as f}from"./confirm.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{y as h,z as b}from"./crontab.api.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./cascader-panel.js?v=1714377894636";import"./index62.js?v=1714377894636";import"./index134.js?v=1714377894636";import"./config.js?v=1714377894636";import"./index41.js?v=1714377894636";import"./mysql.store.js?v=1714377894636";import"./check.js?v=1714377894636";const y=i(m({__name:"TaskForm",props:{compData:{type:Object,default:()=>({})}},setup(a,{expose:r}){const s=a,{proxy:t}=u(),e=n(),i=d({is_args:"",args_holder:"",args_title:""}),{refs:{timeForm:l}}=o(),p=d({name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],args:[{required:!0,message:"请输入参数",trigger:"blur"}],script_id:[{validator:(a,r,s)=>{"script"===k.on&&""===r?s(new Error("请选择脚本")):s()}}]}),c=n({mode:"ace/mode/nginx",theme:"ace/theme/chrome",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!1,fontSize:"12px"}),m=n(),y=n(!1),k=d({name:"",on:"script",script_id:"",ps:"",args:"",script_body:""}),w=n(s.compData.scriptData),F=async a=>{e.value.form.validate((async a=>{if(a){let a={...k,cycle_type:l.value.type,cycle_hour:l.value.hour,cycle_minute:l.value.minute,cycle_where:l.value.where1,operator_where:[]};delete a.on,"script"===k.on?(a.script_id=k.script_id[1],a.script_body=""):(a.script_body=k.script_body,a.script_id=""),"day"===l.value.type&&a.cycle_where,f({$refs:m.value,loading:y,request:async()=>s.compData.rowData?(a.trigger_id=s.compData.rowData.trigger_id,a.script_id="script"===k.on?a.script_id||s.compData.rowData.script_id:"",await h({data:JSON.stringify(a)})):await b({data:JSON.stringify(a)}),complete:s.compData.getTaskList&&s.compData.getTaskList})}}))},D=()=>{l.value={type:"day",week:"1",hour:"1",minute:"30",where1:"1",timeSet:["1"]}};return _((()=>{if(s.compData.rowData){const{args_ps:a,args_title:r}=s.compData.rowData.script_info,{name:t,ps:e,script_id:o,args:p,script_body:c}=s.compData.rowData;Object.assign(k,{name:t,ps:e,args:p,script_id:o,script_body:c,on:"0"===o||0===o?"0":"script"}),l.value.type=s.compData.rowData.cycle_type,l.value.hour=s.compData.rowData.cycle_hour,l.value.minute=s.compData.rowData.cycle_minute,l.value.where1=s.compData.rowData.cycle_where,s.compData.rowData.args&&""===c?(i.is_args=!0,i.args_holder=a,i.args_title=r):i.is_args=!1}})),r({onConfirm:F}),g((async()=>{await D()})),{__sfc:!0,props:s,vm:t,alertForm:e,propsData:{label:"name",value:"script_id",children:"script_list"},argsForm:i,timeForm:l,rules:p,config:c,taskArrangement:m,formDisabled:y,taskForm:k,scriptOptions:w,onConfirm:F,changeScriptType:a=>{"0"===a&&(k.script_body="",i.is_args=!1),k.script_id="",k.args=""},changeScript:a=>{let r=t.$refs.scriptCascader.getCheckedNodes()[0].data;1===r.is_args?(i.is_args=!0,i.args_holder=r.args_ps,i.args_title=r.args_title):i.is_args=!1},onClearTime:D}}}),(function(){var o=this,i=o._self._c,m=o._self._setupProxy;return i("div",{staticClass:"p-20x"},[i(r,{ref:"taskArrangement",attrs:{disabled:m.formDisabled,"label-position":"right",rules:m.rules,"label-width":"80px",model:m.taskForm}},[i(s,{attrs:{label:"名称",prop:"name"}},[i(a,{attrs:{width:"32.2rem",placeholder:"请输入任务名称"},model:{value:m.taskForm.name,callback:function(a){o.$set(m.taskForm,"name",a)},expression:"taskForm.name"}})],1),i(c,{ref:"alertForm",staticClass:"my-20x",attrs:{"show-notice":!1}}),i(s,{attrs:{label:"运行"}},[i(t,{staticClass:"mr-12x w-[12rem]",on:{change:m.changeScriptType},model:{value:m.taskForm.on,callback:function(a){o.$set(m.taskForm,"on",a)},expression:"taskForm.on"}},[i(e,{attrs:{label:"脚本库",value:"script"}}),i(e,{attrs:{label:"自定义脚本",value:"0"}})],1),"script"===m.taskForm.on?i(s,{staticClass:"!inline-block",attrs:{prop:"script_id"}},[i(p,{ref:"scriptCascader",staticClass:"w-[19rem]",attrs:{"show-all-levels":!1,props:m.propsData,placeholder:"请选择脚本,支持搜索",options:m.scriptOptions,filterable:""},on:{change:m.changeScript},model:{value:m.taskForm.script_id,callback:function(a){o.$set(m.taskForm,"script_id",a)},expression:"taskForm.script_id"}})],1):o._e(),"0"===m.taskForm.on||0===m.taskForm.on?i(l,{staticClass:"mt-12x !h-[12rem] !w-[32.2rem]",attrs:{"is-zoom":!0,config:m.config},model:{value:m.taskForm.script_body,callback:function(a){o.$set(m.taskForm,"script_body",a)},expression:"taskForm.script_body"}}):o._e()],1),i(s,{attrs:{label:"备注"}},[i(a,{attrs:{placeholder:"请输入备注",width:"32.2rem"},model:{value:m.taskForm.ps,callback:function(a){o.$set(m.taskForm,"ps",a)},expression:"taskForm.ps"}})],1),m.argsForm.is_args?i(s,{attrs:{label:m.argsForm.args_title,prop:"args"}},[i(a,{attrs:{placeholder:m.argsForm.args_holder,width:"32.2rem"},model:{value:m.taskForm.args,callback:function(a){o.$set(m.taskForm,"args",a)},expression:"taskForm.args"}})],1):o._e()],1)],1)}),[],!1,null,"6933f0dc",null,null).exports;export{y as default};
