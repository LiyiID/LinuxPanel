import{_ as e}from"./index52.js?v=1714377894636";import{_ as a}from"./index53.js?v=1714377894636";import{g as t,o as s,e as i,n,a as l}from"./main.js?v=1714377894636";import{_ as r}from"./index39.js?v=1714377894636";import{_ as o}from"./index54.js?v=1714377894636";import{_ as m}from"./index55.js?v=1714377894636";import{_ as c}from"./index57.js?v=1714377894636";import{L as u,q as p,s as d}from"./element-lib.js?v=1714377894636";import{_ as v}from"./index43.js?v=1714377894636";import{_ as f}from"./index58.js?v=1714377894636";import{_ as g}from"./index59.js?v=1714377894636";import"./index45.js?v=1714377894636";import{_ as h}from"./index60.js?v=1714377894636";import{e as j,b,v as y,H as x,h as _,j as S}from"./vue-lib.js?v=1714377894636";import{g as C,m as T,j as P,k,l as w,n as J,o as L,i as N}from"./site.store.js?v=1714377894636";import{r as O,k as I,l as B,c as R,N as D,m as $,p as M,n as q,f as E,g as G,i as A,o as z}from"./site.popup.js?v=1714377894636";import{o as F}from"./index61.js?v=1714377894636";import{a as H}from"./confirm.js?v=1714377894636";import{c as V}from"./check.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{s as K}from"./site.method.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./index38.js?v=1714377894636";import"./element-ui.common.js?v=1714377894636";import"./date-util.js?v=1714377894636";import"./vdom.js?v=1714377894636";import"./index62.js?v=1714377894636";import"./cascader-panel.js?v=1714377894636";import"./config.js?v=1714377894636";const Q=n(j({__name:"index",setup(e){const{proxy:a}=S(),{refs:{modulesTableParams:n},getModulesList:l,getModulesTypeList:r}=C(),{getPublicConfigInfo:o}=t(),m=b(!1),c=b(!1),u=b([]),p=y({isRecurrence:!1,describe:{title:"",th:"",message:"",propsValue:""}}),d=[{content:"添加Java项目",active:!0,event:()=>{B()}},{content:"JAVA环境管理",dropdown:!0,dropdownClass:"bg-white",splitButton:!0,settingList:[{label:"JDK管理",name:"jdkSettings"},{label:"Tomcat管理",name:"tomcatSettings"}],event:e=>{"string"!=typeof e&&(e="jdkSettings"),$(e)}},{content:"项目守护间隔时间",hide:s,event:()=>{M("java")}},{content:"项目编排",hide:s,event:()=>{q()}}],v=b([{label:"名称",prop:"name"},{label:"结果",render:e=>x("span",{class:e.status?"text-primary":"text-danger"},e.status?"操作成功":e.msg)}]),f=b([{label:"启动项目",value:"startJavaSite",diyBatch:()=>{g("start")}},{label:"停用项目",value:"stopJavaSite",diyBatch:()=>{g("stop")}},{label:"绑定外网",value:"bindJavaSite",diyBatch:()=>{F({title:"批量绑定选中的项目后，项目将可以通过外网访问，是否继续操作？",dataList:u.value,titleType:"批量绑定外网",diyRes:!0,requestFun:async e=>{var a,t,s;let i=null==(a=u.value)?void 0:a.map((e=>e.name));const n=await T({data:JSON.stringify({project_names:i})});l("java");let r=null==(t=n.data.project_names)?void 0:t.map((e=>({name:e,status:!0})));null==(s=n.data.error_list)||s.forEach((e=>{r.push({name:e.project_name,status:!1,msg:e.msg})}));let o={resultData:r,resultTitle:"绑定外网",resultColumn:v.value};O(o)},tableColumn:[{prop:"name",label:"网站名"},{prop:"result",label:"状态"}],isRecurrence:!1})}},{label:"部署证书",value:"setCertificates",isRefBatch:!0},{label:"删除项目",value:"delJavaSite",isRefBatch:!0}]),g=async e=>{try{F({diyRes:!0,isCloseRes:!0,title:"批量"+("stop"===e?"停止":"启动")+"选中的项目后，项目将"+("stop"===e?"无法正常访问，用户访问会显示当前项目停用页面":"恢复正常访问")+"，是否继续操作？",dataList:u.value,titleType:"批量"+("stop"===e?"停止":"启动")+"项目",requestFun:async t=>{var s;let i=a.$load("正在处理中,请稍后..."),n=null==(s=u.value)?void 0:s.map((e=>e.name));const r=await P({data:JSON.stringify({operation:e,project_names:n})});let o=r.data.project_names.map((e=>({name:e,status:r.data.status})));i.close(),l("java"),O({resultData:o,resultTitle:("stop"===e?"停止":"启动")+"项目"})},tableColumn:[{prop:"name",label:"分组名称"},{prop:"result",label:"状态"}],isRecurrence:!1})}catch(t){}},h=(e,a)=>{a||(a=!1);let t={};a&&(t={type:"input",inputText:"批量删除项目"}),H({confirm:{icon:"warning",title:a?"批量删除项目":"删除java项目",message:a?"批量删除选中的项目后，项目将无法恢复，是否继续操作？":"您正在删除Java项目-[ "+e.name+" ]，继续吗？",...t},loading:"正在删除，请稍后...",request:async()=>{var t;if(a){let e=null==(t=u.value)?void 0:t.map((e=>e.name));return await k({data:JSON.stringify({project_names:e})},"java")}return await w({data:JSON.stringify({project_name:e.name})},"java")},async complete(){l("java")}})},j=async e=>{try{const t=await J();if(Object.values(t.data).some((e=>e.status))){await a.$confirm({title:"修复项目",message:"您正在修复Java项目-[ "+e.name+" ]，是否继续吗？",icon:"warning"});let t=a.$load("正在修复中,请稍后...");const s=await L({data:JSON.stringify({project_name:e.name})});t.close(),a.$message.request(s),l("java")}else a.$message.error("当前tomcat版本未安装，请安装后重试！"),$("tomcatSettings")}catch(t){}},Q=async()=>{var e,a;let t=V(null==(e=JSON.parse(sessionStorage.getItem("BT-CONFIG")||"{}"))?void 0:e.web,"object",{});t.hasOwnProperty("setup")&&!t.setup&&(o(),t=null==(a=JSON.parse(sessionStorage.getItem("BT-CONFIG")||"{}"))?void 0:a.web),t.hasOwnProperty("setup")&&!t.setup&&(c.value=!0)},U=I({changeStatusEvent:e=>{K.setProject(e,e.run?"stop":"start","java",(()=>l("java")))},deleteEvent:h,setSiteTime:e=>{A(e,!1,"java")},openSetting:(e,a)=>{z(e,a||!1)},repairEvent:j});return _((async()=>{Q(),await l("java")})),{__sfc:!0,vm:a,modulesTableParams:n,getModulesList:l,getModulesTypeList:r,getPublicConfigInfo:o,hovering:m,maskLayer:c,checkedList:u,batchConfig:p,tableBtnGroup:d,resultColumn:v,batchGroup:f,handleSelectionChange:e=>{u.value=e},handleBatch:e=>{switch(e){case"settingClass":G(u.value,"java");break;case"delJavaSite":h(u.value,!0);break;case"setCertificates":E(u.value)}},handleMultiSetProject:g,handleSerach:e=>{n.value.search=e,void 0===e&&(n.value.search=""),l("java")},changePage:e=>{n.value.p=e,l("java")},changeSize:e=>{var a;n.value.limit=e;let t=JSON.parse(null!=(a=localStorage.getItem("siteOtherPageLimit"))?a:"{}");t.java=e,localStorage.setItem("siteOtherPageLimit",JSON.stringify(t)),l("java")},getTableList:()=>{l("java")},deleteEvent:h,repairEvent:j,openInstall:async e=>{const{data:t}=await N({sName:e.name});if("-1"===t.task)return a.$message.error("当前插件正在安装，不可重复安装");i({name:t.name,type:t.type,pluginInfo:t})},checkInstall:Q,tableColumns:U,javaAddSiteDialog:B,classSettingDialog:R,NPSDialog:D,isRelease:s}}}),(function(){var t=this,s=t._self._c,i=t._self._setupProxy;return s("div",[s(h,{attrs:{visible:i.maskLayer,width:"38rem"}},[s("div",{staticClass:"flex items-center"},[s("span",[t._v("未安装运行环境，")]),s(l,{staticClass:"!font-bold !text-[1.4rem]",on:{click:function(e){return i.openInstall({name:"nginx"})}}},[t._v("安装Nginx")]),s(u,{attrs:{direction:"vertical"}}),s(l,{staticClass:"!font-bold !text-[1.4rem]",on:{click:function(e){return i.openInstall({name:"apache"})}}},[t._v("安装Apache")])],1)]),s(g,{scopedSlots:t._u([{key:"header-left",fn:function(){return[s("div",{staticClass:"flex items-center"},[s(f,{attrs:{group:i.tableBtnGroup}}),s("div",{staticClass:"flex items-center ml-12x"},[s(l,{attrs:{href:"https://www.bt.cn/bbs/thread-76217-1-1.html"}},[t._v("Java项目教程")]),s("i",{staticClass:"el-icon-link text-primary text-[1.6rem] ml-4x"})],1),s(v,{staticClass:"ml-12x inline-block",attrs:{icon:"demand",iconClass:"text-1.6rem",content:"需求反馈"},on:{click:function(e){return i.NPSDialog()}}})],1)]},proxy:!0},{key:"header-right",fn:function(){return[i.isRelease?t._e():s("div",{staticClass:"flex items-center"},[s(p,{staticClass:"mr-8x w-[12rem]",on:{change:function(e){return i.getModulesList("java")}},model:{value:i.modulesTableParams.type_id,callback:function(e){t.$set(i.modulesTableParams,"type_id",e)},expression:"modulesTableParams.type_id"}},[s("div",{staticClass:"max-h-[20rem] overflow-auto",class:{"no-hover":i.hovering}},t._l(i.modulesTableParams.typeList,(function(e,a){return s(d,{key:a,attrs:{label:e.name,value:e.id}})})),1),s("div",{staticClass:"classify-item",on:{click:function(e){return i.classSettingDialog("java")},mouseover:function(e){i.hovering=!0},mouseout:function(e){i.hovering=!1}}},[t._v(" 分类设置 ")])])],1),s("div",{staticClass:"relative"},[s(c,{attrs:{placeholder:t.$t("SitePhpModel.TableSearch"),width:"40rem"},on:{search:i.handleSerach,clear:i.handleSerach},model:{value:i.modulesTableParams.search,callback:function(e){t.$set(i.modulesTableParams,"search",e)},expression:"modulesTableParams.search"}})],1),s(m,{staticClass:"!mx-8x",attrs:{refresh:i.getTableList}}),s(o,{attrs:{name:"siteJavaTable",column:i.tableColumns}})]},proxy:!0},{key:"content",fn:function(){return[s(r,{directives:[{name:"loading",rawName:"v-loading",value:i.modulesTableParams.loading,expression:"modulesTableParams.loading"}],ref:"siteJavaTable",attrs:{"element-loading-text":"正在加载中...",data:i.modulesTableParams.list,column:i.tableColumns},on:{"selection-change":i.handleSelectionChange},scopedSlots:t._u([{key:"empty",fn:function(){return[s("div",{staticClass:"flex items-center justify-center"},[t._v(" 您的列表为空，您可以 "),s(l,{on:{click:function(e){return i.javaAddSiteDialog()}}},[t._v("添加一个项目")])],1)]},proxy:!0}])})]},proxy:!0},{key:"footer-left",fn:function(){return[s(a,{attrs:{data:i.batchGroup,config:i.batchConfig,"batch-fn":()=>{}},on:{"handle-batch":i.handleBatch}})]},proxy:!0},{key:"footer-right",fn:function(){return[s(e,{attrs:{total:i.modulesTableParams.total,"current-page":i.modulesTableParams.p,"page-size":i.modulesTableParams.limit},on:{"current-change":i.changePage,"size-change":i.changeSize}})]},proxy:!0}])})],1)}),[],!1,null,"21210461",null,null).exports;export{Q as default};
