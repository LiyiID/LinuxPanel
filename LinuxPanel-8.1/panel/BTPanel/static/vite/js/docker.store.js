import{z as t,V as a,A as s}from"./vue-lib.js?v=1714377894636";import{v as i,w as e,x as o,y as r,z as n,A as l,B as h,C as c,D as d,E as D,F as p,G as m,H as g,I as b,J as T}from"./docker.api.js?v=1714377894636";import{J as u,c as y}from"./main.js?v=1714377894636";import{c as _}from"./check.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";const L=t("DOCKER-STORE",{state:()=>({tabActive:"deployment",refreshServerTable:!1,refreshCommonTable:!1,refreshMirrorTable:!1,containerLogTab:"",quickListData:[],currentConDetail:{},maxCPU:0,maxMem:0,loading:!1,firstLoad:{app:!0,container:!0,item:!0,template:!0,mirror:!0,net:!0,storage:!0,stash:!0},deployMenuData:{loading:!1,list:[],search:"",total:0,p:1,row:20},containerTableData:{loading:!1,list:[],showList:[],grouped:{},selection:[],historySearch:[],rowData:{},topList:[],total:0,p:1,limit:20,usedList:[]},itemTableData:{loading:!1,list:[],showList:[],selection:[],historySearch:[],rowData:{},total:0,p:1,limit:20},projectGroupData:{loading:!1,list:[]},templateTableData:{loading:!1,list:[],showList:[],selection:[],historySearch:[],rowData:{},total:0,p:1,limit:20},mirrorTableData:{loading:!1,list:[],showList:[],selection:[],historySearch:[],rowData:{},total:0,p:1,limit:20},netTableData:{loading:!1,list:[],showList:[],selection:[],historySearch:[],rowData:{},total:0,p:1,limit:20},storageTableData:{loading:!1,list:[],showList:[],selection:[],historySearch:[],rowData:{},total:0,p:1,limit:20},stashTableData:{loading:!1,list:[],showList:[],selection:[],historySearch:[],rowData:{},total:0,p:1,limit:20},settingData:{service_status:!0,docker_installed:!1,docker_compose_installed:!1,docker_compose_path:"/usr/bin/docker-compose",monitor_status:!1,monitor_save_date:0,url:"11",options:[],daemon_path:"/etc/docker/daemon.json",installing:0}}),actions:{chunkArray(t){const a=[];for(let s=0;s<t.list.length;s+=t.limit)a.push(t.list.slice(s,s+t.limit));return a},async getAppList(t){try{this.firstLoad.app&&(this.loading=!0);const a={p:this.deployMenuData.p,row:this.deployMenuData.row,query:this.deployMenuData.search};!0===t&&(a.force=1);const s=await i(a);s.status&&(""!==this.deployMenuData.search?this.deployMenuData.list=s.data.data:this.deployMenuData.list=[...this.deployMenuData.list,...s.data.data],this.firstLoad.app=!1,this.deployMenuData.total=u(s.data.page))}catch(a){}finally{this.loading=!1}},async getQuickList(){try{0===this.quickListData.length&&(this.loading=!0);const t=await e();this.quickListData=t.data}catch(t){}finally{this.loading=!1}},async getCList(){var t;try{this.firstLoad.container&&(this.containerTableData.loading=!0);const a=await o();this.firstLoad.container=!1;const s=_(null==(t=a.data)?void 0:t.container_list,"array",[]);this.containerTableData.list=this.sortContainerList(s),this.containerTableData.topList=a.data.container_to_top,this.containerTableData.total=a.data.container_list.length,this.containerTableData.showList=this.chunkArray(this.containerTableData)[this.containerTableData.p-1]||[],this.containerTableData.grouped=a.data.grouped_by_status,this.maxCPU=a.data.online_cpus,this.maxMem=Number(y(Number(a.data.mem_total),!1,0,"MB"));const i=await r();this.setContainerInfo(this.containerTableData.list,_(i.data,"array",[])),this.containerTableData.showList=this.chunkArray(this.containerTableData)[this.containerTableData.p-1]||[]}catch(a){}finally{this.containerTableData.loading=!1}},setContainerInfo(t,s){t.forEach(((t,i)=>{const e=s.find((a=>a.id===t.id));e&&(a.set(t,"backup_count",e.backup_count),a.set(t,"remark",e.remark))}))},sortContainerList:t=>t.sort(((t,a)=>1==t.is_top&&1!=a.is_top?-1:1!=t.is_top&&1==a.is_top?1:t.name.localeCompare(a.name))),setTopContainerList(){this.containerTableData.list=this.sortContainerList(this.containerTableData.list),this.containerTableData.showList=this.chunkArray(this.containerTableData)[this.containerTableData.p-1]||[]},async getCurrentCon(t){try{const a=await n({data:JSON.stringify({id:t})});a.status&&(this.currentConDetail=a.data)}catch(a){}},async getIList(){try{this.firstLoad.item&&(this.itemTableData.loading=!0);const t=await l();this.firstLoad.item=!1,this.itemTableData.list=t.data,this.itemTableData.total=t.data.length,this.itemTableData.showList=this.chunkArray(this.itemTableData)[this.itemTableData.p-1]||[];(await h()).data.forEach(((t,a)=>{const s=this.itemTableData.list[a];this.itemTableData.list.splice(a,1,{...s,num:t})})),this.itemTableData.showList=this.chunkArray(this.itemTableData)[this.itemTableData.p-1]||[]}catch(t){}finally{this.itemTableData.loading=!1}},async getProjectGroup(){try{0===this.projectGroupData.list.length&&(this.projectGroupData.loading=!0);const{data:t}=await c(),a=_(t.value,"array",[]);this.projectGroupData.list=a}catch(t){}finally{this.projectGroupData.loading=!1}},async getTList(){try{this.firstLoad.template&&(this.templateTableData.loading=!0);const t=await d();this.firstLoad.template=!1,this.templateTableData.list=t.data,this.templateTableData.total=t.data.length,this.templateTableData.showList=this.chunkArray(this.templateTableData)[this.templateTableData.p-1]||[]}catch(t){}finally{this.templateTableData.loading=!1}},async getMList(t){try{if(this.firstLoad.mirror&&(this.mirrorTableData.loading=!0),"page"===t)return void(this.mirrorTableData.showList=this.chunkArray(this.mirrorTableData)[this.mirrorTableData.p-1]||[]);const a=await D();this.firstLoad.mirror=!1,this.mirrorTableData.list=a.data,this.mirrorTableData.total=a.data.length,this.mirrorTableData.showList=this.chunkArray(this.mirrorTableData)[this.mirrorTableData.p-1]||[]}catch(a){}finally{this.mirrorTableData.loading=!1}},async getNList(){try{this.firstLoad.net&&(this.netTableData.loading=!0);const t=await p();this.firstLoad.net=!1,this.netTableData.list=t.data,this.netTableData.total=t.data.length,this.netTableData.showList=this.chunkArray(this.netTableData)[this.netTableData.p-1]||[]}catch(t){}finally{this.netTableData.loading=!1}},async getSList(){try{this.firstLoad.storage&&(this.storageTableData.loading=!0);const t=await m();this.firstLoad.storage=!1,this.storageTableData.list=t.data,this.storageTableData.total=t.data.length,this.storageTableData.showList=this.chunkArray(this.storageTableData)[this.storageTableData.p-1]||[]}catch(t){}finally{this.storageTableData.loading=!1}},async getStash(){try{this.firstLoad.stash&&(this.stashTableData.loading=!0);const t=await g();this.firstLoad.stash=!1,this.stashTableData.list=t.data,this.stashTableData.total=t.data.length,this.stashTableData.showList=this.chunkArray(this.stashTableData)[this.stashTableData.p-1]||[]}catch(t){}finally{this.stashTableData.loading=!1}},async getSet(t){try{if(this.loading=!0,!1!==t){const{data:t}=await b();this.settingData.service_status=t.service_status,this.settingData.docker_installed=t.docker_installed,this.settingData.docker_compose_installed=t.docker_compose_installed,this.settingData.docker_compose_path=t.docker_compose_path,this.settingData.monitor_status=t.monitor_status,this.settingData.monitor_save_date=t.monitor_save_date,this.settingData.daemon_path=t.daemon_path}const a=await T();0===a.data.registry_mirrors.length?this.settingData.url="未设置加速URL":this.settingData.url=a.data.registry_mirrors[0];const s=[];Object.entries(a.data.com_reg_mirrors).forEach((t=>{s.push({label:"".concat(t[0],"(").concat(t[1],")"),value:t[0]})})),this.settingData.options=s,this.loading=!1}catch(a){this.loading=!1}},async getDockerState(){try{this.loading=!0;const{data:t}=await b();this.settingData.service_status=t.service_status,this.settingData.docker_installed=t.docker_installed,this.settingData.docker_compose_installed=t.docker_compose_installed,this.settingData.docker_compose_path=t.docker_compose_path,this.settingData.monitor_status=t.monitor_status,this.settingData.monitor_save_date=t.monitor_save_date,this.settingData.daemon_path=t.daemon_path,this.loading=!1}catch(t){this.loading=!1}}}}),f=()=>{const t=L();return{refs:s(t),...t}};export{f as g,L as u};
