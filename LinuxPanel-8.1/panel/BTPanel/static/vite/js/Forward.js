import{_ as e}from"./index52.js?v=1714377894636";import{_ as t}from"./index53.js?v=1714377894636";import{_ as a}from"./index39.js?v=1714377894636";import{o as r,_ as n}from"./element-lib.js?v=1714377894636";import{ar as s,cm as o,J as i,cn as l,au as p,n as d}from"./main.js?v=1714377894636";import{_ as c}from"./index58.js?v=1714377894636";import{_ as m}from"./index59.js?v=1714377894636";import{e as u,b as f,v as g,H as _,h as j,j as y}from"./vue-lib.js?v=1714377894636";import{c as h}from"./check.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{f as x}from"./firewall.table.js?v=1714377894636";import{j as b}from"./firewall.popup.js?v=1714377894636";import{F as v}from"./index31.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./index45.js?v=1714377894636";import"./index46.js?v=1714377894636";import"./index.vue_vue_type_style_index_0_lang.js?v=1714377894636";import"./index38.js?v=1714377894636";import"./index77.js?v=1714377894636";import"./index42.js?v=1714377894636";import"./firewall.store.js?v=1714377894636";import"./confirm.js?v=1714377894636";import"./config.js?v=1714377894636";import"./descriptions.js?v=1714377894636";import"./index98.js?v=1714377894636";import"./index57.js?v=1714377894636";import"./upload.js?v=1714377894636";import"./index62.js?v=1714377894636";import"./home.popup.js?v=1714377894636";const w=d(u({__name:"Forward",setup(e){const{proxy:t}=y(),a=f([]),r=f({}),n=f(""),d=f(1),c=f(0),m=f(!1),u=g({p:1,limit:20}),w=f([{label:"删除",value:"delete"}]);let k=[],P=0;const C=g({isRecurrence:!0,describe:{title:"批量删除端口转发",th:"目标IP",message:"批量删除选中端口转发规则，是否继续操作？",propsValue:"ended_ip"},tableDisplayConfig:{label:"状态",prop:"status",render:e=>_("span",{class:0===k.length?"text-warning":k.includes(e.id)?"text-primary":"text-danger"},(()=>{if(0===k.length)return"等待执行";{let t=k.includes(e.id)?"执行成功":"执行失败";return P===2*k.length?(k=[],P=0):P++,t}})())}}),S=f([{active:!0,content:"添加端口转发",event:()=>{r.value={},b(!1,(()=>$()))}},{content:"导入规则",event:()=>{t.$refs.fileIpRef.open()}},{content:"导出规则",event:()=>{E()}}]),$=async(e=1)=>{try{m.value=!0;const{data:t}=await o({data:JSON.stringify({...u,p:e,query:n.value})});a.value=h(t.data,"array",[]),c.value=i(t.page)}catch(t){}finally{m.value=!1}},I=async e=>{b(e,(()=>$()))},O=async e=>{try{await t.$confirm({icon:"warning",title:"删除端口转发规则【源端口："+e.start_port+" -> 目标端口："+e.ended_port+"】",width:"40rem",message:"删除选中规则后，该源端口将停止转发至目标端口，是否继续操作？"});const a=t.$load("正在删除IP规则，请稍后...");e.s_port=e.start_port,e.d_port=e.ended_port,e.d_ip=e.ended_ip,delete e.start_port,delete e.ended_portS,delete e.ended_ip;const r=await l({data:JSON.stringify(e)});await t.$message.request(r),$(),a.close()}catch(a){}},E=async()=>{const e=await s({data:JSON.stringify({rule_name:"trans_rule"})});e.data.status?window.open("/download?filename="+e.data.msg):t.$message.request(e)},F=x({updataEvent:I,deleteRow:O});return j((()=>{$()})),{__sfc:!0,vm:t,getData:a,rowData:r,search:n,currentPage:d,completedTotal:c,loading:m,tableParam:u,batchGroup:w,resList:k,index:P,batchConfig:C,tableBtnGroup:S,pageChange:e=>{u.limit=e,$()},currentListPage:$,updataEvent:I,deleteRow:O,batchEvent:async(e,t,a)=>{try{let e=t;e.s_port=t.start_port,e.d_port=t.ended_port,e.d_ip=t.ended_ip,delete e.start_port,delete e.ended_portS,delete e.ended_ip;const a=await l({data:JSON.stringify(e)});return a.data.status&&k.push(t.id),a}catch(r){}},ruleExport:E,changeInputFile:async e=>{let a={rule_name:"trans_rule",file_name:t.$refs.fileIpRef.fileData.f_name};const r=t.$load("正在导入规则，请稍后..."),n=await p({data:JSON.stringify(a)});n.status&&$(),r.close(),t.$message.request(n)},tableColumn:F,FirewallSafetyUpload:v}}}),(function(){var s=this,o=s._self._c,i=s._self._setupProxy;return o("div",{staticClass:"py-20x"},[o(m,{scopedSlots:s._u([{key:"header-left",fn:function(){return[o(c,{attrs:{group:i.tableBtnGroup}}),o(i.FirewallSafetyUpload,{ref:"fileIpRef",on:{"upload-success":i.changeInputFile}})]},proxy:!0},{key:"header-right",fn:function(){return[o(r,{staticClass:"float-right",attrs:{size:"small",clearable:"",placeholder:"请输入端口信息"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&s._k(e.keyCode,"enter",13,e.key,"Enter")?null:i.currentListPage(1)}},model:{value:i.search,callback:function(e){i.search=e},expression:"search"}},[o(n,{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(e){return i.currentListPage(1)}},slot:"append"})],1)]},proxy:!0},{key:"content",fn:function(){return[o(a,{directives:[{name:"loading",rawName:"v-loading",value:i.loading,expression:"loading"}],ref:"table",attrs:{column:i.tableColumn,data:i.getData,description:"端口转发列表为空","element-loading-text":"正在加载端口转发列表，请稍后..."}})]},proxy:!0},{key:"footer-left",fn:function(){return[o(t,{attrs:{data:i.batchGroup,config:i.batchConfig,"batch-fn":i.batchEvent},on:{"handle-complete":function(e){return i.currentListPage(i.tableParam.p)}}})]},proxy:!0},{key:"footer-right",fn:function(){return[o(e,{attrs:{total:i.completedTotal,"current-page":i.currentPage,"page-size":i.tableParam.limit},on:{"size-change":i.pageChange,"current-change":i.currentListPage}})]},proxy:!0}])})],1)}),[],!1,null,null,null,null).exports;export{w as default};
