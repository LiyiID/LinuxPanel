import{_ as t}from"./index118.js?v=1714377894636";import{n as s,q as e}from"./main.js?v=1714377894636";import{w as a,x as i,q as l,s as n}from"./element-lib.js?v=1714377894636";import{e as o,b as r,h as p,j as c}from"./vue-lib.js?v=1714377894636";import{g as m,bF as u,bG as d}from"./site.store.js?v=1714377894636";import{a2 as f,a5 as v}from"./site.popup.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./check.js?v=1714377894636";import"./index38.js?v=1714377894636";import"./index45.js?v=1714377894636";import"./element-ui.common.js?v=1714377894636";import"./date-util.js?v=1714377894636";import"./vdom.js?v=1714377894636";import"./index62.js?v=1714377894636";import"./cascader-panel.js?v=1714377894636";const y=s(o({__name:"LetsEncryptRenew",props:{compData:{default:()=>({})}},setup(t){const s=t,{proxy:e}=c(),{refs:{sslDnsApiInfo:a,siteInfo:i},getSslDnsApiInfo:l,applyLetResult:n}=m(),o=r([{label:"文件验证 - HTTP",value:"http",data:!1,config:!1}]),y=r("http"),j=r([{text:"通配符证书不能使用【文件验证】，请选择DNS验证"},{text:"使用【文件验证】，请确保没有开[启强制HTTPS/301重定向/反向代理]等功能"},{text:"使用【阿里云DNS】【DnsPod】等验证方式需要设置正确的密钥"},{text:"续签成功后，证书将在下次到期前30天尝试自动续签"},{text:"使用【DNS验证 - 手动解析】续签的证书无法实现下次到期前30天自动续签"}]);return p((async()=>{await l(),o.value=o.value.concat(a.value)})),{__sfc:!0,props:s,vm:e,sslDnsApiInfo:a,siteInfo:i,getSslDnsApiInfo:l,applyLetResult:n,dnsArray:o,dnsVerify:y,letSslHelp:j,setSslDnsApi:t=>{const s=y.value;if("dns"!==s&&"http"!==s){const e=a.value.find((t=>t.value===s)),i=!e.data;(!t||t&&i)&&f({title:"设置".concat(e.info.title,"接口"),row:e.info})}},oneClickRenew:async()=>{let t={domains:JSON.stringify(s.compData.dns),auth_type:"http",auth_to:s.compData.id||"dns",auto_wildcard:"0"};if("http"===y.value){const t=JSON.stringify(s.compData.dns);if(-1!==(null==t?void 0:t.indexOf("*.")))return e.$message.error("包含通配符的域名不能使用文件验证(HTTP)!")}else{if("dns"!==y.value){const{data:s,info:{data:i}}=a.value.find((t=>t.value===y.value));if(!s)return void e.$message.error("指定dns接口没有设置密钥信息");t.auth_to="".concat(y.value,"|").concat(i[0].value,"|").concat(i[1].value)}t.auth_type="dns"}t.id=i.value.id,t.siteName=i.value.name;const l=await v(),{data:o}="proxy"==i.value.project_type||"nginx"==i.value.project_type?await u({...t,site_name:i.value.name}):await d(t);null==l||l.close(),n(o,t)}}}}),(function(){var s=this,o=s._self._c,r=s._self._setupProxy;return o("div",{staticClass:"p-[1.5rem]"},[o(a,{staticClass:"mb-20x"},[o(i,{attrs:{label:"请选择验证方式"}},[o(l,{staticClass:"mr-16x",attrs:{placeholder:"请选择"},on:{change:function(t){return r.setSslDnsApi(!0)}},model:{value:r.dnsVerify,callback:function(t){r.dnsVerify=t},expression:"dnsVerify"}},s._l(r.dnsArray,(function(t){return o(n,{key:t.value,attrs:{label:t.label,value:t.value}},[o("span",{staticClass:"flex justify-between"},[o("span",[s._v(s._s(t.label))]),o("span",{directives:[{name:"show",rawName:"v-show",value:t.config,expression:"item.config"}],class:t.data?"text-primary":"text-orange"},[s._v(" "+s._s(t.data?"[已配置]":"[未配置]")+" ")])])])})),1),o(e,{directives:[{name:"show",rawName:"v-show",value:"dns"!==r.dnsVerify&&"http"!==r.dnsVerify,expression:"dnsVerify !== 'dns' && dnsVerify !== 'http'"}],staticClass:"ml-8x",attrs:{type:"defalut"},on:{click:function(t){return r.setSslDnsApi(!1)}}},[s._v(" 配置 ")]),o(e,{staticClass:"ml-8x",on:{click:r.oneClickRenew}},[s._v(" 一键续签 ")])],1)],1),o(t,{staticClass:"ml-20x",attrs:{list:r.letSslHelp,listStyle:"disc"}})],1)}),[],!1,null,null,null,null).exports;export{y as default};
