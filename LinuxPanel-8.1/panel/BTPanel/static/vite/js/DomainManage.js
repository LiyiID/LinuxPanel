import{_ as __unplugin_components_2}from"./index85.js?v=1714377894636";import{w as __unplugin_components_0$1,x as __unplugin_components_1}from"./element-lib.js?v=1714377894636";import{a as __unplugin_components_3,ae as getDataInfo,o as isRelease,l as dialogView,n as normalizeComponent,r as __unplugin_components_4,q as __unplugin_components_6,b as __unplugin_components_3$2}from"./main.js?v=1714377894636";import{_ as __unplugin_components_3$1}from"./index53.js?v=1714377894636";import{_ as __unplugin_components_2$1}from"./index39.js?v=1714377894636";import{_ as __unplugin_components_0}from"./index59.js?v=1714377894636";import{_ as __vitePreload}from"./preload-helper.js?v=1714377894636";import{e as defineComponent,v as reactive,b as ref$1,H as h,h as onMounted,j as getCurrentInstance}from"./vue-lib.js?v=1714377894636";import{a as onDefaultConfirm}from"./confirm.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{g as getSiteStore,J as delDomainMultiple,K as multiRemoveProjectDomain,L as delPhpAsyncDomain,M as proxyBatchDelDomain,N as removeProjectDomain,O as getPythonProjectDomain,P as getPhpAsyncDomain,Q as proxyGetDomain,R as getProjectDomain,B as getProjectInfo,S as proxyDelDomain,T as removePythonProjectDomain,U as delDomain,V as addDomain,W as addPythonProjectDomain,X as addPhpAsyncDomain,Y as proxyAddDomain,Z as addProjectDomain,_ as getHttpsPort,$ as ProxySetHttps,a0 as setHttpsPort}from"./site.store.js?v=1714377894636";import{r as resultDialog}from"./site.popup.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./config.js?v=1714377894636";import"./check.js?v=1714377894636";import"./index38.js?v=1714377894636";import"./index45.js?v=1714377894636";import"./element-ui.common.js?v=1714377894636";import"./date-util.js?v=1714377894636";import"./vdom.js?v=1714377894636";import"./index62.js?v=1714377894636";import"./cascader-panel.js?v=1714377894636";const _sfc_main=defineComponent({__name:"DomainManage",props:{compData:{default:()=>({})}},setup(__props){var _a;const props=__props,{proxy:vm}=getCurrentInstance(),portForm=reactive({port:""}),{refs:{siteInfo:siteInfo}}=getSiteStore(),siteType=ref$1(null==(_a=props.compData.project_type)?void 0:_a.toLowerCase()),checkedList=ref$1([]),portPopup=ref$1(!1),domainData=ref$1(""),port=ref$1("未开启"),tableData=ref$1([]),tableLoad=ref$1(!1),isBindExtranet=ref$1(!1),tableColumn=ref$1([{type:"selection",width:40},{label:"域名",prop:"name",width:400,render:e=>h(__unplugin_components_3,{attrs:{href:"http://".concat(e.name,":").concat(e.port)}},[e.name])},{label:"端口",prop:"port"},{label:"操作",align:"right",render:e=>1===tableData.value.length&&isBindExtranet.value?h("span",["不可操作"]):h(__unplugin_components_3,{on:{click:()=>{deleteEvent(e)}}},"删除")}]),resultColumn=ref$1([{label:"域名",prop:"name"},{label:"结果",render:e=>h("span",{class:e.status?"text-primary":"text-danger"},e.status?"操作成功":e.msg)}]),batchGroup=ref$1([{label:"删除",value:"delete",diyBatch:async()=>{"php"===siteType.value?onDefaultConfirm({confirm:{title:"批量删除",message:"批量删除，该操作可能会存在风险，是否继续？",icon:"warning"},loading:"正在删除，请稍后...",request:async()=>{let e=[checkedList.value.map((e=>e.id))];const a=await delDomainMultiple({domains_id:e,id:props.compData.id});let t=[];await a.success.forEach((e=>{t.push({name:e,msg:"删除成功",status:!0})})),await Object.keys(a.error).forEach((e=>{t.push({name:e,msg:a.data.error[e],status:!1})})),await resultDialog({resultData:t,resultColumn:resultColumn}),getSiteNameList()}}):onDefaultConfirm({confirm:{title:"批量删除",message:"同时删除选中的域名，是否继续？",icon:"warning",type:"calc"},loading:"正在删除，请稍后...",request:async()=>{let e,a=[];if("python"===siteType.value)e=await multiRemoveProjectDomain({name:props.compData.name,domain_ids:JSON.stringify(checkedList.value.map((e=>e.id)))}),await e.data.success.forEach((e=>{a.push({name:e,msg:"删除成功",status:!0})})),await Object.keys(e.data.error).forEach((t=>{a.push({name:t,msg:e.data.error[t],status:!1})}));else if("phpasync"==siteType.value){let e=await delPhpAsyncDomain({sitename:props.compData.name,domain:JSON.stringify(checkedList.value.map((e=>e.name)))});a=e.data}else if("proxy"==siteType.value||"nginx"===siteType.value){let e=await proxyBatchDelDomain({id:props.compData.id,site_name:props.compData.name,domains:checkedList.value.map((e=>e.name)).join("\n")});a=e.data}else checkedList.value.forEach((async e=>{var t,o;let n=await removeProjectDomain({data:JSON.stringify({project_name:props.compData.name,domain:e.name})},siteType.value);a.push({name:e.name,msg:(null==(t=n.data)?void 0:t.data)||(null==(o=n.data)?void 0:o.error_msg)||n.msg,status:n.data.status})}));return await resultDialog({resultData:a,resultColumn:resultColumn}),getSiteNameList(),null}})}}]),batchConfig=reactive({isRecurrence:!1,describe:{title:"批量删除脚本",th:"脚本",message:"批量删除后脚本信息将无法恢复，是否继续？",propsValue:"name"}}),getInfo=async()=>{var e,a;let t=null==(e=siteInfo.value.project_type)?void 0:e.toLowerCase();"node"===t&&(t="nodejs");let o={project_name:siteInfo.value.name};"python"===t&&(o.name=siteInfo.value.name,delete o.project_name);try{const e=await getProjectInfo({data:JSON.stringify(o)},t);e.status&&(siteInfo.value=e.data,isBindExtranet.value=1===(null==(a=e.data.project_config)?void 0:a.bind_extranet)||!1)}catch(n){}},handleSelect=e=>{checkedList.value=e},deleteEvent=async e=>{onDefaultConfirm({confirm:{title:"删除【".concat(e.name,"】"),message:"删除".concat(e.name,"后，将无法使用该域名访问网站，是否继续操作？"),icon:"warning"},loading:"正在删除，请稍后...",request:async()=>{var a;if("proxy"===siteType.value||"nginx"===siteType.value)return await proxyDelDomain({id:props.compData.id,site_name:props.compData.name,domain:e.name,port:e.port});if("php"!==siteType.value&&"phpasync"!==siteType.value&&"python"!==siteType.value)return await removeProjectDomain({data:JSON.stringify({project_name:props.compData.name,domain:e.name})},siteType.value);if("python"===siteType.value)return await removePythonProjectDomain({data:JSON.stringify({name:props.compData.name,domain:e.name})});if("phpasync"==siteType.value){let t=await delPhpAsyncDomain({sitename:props.compData.name,domain:JSON.stringify([e.name])});return{status:t.status,msg:(null==(a=t.data[0])?void 0:a.msg)||t.msg}}return await delDomain({id:e.pid,webname:props.compData.name,domain:e.name,port:e.port})},complete:getSiteNameList})},batchEvent=async(e,a,t)=>{},addDomainData=async()=>{if(""===domainData.value)return void vm.$message.error("域名不能为空");let e=String(domainData.value.match(/:(\d+)/g)).replace(/:/g,"");if(["21","25","443","888","8888","8443"].includes(e))return void vm.$message.error("端口不能为常用端口21、25、443、888、8888、8443");if("java"===siteType.value){const e=await check_domain_list(domainData.value);if(!e)return e}else{const e=await check_domain_list(domainData.value,!0);if(!e)return e}let a=vm.$load("正在添加域名，请稍候...");try{let e;if(e="php"===siteType.value?await addDomain({domain:domainData.value.replace(/\n/g,","),webname:props.compData.name,id:props.compData.id}):"python"==siteType.value?await addPythonProjectDomain({data:JSON.stringify({name:props.compData.name,domains:domainData.value.split("\n")})}):"phpasync"==siteType.value?await addPhpAsyncDomain({sitename:props.compData.name,domains:JSON.stringify(domainData.value.split("\n"))}):"proxy"==siteType.value||"nginx"===siteType.value?await proxyAddDomain({id:props.compData.id,site_name:props.compData.name,domains:domainData.value}):await addProjectDomain({data:JSON.stringify({project_name:props.compData.name,domains:domainData.value.split("\n")})},siteType.value),!(null==e?void 0:e.status)&&(null==e?void 0:e.msg))return void vm.$message.error(e.msg);domainData.value="";let t=[],o=e.data.domains;"proxy"!==siteType.value&&"nginx"!==siteType.value||(o=e.data),o.forEach((async(e,n)=>{t.push({name:e.name,msg:e.msg||"--",status:e.status}),n===o.length-1&&(a.close(),await dialogView({title:"域名添加结果",area:46,component:()=>__vitePreload((()=>import("./index63.js?v=1714377894636")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url),compData:{resultData:t,resultColumn:resultColumn,showMult:!1,resultTitle:"添加域名"}}),getSiteNameList())}))}catch(t){}finally{a.close()}},getPort=async()=>{tableLoad.value=!0;try{const e=await getHttpsPort({siteName:props.compData.name});port.value=e.data||"未开启",e.data&&(portForm.port=e.data)}catch(e){}finally{tableLoad.value=!1}},getSiteNameList=async()=>{tableLoad.value=!0;let e={table:"domain",list:"True",search:props.compData.id};try{let a;a=specialData.value.includes(siteType.value)?await getDataInfo(e):"python"==siteType.value?await getPythonProjectDomain({data:JSON.stringify({name:props.compData.name})}):"phpasync"==siteType.value?await getPhpAsyncDomain({sitename:props.compData.name}):"nginx"==siteType.value||"proxy"==siteType.value?await proxyGetDomain({site_name:props.compData.name,id:props.compData.id}):await getProjectDomain({data:JSON.stringify({project_name:props.compData.name})},siteType.value),"nginx"==siteType.value||"proxy"==siteType.value?(port.value=Number(a.data.https_port)||"未开启",a.data&&(portForm.port=a.data.https_port),tableData.value=a.data.domain_list):tableData.value=a.data}catch(a){}finally{tableLoad.value=!1}},setPorxyPort=async()=>{let e=vm.$load("正在设置HTTPS端口，请稍候...");try{const a=await ProxySetHttps({site_name:props.compData.name,https_port:Number(portForm.port)});vm.$message.request(a),port.value=Number(portForm.port),e.close(),portPopup.value=!1}catch(a){}finally{portPopup.value=!1,e.close()}},setPort=async()=>{if("proxy"===siteType.value)return void setPorxyPort();let e=vm.$load("正在设置HTTPS端口，请稍候...");try{const a=await setHttpsPort({siteName:props.compData.name,port:Number(portForm.port)});vm.$message.request(a),port.value=Number(portForm.port),e.close(),portPopup.value=!1}catch(a){}finally{portPopup.value=!1,e.close()}},check_domain_list=async(e,a)=>{let t=e.trim().replace(" ","").split("\n");for(var o=0;o<t.length;o++){var n=t[o];if(a&&!check_domain_port(n))return vm.$message.error("第"+(o+1)+"行【"+n+"】域名格式错误"),!1;if(!a&&!check_domain(n))return vm.$message.error("第"+(o+1)+"行【"+n+"】域名格式错误"),!1}return t},check_domain_port=e=>/^([\w\u4e00-\u9fa5\-\*]{1,100}\.){1,10}([\w\u4e00-\u9fa5\-]{1,24}|[\w\u4e00-\u9fa5\-]{1,24}\.[\w\u4e00-\u9fa5\-]{1,24})(:([1-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5]))?$/.test(strim(e)),check_domain=e=>/^([\w\u4e00-\u9fa5\-\*]{1,100}\.){1,10}([\w\u4e00-\u9fa5\-]{1,24}|[\w\u4e00-\u9fa5\-]{1,24}\.[\w\u4e00-\u9fa5\-]{1,24})$/.test(strim(e)),strim=str=>{let reg_str="/ /g",reg=eval(reg_str);return str=str.replace(reg,""),str},specialData=ref$1(["php","html"]),mountedEvent=async()=>{var e;let a=null==(e=props.compData.project_type)?void 0:e.toLowerCase();"node"===a&&(a="nodejs"),siteType.value=a,"php"===a||"proxy"===a||"nginx"===a||"html"===a||"phpasync"===a?isBindExtranet.value=!0:await getInfo(),await getSiteNameList()};return onMounted((()=>{mountedEvent()})),{__sfc:!0,vm:vm,props:props,portForm:portForm,siteInfo:siteInfo,siteType:siteType,checkedList:checkedList,portPopup:portPopup,domainData:domainData,port:port,tableData:tableData,tableLoad:tableLoad,isBindExtranet:isBindExtranet,tableColumn:tableColumn,resultColumn:resultColumn,batchGroup:batchGroup,batchConfig:batchConfig,getInfo:getInfo,handleSelect:handleSelect,deleteEvent:deleteEvent,batchEvent:batchEvent,addDomainData:addDomainData,getPort:getPort,getSiteNameList:getSiteNameList,setPorxyPort:setPorxyPort,setPort:setPort,check_domain_list:check_domain_list,check_domain_port:check_domain_port,check_domain:check_domain,strim:strim,specialData:specialData,mountedEvent:mountedEvent,isRelease:isRelease,BtLink:__unplugin_components_3}}});var _sfc_render=function(){var e=this,a=e._self._c,t=e._self._setupProxy;return a("div",[a("div",{staticClass:"flex items-end mb-12x"},[a(__unplugin_components_4,{ref:"popover",attrs:{placement:"top-start","popper-class":"green-tips-popover",trigger:"focus"}},[a("div",{staticClass:"!p-12x bg-[#20a53a] text-white"},[e._v(" 如需绑定外网，请换行填写，每行一个域名，默认为80端口"),a("br"),e._v(" IP地址格式：192.168.1.199"),a("br"),e._v(" 泛解析添加方法 *.domain.com"),a("br"),a("span",{directives:[{name:"show",rawName:"v-show",value:"java"!==t.siteType,expression:"siteType !== 'java'"}]},[e._v("如另加端口格式为 www.domain.com:88")]),a("span",{directives:[{name:"show",rawName:"v-show",value:"java"===t.siteType,expression:"siteType === 'java'"}]},[e._v("暂不支持添加端口格式的域名")])]),a(__unplugin_components_2,{attrs:{slot:"reference",type:"textarea",resize:"none",rows:4,width:"42rem",placeholder:"如需绑定外网，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n"+("java"!==t.siteType?"如另加端口格式为 www.domain.com:88":"暂不支持添加端口格式的域名 *.domain.com:88")},slot:"reference",model:{value:t.domainData,callback:function(e){t.domainData=e},expression:"domainData"}})],1),a(__unplugin_components_6,{staticClass:"absolute right-[4rem] top-[5rem]",on:{click:t.addDomainData}},[e._v("添加")])],1),a(__unplugin_components_0,{scopedSlots:e._u([{key:"header-right",fn:function(){return["php"!==t.siteType&&"proxy"!==t.siteType||t.isRelease?e._e():a("div",[e._v(" HTTPS端口："+e._s(t.port)+" "),a(t.BtLink,{directives:[{name:"show",rawName:"v-show",value:"number"==typeof t.port,expression:"typeof port === 'number'"}],on:{click:function(e){t.portPopup=!0}}},[e._v("更换")])],1)]},proxy:!0},{key:"content",fn:function(){return[a(__unplugin_components_2$1,{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoad,expression:"tableLoad"}],attrs:{column:t.tableColumn,data:t.tableData,maxHeight:"440"},on:{"selection-change":t.handleSelect}})]},proxy:!0},{key:"footer-left",fn:function(){return[a(__unplugin_components_3$1,{staticClass:"mt-12x",attrs:{data:t.batchGroup,config:t.batchConfig,"batch-fn":t.batchEvent}})]},proxy:!0},{key:"popup",fn:function(){return[a(__unplugin_components_3$2,{attrs:{title:"更换端口",visible:t.portPopup,area:42,showFooter:""},on:{"update:visible":function(e){t.portPopup=e},confirm:t.setPort}},[a("div",{staticClass:"p-20x"},[a(__unplugin_components_0$1,{staticClass:"flex justify-center",attrs:{"label-position":"right",model:t.portForm}},[a(__unplugin_components_1,{attrs:{label:"HTTPS端口"}},[a("div",{staticClass:"w-[24rem]"},[a(__unplugin_components_2,{attrs:{type:"number",min:0},model:{value:t.portForm.port,callback:function(a){e.$set(t.portForm,"port",a)},expression:"portForm.port"}})],1)])],1)],1)])]},proxy:!0}])}),"php"!==t.siteType&&"java"!==t.siteType?a("ul",{staticClass:"mt-8x leading-8 text-[1.2rem] list-disc ml-20x"},[a("li",[e._v("如果您的是HTTP项目，且需要映射到外网，请至少绑定一个域名")]),a("li",[e._v("建议所有域名都使用默认的80端口")])]):e._e()],1)},_sfc_staticRenderFns=[],__component__=normalizeComponent(_sfc_main,_sfc_render,_sfc_staticRenderFns,!1,null,"ce5c63c3",null,null);const DomainManage=__component__.exports;export{DomainManage as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./index63.js?v=1714377894636","./index39.js?v=1714377894636","./element-lib.js?v=1714377894636","./__commonjsHelpers__.js?v=1714377894636","./vue-lib.js?v=1714377894636","./public-lib.js?v=1714377894636","./main.js?v=1714377894636","./modulepreload-polyfill.js?v=1714377894636","./preload-helper.js?v=1714377894636","./request-lib.js?v=1714377894636","./locales-lib.js?v=1714377894636","./element-lib.js?v=1714377894636"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
