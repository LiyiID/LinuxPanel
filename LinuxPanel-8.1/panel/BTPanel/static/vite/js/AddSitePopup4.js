import{aS as e,n as t,D as o,r,q as a,a as s}from"./main.js?v=1714377894636";import{w as l,x as i,j as d,q as n,s as c}from"./element-lib.js?v=1714377894636";import{_ as p}from"./index85.js?v=1714377894636";import{e as m,b as u,h as _,j as h}from"./vue-lib.js?v=1714377894636";import{g as f,b7 as v,b6 as b,b4 as j,b5 as w,B as g}from"./site.store.js?v=1714377894636";import{r as x}from"./site.rules.js?v=1714377894636";import{o as A}from"./confirm.js?v=1714377894636";import{c as F}from"./check.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./config.js?v=1714377894636";const y=t(m({__name:"AddSitePopup",props:{compData:{default:{rowData:{},isEdit:!1}}},setup(t,{expose:o}){const r=t,{getModulesList:a}=f(),{proxy:s}=h(),l=u({project_exe:"",project_name:"",port:"",project_cmd:"",run_user:"www",project_ps:"",domains:"",release_firewall:!1,is_power_on:!1,bind_extranet:!1}),i=u(!1),d=u(),n=u(!1),c=u([]),p=async()=>{try{const e=await v();c.value=e.data}catch(e){}},m=async e=>{let t=Object.assign({},l.value);if(""!==t.domains){t.bind_extranet=1;const e=F(t.domains,"string","");t.domains=e.split("\n")}else t.bind_extranet=0,delete t.domains;A({$refs:d.value,loading:{disable:i},request:async()=>{let o;return o=r.compData.isEdit?await j({data:JSON.stringify(t)},"other"):await w({data:JSON.stringify(t)},"other"),o.data.status?s.$message.success(o.data.data):s.$message.error(o.data.error_msg),a("other"),e(),null}})},y=async()=>{var e;try{let t=(await g({data:JSON.stringify({project_name:null==(e=r.compData)?void 0:e.rowData.name})},"other")).data;t.isEdit=!0,l.value={...null==t?void 0:t.project_config,project_ps:null==t?void 0:t.ps,is_power_on:!!(null==t?void 0:t.project_config.is_power_on),project_log:(null==t?void 0:t.project_config.project_log)?1:0,web_log:(null==t?void 0:t.project_config.web_log)?1:0}}catch(t){}};return _((async()=>{n.value=!0,await p(),n.value=!1,r.compData.isEdit&&y()})),o({onConfirm:m}),{__sfc:!0,props:r,getModulesList:a,vm:s,otherAddForm:l,formDisabled:i,otherAddFormRef:d,formLoading:n,userList:c,getRootUser:p,changeName:e=>{r.compData.isEdit||(l.value.project_ps=e)},checkPortUse:async()=>{if(l.value.port)try{const e=await b({port:l.value.port},"go");e.status||(s.$message.request(e),l.value.port="")}catch(e){}},onPathChange:()=>{e({type:"file",path:l.value.project_exe,change:e=>{var t;l.value.project_exe=e;let o=null==(t=e.substring(e.lastIndexOf("/")+1))?void 0:t.replace(/\./g,"_");l.value.project_name=o,l.value.project_ps=o}})},onConfirm:m,getInfo:y,rules:x}}}),(function(){var e=this,t=e._self._c,m=e._self._setupProxy;return t("div",{staticClass:"p-20x"},[t(l,{directives:[{name:"loading",rawName:"v-loading",value:m.formLoading,expression:"formLoading"}],ref:"otherAddFormRef",attrs:{model:m.otherAddForm,"label-width":"100px",rules:m.rules,disabled:m.formDisabled}},[t(i,{attrs:{label:"项目执行文件",prop:"project_exe"}},[t(p,{attrs:{width:"32rem","icon-type":"folder",placeholder:"请选择项目可执行文件"},on:{folder:m.onPathChange},model:{value:m.otherAddForm.project_exe,callback:function(t){e.$set(m.otherAddForm,"project_exe",t)},expression:"otherAddForm.project_exe"}})],1),t(i,{attrs:{label:"项目名称",prop:"project_name"}},[t(p,{attrs:{disabled:e.compData.isEdit,width:"32rem",placeholder:"请输入项目名称"},on:{input:m.changeName},model:{value:m.otherAddForm.project_name,callback:function(t){e.$set(m.otherAddForm,"project_name",t)},expression:"otherAddForm.project_name"}})],1),t(i,{attrs:{label:"项目端口",prop:"port"}},[t("div",{staticClass:"flex items-center"},[t(p,{staticClass:"mr-12x",attrs:{width:"20rem",type:"number",placeholder:"请输入项目的真实端口"},on:{blur:m.checkPortUse},model:{value:m.otherAddForm.port,callback:function(t){e.$set(m.otherAddForm,"port",t)},expression:"otherAddForm.port"}}),e.compData.isEdit?e._e():t(o,{model:{value:m.otherAddForm.release_firewall,callback:function(t){e.$set(m.otherAddForm,"release_firewall",t)},expression:"otherAddForm.release_firewall"}},[e._v(" 放行端口 "),t(d,{staticClass:"item",attrs:{effect:"dark",content:"选中将在防火墙安全组放行监听端口，放行后该项目可在外网访问",placement:"right"}},[t("i",{staticClass:"el-icon-question text-warning"})])],1)],1)]),t(i,{attrs:{label:"执行命令",prop:"project_cmd"}},[t(p,{attrs:{placeholder:"请输入项目的执行命令"},model:{value:m.otherAddForm.project_cmd,callback:function(t){e.$set(m.otherAddForm,"project_cmd",t)},expression:"otherAddForm.project_cmd"}})],1),t(i,{attrs:{label:"运行用户"}},[t("div",{staticClass:"flex items-center"},[t(n,{staticClass:"mr-8x w-[16rem]",model:{value:m.otherAddForm.run_user,callback:function(t){e.$set(m.otherAddForm,"run_user",t)},expression:"otherAddForm.run_user"}},e._l(m.userList,(function(e){return t(c,{key:e,attrs:{value:e,label:e}})})),1),t("span",{staticClass:"text-[1.2rem] text-[#666]"},[e._v("* 无特殊需求请选择www用户")])],1)]),t(i,{attrs:{label:"开机启动"}},[t(o,{model:{value:m.otherAddForm.is_power_on,callback:function(t){e.$set(m.otherAddForm,"is_power_on",t)},expression:"otherAddForm.is_power_on"}},[e._v("是否设置开机启动")])],1),t(i,{attrs:{label:"项目备注"}},[t(p,{attrs:{width:"32rem",placeholder:"输入项目备注，非必填"},model:{value:m.otherAddForm.project_ps,callback:function(t){e.$set(m.otherAddForm,"project_ps",t)},expression:"otherAddForm.project_ps"}})],1),e.compData.isEdit?e._e():t(i,{attrs:{label:"绑定域名"}},[t(r,{ref:"popover",attrs:{placement:"top-start","popper-class":"green-tips-popover",title:"",width:"400",trigger:"focus"}},[t("div",{staticClass:"!p-12x bg-[#20a53a] text-white"},[e._v(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),t("br"),e._v(" IP地址格式：192.168.1.199"),t("br"),e._v(" 泛解析添加方法 *.domain.com"),t("br"),e._v(" 如另加端口格式为 www.domain.com:88 ")]),t(p,{directives:[{name:"popover",rawName:"v-popover:popover",arg:"popover"}],attrs:{slot:"reference",rows:6,resize:"none",width:"40rem",type:"textarea",placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},slot:"reference",model:{value:m.otherAddForm.domains,callback:function(t){e.$set(m.otherAddForm,"domains",t)},expression:"otherAddForm.domains"}})],1)],1),e.compData.isEdit?t(i,{attrs:{label:" "}},[t(a,{on:{click:m.onConfirm}},[e._v("保存配置")])],1):e._e()],1),e.compData.isEdit?e._e():t("ul",{staticClass:"mt-20x leading-8 text-[1.2rem] list-disc ml-20x"},[t("li",[e._v("执行命令：请输入项目需要携带的参数，默认请输入执行文件名")]),t("li",[e._v(" 项目教程可参考: "),t(s,{attrs:{href:"https://www.bt.cn/bbs/thread-93034-1-1.html"}},[e._v("https://www.bt.cn/bbs/thread-93034-1-1.html "),t("i",{staticClass:"el-icon-link"})])],1)])],1)}),[],!1,null,"c16c54b2",null,null).exports;export{y as default};
