import{Z as t,d as e,Q as i,w as s,x as r,K as a,y as n,z as o,j as l,q as m,s as c,o as u}from"./element-lib.js?v=1714377894636";import{ab as d,g as p,q as h,ai as v,aS as f,B as g,n as b,D as _}from"./main.js?v=1714377894636";import{_ as y}from"./index85.js?v=1714377894636";import{g as w}from"./__commonjsHelpers__.js?v=1714377894636";import{_ as x}from"./index117.js?v=1714377894636";import{_ as C}from"./index41.js?v=1714377894636";import{_ as k}from"./index39.js?v=1714377894636";import{e as F,A as $,b as S,v as V,f as M,c as P,h as L,j as D,H as N}from"./vue-lib.js?v=1714377894636";import{u as E}from"./docker.store.js?v=1714377894636";import{c as j,a as T}from"./check.js?v=1714377894636";import{N as O,O as z,P as A}from"./docker.api.js?v=1714377894636";import{_ as B}from"./checkbox-button.js?v=1714377894636";var R={exports:{}};const q=w(R.exports=function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/",i(i.s=64)}({0:function(t,e,i){function s(t,e,i,s,r,a,n,o){var l,m="function"==typeof t?t.options:t;if(e&&(m.render=e,m.staticRenderFns=i,m._compiled=!0),s&&(m.functional=!0),a&&(m._scopeId="data-v-"+a),n?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),r&&r.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(n)},m._ssrRegister=l):r&&(l=o?function(){r.call(this,this.$root.$options.shadowRoot)}:r),l)if(m.functional){m._injectStyles=l;var c=m.render;m.render=function(t,e){return l.call(e),c(t,e)}}else{var u=m.beforeCreate;m.beforeCreate=u?[].concat(u,l):[l]}return{exports:t,options:m}}i.d(e,"a",(function(){return s}))},29:function(e,i){e.exports=t},4:function(t,i){t.exports=e()},50:function(t,e){t.exports=d},64:function(t,e,i){i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"el-slider",class:{"is-vertical":t.vertical,"el-slider--with-input":t.showInput},attrs:{role:"slider","aria-valuemin":t.min,"aria-valuemax":t.max,"aria-orientation":t.vertical?"vertical":"horizontal","aria-disabled":t.sliderDisabled}},[t.showInput&&!t.range?i("el-input-number",{ref:"input",staticClass:"el-slider__input",attrs:{step:t.step,disabled:t.sliderDisabled,controls:t.showInputControls,min:t.min,max:t.max,debounce:t.debounce,size:t.inputSize},on:{change:t.emitChange},model:{value:t.firstValue,callback:function(e){t.firstValue=e},expression:"firstValue"}}):t._e(),i("div",{ref:"slider",staticClass:"el-slider__runway",class:{"show-input":t.showInput,disabled:t.sliderDisabled},style:t.runwayStyle,on:{click:t.onSliderClick}},[i("div",{staticClass:"el-slider__bar",style:t.barStyle}),i("slider-button",{ref:"button1",attrs:{vertical:t.vertical,"tooltip-class":t.tooltipClass},model:{value:t.firstValue,callback:function(e){t.firstValue=e},expression:"firstValue"}}),t.range?i("slider-button",{ref:"button2",attrs:{vertical:t.vertical,"tooltip-class":t.tooltipClass},model:{value:t.secondValue,callback:function(e){t.secondValue=e},expression:"secondValue"}}):t._e(),t._l(t.stops,(function(e,s){return t.showStops?i("div",{key:s,staticClass:"el-slider__stop",style:t.getStopStyle(e)}):t._e()})),t.markList.length>0?[i("div",t._l(t.markList,(function(e,s){return i("div",{key:s,staticClass:"el-slider__stop el-slider__marks-stop",style:t.getStopStyle(e.position)})})),0),i("div",{staticClass:"el-slider__marks"},t._l(t.markList,(function(e,s){return i("slider-marker",{key:s,style:t.getStopStyle(e.position),attrs:{mark:e.mark}})})),1)]:t._e()],2)],1)};s._withStripped=!0;var r=i(50),a=i.n(r),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"button",staticClass:"el-slider__button-wrapper",class:{hover:t.hovering,dragging:t.dragging},style:t.wrapperStyle,attrs:{tabindex:"0"},on:{mouseenter:t.handleMouseEnter,mouseleave:t.handleMouseLeave,mousedown:t.onButtonDown,touchstart:t.onButtonDown,focus:t.handleMouseEnter,blur:t.handleMouseLeave,keydown:[function(e){return!("button"in e)&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.onLeftKeyDown(e)},function(e){return!("button"in e)&&t._k(e.keyCode,"right",39,e.key,["Right","ArrowRight"])||"button"in e&&2!==e.button?null:t.onRightKeyDown(e)},function(e){return!("button"in e)&&t._k(e.keyCode,"down",40,e.key,["Down","ArrowDown"])?null:(e.preventDefault(),t.onLeftKeyDown(e))},function(e){return!("button"in e)&&t._k(e.keyCode,"up",38,e.key,["Up","ArrowUp"])?null:(e.preventDefault(),t.onRightKeyDown(e))}]}},[i("el-tooltip",{ref:"tooltip",attrs:{placement:"top","popper-class":t.tooltipClass,disabled:!t.showTooltip}},[i("span",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(t.formatValue))]),i("div",{staticClass:"el-slider__button",class:{hover:t.hovering,dragging:t.dragging}})])],1)};n._withStripped=!0;var o=i(29),l={name:"ElSliderButton",components:{ElTooltip:i.n(o).a},props:{value:{type:Number,default:0},vertical:{type:Boolean,default:!1},tooltipClass:String},data:function(){return{hovering:!1,dragging:!1,isClick:!1,startX:0,currentX:0,startY:0,currentY:0,startPosition:0,newPosition:null,oldValue:this.value}},computed:{disabled:function(){return this.$parent.sliderDisabled},max:function(){return this.$parent.max},min:function(){return this.$parent.min},step:function(){return this.$parent.step},showTooltip:function(){return this.$parent.showTooltip},precision:function(){return this.$parent.precision},currentPosition:function(){return(this.value-this.min)/(this.max-this.min)*100+"%"},enableFormat:function(){return this.$parent.formatTooltip instanceof Function},formatValue:function(){return this.enableFormat&&this.$parent.formatTooltip(this.value)||this.value},wrapperStyle:function(){return this.vertical?{bottom:this.currentPosition}:{left:this.currentPosition}}},watch:{dragging:function(t){this.$parent.dragging=t}},methods:{displayTooltip:function(){this.$refs.tooltip&&(this.$refs.tooltip.showPopper=!0)},hideTooltip:function(){this.$refs.tooltip&&(this.$refs.tooltip.showPopper=!1)},handleMouseEnter:function(){this.hovering=!0,this.displayTooltip()},handleMouseLeave:function(){this.hovering=!1,this.hideTooltip()},onButtonDown:function(t){this.disabled||(t.preventDefault(),this.onDragStart(t),window.addEventListener("mousemove",this.onDragging),window.addEventListener("touchmove",this.onDragging),window.addEventListener("mouseup",this.onDragEnd),window.addEventListener("touchend",this.onDragEnd),window.addEventListener("contextmenu",this.onDragEnd))},onLeftKeyDown:function(){this.disabled||(this.newPosition=parseFloat(this.currentPosition)-this.step/(this.max-this.min)*100,this.setPosition(this.newPosition),this.$parent.emitChange())},onRightKeyDown:function(){this.disabled||(this.newPosition=parseFloat(this.currentPosition)+this.step/(this.max-this.min)*100,this.setPosition(this.newPosition),this.$parent.emitChange())},onDragStart:function(t){this.dragging=!0,this.isClick=!0,"touchstart"===t.type&&(t.clientY=t.touches[0].clientY,t.clientX=t.touches[0].clientX),this.vertical?this.startY=t.clientY:this.startX=t.clientX,this.startPosition=parseFloat(this.currentPosition),this.newPosition=this.startPosition},onDragging:function(t){if(this.dragging){this.isClick=!1,this.displayTooltip(),this.$parent.resetSize();var e=0;"touchmove"===t.type&&(t.clientY=t.touches[0].clientY,t.clientX=t.touches[0].clientX),this.vertical?(this.currentY=t.clientY,e=(this.startY-this.currentY)/this.$parent.sliderSize*100):(this.currentX=t.clientX,e=(this.currentX-this.startX)/this.$parent.sliderSize*100),this.newPosition=this.startPosition+e,this.setPosition(this.newPosition)}},onDragEnd:function(){var t=this;this.dragging&&(setTimeout((function(){t.dragging=!1,t.hideTooltip(),t.isClick||(t.setPosition(t.newPosition),t.$parent.emitChange())}),0),window.removeEventListener("mousemove",this.onDragging),window.removeEventListener("touchmove",this.onDragging),window.removeEventListener("mouseup",this.onDragEnd),window.removeEventListener("touchend",this.onDragEnd),window.removeEventListener("contextmenu",this.onDragEnd))},setPosition:function(t){var e=this;if(null!==t&&!isNaN(t)){t<0?t=0:t>100&&(t=100);var i=100/((this.max-this.min)/this.step),s=Math.round(t/i)*i*(this.max-this.min)*.01+this.min;s=parseFloat(s.toFixed(this.precision)),this.$emit("input",s),this.$nextTick((function(){e.displayTooltip(),e.$refs.tooltip&&e.$refs.tooltip.updatePopper()})),this.dragging||this.value===this.oldValue||(this.oldValue=this.value)}}}},m=i(0),c=Object(m.a)(l,n,[],!1,null,null,null);c.options.__file="packages/slider/src/button.vue";var u=c.exports,d={name:"ElMarker",props:{mark:{type:[String,Object]}},render:function(){var t=arguments[0],e="string"==typeof this.mark?this.mark:this.mark.label;return t("div",{class:"el-slider__marks-text",style:this.mark.style||{}},[e])}},p=i(4),h={name:"ElSlider",mixins:[i.n(p).a],inject:{elForm:{default:""}},props:{min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},value:{type:[Number,Array],default:0},showInput:{type:Boolean,default:!1},showInputControls:{type:Boolean,default:!0},inputSize:{type:String,default:"small"},showStops:{type:Boolean,default:!1},showTooltip:{type:Boolean,default:!0},formatTooltip:Function,disabled:{type:Boolean,default:!1},range:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},height:{type:String},debounce:{type:Number,default:300},label:{type:String},tooltipClass:String,marks:Object},components:{ElInputNumber:a.a,SliderButton:u,SliderMarker:d},data:function(){return{firstValue:null,secondValue:null,oldValue:null,dragging:!1,sliderSize:1}},watch:{value:function(t,e){this.dragging||Array.isArray(t)&&Array.isArray(e)&&t.every((function(t,i){return t===e[i]}))||this.setValues()},dragging:function(t){t||this.setValues()},firstValue:function(t){this.range?this.$emit("input",[this.minValue,this.maxValue]):this.$emit("input",t)},secondValue:function(){this.range&&this.$emit("input",[this.minValue,this.maxValue])},min:function(){this.setValues()},max:function(){this.setValues()}},methods:{valueChanged:function(){var t=this;return this.range?![this.minValue,this.maxValue].every((function(e,i){return e===t.oldValue[i]})):this.value!==this.oldValue},setValues:function(){if(!(this.min>this.max)){var t=this.value;this.range&&Array.isArray(t)?t[1]<this.min?this.$emit("input",[this.min,this.min]):t[0]>this.max?this.$emit("input",[this.max,this.max]):t[0]<this.min?this.$emit("input",[this.min,t[1]]):t[1]>this.max?this.$emit("input",[t[0],this.max]):(this.firstValue=t[0],this.secondValue=t[1],this.valueChanged()&&(this.dispatch("ElFormItem","el.form.change",[this.minValue,this.maxValue]),this.oldValue=t.slice())):this.range||"number"!=typeof t||isNaN(t)||(t<this.min?this.$emit("input",this.min):t>this.max?this.$emit("input",this.max):(this.firstValue=t,this.valueChanged()&&(this.dispatch("ElFormItem","el.form.change",t),this.oldValue=t)))}},setPosition:function(t){var e=this.min+t*(this.max-this.min)/100;if(this.range){var i=void 0;i=Math.abs(this.minValue-e)<Math.abs(this.maxValue-e)?this.firstValue<this.secondValue?"button1":"button2":this.firstValue>this.secondValue?"button1":"button2",this.$refs[i].setPosition(t)}else this.$refs.button1.setPosition(t)},onSliderClick:function(t){if(!this.sliderDisabled&&!this.dragging){if(this.resetSize(),this.vertical){var e=this.$refs.slider.getBoundingClientRect().bottom;this.setPosition((e-t.clientY)/this.sliderSize*100)}else{var i=this.$refs.slider.getBoundingClientRect().left;this.setPosition((t.clientX-i)/this.sliderSize*100)}this.emitChange()}},resetSize:function(){this.$refs.slider&&(this.sliderSize=this.$refs.slider["client"+(this.vertical?"Height":"Width")])},emitChange:function(){var t=this;this.$nextTick((function(){t.$emit("change",t.range?[t.minValue,t.maxValue]:t.value)}))},getStopStyle:function(t){return this.vertical?{bottom:t+"%"}:{left:t+"%"}}},computed:{stops:function(){var t=this;if(!this.showStops||this.min>this.max)return[];if(0===this.step)return[];for(var e=(this.max-this.min)/this.step,i=100*this.step/(this.max-this.min),s=[],r=1;r<e;r++)s.push(r*i);return this.range?s.filter((function(e){return e<100*(t.minValue-t.min)/(t.max-t.min)||e>100*(t.maxValue-t.min)/(t.max-t.min)})):s.filter((function(e){return e>100*(t.firstValue-t.min)/(t.max-t.min)}))},markList:function(){var t=this;return this.marks?Object.keys(this.marks).map(parseFloat).sort((function(t,e){return t-e})).filter((function(e){return e<=t.max&&e>=t.min})).map((function(e){return{point:e,position:100*(e-t.min)/(t.max-t.min),mark:t.marks[e]}})):[]},minValue:function(){return Math.min(this.firstValue,this.secondValue)},maxValue:function(){return Math.max(this.firstValue,this.secondValue)},barSize:function(){return this.range?100*(this.maxValue-this.minValue)/(this.max-this.min)+"%":100*(this.firstValue-this.min)/(this.max-this.min)+"%"},barStart:function(){return this.range?100*(this.minValue-this.min)/(this.max-this.min)+"%":"0%"},precision:function(){var t=[this.min,this.max,this.step].map((function(t){var e=(""+t).split(".")[1];return e?e.length:0}));return Math.max.apply(null,t)},runwayStyle:function(){return this.vertical?{height:this.height}:{}},barStyle:function(){return this.vertical?{height:this.barSize,bottom:this.barStart}:{width:this.barSize,left:this.barStart}},sliderDisabled:function(){return this.disabled||(this.elForm||{}).disabled}},mounted:function(){var t=void 0;this.range?(Array.isArray(this.value)?(this.firstValue=Math.max(this.min,this.value[0]),this.secondValue=Math.min(this.max,this.value[1])):(this.firstValue=this.min,this.secondValue=this.max),this.oldValue=[this.firstValue,this.secondValue],t=this.firstValue+"-"+this.secondValue):("number"!=typeof this.value||isNaN(this.value)?this.firstValue=this.min:this.firstValue=Math.min(this.max,Math.max(this.min,this.value)),this.oldValue=this.firstValue,t=this.firstValue),this.$el.setAttribute("aria-valuetext",t),this.$el.setAttribute("aria-label",this.label?this.label:"slider between "+this.min+" and "+this.max),this.resetSize(),window.addEventListener("resize",this.resetSize)},beforeDestroy:function(){window.removeEventListener("resize",this.resetSize)}},v=Object(m.a)(h,s,[],!1,null,null,null);v.options.__file="packages/slider/src/main.vue";var f=v.exports;f.install=function(t){t.component(f.name,f)},e.default=f}}));const H=b(F({__name:"ContainerEdit",props:{compData:{default:()=>({})},type:{default:"edit"}},setup(t,{expose:e}){const s=t,{proxy:r}=D(),a=E(),{getMList:n,getNList:o,getSList:l,getCList:m}=a,{currentConDetail:c,netTableData:u,mirrorTableData:d,maxCPU:b,maxMem:_,storageTableData:w}=$(a),x=S([{title:"暴露端口",value:"port"},{title:"暴露所有",value:"all"}]),{refs:{mainHeight:C}}=p(),k=S(!1),F=S([{title:"本机目录",value:"dir"},{title:"挂载卷",value:"volume"}]),R=V({name:"",image:"",port:"port",portList:[],net:"",ip_address:"",mountList:[],command:"",entrypoint:"",auto_remove:!1,console:[],privileged:!1,reSet:"always",mem_reservation:0,cpu_quota:0,labels:"",environment:"",mem_limit:0,remark:""}),q=S(!1);M((()=>R.auto_remove),((t,e)=>{t&&(R.reSet="no")}));const H=P((()=>C.value-240)),X=()=>{var t,e,i,r,a,n,o,l,m,u,d,p,h,f,g,b;const _=s.compData.row;R.name=_.name,R.image=_.image,R.remark=_.remark;const y=j(_.ports,"object",{});R.portList=[],null==(t=Object.entries(y))||t.forEach(((t,e)=>{if(t[1]){const[e,...i]=t[0].split("/");R.portList.push({id:v(),server:t[1][0].HostPort,con:e,protocol:i})}}));const w=Object.entries((null==(e=c.value.NetworkSettings)?void 0:e.Networks)||{});w.length>0&&(R.net=w[0][0],R.ip_address=w[0][1].IPAddress),null==(i=c.value.Mounts)||i.forEach(((t,e)=>{R.mountList.push({id:v(),Mtype:"dir",volume:"",local:t.Source,dir:t.Destination,auth:t.RW?"rw":"ro"})})),R.auto_remove=null==(a=null==(r=c.value)?void 0:r.HostConfig)?void 0:a.AutoRemove,(null==(o=null==(n=c.value)?void 0:n.Config)?void 0:o.Tty)&&R.console.push("-t"),(null==(m=null==(l=c.value)?void 0:l.Config)?void 0:m.OpenStdin)&&R.console.push("-i"),R.privileged=null==(u=c.value.HostConfig)?void 0:u.Privileged,R.reSet=null==(d=c.value.HostConfig)?void 0:d.RestartPolicy.Name,R.mem_reservation=(null==(p=c.value.HostConfig)?void 0:p.MemoryReservation)/1024/1024,R.cpu_quota=(null==(h=c.value.HostConfig)?void 0:h.CpuQuota)/1e5,R.mem_limit=(null==(f=c.value.HostConfig)?void 0:f.Memory)/1024/1024,null==(g=Object.entries(c.value.Config.Labels))||g.forEach(((t,e)=>{R.labels+="".concat(t[0],"=").concat(t[1],"\n")})),null==(b=c.value.Config.Env)||b.forEach(((t,e)=>{R.environment+="".concat(t,"\n")}))},I=S(),Y={name:[{validator:(t,e,i)=>{""==e?i(new Error("请输入容器名称")):i()},trigger:["blur","change"]}],image:[{validator:(t,e,i)=>{""==e?i(new Error("请选择镜像")):i()},trigger:["blur","change"]}],ip_address:[{validator:(t,e,i)=>{""!==e?T(e)?i():i(new Error("请输入正确的ip地址")):i()},trigger:["blur","change"]}]},U=[{label:"本地端口",prop:"server",minWidth:100,render:t=>N(y,{attrs:{size:"mini",value:t.server,placeholder:"例如：80"},on:{input:e=>K(e,t,"server")}})},{label:"容器",prop:"con",minWidth:100,render:t=>N(y,{attrs:{size:"mini",value:t.con,placeholder:"例如：80"},on:{input:e=>K(e,t,"con")}})},{label:"协议",prop:"protocol ",minWidth:100,render:t=>N("div",{class:"flex items-center"},[N(i,{attrs:{size:"mini",value:t.protocol},on:{input:e=>K(e,t,"protocol")}},[N(B,{attrs:{label:"tcp"}},["TCP"]),N(B,{attrs:{label:"udp"}},["UDP"])]),N(h,{attrs:{size:"small",title:"删除",type:"default"},class:"!ml-[2rem] h-[2.8]",on:{click:()=>W(t)}},[N("i",{class:"el-icon-delete"})])])}],K=(t,e,i)=>{switch(i){case"server":e.server=t;break;case"con":e.con=t;break;case"protocol":e.protocol=t}},W=t=>{const e=R.portList.findIndex((e=>e.id===t.id));R.portList.splice(e,1)},J=V({cert:"",key:"",domain:"",port:null}),Q=S(!1),Z=P((()=>u.value.list.map(((t,e)=>({key:t.name,title:t.name}))))),G=P((()=>d.value.list.map(((t,e)=>({value:t.name}))))),tt=P((()=>w.value.list.map(((t,e)=>({key:t.Name,title:t.Name}))))),et=S([{key:"ro",title:"只读"},{key:"rw",title:"读写"}]),it=()=>{var t;if("all"==R.port||0==R.portList.length)return!0;const e={};return null==(t=R.portList)||t.forEach((t=>""==t.server?(r.$message.error("本地端口不能为空"),!1):isNaN(Number(t.server))||Number(t.server)<1||Number(t.server)>65535?(r.$message.error("请输入正确的本地端口范围"),!1):""==t.con?(r.$message.error("容器不能为空"),!1):isNaN(Number(t.con))||Number(t.con)<1||Number(t.con)>65535?(r.$message.error("请输入正确的容器端口范围"),!1):0==t.protocol.length?(r.$message.error("协议不能为空"),!1):void(e["".concat(t.con,"/").concat(t.protocol.join("/"))]=t.server))),e},st=()=>{var t;if(0==R.mountList.length)return!0;let e={};return null==(t=R.mountList)||t.forEach((t=>{"volume"==t.Mtype?""==t.volume&&(r.$message.error("挂载卷不能为空"),e=!1):""==t.local&&(r.$message.error("挂载目录不能为空"),e=!1),""==t.auth&&(r.$message.error("权限不能为空"),e=!1),""==t.dir&&(r.$message.error("容器目录不能为空"),e=!1),!1!==e&&(e["".concat("volume"==t.Mtype?t.volume:t.local)]={bind:t.dir,mode:t.auth})})),e},rt=t=>{const e=t.split("\n");return 1==e.length?t:e.join("\n")},at=async()=>{I.value.validate((async t=>{var e;if(t)try{I.value.$root.loading(q,"加载中...");const t=it(),i=st();if(g(t)||!i)return!1;const s={name:R.name,image:R.image,publish_all_ports:"all"==R.port?"1":"0",ports:!0===t?"":t,network:R.net,ip_address:R.ip_address,command:R.command,entrypoint:R.entrypoint,auto_remove:R.auto_remove?"1":"0",privileged:R.privileged?"1":"0",restart_policy:{Name:R.reSet},mem_reservation:"".concat(0==R.mem_reservation?0:"".concat(R.mem_reservation,"MB")),cpu_quota:R.cpu_quota,mem_limit:"".concat(0==R.mem_limit?0:"".concat(R.mem_limit,"MB")),labels:rt(R.labels),environment:rt(R.environment),remark:R.remark};R.auto_remove&&(s.restart_policy.Name=""),i&&Object.keys(i).length>0&&(s.volumes=i),"on-failure"==R.reSet&&(s.restart_policy.MaximumRetryCount=5),R.console.length>0&&(null==(e=R.console)||e.forEach(((t,e)=>{switch(t){case"-t":s.tty="1";break;case"-i":s.stdin_open="1"}})));const a=await A({data:JSON.stringify(s)});a.status?(r.$emit("close"),Q.value&&R.portList.length>0&&await z({container_id:a.id,container_name:a.name,container_port:J.port,domain:J.domain,privateKey:J.key,certPem:J.cert}),m(),r.$message.success(a.msg),nt()):r.$message.error(a.msg)}catch(i){}finally{q.value=!1}}))},nt=()=>{};return e({onConfirm:at}),L((async()=>{await o(),await n(),await l(),"edit"==s.type&&X()})),{__sfc:!0,vm:r,store:a,getMList:n,getNList:o,getSList:l,getCList:m,currentConDetail:c,netTableData:u,mirrorTableData:d,maxCPU:b,maxMem:_,storageTableData:w,props:s,type:x,mainHeight:C,isAdv:k,MOption:F,cmdForm:R,formDisabled:q,containerEditHight:H,getDetail:X,cmdFormRef:I,cmdRules:Y,tableColumn:U,setPort:K,addPort:()=>{R.portList.push({id:v(),server:"",con:"",protocol:["tcp"]})},delPort:W,noPortConfig:J,isRequestNoPort:Q,addNoPortLogin:t=>{Q.value=!0,J.cert=t.cert,J.key=t.key,J.domain=t.domain,J.port=t.port},netOptions:Z,changeNet:t=>{R.net=t},addMount:()=>{R.mountList.push({id:v(),Mtype:"volume",volume:"",local:"",dir:"",auth:"ro"})},delMount:t=>{const e=R.mountList.findIndex((e=>e.id===t.id));R.mountList.splice(e,1)},mirrorOptions:G,querySearch:(t,e)=>{let i=G.value;e(t?i.filter((e=>e.value.includes(t))):i)},volumeOptions:tt,authOptions:et,openFile:t=>{f({type:"dir",change:e=>{t.local=e}})},clearSpace:t=>{const e=j(t.local,"string","");t.local=e.replace(/\s+/g,"")},confirm:()=>{I.value.validate((async t=>{var e;if(t)try{const t=it(),i=st();if(g(t)||!i)return!1;const a={id:s.compData.row.id,new_name:R.name,new_image:R.image,new_publish_all_ports:"all"==R.port?"1":"0",new_ports:!0===t?"":t,new_network:R.net,new_ip_address:R.ip_address,new_command:R.command,new_entrypoint:R.entrypoint,new_auto_remove:R.auto_remove?"1":"0",new_privileged:R.privileged?"1":"0",new_restart_policy:{Name:R.reSet},new_mem_reservation:"".concat(0==R.mem_reservation?0:"".concat(R.mem_reservation,"MB")),new_cpu_quota:R.cpu_quota,new_mem_limit:"".concat(0==R.mem_limit?0:"".concat(R.mem_limit,"MB")),new_labels:rt(R.labels),new_environment:rt(R.environment),remark:R.remark};R.auto_remove&&(a.new_restart_policy.Name=""),i&&Object.keys(i).length>0&&(a.new_volumes=i),"on-failure"==R.reSet&&(a.new_restart_policy.MaximumRetryCount=5),R.console.length>0&&(null==(e=R.console)||e.forEach(((t,e)=>{switch(t){case"-t":a.new_tty=!0;break;case"-i":a.new_stdin_open=!0}}))),await r.$confirm({title:"编辑容器【".concat(s.compData.row.name,"】"),width:"45rem",type:"input",message:'【command、entrypoint，标签和环境变量】<span class="text-danger">配置错误可能导致编辑后的容器无法运行或者丢失</span>，请谨慎操作',icon:"warning",useHtml:!0,iconColor:"#f0ad4e",inputText:"确认无误"});const n=await O({data:JSON.stringify(a)});n.status?(r.$root.close(),r.$emit("close"),Q.value&&R.portList.length>0&&await z({container_id:n.id,container_name:n.name,container_port:J.port,domain:J.domain,privateKey:J.key,certPem:J.cert}),r.$message.success(n.msg),setTimeout((()=>{window.location.reload()}),1e3)):r.$message.error(n.msg)}catch(i){}}))},portSubmit:it,mountSubmit:st,setInput:rt,onConfirm:at,openNps:nt,btBtn:h}}}),(function(){var t=this,e=t._self._c,d=t._self._setupProxy;return e("div",{staticClass:"container-dialog",style:"max-height:".concat(d.containerEditHight,"px")},[e(s,{ref:"cmdFormRef",staticClass:"relative w-full",attrs:{size:"small",model:d.cmdForm,rules:d.cmdRules,disabled:d.formDisabled,"label-position":"right"},nativeOn:{submit:function(t){t.preventDefault()}}},[e("div",{staticClass:"pt-[1.6rem] pb-[0]"},[e(r,{attrs:{prop:"name",label:"容器名称"}},[e(y,{directives:[{name:"focus",rawName:"v-focus"}],attrs:{width:"40rem",placeholder:"请输入容器名称"},model:{value:d.cmdForm.name,callback:function(e){t.$set(d.cmdForm,"name",e)},expression:"cmdForm.name"}})],1),e(r,{attrs:{prop:"image",label:"镜像"}},[e(a,{staticClass:"w-[40rem]",attrs:{"popper-class":"my-autocomplete","fetch-suggestions":d.querySearch,placeholder:"请输入或选择镜像"},model:{value:d.cmdForm.image,callback:function(e){t.$set(d.cmdForm,"image",e)},expression:"cmdForm.image"}},[e("i",{staticClass:"el-icon-arrow-down el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})])],1),e(r,{staticClass:"!mt-[1.6rem]",attrs:{prop:"port",label:"端口"}},[e(x,{attrs:{type:"button",options:d.type},model:{value:d.cmdForm.port,callback:function(e){t.$set(d.cmdForm,"port",e)},expression:"cmdForm.port"}})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:"port"==d.cmdForm.port,expression:"cmdForm.port == 'port'"}],staticClass:"my-[1.5rem] ml-[10rem]"},[e(k,{directives:[{name:"show",rawName:"v-show",value:d.cmdForm.portList.length>0,expression:"cmdForm.portList.length > 0"}],ref:"Table",attrs:{column:d.tableColumn,data:d.cmdForm.portList,description:"端口列表为空"}}),e("div",{staticClass:"mt-[1.5rem]"},[e(d.btBtn,{attrs:{title:"添加端口",type:"default"},on:{click:d.addPort}},[t._v("添加")])],1)],1)],1),e(r,{directives:[{name:"show",rawName:"v-show",value:!d.cmdForm.auto_remove,expression:"!cmdForm.auto_remove"}],staticClass:"!mt-[.8rem]",attrs:{prop:"path",label:"重启规则"}},[e(n,{staticClass:"h-[5rem] !flex !flex-wrap",model:{value:d.cmdForm.reSet,callback:function(e){t.$set(d.cmdForm,"reSet",e)},expression:"cmdForm.reSet"}},[e(o,{staticClass:"!leading-[2.5rem]",attrs:{label:"no"}},[t._v("不重启")]),e(o,{staticClass:"!leading-[2.5rem]",attrs:{label:"on-failure"}},[t._v("失败后重启（默认重启5次）")]),e(o,{staticClass:"!leading-[2.5rem]",attrs:{label:"unless-stopped"}},[t._v("仅非正常退出的时候重启")]),e(o,{staticClass:"!leading-[2.5rem]",attrs:{label:"always"}},[t._v("停止后马上重启 "),e(l,{staticClass:"item",attrs:{effect:"dark",content:"服务器重启时也会马上重启",placement:"top"}},[e("div",{staticClass:"el-alert__icon el-icon-info text-warning"})])],1)],1)],1),e("div",{staticClass:"more flex items-center cursor-pointer pl-[10rem] my-[2rem] px-[2rem]",on:{click:function(t){d.isAdv=!d.isAdv}}},[e("i",{class:d.isAdv?"el-icon-arrow-down":"el-icon-arrow-right"}),e("div",{staticClass:"ml-[1rem] text-[#20a53a] w-[16rem] select-none"},[t._v(" "+t._s("更多设置，".concat(d.isAdv?"点击收回":"点击查看"))+" ")])]),e("div",{directives:[{name:"show",rawName:"v-show",value:d.isAdv,expression:"isAdv"}],staticClass:"py-[2rem] pt-[0]"},[e("div",{staticClass:"flex items-center mb-[1.5rem]"},[e(r,{attrs:{label:"网络"}},[e(C,{staticClass:"w-[24rem]",attrs:{options:d.netOptions,change:d.changeNet},model:{value:d.cmdForm.net,callback:function(e){t.$set(d.cmdForm,"net",e)},expression:"cmdForm.net"}})],1),e(r,{directives:[{name:"show",rawName:"v-show",value:""!=d.cmdForm.net&&"bridge"!=d.cmdForm.net,expression:"cmdForm.net != '' && cmdForm.net != 'bridge'"}],staticClass:"shortLabel",staticStyle:{"margin-top":"0rem !important"},attrs:{"label-width":"6.2rem",prop:"ip_address",label:"ip"}},[e(y,{attrs:{width:"24rem",placeholder:"请输入ip,例：172.20.x.x"},model:{value:d.cmdForm.ip_address,callback:function(e){t.$set(d.cmdForm,"ip_address",e)},expression:"cmdForm.ip_address"}})],1)],1),e(r,{attrs:{label:"挂载/映射"}},[t._l(d.cmdForm.mountList,(function(i){return e("div",{directives:[{name:"show",rawName:"v-show",value:d.cmdForm.mountList.length>0,expression:"cmdForm.mountList.length > 0"}],key:i.id,staticClass:"border-[#ececec] border rounded-[.2rem] mb-[1rem] p-[1.5rem]"},[e("div",{staticClass:"flex items-center justify-between mb-[1.5rem]"},[e(x,{attrs:{type:"button",options:d.MOption},model:{value:i.Mtype,callback:function(e){t.$set(i,"Mtype",e)},expression:"item.Mtype"}}),e(d.btBtn,{staticClass:"!ml-[4rem]",attrs:{title:"删除",type:"default"},on:{click:function(t){return d.delMount(i)}}},[e("i",{staticClass:"el-icon-delete"})])],1),e("div",{staticClass:"manu flex items-center text-[1.2rem]"},[e("div",{directives:[{name:"show",rawName:"v-show",value:"volume"==i.Mtype,expression:"item.Mtype == 'volume'"}]},[e("div",{staticClass:"px-[.2rem] py-[.4rem]"},[t._v("挂载卷")]),e("div",[e(m,{staticClass:"w-[17rem]",attrs:{size:"mini"},model:{value:i.volume,callback:function(e){t.$set(i,"volume",e)},expression:"item.volume"}},t._l(d.volumeOptions,(function(t){return e(c,{key:t.key,attrs:{label:t.title,value:t.key}})})),1)],1)]),e("div",{directives:[{name:"show",rawName:"v-show",value:"dir"==i.Mtype,expression:"item.Mtype == 'dir'"}]},[e("div",{staticClass:"px-[.2rem] py-[.4rem]"},[t._v("挂载目录")]),e("div",[e(y,{staticClass:"w-[17rem]",attrs:{size:"mini","icon-type":"folder",placeholder:"请输入镜像路径"},on:{folder:function(t){return d.openFile(i)},"&change":function(t){return d.clearSpace(i)}},model:{value:i.local,callback:function(e){t.$set(i,"local",e)},expression:"item.local"}})],1)]),e("div",{staticClass:"ml-[1rem]"},[e("div",{staticClass:"px-[.2rem] py-[.4rem]"},[t._v("权限")]),e("div",[e(m,{staticClass:"w-[17rem]",attrs:{size:"mini"},model:{value:i.auth,callback:function(e){t.$set(i,"auth",e)},expression:"item.auth"}},t._l(d.authOptions,(function(t){return e(c,{key:t.key,attrs:{label:t.title,value:t.key}})})),1)],1)]),e("div",{staticClass:"ml-[1rem]"},[e("div",{staticClass:"px-[.2rem] py-[.4rem]"},[t._v("容器目录")]),e("div",[e(y,{attrs:{width:"17rem"},model:{value:i.dir,callback:function(e){t.$set(i,"dir",e)},expression:"item.dir"}})],1)])])])})),e(d.btBtn,{attrs:{title:"添加挂载",type:"default"},on:{click:d.addMount}},[t._v("添加")])],2),e(r,{attrs:{label:"command"}},[e(y,{attrs:{width:"24rem"},model:{value:d.cmdForm.command,callback:function(e){t.$set(d.cmdForm,"command",e)},expression:"cmdForm.command"}})],1),e(r,{attrs:{label:"entrypoint"}},[e(y,{attrs:{width:"24rem"},model:{value:d.cmdForm.entrypoint,callback:function(e){t.$set(d.cmdForm,"entrypoint",e)},expression:"cmdForm.entrypoint"}})],1),e(r,{staticClass:"!mt-[.8rem]",attrs:{prop:"auto_remove",label:" "}},[e(_,{model:{value:d.cmdForm.auto_remove,callback:function(e){t.$set(d.cmdForm,"auto_remove",e)},expression:"cmdForm.auto_remove"}},[t._v("容器退出后自动删除容器")])],1),e(r,{staticClass:"!mt-[.8rem]",attrs:{prop:"console",label:"控制台交互"}},[e(i,{model:{value:d.cmdForm.console,callback:function(e){t.$set(d.cmdForm,"console",e)},expression:"cmdForm.console"}},[e(_,{attrs:{label:"-t"}},[t._v("伪终端（-t）")]),e(_,{attrs:{label:"-i"}},[t._v("标准输入（-i）")])],1)],1),e(r,{staticClass:"!mt-[0rem]",attrs:{prop:"privileged",label:" "}},[e(_,{model:{value:d.cmdForm.privileged,callback:function(e){t.$set(d.cmdForm,"privileged",e)},expression:"cmdForm.privileged"}},[t._v("特权模式")])],1),e(r,{attrs:{prop:"mem_reservation",label:"最小分配内存"}},[e("div",{staticClass:"flex items-center"},[e("div",{staticClass:"w-[20rem] pl-[.6rem]"},[e(q,{attrs:{min:0,max:d.maxMem},model:{value:d.cmdForm.mem_reservation,callback:function(e){t.$set(d.cmdForm,"mem_reservation",e)},expression:"cmdForm.mem_reservation"}})],1),e("span",{staticClass:"ml-[1.2rem] flex items-center"},[e(y,{staticClass:"mr-[.6rem]",attrs:{size:"mini",width:"8rem"},model:{value:d.cmdForm.mem_reservation,callback:function(e){t.$set(d.cmdForm,"mem_reservation",t._n(e))},expression:"cmdForm.mem_reservation"}}),e("span",[t._v("MB (最大值："+t._s(d.maxMem)+")")])],1)])]),e(r,{staticClass:"!mt-[1.4rem]",attrs:{prop:"cpu_quota",label:"CPU限制"}},[e("div",{staticClass:"flex items-center"},[e("div",{staticClass:"w-[20rem] pl-[.6rem]"},[e(q,{attrs:{min:0,max:d.maxCPU},model:{value:d.cmdForm.cpu_quota,callback:function(e){t.$set(d.cmdForm,"cpu_quota",e)},expression:"cmdForm.cpu_quota"}})],1),e("span",{staticClass:"ml-[1.2rem] flex items-center"},[e(y,{staticClass:"mr-[.6rem]",attrs:{size:"mini",width:"8rem"},model:{value:d.cmdForm.cpu_quota,callback:function(e){t.$set(d.cmdForm,"cpu_quota",t._n(e))},expression:"cmdForm.cpu_quota"}}),e("span",[t._v("核 (最大值："+t._s(d.maxCPU)+")")])],1)])]),e(r,{staticClass:"!mt-[1.4rem]",attrs:{prop:"path",label:"内存限制"}},[e("div",{staticClass:"flex items-center"},[e("div",{staticClass:"w-[20rem] pl-[.6rem]"},[e(q,{attrs:{min:0,max:d.maxMem},model:{value:d.cmdForm.mem_limit,callback:function(e){t.$set(d.cmdForm,"mem_limit",e)},expression:"cmdForm.mem_limit"}})],1),e("span",{staticClass:"ml-[1.2rem] flex items-center"},[e(y,{staticClass:"mr-[.6rem]",attrs:{size:"mini",width:"8rem"},model:{value:d.cmdForm.mem_limit,callback:function(e){t.$set(d.cmdForm,"mem_limit",t._n(e))},expression:"cmdForm.mem_limit"}}),t._v(" MB "),e("span",[t._v("(最大值："+t._s(d.maxMem)+")")])],1)])]),e(r,{attrs:{prop:"labels",label:"标签"}},[e(u,{staticClass:"!w-[50rem]",attrs:{type:"textarea",rows:5,placeholder:"容器标签，一行一个，例：key=value"},model:{value:d.cmdForm.labels,callback:function(e){t.$set(d.cmdForm,"labels",e)},expression:"cmdForm.labels"}})],1),e(r,{attrs:{prop:"environment",label:"环境变量"}},[e(u,{staticClass:"!w-[50rem]",attrs:{type:"textarea",rows:5,placeholder:"添加环境变量格式如下，有多个请换行添加：\nJAVA_HOME=/usr/local/java8\nHOSTNAME=master"},model:{value:d.cmdForm.environment,callback:function(e){t.$set(d.cmdForm,"environment",e)},expression:"cmdForm.environment"}})],1),e(r,{attrs:{prop:"remark",label:"备注"}},[e(u,{staticClass:"!w-[50rem]",attrs:{type:"textarea",rows:5,placeholder:"容器备注"},model:{value:d.cmdForm.remark,callback:function(e){t.$set(d.cmdForm,"remark",e)},expression:"cmdForm.remark"}})],1)],1),"edit"==d.props.type?e("div",{staticClass:"ml-[10rem] my-[2.4rem]"},["edit"==d.props.type?e(d.btBtn,{attrs:{title:"保存容器配置",type:"primary"},on:{click:d.confirm}},[t._v(" 保存容器配置 ")]):t._e()],1):t._e()],1)],1)}),[],!1,null,"f2755a35",null,null).exports;export{H as C};
