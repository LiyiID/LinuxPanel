import{q as a,s as e,w as t,x as s}from"./element-lib.js?v=1714377894636";import{g as l,K as r,l as i,o,d as n,e as c,n as u,a as m,b as p}from"./main.js?v=1714377894636";import{_ as d}from"./index85.js?v=1714377894636";import{_ as v}from"./index52.js?v=1714377894636";import{_ as y}from"./index53.js?v=1714377894636";import{_ as h}from"./index39.js?v=1714377894636";import{_ as b}from"./index57.js?v=1714377894636";import{_ as f}from"./index54.js?v=1714377894636";import{_ as g}from"./index56.js?v=1714377894636";import{_ as w}from"./index43.js?v=1714377894636";import{_ as x}from"./index58.js?v=1714377894636";import{_}from"./index59.js?v=1714377894636";import{_ as C}from"./index45.js?v=1714377894636";import{_ as q}from"./index60.js?v=1714377894636";import{_ as P}from"./preload-helper.js?v=1714377894636";import{e as S,A as k,b as D,f as L,v as j,c as A,H as B,w as V,I as T,j as O,l as R}from"./vue-lib.js?v=1714377894636";import{a as F,r as N,b as $,N as E,c as H,d as M}from"./database.popup.js?v=1714377894636";import{m as G,d as I,M as z,S as J,e as K,B as Q,f as U,h as W,b as X,s as Y}from"./mysql.store.js?v=1714377894636";import{g as Z}from"./index28.js?v=1714377894636";import{c as aa}from"./check.js?v=1714377894636";const ea=u(S({__name:"index",props:{databaseType:{default:""},tableBtnGroup:{default:()=>{}},tableBtnGroupRight:{default:()=>{}},tableColumn:{default:()=>{}},tableData:{default:!1},tableBatch:{default:()=>{}},recomList:{default:()=>[]},maskLayer:{type:Boolean}},setup(a){const e=a,{refs:{tabActive:t,tableParam:s,timer:u,textTimer:m,mongodbPwd:p,mysqlNotLocal:d},getDatabase:v}=Z(),{mysqlData:y,sid:h}=k(G()),{getDatabase:b}=G(),{refs:{mainHeight:f,pageSerachVal:g}}=l(),{proxy:w}=O(),x=D(!1);L((()=>g.value),(a=>{s.value.search=g.value}));const _=w.$slots.empty,C=j({}),q=D(!1),S=D("mysql"===t.value?h.value:s.value.sid),ea=D(aa("mysql"==t.value?y.value.serverList:s.value.serverList,"array",[])),ta=D(aa("mysql"==t.value?y.value.typeList:s.value.serverList,"array",[])),sa=A((()=>r(ta.value)&&ta.value.filter((a=>a.id<0)))),la=D(!1),ra=D(""),ia=D(!1),oa=D(""),na=D(!1),ca=D(),ua=j({allClassValue:""}),ma=j({p:1,limit:10,type:1,search:"",total:"mysql"===t.value?y.value.total:s.value.total,list:[],index:0});let pa=[],da=0;const va=j({isRecurrence:!1,describe:{title:"",th:"",message:"",propsValue:"name"},tableDisplayConfig:{label:"状态",prop:"status",render:a=>B("span",{class:0===pa.length?"text-warning":pa.includes(a.id)?"text-primary":"text-danger"},(()=>{if(0===pa.length)return"等待执行";{let e=pa.includes(a.id)?"执行成功":"执行失败";return da===2*pa.length?(pa=[],da=0):da++,e}})())}}),ya=D(!1),ha=D([{active:!0,content:w.$t("BtnGroup.AddDataBase"),event:async()=>{F(ea)}},{content:w.$t("BtnGroup.RootPassword"),hide:"Mysql"!==e.databaseType&&"MongoDB"!==e.databaseType,event:async()=>{try{if("Mysql"==e.databaseType){const{data:a}=await I({table:"config",key:"mysql_root",id:1});N(a)}else if("MongoDB"==e.databaseType){if("enabled"!==p.value.authorization)return void w.$message.error("请先开启安全认证");N(p.value.root)}}catch(a){}}},{content:w.$t("BtnGroup.AdminPassword"),hide:"PgSql"!=e.databaseType,event:async()=>{const{data:a}=await z("pgsql");ra.value=a.msg||"",q.value=!0}},{content:"远程数据库",event:()=>{i({title:e.databaseType+"远程数据库",area:86,isAsync:!0,component:()=>P((()=>import("./CloudServer.js?v=1714377894636")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]),import.meta.url),compData:ea.value,showFooter:!1})}}]),ba=D([{content:"同步数据库",dropdown:!0,splitButton:!1,settingList:[{label:"从面板同步到服务器",name:"syncAll",description:"将面板的数据库同步到本地服务器中"},{label:"从服务器同步到面板",name:"acquireToServer",description:"从服务器获取所有数据库，并同步到面板中<br>（数据库密码无法同步，需在面板重新配置）"}],event:async a=>{if("syncAll"===a){const a=w.$load("正在同步...");try{let a;a="mysql"===t.value?await J({type:"0",ids:[]}):await K({data:JSON.stringify({type:"0",ids:[]})},t.value),w.$message.request(a)}catch(e){}finally{a.close()}}else"acquireToServer"===a&&await $(ea.value)}}]),fa=async(a=(()=>{}),e=(()=>{}))=>"mysql"===t.value?(await a(),"mysql"):(await e(),"other"),ga=async({id:a})=>{try{await fa((async()=>{const{data:e}=await J({ids:JSON.stringify([a])},"1");return e.status&&pa.push(a),e}),(async()=>{const{data:e}=await K({data:JSON.stringify({ids:JSON.stringify([a]),type:"1"})},t.value);return e.status&&pa.push(a),e}))}catch(e){}},wa=a=>(i({title:"设置数据库权限",area:42,isAsync:!0,component:()=>P((()=>import("./SetMysqlPermession.js?v=1714377894636")),__vite__mapDeps([32,33,4,5,2,3,6,7,8,9,10,34,35,36,37,14,15,30,31]),import.meta.url),compData:{data:a,type:"multlples"},showFooter:!0}),Promise.resolve()),xa=async({id:a})=>{try{await fa((async()=>{const{data:e}=await Q({id:a});return e.status&&pa.push(a),e}),(async()=>{const{data:e}=await U({data:JSON.stringify({id:a})},t.value);return e.status&&pa.push(a),e}))}catch(e){}},_a=async a=>{let e=[];(a=aa(a,"array",[])).forEach((a=>{e.push(a.id)})),await M(e,"isMult")},Ca=j({loading:!1,list:[],selection:[],historySearch:[],rowData:{},total:0});return L((()=>y.value.total),(()=>{ma.total=y.value.total,ma.limit=y.value.limit}),{immediate:!0}),L((()=>s.value.total),(()=>{ma.total=s.value.total,ma.limit=s.value.limit}),{immediate:!0}),L((()=>t.value),((a,l)=>{let r=aa(s.value.serverList,"array",[]);if("mysql"===t.value)ia.value=e.maskLayer||!1,ha.value[1].hide=()=>d.value;else{aa(r,"array",[]).every((a=>0!==a.id))&&(ya.value=!0),s.value.unLocalDb.includes(t.value)?ia.value=!0:ia.value=!1}}),{immediate:!0}),L((()=>e.maskLayer),(()=>{"mysql"===t.value&&(ia.value=e.maskLayer||!1)}),{immediate:!0}),V((async()=>{var a,e,l,r;ea.value=aa("mysql"==t.value?y.value.serverList:s.value.serverList,"array",[]),Array.isArray(ea.value)&&""!==(null==(a=ea.value[0])?void 0:a.id)&&(null==(e=ea.value)||e.unshift({id:"",ps:"全部",db_host:"全部"})),ta.value=aa("mysql"==t.value?y.value.typeList:s.value.serverList,"array",[]),Array.isArray(ta.value)&&""!==(null==(l=ta.value[0])?void 0:l.id)&&(null==(r=ta.value)||r.unshift({id:"",ps:"全部"}));const i=await fa();S.value="mysql"==i?h.value:s.value.sid,ma.total=("mysql"==t.value?y:s).value.total,ma.limit=("mysql"==t.value?y:s).value.limit})),T((()=>{clearInterval(m.value),clearTimeout(u.value)})),{__sfc:!0,tabActive:t,tableParam:s,timer:u,textTimer:m,mongodbPwd:p,mysqlNotLocal:d,getModulesDatabase:v,mysqlData:y,sid:h,getDatabase:b,mainHeight:f,pageSerachVal:g,vm:w,props:e,showSearchHistory:x,closeSearchHistory:()=>{R((()=>{x.value=!1}))},hasEmpty:_,form:C,rootPwdPopup:q,selectValue:S,selectOptions:ea,dbTypeOptions:ta,filteredDbTypeOptions:sa,hovering:la,rootPwd:ra,maskLayer:ia,allClassValue:oa,classPopup:na,setClassFormRef:ca,setClassForm:ua,rules:{allClassValue:[{required:!0,message:"请选择分类",trigger:"change"}]},tableParamData:ma,resList:pa,index:da,batchConfig:va,isNotLocal:ya,tableBtnGroup:ha,tableBtnGroupRight:ba,searchValue:a=>{s.value.search=a},selectSubmit:async a=>{await fa((async()=>{h.value=a,await b()}),(async()=>{s.value.sid=a,await v()})),ma.p=1},openClassify:()=>{H()},searchSubmit:async a=>{null==a&&(a=""),await fa((async()=>{y.value.search=a,await b()}),(async()=>{s.value.search=a,await v()})),ma.p=1},changePageLimit:a=>{fa((()=>{y.value.limit=a,b()}),(()=>{s.value.limit=a,v()}))},judgeType:fa,handleBathComplete:a=>{fa((()=>{b()}),(()=>{v()}))},changePageSize:a=>{ma.p=a,fa((()=>{b(a)}),(()=>{v(a)}))},batchEvent:async(a,e,t)=>{switch(a){case"Synchronization":return await ga(e);case"BackDatabase":return await xa(e);case"delete":return await _a(e);case"settingPermisstion":return await wa(e)}return Promise.resolve()},batchSync:ga,batchSettingPermisstion:wa,batchBack:xa,batchDelete:_a,tableList:Ca,handleSelectionChange:a=>{Ca.list=a},handleBatch:a=>{if("setClassify"==a)return void(na.value=!0);let e=[];switch(a){case"Synchronization":e=["同步"],va.describe.message="批量".concat(e[0],"已选的数据库，").concat(e[0],"过程中存在风险，请在闲置时间进行").concat(e[0],"，是否继续操作？");break;case"BackDatabase":e=["备份"],va.describe.message="批量".concat(e[0],"已选的数据库，是否继续操作？");break;case"delete":e=["删除"],_a(Ca.list);break;case"settingPermisstion":e=["设置"],wa(Ca.list)}va.isRecurrence=!0,va.describe.th="数据库",va.describe.title="批量".concat(e[0]||"操作","数据库")},onSubmitRootPwd:async()=>{try{const{data:a}=await W({data:JSON.stringify({status:"1",password:ra.value})},"pgsql");w.$message.request(a),a.status&&(q.value=!1)}catch(a){}},openAddServer:()=>{i({title:"远程数据库",area:86,isAsync:!0,component:()=>P((()=>import("./CloudServer.js?v=1714377894636")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]),import.meta.url),compData:ea.value,showFooter:!1})},installLocal:async()=>{const{data:a}=await X({sName:"pgsql"==t.value?"pgsql_manager":t.value});"pgsql"==t.value?a.versions.forEach((e=>e.setup?void n({pluginInfo:a}):void c({name:a.name,type:a.type,pluginInfo:a}))):c({name:a.name,type:a.type,pluginInfo:a})},sortChange:({column:a,prop:e,order:l})=>{e&&(y.value.order=l?e+("ascending"===l?" asc":" desc"):"",fa((()=>{b(ma.p)}),(()=>{v(ma.p)})),ma.total=("mysql"==t.value?y:s).value.total,ma.limit=("mysql"==t.value?y:s).value.limit)},setAllClass:async()=>{ca.value.validate((async a=>{if(a){let a=Ca.list.map((a=>a.name));try{const e=await Y({database_names:a.join(","),id:ua.allClassValue,db_type:t.value});w.$message.request(e),fa((()=>{b()}),(()=>{v()})),na.value=!1}catch(e){}}}))},addMysqlDialog:F,NPSDialog:E,isRelease:o}}}),(function(){var l,r=this,i=r._self._c,o=r._self._setupProxy;return i("div",{staticClass:"flex flex-col"},[i(q,{attrs:{visible:o.maskLayer,width:"sqlserver"!==o.tabActive?"58rem":"38rem"}},[i("span",{staticClass:"mr-8x"},[r._v(r._s("sqlserver"==o.tabActive?"当前未配置远程数据库，":"当前未安装"+o.tabActive+"环境".concat((null==(l=o.selectOptions)?void 0:l.length)>1?"":"/远程数据库")))]),i(m,{staticClass:"!text-[1.4rem]",on:{click:o.openAddServer}},[r._v("添加远程数据库")]),"sqlserver"!=o.tabActive?i(C):r._e(),"sqlserver"!=o.tabActive?i(m,{staticClass:"!text-[1.4rem]",on:{click:o.installLocal}},[r._v(" 安装"+r._s(o.tabActive)+"环境")]):r._e()],1),i(_,{scopedSlots:r._u([{key:"header-left",fn:function(){return[i("div",{staticClass:"flex items-center"},[i(x,{staticClass:"mr-12x",attrs:{group:o.tableBtnGroup}}),r._t("btn-left"),i("div",{staticClass:"bg-[#ececec] w-[0.1rem] h-10 mx-[0.8rem]"}),i(x,{staticClass:"mr-120x",attrs:{group:o.tableBtnGroupRight}}),r._t("btn-right"),i(w,{staticClass:"ml-12x inline-block",attrs:{icon:"demand",iconClass:"text-1.6rem",content:"需求反馈"},on:{click:function(a){return o.NPSDialog()}}})],2)]},proxy:!0},{key:"header-right",fn:function(){return["mysql"!==o.tabActive||o.isRelease?i(a,{staticClass:"w-[12rem] mr-8x",on:{change:o.selectSubmit},model:{value:o.selectValue,callback:function(a){o.selectValue=a},expression:"selectValue"}},r._l(o.selectOptions,(function(a,t){return i(e,{key:t,attrs:{label:a.ps,value:a.id}})})),1):i(a,{staticClass:"mr-8x",attrs:{placeholder:"请选择分类"},on:{change:o.selectSubmit},model:{value:o.selectValue,callback:function(a){o.selectValue=a},expression:"selectValue"}},[i("div",{staticClass:"max-h-[20rem] overflow-auto",class:{"no-hover":o.hovering}},r._l(o.dbTypeOptions,(function(a,t){return i(e,{key:t,attrs:{label:a.ps,value:a.id}})})),1),i("div",{staticClass:"classify-item",on:{click:o.openClassify,mouseover:function(a){o.hovering=!0},mouseout:function(a){o.hovering=!1}}},[r._v(" 分类设置 ")])]),"mysql"==o.tabActive?[i("div",{staticClass:"relative"},[i(b,{staticClass:"mr-12x",attrs:{placeholder:r.$t("FtpContent.FtpSearchPlaceHolder")},on:{focus:function(a){o.showSearchHistory=!0},blur:o.closeSearchHistory,clear:o.searchSubmit,search:o.searchSubmit},model:{value:o.tableParam.search,callback:function(a){r.$set(o.tableParam,"search",a)},expression:"tableParam.search"}}),i(g,{directives:[{name:"show",rawName:"v-show",value:o.showSearchHistory,expression:"showSearchHistory"}],attrs:{compData:{historySearch:o.mysqlData.historySearch,recomList:r.recomList,name:"databases",key:"mysql"}},on:{"updata:searchValue":o.searchValue}})],1),i(f,{attrs:{name:"mysqlTableColumn",column:r.tableColumn}})]:i(b,{attrs:{placeholder:"请输入数据库名称/备注"},on:{clear:o.searchSubmit,search:o.searchSubmit},model:{value:o.tableParam.search,callback:function(a){r.$set(o.tableParam,"search",a)},expression:"tableParam.search"}})]},proxy:!0},{key:"content",fn:function(){return[i(h,{attrs:{"max-height":o.mainHeight-340,column:r.tableColumn,data:r.tableData},on:{"selection-change":o.handleSelectionChange,"sort-change":o.sortChange},scopedSlots:r._u(["redis"!==o.tabActive?{key:"empty",fn:function(){return[i("div",{staticClass:"flex items-center justify-center"},[r._v(" 您的数据库列表为空，您可以 "),i(m,{on:{click:function(a){return o.addMysqlDialog(o.selectOptions)}}},[r._v("添加一个数据库")])],1)]},proxy:!0}:null],null,!0)})]},proxy:!0},{key:"footer-left",fn:function(){return[i(y,{attrs:{data:r.tableBatch,config:o.batchConfig,"batch-fn":o.batchEvent},on:{"handle-batch":o.handleBatch,"handle-complete":o.handleBathComplete}})]},proxy:!0},{key:"footer-right",fn:function(){return[i(v,{attrs:{total:o.tableParamData.total,"current-page":o.tableParamData.p,"page-size":o.tableParamData.limit},on:{"size-change":o.changePageLimit,"current-change":o.changePageSize}})]},proxy:!0},{key:"popup",fn:function(){return[i(p,{attrs:{title:"管理员密码",visible:o.rootPwdPopup,area:38,showFooter:""},on:{"update:visible":function(a){o.rootPwdPopup=a},confirm:o.onSubmitRootPwd}},[i("div",{staticClass:"p-20x"},[i(t,{attrs:{model:o.form,"label-position":"right"}},[i(s,{attrs:{label:"管理员密码",prop:"password",rules:[{required:!0,message:"请输入管理员密码",trigger:"blur"}]}},[i(d,{attrs:{iconType:"refresh"},model:{value:o.rootPwd,callback:function(a){o.rootPwd=a},expression:"rootPwd"}})],1)],1)],1)]),i(p,{attrs:{title:"设置数据库分类",showFooter:"",area:40,visible:o.classPopup},on:{"update:visible":function(a){o.classPopup=a},confirm:o.setAllClass}},[i(t,{ref:"setClassFormRef",staticClass:"p-[2rem]",attrs:{rules:o.rules,model:o.setClassForm}},[i(s,{attrs:{label:"数据库分类",prop:"allClassValue"}},[i(a,{staticClass:"w-[22rem]",attrs:{placeholder:"请选择您的分类"},model:{value:o.setClassForm.allClassValue,callback:function(a){r.$set(o.setClassForm,"allClassValue",a)},expression:"setClassForm.allClassValue"}},r._l(o.filteredDbTypeOptions,(function(a,t){return i(e,{key:t,attrs:{label:a.ps,value:a.id}})})),1)],1)],1)],1)]},proxy:!0}],null,!0)})],1)}),[],!1,null,"76b7a577",null,null).exports;export{ea as D};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./CloudServer.js?v=1714377894636","./index118.js?v=1714377894636","./vue-lib.js?v=1714377894636","./__commonjsHelpers__.js?v=1714377894636","./main.js?v=1714377894636","./modulepreload-polyfill.js?v=1714377894636","./preload-helper.js?v=1714377894636","./request-lib.js?v=1714377894636","./locales-lib.js?v=1714377894636","./public-lib.js?v=1714377894636","./element-lib.js?v=1714377894636","./index39.js?v=1714377894636","./element-lib.js?v=1714377894636","./index59.js?v=1714377894636","./mysql.store.js?v=1714377894636","./check.js?v=1714377894636","./element-lib.js?v=1714377894636","./index.vue_vue_type_style_index_0_lang.js?v=1714377894636","./index45.js?v=1714377894636","./element-ui.common.js?v=1714377894636","./date-util.js?v=1714377894636","./vdom.js?v=1714377894636","./index62.js?v=1714377894636","./cascader-panel.js?v=1714377894636","./index38.js?v=1714377894636","./index28.js?v=1714377894636","./index77.js?v=1714377894636","./element-lib.js?v=1714377894636","./index42.js?v=1714377894636","./database.popup.js?v=1714377894636","./confirm.js?v=1714377894636","./config.js?v=1714377894636","./SetMysqlPermession.js?v=1714377894636","./index85.js?v=1714377894636","./element-lib.js?v=1714377894636","./index41.js?v=1714377894636","./element-lib.js?v=1714377894636","./element-lib.js?v=1714377894636"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
