import{_ as s}from"./index39.js?v=1714377894636";import{g as t,p as e,n as a,_ as i,a as n,q as o}from"./main.js?v=1714377894636";import{e as r,b as l,v as c,j as p}from"./vue-lib.js?v=1714377894636";import{g as m,b as d,o as u,d as f,e as y,p as g,q as v}from"./ftp.store.js?v=1714377894636";import{u as j,f as h,a as _}from"./index27.js?v=1714377894636";import{a as x}from"./confirm.js?v=1714377894636";import"./element-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./index52.js?v=1714377894636";import"./index53.js?v=1714377894636";import"./index54.js?v=1714377894636";import"./index56.js?v=1714377894636";import"./index57.js?v=1714377894636";import"./index48.js?v=1714377894636";import"./index45.js?v=1714377894636";import"./config.js?v=1714377894636";import"./index58.js?v=1714377894636";import"./index59.js?v=1714377894636";import"./index60.js?v=1714377894636";import"./index38.js?v=1714377894636";import"./check.js?v=1714377894636";import"./index76.js?v=1714377894636";import"./index77.js?v=1714377894636";import"./index42.js?v=1714377894636";const P=a(r({__name:"index",setup(s,{expose:a}){const{proxy:i}=p(),{refs:{authType:n}}=t(),{refs:{ftpAnalysisList:o,isSearchClick:r},getFtpList:P}=m(),L=l([{icon:"/ftp/icon-login-error.svg",title:"多次登录失败"},{icon:"/ftp/icon-login-address.svg",title:"登录地区异常"},{icon:"/ftp/icon-shell-file.svg",title:"上传脚本文件"},{icon:"/ftp/icon-anonymous.svg",title:"匿名用户登录"},{icon:"/ftp/icon-login-time.svg",title:"登录时间异常"}]),w=c({login_error:!0,time:!0,area:!0,anonymous:!0,upload_shell:!0,day:7,otherDay:1,user:"all",userList:[],cycle:1,value:[],option:{},config:{},search:"",status:!0}),F=async({ip:s})=>{x({confirm:{icon:"warning",title:"IP封禁",message:"封禁【"+s+"】后，将不再允许此IP访问服务器，是否继续操作？"},loading:"正在拉黑IP，请稍后...",request:async()=>await u({data:JSON.stringify({choose:"address",address:s,domain:"",types:"drop",brief:"FTP日志分析点击IP拉黑"})}),async complete(){S()}})},T=async({user:s,id:t})=>{if(0===t)return i.$message.error("匿名用户不可删除");x({confirm:{icon:"warning",title:"删除FTP用户【"+s+"】",message:"删除选中的FTP用户后，该FTP用户将彻底失去访问和操作权限，是否继续操作？"},loading:"正在删除FTP用户，请稍后...",request:async()=>await f({id:t,username:s}),async complete(){S(),P()}})},b=async({user:s,id:t})=>{if(0===t)return i.$message.error("匿名用户不可停用");x({confirm:{icon:"warning",title:"停用FTP用户【"+s+"】",message:"停用选中的FTP用户后，该FTP用户将失去访问权限，是否继续操作？"},loading:"正在设置FTP状态，请稍后...",request:async()=>await y({id:t,username:s,status:0}),async complete(){S(),P()}})},C=async({ip:s})=>{x({confirm:{icon:"warning",title:"忽略IP",message:"忽略【"+s+"】后，该IP将加入白名单中，FTP日志分析将不在记录该IP的数据，是否继续操作？"},loading:"正在忽略IP，请稍后...",request:async()=>await g({ip:s,type:"add"}),async complete(){S()}})},A=j({maskIpEvent:F,deleteDataEvent:T,stopDataEvent:b,ignoreScanEvent:C}),S=async()=>{try{const s=await v({search:w.search,day:"other"===w.day?Number(w.otherDay):w.day,username:"all"===w.user?"[]":JSON.stringify(w.userList)});if(s.status){o.value.data=[];for(const t in s.data){const e=s.data[t];o.value.data.push({time:e.exec_time,type:e.type,user:e.user,ip:t,id:e.id})}}}catch(s){}},I=()=>{o.value={scanStatus:!1,autoScanText:"定时自动扫描",btn:"立即扫描",data:[]}};return a({onCancel:I}),{__sfc:!0,vm:i,authType:n,ftpAnalysisList:o,isSearchClick:r,getFtpList:P,scanList:L,ruleForm:w,openFtpLogsWhiteList:()=>{h({refresh:S})},openLogsAnalysis:async s=>{let t;try{if("ltd"===n.value){t=i.$load(i.$t("正在获取日志服务状态，请稍后..."));const{status:e,msg:a}=await d({exec_name:"getlog"});t.close(),e&&"stop"!==a?_({type:Boolean(s),form:w,refresh:S}):await x({confirm:{icon:"warning",title:"开启FTP日志服务",message:"FTP日志服务未启动，无法记录访问日志，是否启动日志服务?"},loading:"正在开启日志服务，请稍后...",request:async()=>await d({exec_name:"start"}),async complete(){await _({type:Boolean(s),form:w,refresh:S})}})}else await e({sourceId:r.value?260:220})}catch(a){}finally{t&&t.close()}},maskIpEvent:F,deleteDataEvent:T,stopDataEvent:b,ignoreScanEvent:C,tableColumn:A,refresh:S,onCancel:I}}}),(function(){var t=this,e=t._self._c,a=t._self._setupProxy;return e("div",{staticClass:"ftp-log-scan"},[e("div",{staticClass:"scan-header"},[e("div",{staticClass:"scan-header-left"},[e(i,{staticClass:"scan-header-icon",attrs:{src:"/ftp/icon-ftp-log.svg"}}),e("div",{staticClass:"scan-header-title"},[a.ftpAnalysisList.scanStatus?e("div",[t._v(" 扫描完成，"+t._s(a.ftpAnalysisList.data.length?"共扫描出"+a.ftpAnalysisList.data.length+"条风险记录":"未扫描出风险记录")+" ")]):e("div",[t._v("FTP日志扫描，快速扫描当前FTP的安全详情")]),e("p",[t._v(" 推荐定期自动扫描功能，定期扫描生成分析结果并发送通知【"),e(n,{on:{click:function(s){return a.openLogsAnalysis(0)}}},[t._v(" "+t._s(a.ftpAnalysisList.autoScanText)+" ")]),t._v("】 ")],1)])],1),e("div"),e(o,{staticClass:"scan-header-btn",attrs:{title:a.ftpAnalysisList.btn},on:{click:function(s){return a.openLogsAnalysis(1)}}},[t._v(" "+t._s(a.ftpAnalysisList.btn)+" ")])],1),e("div",{staticClass:"scan-content"},[a.ftpAnalysisList.scanStatus?e("div",[e(o,{staticClass:"!mb-[1rem]",attrs:{type:"default"},on:{click:function(s){return a.openFtpLogsWhiteList()}}},[t._v("白名单")]),e(s,{ref:"ftpScanTable",attrs:{"max-height":"310",column:a.tableColumn,data:a.ftpAnalysisList.data,description:"扫描列表为空"}})],1):e("div",{staticClass:"scan-content-preview"},[e("div",[t._v("支持以下FTP日志安全风险扫描：")]),e("div",{staticClass:"scan-content-preview-list"},t._l(a.scanList,(function(s,a){return e("div",{key:a,staticClass:"preview-list-item"},[e(i,{staticClass:"preview-list-item-icon",attrs:{src:s.icon}}),e("span",[t._v(t._s(s.title))])],1)})),0)])])])}),[],!1,null,"360832d2",null,null).exports;export{P as default};
