import{g as e,bK as t,bL as s,b6 as a,bM as l,bN as n,n as o,a as i,q as c,F as m,D as r}from"./main.js?v=1714377894636";import{a9 as p,q as d,s as u,y as f,j as v,z as h}from"./element-lib.js?v=1714377894636";import{e as y,v as _,b,h as x,j}from"./vue-lib.js?v=1714377894636";import{g as k}from"./home.store.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";const C=o(y({__name:"HomeRecommendInstall",setup(o){const{proxy:i}=j(),{refs:{memory:c}}=k(),{refs:{isSetup:m}}=e(),r=_({lnmp:{type:"lnmp",title:"LNMP（".concat(i.$t("BtRecommendInstall.Recommend"),"）"),install:1,soft:{Nginx:{icon:"nginx",value:"",selected:!0,options:[]},MySQL:{icon:"mysql",value:"",selected:!0,options:[]},"Pure-Ftpd":{icon:"pureftpd",value:"",selected:!0,options:[]},PHP:{icon:"php",value:"",selected:!0,options:[]},phpMyAdmin:{icon:"phpmyadmin",value:"",selected:!0,options:[]}}},lamp:{type:"lamp",title:"LAMP",install:1,soft:{Apache:{icon:"apache",value:"",selected:!0,options:[]},MySQL:{icon:"mysql",value:"",selected:!0,options:[]},"Pure-Ftpd":{icon:"pureftpd",value:"",selected:!0,options:[]},PHP:{icon:"php",value:"",selected:!0,options:[]},phpMyAdmin:{icon:"phpmyadmin",value:"",selected:!0,options:[]}}},java:{type:"java",title:"JAVA",install:1,soft:{Nginx:{icon:"nginx",value:"",selected:!0,options:[]},MySQL:{icon:"mysql",value:"",selected:!0,options:[]},"Pure-Ftpd":{icon:"pureftpd",value:"",selected:!0,options:[]},jdk:{icon:"java",value:"",selected:!0,options:[]},phpMyAdmin:{icon:"phpmyadmin",value:"",selected:!0,options:[]}}}}),p=b([]),d=b([]),u={5.1:{max:256,rec:512},5.5:{max:600,rec:1024},5.6:{max:800,rec:1024},5.7:{max:1500,rec:2048},"8.0":{max:5e3,rec:6144},AliSQL:{max:800,rec:1024},"mariadb_10.0":{max:800,rec:1024},"mariadb_10.1":{max:1500,rec:2048}},f={"4.0":["5.2","5.3","5.4","5.5","5.6","7.0","7.1","7.2","7.3","7.4"],4.4:["5.4","5.4","5.5","5.6","7.0","7.1","7.2","7.3"],4.9:["5.6","7.0","7.1","7.2","7.3","7.4","8.0"],"5.0":["7.2","7.3","7.4","8.0"],5.1:["7.2","7.3","7.4","8.0"],5.2:["7.2","7.3","7.4","8.0","8.1"]},v=["4.0"],h=["5.1"],y=["5.2","5.3","5.5","7.0"],C={2.2:{php:{min:"5.2",max:"5.4"},model:"php5_module"},2.4:{php:{min:"5.3",max:"8.1"},model:"php-fpm"}},w=e=>{const t=r[e].soft.PHP.value;r[e].soft.phpMyAdmin.options=[],Object.keys(f).forEach((s=>{const a=f[s];a&&a.indexOf(t)>-1&&(r[e].soft.phpMyAdmin.options.push({label:"phpMyAdmin ".concat(s),value:s}),"5.2"!==s&&(r[e].soft.phpMyAdmin.value=s))}))},$=(e,t)=>{const{icon:s,value:a}=e,l=u[a];switch(s){case"apache":i.$message.warn(i.$t("BtRecommendInstall.OperationModeTips",{mode:C[a].model}));break;case"mysql":c.value.memTotal<l.max&&i.$message.warn(i.$t("BtRecommendInstall.MemorySmallTips",{size:l.rec/1024,version:a}));break;case"php":w(t)}},I=async()=>{const e=await n(),{data:t}=e;t.forEach((e=>{const{name:t}=e;if("Tomcat"===t)return;const s=[];let a="";switch(e.versions.forEach((({version:e})=>{const l="PHP"===t&&"8.0"===e,n="MySQL"===t&&"5.7"===e,o="phpMyAdmin"===t&&"5.1"===e,m="jdk"===t&&e.includes("1.8"),r=u[e];let p="";switch(null==t?void 0:t.toLowerCase()){case"nginx":p="1.25"===e?"[支持http3]":"";break;case"mysql":if(c.value.memTotal<r.max&&(p="[".concat(i.$t("BtRecommendInstall.OperationModeOption",{mem:r.rec/1024}),"]")),h.includes(e))return;break;case"php":if(y.includes(e))return;break;case"apache":p="[".concat(i.$t("BtRecommendInstall.MemorySmallOption",{model:C[e].model}),"]");break;case"phpmyadmin":if(!f[e])return;if(v.includes(e))return;if(-1!==f[e].indexOf("8.0"))return;break;case"jdk":e=e.replace("jdk","")}(!a&&l||n||o||m)&&(a=e),s.push({label:"".concat(t," ").concat(e),value:e,ps:p,disabled:!1})})),null==t?void 0:t.toLowerCase()){case"php":p.value.push(...s);break;case"phpmyadmin":d.value.push(...s)}!a&&s.length>0&&(a=s[0].value),Object.keys(r).forEach((e=>{const l=r[e].soft[t];l&&(l.value=a,l.options=s,"phpMyAdmin"===t&&"java"!==e&&$(r[e].soft.PHP,e))}))}))};return x((()=>{I()})),{__sfc:!0,vm:i,memory:c,isSetup:m,recommend:r,phpList:p,phpmyadminList:d,mysqlMemRequire:u,phpmyadminRequire:f,phpmyadminDeprecatedVersion:v,mysqlDeprecatedVersion:h,phpDeprecatedVersion:y,apacheRequire:C,renderPhpMyAdminList:w,changeSoftwareVersion:$,installSoft:async e=>{let l=0;const n=i.$load("正在添加软件至消息盒子，请稍后..."),o=r[e].install;for(const a in r[e].soft){const n=r[e].soft[a];if(n.selected){let e=null==a?void 0:a.toLowerCase();if("php"===e)e="php-"+n.value;else if("pure-ftpd"===e)e="pureftpd";else if("jdk"===e){try{t({name:e,version:"java"===n.icon?"jdk"+n.value:n.value,type:1})}catch(c){}continue}try{await s({sName:e,version:"java"===n.icon?"jdk"+n.value:n.value,type:o,id:l++})}catch(c){}}}n.close(),m.value=!0,await a(),i.$message.success("已将下载任务添加到队列!"),i.$emit("close")},cancelShowRec:async()=>{try{await i.$confirm({icon:"warning",title:"取消显示推荐安装",message:"不再显示推荐安装信息，继续操作？"});const e=i.$load("正在取消显示推荐安装，请稍后...");(await l({path:"/www/server/nginx"})).status?(i.$message.success("设置成功"),m.value=!0):i.$message.error("设置失败"),i.$emit("close"),e.close()}catch(e){}},initSoft:I}}}),(function(){var e=this,t=e._self._c,s=e._self._setupProxy;return t("div",{staticClass:"h-full p-[2rem]"},[t(p,{staticStyle:{border:"1px solid #eee"},attrs:{type:"warning","show-icon":"",closable:!1}},[t("div",{staticClass:"flex text-red"},[t("div",{staticClass:"flex items-center text-[1.2rem]"},[t("span",[e._v(e._s(e.$t("BtRecommendInstall.DescribeOne")))]),t(i,{staticClass:"mx-2",attrs:{href:"/soft",target:"_self"}},[e._v(e._s(e.$t("BtRecommendInstall.Software")))]),t("span",{staticClass:"mr-4"},[e._v(e._s(e.$t("BtRecommendInstall.DescribeTwo")))])],1),t(c,{attrs:{size:"",type:"defalut"},on:{click:s.cancelShowRec}},[e._v(e._s(e.$t("BtRecommendInstall.NotShow")))])],1)]),t("div",{staticClass:"flex mt-[1.5rem] recommend-list"},e._l(s.recommend,(function(a){return t("div",{key:a.type,staticClass:"recommend-item flex-1"},[t("h3",{staticClass:"mb-[1rem] pl-[.5rem] recommend-title"},[e._v(e._s(a.title))]),t("div",{staticClass:"px-[1.5rem] py-[2rem] rounded-[.4rem] transition-all duration-200 recommend-cont"},[t("ul",{staticClass:"soft-list"},e._l(a.soft,(function(l,n){return t("li",{key:n,staticClass:"flex items-center"},[t(m,{staticClass:"ml-1 mr-4",attrs:{name:"soft-ico-"+l.icon,size:"3.2"}}),t(d,{staticClass:"flex-1 mr-8",attrs:{size:"mini"},on:{change:function(e){return s.changeSoftwareVersion(l,a.type)}},model:{value:l.value,callback:function(t){e.$set(l,"value",t)},expression:"softItem.value"}},e._l(l.options,(function(s){return t(u,{key:s.value,staticClass:"flex justify-between",attrs:{label:s.label,disabled:s.disabled,value:s.value}},[t("span",[e._v(e._s(s.label))]),t("span",{staticClass:"pl-8 text-orange"},[e._v(e._s(s.ps))])])})),1),t(r,{model:{value:l.selected,callback:function(t){e.$set(l,"selected",t)},expression:"softItem.selected"}})],1)})),0),t("div",{staticClass:"flex items-baseline my-8"},[t("span",{staticClass:"mr-4"},[e._v(e._s(e.$t("BtRecommendInstall.InstallMethod"))+"：")]),t(f,{model:{value:a.install,callback:function(t){e.$set(a,"install",t)},expression:"reItem.install"}},[t(v,{staticClass:"item",attrs:{effect:"dark",placement:"top-start"},scopedSlots:e._u([{key:"content",fn:function(){return[t("div",{staticClass:"w-110"},[e._v(e._s(e.$t("BtRecommendInstall.FastInstallDescribe")))])]},proxy:!0}],null,!0)},[t(h,{staticClass:"!mr-8",attrs:{label:1}},[e._v(e._s(e.$t("BtRecommendInstall.FastInstall")))])],1),t(v,{staticClass:"item",attrs:{effect:"dark",placement:"top-start"},scopedSlots:e._u([{key:"content",fn:function(){return[t("div",{staticClass:"w-110"},[e._v(e._s(e.$t("BtRecommendInstall.CompileInstallDescribe")))])]},proxy:!0}],null,!0)},[t(h,{staticClass:"!mr-0",attrs:{label:0}},[e._v(e._s(e.$t("BtRecommendInstall.CompileInstall")))])],1)],1)],1),t("div",{staticClass:"flex justify-center"},[t(c,{on:{click:function(e){return s.installSoft(a.type)}}},[e._v(e._s(e.$t("BtRecommendInstall.OneClickInstall")))])],1)])])})),0)],1)}),[],!1,null,"73469508",null,null).exports;export{C as default};
