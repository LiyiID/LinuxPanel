import{_ as t}from"./index118.js?v=1714377894636";import{_ as e}from"./index39.js?v=1714377894636";import{f as s,a,n as r,q as l}from"./main.js?v=1714377894636";import{_ as i}from"./index59.js?v=1714377894636";import{a9 as o}from"./element-lib.js?v=1714377894636";import{_ as n}from"./index45.js?v=1714377894636";import{e as p,b as m,H as u,h as d,j as c}from"./vue-lib.js?v=1714377894636";import{g as f,bA as y,bB as g,ex as x,ey as j,bz as v}from"./site.store.js?v=1714377894636";import{ad as _}from"./site.popup.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./check.js?v=1714377894636";import"./index38.js?v=1714377894636";import"./element-ui.common.js?v=1714377894636";import"./date-util.js?v=1714377894636";import"./vdom.js?v=1714377894636";import"./index62.js?v=1714377894636";import"./cascader-panel.js?v=1714377894636";const L=r(p({__name:"TrustAsiaList",setup(t){const{refs:{trustAsiaList:e,trustAsiaListArrange:r,siteInfo:l,sslAlertState:i},getDomainAllList:o,getSslInfoConfig:p,getTrustAsiaDataList:L,getPhpModulesList:b,getModulesList:h}=f(),{proxy:w}=c(),S=m(!1),A=m([{label:"域名",prop:"commonName"},{label:"到期时间",prop:"endtime",width:110,render:(t,e)=>s(t.endtime,"yyyy/MM/dd")},{label:"状态",prop:"stateName",width:100},{label:"操作",prop:"ps",width:100,showOverflowTooltip:!1,align:"right",render:(t,e)=>{if("审核已终止"===t.stateName)return u("span",["--"]);let s=[u(a,{on:{click:()=>I(t,!1)}},["部署"])];return"WF_DOMAIN_APPROVAL"===t.stateCode?s=[u(a,{on:{click:()=>T(t)}},["验证域名"])]:t.partnerOrderId===r.value&&(s=[u("span",["已部署"]),u(n),u(a,{on:{click:()=>O()}},["关闭"])]),s}}]),C=async()=>{S.value=!0,await L(),S.value=!1},I=async(t,e)=>{var s;let a=null;try{a=w.$load("正在部署证书，请稍后...");const{data:r}="proxy"==l.value.project_type||"nginx"==l.value.project_type?await y({site_name:l.value.name,partnerOrderId:t.partnerOrderId}):await g({partnerOrderId:t.partnerOrderId,siteName:l.value.name});if(r.status)if(w.$message.request(r),C(),p(),"PHP"===l.value.project_type)b();else{let t=null==(s=l.value.project_type)?void 0:s.toLowerCase();"node"===t&&(t="nodejs"),h(t)}else{let t="当前证书已成功申请！自动部署失败，请尝试手动部署证书！\n";e||(t=""),w.$message.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:t+r.msg,type:r.status?"success":"error",showClose:!r.status})}}catch(r){}finally{a&&a.close()}},O=async()=>{let t=null;try{t=w.$load("正在关闭SSL，请稍后...");const{data:e}="proxy"==l.value.project_type||"nginx"==l.value.project_type?await x({site_name:l.value.name}):await j({updateOf:1,siteName:l.value.name});w.$message.request(e),C()}catch(e){}finally{t&&t.close()}},T=async t=>{let e=null;try{e=w.$load("正在验证证书申请状态，请稍后...");const{data:s,msg:a,status:r}=await v({partnerOrderId:t.partnerOrderId,siteName:l.value.name});w.$message.request({status:r,msg:a}),r&&"COMPLETED"===s.stateCode?(e.close(),await I(t,!0)):w.$message.success("等待CA验证中，若长时间未能成功验证，请登录官网使用DNS方式重新申请..."),C()}catch(s){}finally{e&&e.close()}};return d((()=>{C()})),{__sfc:!0,trustAsiaList:e,trustAsiaListArrange:r,siteInfo:l,sslAlertState:i,getDomainAllList:o,getSslInfoConfig:p,getTrustAsiaDataList:L,getPhpModulesList:b,getModulesList:h,vm:w,trustAsiaHelpList:[{text:"注意：请勿将SSL证书用于非法网站，一经发现，吊销证书。",color:"text-danger"},{text:"申请之前，请确保域名已解析，如未解析会导致审核失败(包括根域名)。"},{text:"宝塔SSL申请的是免费版TrustAsia DV SSL CA - G5证书，仅支持单个域名申请。"},{text:"有效期1年，不支持续签，到期后需要重新申请"},{text:"建议使用二级域名为www的域名申请证书,此时系统会默认赠送顶级域名为可选名称"},{text:"在未指定SSL默认站点时,未开启SSL的站点使用HTTPS会直接访问到已开启SSL的站点"},{content:'测试SSL申请注意事项及教程<a href="https://www.bt.cn/bbs/thread-33113-1-1.html" target="_blank" class="btlink"> 使用帮助</a>',useHtml:!0}],tableLoading:S,tableColumn:A,getCertList:C,applyTrustCert:async()=>{await o(),_()},deployCert:I,closeCert:O,verifyDomain:T}}}),(function(){var s=this,r=s._self._c,n=s._self._setupProxy;return r("div",{staticClass:"pt-16x overflow-y-hidden"},[r(o,{staticClass:"my-16x",attrs:{type:"error",closable:!1},scopedSlots:s._u([{key:"title",fn:function(){return[r("span",{staticClass:"text-[1.2rem] h-[4.2rem] leading-[1.8rem]"},[r("span",[s._v("提示：尊敬的用户您好，感谢您对宝塔免费证书的支持，由于证书签发机制的调整，原一年的免费证书，将缩短至90天。本调整将于2024年4月25日生效。请注意及时续签。")]),r(a,{attrs:{href:"https://www.trustasia.com/view-free-ssl-one-year-adjustment-announcement/",target:"_blank"}},[s._v(" 查看详情 ")]),s._v("。 ")],1)]},proxy:!0}])}),r("div",{staticClass:"flex flex-col w-full pt-16x"},[r(i,{scopedSlots:s._u([{key:"header-left",fn:function(){return[r(l,{staticClass:"mb-16x",attrs:{type:"primary"},on:{click:n.applyTrustCert}},[s._v("申请证书")])]},proxy:!0},{key:"content",fn:function(){return[r("div",{class:n.sslAlertState?"h-[28rem]":"h-[32rem]"},[r(e,{directives:[{name:"loading",rawName:"v-loading",value:n.tableLoading,expression:"tableLoading"}],ref:"busTable",attrs:{maxHeight:n.sslAlertState?280:320,data:n.trustAsiaList,"default-sort":{prop:"date",order:"descending"},column:n.tableColumn}})],1)]},proxy:!0}])})],1),r(t,{staticClass:"ml-20x",attrs:{list:n.trustAsiaHelpList,listStyle:"disc"}})],1)}),[],!1,null,"0a586a6a",null,null).exports;export{L as default};
