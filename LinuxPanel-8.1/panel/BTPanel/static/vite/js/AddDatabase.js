import{ai as s,o as e,l as a,n as t,a as r,F as i}from"./main.js?v=1714377894636";import{w as l,x as o,A as d,q as m,s as n}from"./element-lib.js?v=1714377894636";import{_ as p}from"./index85.js?v=1714377894636";import{_ as u}from"./index41.js?v=1714377894636";import{e as c,A as v,b,v as f,c as g,w as _,h,j as y}from"./vue-lib.js?v=1714377894636";import{a as x}from"./request-lib.js?v=1714377894636";import{a as j}from"./check.js?v=1714377894636";import{m as w,T as F,G as k,U as q,V as A}from"./mysql.store.js?v=1714377894636";import{o as C}from"./confirm.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{g as S,u as O}from"./index28.js?v=1714377894636";import D from"./CloudServer.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./config.js?v=1714377894636";import"./index77.js?v=1714377894636";import"./index42.js?v=1714377894636";import"./index118.js?v=1714377894636";import"./index39.js?v=1714377894636";import"./index59.js?v=1714377894636";import"./index.vue_vue_type_style_index_0_lang.js?v=1714377894636";import"./index45.js?v=1714377894636";import"./element-ui.common.js?v=1714377894636";import"./date-util.js?v=1714377894636";import"./vdom.js?v=1714377894636";import"./index62.js?v=1714377894636";import"./cascader-panel.js?v=1714377894636";import"./index38.js?v=1714377894636";import"./database.popup.js?v=1714377894636";const L=t(c({__name:"AddDatabase",setup(t,{expose:r}){const{proxy:i}=y(),l=x.CancelToken.source(),{refs:{tableParam:o,tabActive:d}}=S(),{mysqlData:m}=v(w()),n=b([{title:"所有人",key:"%"},{title:"本地服务器",key:"127.0.0.1"},{title:"指定ip",key:"ip"}]),p=b(!1),u=b(("mysql"===d.value?m.value.serverList:o.value.serverList).filter((s=>""!==s.id))),c=b("mysql"==d.value?m.value.serverList:o.value.serverList),L=b(),$=b([{title:"所有人",key:"0.0.0.0/0"},{title:"本地服务器",key:"127.0.0.1/32"},{title:"指定ip",key:"ip"}]),P=b({name:"",db_user:"",password:s(16),dataAccess:"127.0.0.1",address:"",codeing:"utf8mb4",dtype:"MySQL",ps:"",sid:"",listen_ip:"0.0.0.0/0",host:""}),I=b({name:[{required:!0,message:"请输入数据库名",trigger:["blur","change"]}],db_user:[{required:!0,message:"请输入用户名",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]}],address:[{validator:(s,e,a)=>{"ip"===P.value.dataAccess&&(""===e?a(new Error("请输入IP地址")):(e.split("\n").forEach((s=>{""===s||j(s)||a(new Error("请输入正确的IP地址"))})),a())),a()},trigger:["blur","change"]}],host:[{validator:(s,e,a)=>{"ip"===P.value.listen_ip&&(""===e?a(new Error("请输入IP地址")):a()),a()},trigger:["blur","change"]}]}),E=f({ip:"",status:"",msg:""}),N=async()=>{C({$refs:L.value,loading:p,request:async()=>{if(await z(P.value.sid,d.value),"ip"===P.value.dataAccess&&(P.value.address=P.value.address.replace(/\n/g,",")),"mysql"===d.value)return await F({...P.value,sid:String(P.value.sid),address:"ip"===P.value.dataAccess?P.value.address:P.value.dataAccess});{let s={...P.value,sid:String(P.value.sid),address:"ip"===P.value.dataAccess?P.value.address:P.value.dataAccess};return"pgsql"===d.value&&(s.listen_ip="ip"===s.listen_ip?s.host:s.listen_ip,delete s.host,delete s.dtype,delete s.dataAccess,delete s.address,delete s.codeing),await k(s,d.value)}},async complete(){if("mysql"===d.value){const{getDatabase:s}=w();s()}else{const{getDatabase:s}=O();await s()}}})},T=async()=>{var s;P.value.sid=null==(s=("mysql"===d.value?m.value.serverList:o.value.serverList).filter((s=>""!==s.id))[0])?void 0:s.id,z(P.value.sid,d.value)},z=async(s,e="mysql")=>{try{if(l.cancel(),E.msg="连接中...","mysql"==d.value){E.ip=m.value.serverList.filter((e=>e.id===s))[0].db_host;const{db_status:e,msg:a}=await q({sid:s});E.msg=e?"正常":a,E.status=e}else{const{db_status:e,msg:a}=await A({data:JSON.stringify({sid:s})},d.value);E.msg=e?"正常":a,E.status=e,E.ip=o.value.serverList.filter((e=>e.id===s))[0].db_host}}catch(a){}},B=g((()=>E.status?"icon-success":"icon-error"));return _((()=>{(null==u?void 0:u.length)&&(P.value.sid=u[0].id),"mysql"===d.value?u.value=m.value.serverList.filter((s=>""!==s.id)):u.value=o.value.serverList.filter((s=>""!==s.id))})),h((()=>{T()})),r({onConfirm:N}),{__sfc:!0,vm:i,source:l,tableParam:o,tabActive:d,mysqlData:m,charsetOptions:[{title:"utf8",key:"utf8"},{title:"utf8mb4",key:"utf8mb4"},{title:"gbk",key:"gbk"},{title:"big5",key:"big5"}],permissionOptions:n,formDisabled:p,addressOptions:u,selectOptions:c,addDataBaseForm:L,pgsqlPermissionOptions:$,addForm:P,rules:I,serverStatus:E,getChange:s=>{P.value.db_user=s,P.value.ps=s},openCloundSerevr:()=>{a({title:"远程数据库",area:86,component:D,compData:c.value,showFooter:!1})},submitAddForm:N,openNps:()=>{},onOpen:T,CheckStatusEvent:z,refreshStatus:async()=>{const s=P.value.sid;await z(s),i.$message.success("刷新成功")},svgIcon:B,isRelease:e}}}),(function(){var s=this,e=s._self._c,a=s._self._setupProxy;return e("div",{staticClass:"p-24x"},[e(l,{ref:"addDataBaseForm",attrs:{disabled:a.formDisabled,model:a.addForm,rules:a.rules},nativeOn:{submit:function(s){s.preventDefault()}}},[e(o,{attrs:{label:"数据库名",prop:"name"}},[e(d,{attrs:{span:14}},[e(p,{directives:[{name:"focus",rawName:"v-focus"}],attrs:{placeholder:"新的数据库名称"},on:{input:a.getChange},model:{value:a.addForm.name,callback:function(e){s.$set(a.addForm,"name",e)},expression:"addForm.name"}})],1),e(d,{attrs:{span:10}},["mysql"==a.tabActive?e(o,[e(u,{staticClass:"w-[13.6rem] ml-4x",attrs:{options:a.charsetOptions},model:{value:a.addForm.codeing,callback:function(e){s.$set(a.addForm,"codeing",e)},expression:"addForm.codeing"}})],1):s._e()],1)],1),"mongodb"!=a.tabActive?e(o,{attrs:{label:"用户名",prop:"db_user"}},[e(p,{attrs:{width:"38rem",placeholder:"数据库用户"},model:{value:a.addForm.db_user,callback:function(e){s.$set(a.addForm,"db_user",e)},expression:"addForm.db_user"}})],1):s._e(),"mongodb"!=a.tabActive?e(o,{attrs:{label:"密码",prop:"password"}},[e(p,{attrs:{width:"38rem",iconType:"refresh","is-null":!0},model:{value:a.addForm.password,callback:function(e){s.$set(a.addForm,"password",e)},expression:"addForm.password"}})],1):s._e(),"mysql"===a.tabActive?e(o,{attrs:{label:"访问权限",prop:"dataAccess"}},[e(u,{staticClass:"w-[38rem]",attrs:{options:a.permissionOptions,value:a.addForm.dataAccess},on:{"update:value":function(e){return s.$set(a.addForm,"dataAccess",e)}}}),e(o,{attrs:{prop:"address"}},["ip"===a.addForm.dataAccess?e(p,{staticClass:"mt-8x w-full",attrs:{type:"textarea",rows:4,placeholder:"如需填写多个IP，请换行填写，每行一个IP",width:"38rem"},model:{value:a.addForm.address,callback:function(e){s.$set(a.addForm,"address",e)},expression:"addForm.address"}}):s._e()],1)],1):s._e(),a.isRelease?s._e():["pgsql"===a.tabActive?e(o,{attrs:{label:"访问权限",prop:"listen_ip"}},[e(u,{staticClass:"w-[38rem]",attrs:{options:a.pgsqlPermissionOptions,value:a.addForm.listen_ip},on:{"update:value":function(e){return s.$set(a.addForm,"listen_ip",e)}}}),e(o,{attrs:{prop:"host"}},["ip"===a.addForm.listen_ip?e(p,{staticClass:"mt-8x w-full",attrs:{placeholder:"填写格式如：192.168.69.11/24",width:"38rem"},model:{value:a.addForm.host,callback:function(e){s.$set(a.addForm,"host",e)},expression:"addForm.host"}}):s._e()],1)],1):s._e()],e(o,{attrs:{label:"添加至",prop:"sid"}},[e(m,{staticClass:"w-[24rem]",on:{change:a.CheckStatusEvent},model:{value:a.addForm.sid,callback:function(e){s.$set(a.addForm,"sid",e)},expression:"addForm.sid"}},s._l(a.addressOptions,(function(s,a){return e(n,{key:a,attrs:{label:s.ps+(s.db_host?"（"+s.db_host+"）":""),value:s.id}})})),1),e(r,{staticClass:"ml-8x",on:{click:a.openCloundSerevr}},[s._v("管理远程数据库")])],1),e(o,{attrs:{label:" "}},[e("div",{staticClass:"flex items-start"},[e(i,{staticClass:"mr-4x",attrs:{size:"1.6",name:a.svgIcon}}),e("div",{staticClass:"flex flex-1"},[e("div",{staticClass:"mr-12x text-[1.2rem] min-w-[22rem] max-w-30rem"},[e("span",[s._v(s._s(a.serverStatus.ip)+"状态：")]),e(r,{class:a.serverStatus.status?"":"!text-[#ef0808]"},[s._v(s._s(a.serverStatus.msg))])],1),e("div",{staticClass:"flex items-center"},[e(i,{staticClass:"mr-4x",attrs:{size:"1.4",name:"icon-refresh"}}),e(r,{on:{click:a.refreshStatus}},[s._v("刷新")])],1)])],1)])],2)],1)}),[],!1,null,"4c8a9432",null,null).exports;export{L as default};
