import{_ as e}from"./index118.js?v=1714377894636";import{_ as t}from"./index85.js?v=1714377894636";import{w as a,x as s}from"./element-lib.js?v=1714377894636";import{cG as r,cH as o,cI as l,n as i,D as n}from"./main.js?v=1714377894636";import{_ as c}from"./index46.js?v=1714377894636";import{_ as m}from"./index41.js?v=1714377894636";import{_ as u}from"./index40.js?v=1714377894636";import{_ as p}from"./index117.js?v=1714377894636";import{e as h,b as d,v as _,w as f,S as v,h as g,j as y}from"./vue-lib.js?v=1714377894636";import{f as w}from"./check.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./index.vue_vue_type_style_index_0_lang.js?v=1714377894636";import"./config.js?v=1714377894636";import"./radio-button.js?v=1714377894636";const k=i(h({__name:"editKeywordsMonitor",props:{compData:{default:()=>{}}},setup(e,{expose:t}){const a=e,{proxy:s}=y(),i=d({name:"",method:2,site_name:"",site_url:"",access:"http",send_msg:!1,push_method:[],type:"day",week:1,where1:1,hour:1,minute:19,switch_config:!1,scan_config:{thesaurus:1,scan_args:1===a.compData.scan_args,title_hash:1===a.compData.title_hash,tail_hash:1===a.compData.tail_hash,keywords:1===a.compData.keywords,descriptions:1===a.compData.descriptions,title:1===a.compData.title,search_monitor:1===a.compData.search_monitor,scan_ua:a.compData.scan_ua||"Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)"},id:a.compData.id||""}),n=_({wordCheckall:1===a.compData.thesaurus||!a.compData.id,wordCheck1:2===a.compData.thesaurus||!a.compData.id,wordCheck2:3===a.compData.thesaurus||!a.compData.id}),c=d([{text:"如果是本机端口转发，目标IP为：127.0.0.1"},{text:"如果目标IP不填写，默认则为本机端口转发!"}]),m=d([{title:"全站扫描",key:1},{title:"快速扫描",key:2},{title:"单URL",key:3}]),u=d([{title:"自定义网站",key:"auto"}]),p=d([{title:"HTTPS",value:"https"},{title:"HTTP",value:"http"}]),h=d([{title:"每天",key:"day"},{title:"N天",key:"day-n"},{title:"每星期",key:"week"},{title:"每月",key:"month"}]),k=d([{title:"周一",key:1},{title:"周二",key:2},{title:"周三",key:3},{title:"周四",key:4},{title:"周五",key:5},{title:"周六",key:6},{title:"周日",key:7}]),b=d([]),F=d(!!a.compData.id);f((()=>{i.value.name=("auto"===i.value.site_name?i.value.site_url:i.value.site_name)+m.value.find((e=>e.key===i.value.method)).title}));const x={name:[{validator:(e,t,a)=>{if(!(t.length>0))return a(new Error("请输入监控名称"));a()},trigger:["blur","change"]}],site_name:[{validator:(e,t,a)=>{if("auto"!==t)a();else{if(0===i.value.site_url.length)return a(new Error("请输入网站域名"));if(3!==i.value.method&&!w(i.value.site_url))return a(new Error("检测网站域名格式不正确"));a()}},trigger:["blur","change"]}],push_method:[{validator:(e,t,a)=>{if(i.value.send_msg){if(!(t.length>0))return a(new Error("请选择推送方式"));a()}else a()},trigger:["blur","change"]}],type:[{validator:(e,t,a)=>"day-n"!==t&&"month"!==t||!(i.value.where1<0||i.value.where1>31)?i.value.hour<0||i.value.hour>23?a(new Error("请输入正确小时范围[0-23]")):i.value.minute<0||i.value.minute>59?a(new Error("请输入正确分钟范围[0-59]")):void a():a(new Error("请输入正确天数范围[0-31]")),trigger:["blur","change"]}]},C=v("reload",(()=>{})),D=()=>{s.$refs.editKeywordsMonitor.resetFields(),C()},$=async e=>{s.$refs.editKeywordsMonitor.validate((async t=>{let o=s.$load(s.$t("Loading"));try{if(t){let t=i.value,o=t.method,l=t.site_name;l="auto"===l?t.site_url:l;let n=t.access+"://"+l,c=t.send_msg,m=_({name:t.name,method:o,site_name:l,url:n,send_msg:c?1:0,type:t.type,hour:t.hour,minute:t.minute,id:t.id});c&&(m.send_type=t.push_method[0]),"week"===t.type&&(m.week=t.week),"day"!==t.type&&"month"!==t.type&&"day-n"!==t.type||(m.where1=t.where1),t.switch_config&&(m.scan_config=j()),F.value&&(m.id=t.id);const u=await r(F.value,{data:JSON.stringify(m)});a.compData.callback&&a.compData.callback(),s.$message.request(u),D(),e()}!t&&await s.$message.error("请检查输入内容是否正确！")}catch(l){}finally{o.close()}}))},j=()=>{var e=i.value.scan_config,t={scan_args:e.scan_args?1:0,title:e.title?1:0,keywords:e.keywords?1:0,descriptions:e.descriptions?1:0,title_hash:e.title_hash?1:0,tail_hash:e.tail_hash,search_monitor:e.search_monitor?1:0,scan_ua:e.scan_ua,thesaurus:1};return n.wordCheckall?t.thesaurus=1:n.wordCheck1?t.thesaurus=2:n.wordCheck2?t.thesaurus=3:t.thesaurus=4,t},O=async()=>{try{const{data:e}=await o({type:"sites"});for(let t=0;t<e.data.length;t++)u.value.push({title:e.data[t].name+" ["+e.data[t].ps+"]",key:e.data[t].name});F.value?i.value.site_name=a.compData.site_name:i.value.site_name=e.data[0].name||"auto",a.compData.isSite&&(i.value.site_name=a.compData.name)}catch(e){}},S=async()=>{try{const e=await l();for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){if("sms"===t)continue;b.value.push({title:e[t].title,value:e[t].name,disabled:!e[t].setup,isLink:!e[t].setup,text:"未配置"})}for(let t=0;t<e.length;t++);}catch(e){}};return g((()=>{var e,t,s,r,o;if(O(),S(),F.value){i.value={...a.compData,...a.compData.crontab_info,...a.compData.scan_config,access:null==(e=a.compData.url)?void 0:e.split("://")[0],where1:(null==(t=a.compData.crontab_info)?void 0:t.where1)||"",hour:(null==(s=a.compData.crontab_info)?void 0:s.where_hour)||"",minute:(null==(r=a.compData.crontab_info)?void 0:r.where_minute)||"",id:a.compData.id};let l=null==(o=a.compData.crontab_info)?void 0:o.type;i.value.type="每星期"===l?"week":"每月"===l?"month":"每天"===l?"day":"day-n"}})),t({onConfirm:$,onCancel:D}),{__sfc:!0,props:a,vm:s,ruleForm:i,scan_config:n,helpList:c,methodOptions:m,siteOptions:u,accessOptions:p,typeOptions:h,weekOptions:k,pushOptions:b,isEdit:F,rules:x,methodChange:e=>{i.value.method=e,3===e&&(i.value.site_name="auto")},typeChange:e=>{i.value.type=e,"day"===e?(i.value.hour=2,i.value.minute=15):"day-n"===e?(i.value.where1=3,i.value.hour=5,i.value.minute=27):"week"===e?(i.value.week=1,i.value.hour=2,i.value.minute=45):(i.value.where1=3,i.value.hour=1,i.value.minute=50)},siteNameChange:e=>{i.value.site_name=e},reloadData:C,onCancel:D,submitFrom:$,getScanConfig:j,getSiteList:O,getMessageChannelFun:S,alertChange:e=>{i.value.push_method=[],i.value.push_method.push(e.name)}}}}),(function(){var r=this,o=r._self._c,l=r._self._setupProxy;return o(a,{ref:"editKeywordsMonitor",staticClass:"p-[2rem] addfrom overflow-auto max-h-[60rem]",attrs:{rules:l.rules,model:l.ruleForm,"label-width":"10rem"}},[o(s,{attrs:{label:"监控名",prop:"name"}},[o(t,{attrs:{width:"26rem",placeholder:"请输入监控名",clearable:""},model:{value:l.ruleForm.name,callback:function(e){r.$set(l.ruleForm,"name",e)},expression:"ruleForm.name"}})],1),o(s,{attrs:{label:"检测方式"}},[o(m,{staticClass:"w-[26rem]",attrs:{options:l.methodOptions,change:l.methodChange},model:{value:l.ruleForm.method,callback:function(e){r.$set(l.ruleForm,"method",e)},expression:"ruleForm.method"}})],1),o(s,{attrs:{label:"检测网站",prop:"site_name"}},[o("div",{staticClass:"flex"},[o(m,{staticClass:"w-[20rem] mr-4",attrs:{options:l.siteOptions,disabled:!(3!==l.ruleForm.method&&!r.compData.isSite),change:l.siteNameChange},model:{value:l.ruleForm.site_name,callback:function(e){r.$set(l.ruleForm,"site_name",e)},expression:"ruleForm.site_name"}}),"auto"===l.ruleForm.site_name?o(t,{attrs:{width:"20rem",placeholder:"请输入网站域名",clearable:""},model:{value:l.ruleForm.site_url,callback:function(e){r.$set(l.ruleForm,"site_url",e)},expression:"ruleForm.site_url"}}):r._e()],1)]),o(s,{attrs:{label:"访问网站方式"}},[o(p,{attrs:{options:l.accessOptions},model:{value:l.ruleForm.access,callback:function(e){r.$set(l.ruleForm,"access",e)},expression:"ruleForm.access"}})],1),o(s,{attrs:{label:"发送告警"}},[o(c,{model:{value:l.ruleForm.send_msg,callback:function(e){r.$set(l.ruleForm,"send_msg",e)},expression:"ruleForm.send_msg"}})],1),!l.ruleForm.send_msg?r._e():o(s,{attrs:{label:"通知方式",prop:"push_method"}},[o(u,{on:{change:l.alertChange},model:{value:l.ruleForm.push_method,callback:function(e){r.$set(l.ruleForm,"push_method",e)},expression:"ruleForm.push_method"}})],1),o(s,{attrs:{label:"检测频率",prop:"type"}},[o("div",{staticClass:"flex"},[o(m,{staticClass:"w-[8rem] mr-4",attrs:{options:l.typeOptions,change:l.typeChange},model:{value:l.ruleForm.type,callback:function(e){r.$set(l.ruleForm,"type",e)},expression:"ruleForm.type"}}),"week"===l.ruleForm.type?o(m,{staticClass:"w-[8rem] mr-4",attrs:{options:l.weekOptions},model:{value:l.ruleForm.week,callback:function(e){r.$set(l.ruleForm,"week",e)},expression:"ruleForm.week"}}):r._e(),"day-n"===l.ruleForm.type||"month"===l.ruleForm.type?o(t,{staticClass:"w-[13rem] mr-4",attrs:{type:"number",min:"0",max:"31",iconTitle:"day-n"===l.ruleForm.type?"天":"日",textType:"day-n"===l.ruleForm.type?"天":"日"},model:{value:l.ruleForm.where1,callback:function(e){r.$set(l.ruleForm,"where1",e)},expression:"ruleForm.where1"}}):r._e(),o(t,{staticClass:"w-[13rem] mr-4",attrs:{type:"number",min:"0",max:"23",iconTitle:"小时",textType:"小时"},model:{value:l.ruleForm.hour,callback:function(e){r.$set(l.ruleForm,"hour",e)},expression:"ruleForm.hour"}}),o(t,{staticClass:"w-[13rem]",attrs:{type:"number",min:"0",max:"59",iconTitle:"分钟",textType:"分钟"},model:{value:l.ruleForm.minute,callback:function(e){r.$set(l.ruleForm,"minute",e)},expression:"ruleForm.minute"}})],1)]),o(s,[o(n,{staticClass:"ml-[12rem]",model:{value:l.ruleForm.switch_config,callback:function(e){r.$set(l.ruleForm,"switch_config",e)},expression:"ruleForm.switch_config"}},[r._v("高级配置")])],1),l.ruleForm.switch_config?[o(s,{attrs:{label:"敏感词库"}},[o("div",{},[o("ul",{staticClass:"border-[#ccc] border-1 w-[26rem] rounded-[.2rem] px-[1rem] py-[.5rem]"},[o("li",[o(n,{model:{value:l.scan_config.wordCheckall,callback:function(e){r.$set(l.scan_config,"wordCheckall",e)},expression:"scan_config.wordCheckall"}},[r._v("全选")])],1),o("li",[o(n,{model:{value:l.scan_config.wordCheck1,callback:function(e){r.$set(l.scan_config,"wordCheck1",e)},expression:"scan_config.wordCheck1"}},[r._v("自定义词库")])],1),o("li",[o(n,{model:{value:l.scan_config.wordCheck2,callback:function(e){r.$set(l.scan_config,"wordCheck2",e)},expression:"scan_config.wordCheck2"}},[r._v("默认词库")])],1)])])]),o(s,{attrs:{label:"检测带参数的URL"}},[o("div",{staticClass:"flex min-h-[3.2rem] items-start"},[o("div",{staticClass:"items-center h-[3.2rem]"},[o(c,{model:{value:l.ruleForm.scan_config.scan_args,callback:function(e){r.$set(l.ruleForm.scan_config,"scan_args",e)},expression:"ruleForm.scan_config.scan_args"}})],1),o("div",{staticClass:"unit"},[o("p",[r._v("扫描时检测带参数的URL，如URL: https://bt.cn?a=b")]),o("p",[o("span",{staticClass:"mr-20x"},[r._v("开启前")]),o("span",[r._v("不检测")])]),o("p",[o("span",{staticClass:"mr-20x"},[r._v("开启后")]),o("span",[r._v("检测")])]),o("p",[r._v("注意，开启后检测页面将成倍增长，可能会导致检测时间大量增加")])])])]),o(s,{attrs:{label:"头部JS检测"}},[o(c,{model:{value:l.ruleForm.scan_config.title_hash,callback:function(e){r.$set(l.ruleForm.scan_config,"title_hash",e)},expression:"ruleForm.scan_config.title_hash"}}),o("span",{staticClass:"unit"},[r._v(" 监控页面源码中的title_hash标签是否有修改 ")])],1),o(s,{attrs:{label:"尾部JS检测"}},[o(c,{model:{value:l.ruleForm.scan_config.tail_hash,callback:function(e){r.$set(l.ruleForm.scan_config,"tail_hash",e)},expression:"ruleForm.scan_config.tail_hash"}}),o("span",{staticClass:"unit"},[r._v(" 监控页面源码中的tail_hash标签是否有修改 ")])],1),o(s,{attrs:{label:"关键词检测"}},[o(c,{model:{value:l.ruleForm.scan_config.keywords,callback:function(e){r.$set(l.ruleForm.scan_config,"keywords",e)},expression:"ruleForm.scan_config.keywords"}}),o("span",{staticClass:"unit"},[r._v(" 监控页面源码中的keywords标签是否有修改 ")])],1),o(s,{attrs:{label:"描述检测"}},[o(c,{model:{value:l.ruleForm.scan_config.descriptions,callback:function(e){r.$set(l.ruleForm.scan_config,"descriptions",e)},expression:"ruleForm.scan_config.descriptions"}}),o("span",{staticClass:"unit"},[r._v(" 监控页面源码中的descriptions标签是否有修改 ")])],1),o(s,{attrs:{label:"标题检测"}},[o(c,{model:{value:l.ruleForm.scan_config.title,callback:function(e){r.$set(l.ruleForm.scan_config,"title",e)},expression:"ruleForm.scan_config.title"}}),o("span",{staticClass:"unit"},[r._v(" 监控页面源码中的title标签是否有修改 ")])],1),o(s,{attrs:{label:"搜索引擎收录监控"}},[o(c,{model:{value:l.ruleForm.scan_config.search_monitor,callback:function(e){r.$set(l.ruleForm.scan_config,"search_monitor",e)},expression:"ruleForm.scan_config.search_monitor"}}),o("span",{staticClass:"unit"},[r._v(" 监控搜索引擎是否存在风险关键词 ")])],1),o(s,{attrs:{label:"自定义访问UA"}},[o(t,{attrs:{type:"textarea",width:"36rem",height:"10rem",placeholder:"请输入自定义访问UA",clearable:""},model:{value:l.ruleForm.scan_config.scan_ua,callback:function(e){r.$set(l.ruleForm.scan_config,"scan_ua",e)},expression:"ruleForm.scan_config.scan_ua"}})],1)]:r._e(),o(e,{staticClass:"pl-[3.6rem] pt-[2.4rem]",attrs:{list:l.helpList,listStyle:"disc"}})],2)}),[],!1,null,null,null,null).exports;export{k as default};
