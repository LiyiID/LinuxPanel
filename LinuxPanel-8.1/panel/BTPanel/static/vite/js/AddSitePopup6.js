import{aS as e,n as t,D as a,a as o,q as r}from"./main.js?v=1714377894636";import{w as s,x as n,j as l,q as i,s as d}from"./element-lib.js?v=1714377894636";import{_ as p}from"./index85.js?v=1714377894636";import{e as m,b as c,h as u,j as _}from"./vue-lib.js?v=1714377894636";import{o as f}from"./software2.js?v=1714377894636";import{g as v,ba as j,i as b,b4 as w,b5 as h}from"./site.store.js?v=1714377894636";import{o as A}from"./confirm.js?v=1714377894636";import{r as F}from"./site.rules.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./check.js?v=1714377894636";import"./config.js?v=1714377894636";const g=t(m({__name:"AddSitePopup",props:{compData:{default:{rowData:{},isEdit:!1}}},setup(t,{expose:a}){const o=t,{proxy:r}=_(),{getModulesList:s}=v(),n=c({project_path:"",project_name:"",port:"",project_cmd:"",run_user:"www",project_ps:"",release_firewall:!1,dotnet_version:"",is_power_on:!1,bind_extranet:!1}),l=c(!1),i=c(!1),d=c(),p=c([]),m=async()=>{try{const e=await j();p.value=e.data,n.value.dotnet_version=e.data[0]}catch(e){}},g=async e=>{let t=Object.assign({},n.value);t.is_power_on=t.is_power_on?1:0,A({$refs:d.value,loading:{disable:l},request:async()=>{let a;return a=o.compData.isEdit?await w({data:JSON.stringify(t)},"net"):await h({data:JSON.stringify(t)},"net"),a.data.status?r.$message.success(a.data.data):r.$message.error(a.data.error_msg),s("net"),e(),null}})};return a({onConfirm:g}),u((async()=>{if(i.value=!0,await m(),i.value=!1,o.compData.isEdit){let e=o.compData.rowData;n.value={...null==e?void 0:e.project_config,project_ps:null==e?void 0:e.ps,bind_extranet:1===(null==e?void 0:e.project_config.bind_extranet),is_power_on:1===(null==e?void 0:e.project_config.is_power_on),port:null==e?void 0:e.project_config.port}}})),{__sfc:!0,props:o,vm:r,getModulesList:s,netAddForm:n,formDisabled:l,formLoading:i,netAddFormRef:d,versionData:p,getVersion:m,openVersionPlugin:async()=>{try{const{data:e}=await b({sName:"dotnet"});await f({name:"dotnet",softData:e})}catch(e){}},inputCmd:e=>{if(""!==e){let e=n.value.project_cmd.match(/([0-9]*)$/)[0];n.value.port=e||n.value.port}},onConfirm:g,onPathChange:()=>{e({type:"file",path:n.value.project_path,change:e=>{n.value.project_path=e}})},rules:F}}}),(function(){var e=this,t=e._self._c,m=e._self._setupProxy;return t("div",{staticClass:"p-20x"},[t(s,{directives:[{name:"loading",rawName:"v-loading",value:m.formLoading,expression:"formLoading"}],ref:"netAddFormRef",attrs:{model:m.netAddForm,"label-width":"100px",rules:m.rules,disabled:m.formDisabled}},[t(n,{attrs:{label:"项目名称",prop:"project_name"}},[t(p,{attrs:{width:"32rem",placeholder:"请输入项目名称"},model:{value:m.netAddForm.project_name,callback:function(t){e.$set(m.netAddForm,"project_name",t)},expression:"netAddForm.project_name"}})],1),t(n,{attrs:{label:"运行路径",prop:"project_path"}},[t(p,{attrs:{width:"32rem","icon-type":!e.compData.isEdit&&"folder",disabled:e.compData.isEdit,placeholder:"项目的运行路径"},on:{folder:m.onPathChange},model:{value:m.netAddForm.project_path,callback:function(t){e.$set(m.netAddForm,"project_path",t)},expression:"netAddForm.project_path"}})],1),t(n,{attrs:{label:"启动命令",prop:"project_cmd"}},[t(p,{attrs:{placeholder:"请输入项目的启动命令"},on:{input:m.inputCmd},model:{value:m.netAddForm.project_cmd,callback:function(t){e.$set(m.netAddForm,"project_cmd",t)},expression:"netAddForm.project_cmd"}})],1),t(n,{attrs:{label:"项目端口",prop:"port"}},[t("div",{staticClass:"flex items-center"},[t(p,{staticClass:"mr-12x",attrs:{width:"20rem",type:"number",placeholder:"项目真实端口"},model:{value:m.netAddForm.port,callback:function(t){e.$set(m.netAddForm,"port",t)},expression:"netAddForm.port"}}),e.compData.isEdit?e._e():t(a,{model:{value:m.netAddForm.release_firewall,callback:function(t){e.$set(m.netAddForm,"release_firewall",t)},expression:"netAddForm.release_firewall"}},[e._v(" 放行端口 "),t(l,{staticClass:"item",attrs:{effect:"dark",content:"选中将在防火墙安全组放行监听端口，放行后该项目可在外网访问",placement:"right"}},[t("i",{staticClass:"el-icon-question text-warning"})])],1)],1)]),t(n,{attrs:{label:"Net版本"}},[t("div",{staticClass:"flex items-center"},[t(i,{staticClass:"mr-8x w-[16rem]",attrs:{disabled:!m.versionData.length||e.compData.isEdit},model:{value:m.netAddForm.dotnet_version,callback:function(t){e.$set(m.netAddForm,"dotnet_version",t)},expression:"netAddForm.dotnet_version"}},e._l(m.versionData,(function(e){return t(d,{key:e,attrs:{value:e,label:e}})})),1),t(o,{on:{click:m.openVersionPlugin}},[e._v("版本管理")])],1)]),t(n,{attrs:{label:"开机启动"}},[t(a,{model:{value:m.netAddForm.is_power_on,callback:function(t){e.$set(m.netAddForm,"is_power_on",t)},expression:"netAddForm.is_power_on"}},[e._v("是否设置开机自动启动（默认自带守护进程每120秒检测一次）")])],1),t(n,{attrs:{label:"启动用户"}},[t("div",{staticClass:"flex items-center"},[t(i,{staticClass:"mr-8x w-[16rem]",attrs:{disabled:e.compData.isEdit},model:{value:m.netAddForm.run_user,callback:function(t){e.$set(m.netAddForm,"run_user",t)},expression:"netAddForm.run_user"}},[t(d,{attrs:{label:"www",value:"www"}}),t(d,{attrs:{label:"root",value:"root"}})],1)],1)]),t(n,{attrs:{label:"项目备注"}},[t(p,{attrs:{width:"32rem",placeholder:"输入项目备注，非必填"},model:{value:m.netAddForm.project_ps,callback:function(t){e.$set(m.netAddForm,"project_ps",t)},expression:"netAddForm.project_ps"}})],1),e.compData.isEdit?t(n,{attrs:{label:" "}},[t(r,{on:{click:m.onConfirm}},[e._v("保存配置")])],1):e._e()],1)],1)}),[],!1,null,"6b2d7351",null,null).exports;export{g as default};
