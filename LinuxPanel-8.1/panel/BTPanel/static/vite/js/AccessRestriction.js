import{_ as e}from"./index118.js?v=1714377894636";import{g as t,f as a,a as s,n as r,q as l,b as i,l as o,F as n}from"./main.js?v=1714377894636";import{y as c,ab as m,w as p,x as u,u as d}from"./element-lib.js?v=1714377894636";import{_ as f}from"./index60.js?v=1714377894636";import{_ as b}from"./index77.js?v=1714377894636";import{_ as y}from"./preload-helper.js?v=1714377894636";import{e as v,b as g,H as _,v as h,h as x,j as C,f as A}from"./vue-lib.js?v=1714377894636";import{_ as w}from"./index51.js?v=1714377894636";import{_ as j}from"./index85.js?v=1714377894636";import{_ as D}from"./index39.js?v=1714377894636";import{_ as k}from"./index57.js?v=1714377894636";import"./radio-button.js?v=1714377894636";import{_ as F}from"./index46.js?v=1714377894636";import{_ as L}from"./index59.js?v=1714377894636";import{c3 as P,c4 as S,c5 as $,c6 as R,i as T,c7 as V,c8 as I,c9 as q,ca as E,cb as H,cc as O,cd as z,ce as N,cf as G}from"./site.store.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{a as B}from"./confirm.js?v=1714377894636";import{_ as J}from"./index53.js?v=1714377894636";import{o as K}from"./index61.js?v=1714377894636";import{r as M}from"./site.popup.js?v=1714377894636";import{g as Q,e as U}from"./index38.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./index42.js?v=1714377894636";import"./index.vue_vue_type_style_index_0_lang.js?v=1714377894636";import"./check.js?v=1714377894636";import"./config.js?v=1714377894636";import"./element-ui.common.js?v=1714377894636";import"./date-util.js?v=1714377894636";import"./vdom.js?v=1714377894636";import"./index62.js?v=1714377894636";import"./cascader-panel.js?v=1714377894636";import"./index45.js?v=1714377894636";const W=r(v({__name:"CertAuthentication",props:{compData:{default:()=>({})}},setup(e){const r=e,{proxy:l}=C(),{refs:{authType:i}}=t(),o=g({status:!0}),n=g({title:"限制访问型证书-功能介绍",ps:"提供双向认证证书，可用于限制指定人员访问",source:61,isInstall:!1,desc:["限制指定人员访问","双向认证","内网自签SSL"],height:36,tabImgs:["https://www.bt.cn/Public/new/plugin/introduce/site/ssl_verify_preview.png"]}),c=g([{label:"使用者",prop:"client"},{label:"公司名称",prop:"company"},{label:"到期时间",width:220,render:e=>{if(e.day){let t=e.addtime+24*e.day*60*60;return _("div",[_("span",[a(t,"yyyy-mm-dd")+"（剩余"+e.day+"天）"])])}return _("div",[_("span","--")])}},{label:"状态",render:e=>_("div",[_("span",1===e.status?"正常":0===e.status?"未知":"已撤销")])},{label:"操作",align:"right",render:e=>1!==e.status?_("span",{},"--"):_("div",[_(s,{class:{hidden:1!==e.status||e.day>30,"mr-8x":!0},on:{click:async()=>{try{const t=await P({client:e.client});l.$message.request(t),F()}catch(t){}}}},"续签"),_(s,{class:{"mr-8x":!0,hidden:1!==e.status},on:{click:async()=>{let t=l.$load("正在请求下载，请稍后...");try{const a=await S({id:e.id});a.status?(window.open("/download?filename="+a.msg),t.close()):l.$message.error(a.msg)}catch(a){}finally{t.close()}}}},"下载"),_(s,{class:{hidden:1!==e.status},on:{click:async()=>{B({confirm:{title:"撤销证书"+e.client+"的访问证书",message:"撤销颁发的访问证书后，证书将不在可用，是否继续操作？",icon:"warning"},loading:"正在撤销，请稍后...",request:async()=>await $({id:e.id}),complete:F})}}},"撤销")])}]),m=g([]),p=g(!1),u=g("全部"),d=g(""),f=g(!1),b=g(!1),y=g(!1),v=h({company:"",domain:""}),A=h({client:""}),w=h({company:[{required:!0,message:"请输入公司名称",trigger:"blur"}],domain:[{required:!0,message:"请输入域名列表",trigger:"blur"}]}),j=()=>{f.value=!1,A.client=""},D=()=>{b.value=!1,l.$refs.certFormRef.resetFields(),l.$refs.certFormRef.clearValidate()},k=async()=>{try{if(n.value.isInstall||"ltd"!==i.value)return;const e=await V();e.data.length||b.value||(l.$message.error("请先完善证书配置"),b.value=!0),v.company=e.data[0].company,v.domain=e.data[0].domain,D()}catch(e){}},F=async()=>{try{p.value=!0;const t=await R({status:"全部"===u.value?0:"正常"===u.value?1:-1,search:d.value});if(t.msg.includes("插件不存在")||t.msg.includes("未购买")||t.msg.includes("已到期")){try{const{data:e}=await T({sName:"ssl_verify"});o.value.status=e.endtime>-1&&e.setup,"ltd"===i.value?n.value.isInstall=!e.setup||"":n.value.isInstall=!e.setup&&e.endtime>-1||"",n.value.pluginInfo=e}catch(e){}return}o.value.status=!0,m.value=t.data}catch(e){}finally{p.value=!1}},L=async()=>{let e=l.$load("正在获取状态，请稍后...");try{(await E()).data.forEach((e=>{e.name===r.compData.name&&(y.value=e.ssl_verify)}))}catch(t){}finally{e.close()}};return x((async()=>{await F(),await k(),o.value.status&&await L()})),{__sfc:!0,props:r,vm:l,authType:i,pluginInfo:o,productData:n,tableColumns:c,tableData:m,tableLoading:p,radioValue:u,searchValue:d,generatePopup:f,certPopup:b,certStatus:y,certForm:v,generateForm:A,certRules:w,onAddCert:async()=>{let e=l.$load("正在生成，请稍后...");try{const e=await P({client:A.client});l.$message.request(e),j()}catch(t){}finally{e.close()}},onCancelGenerate:j,onCancelCert:D,openCertConfig:async()=>{await k(),b.value=!0},getSslConfigEvent:k,onAddCertConfig:async()=>{let e=l.$load("正在设置，请稍后...");try{const t=await I(v);l.$message.request(t),e.close(),D()}catch(t){}finally{e.close()}},getList:F,setStatus:async e=>{let t=l.$load("正在设置，请稍后...");try{const t=await q({siteName:r.compData.name,status:e?1:0});l.$message.request(t),y.value=e,L(),F()}catch(a){}finally{t.close()}},getStatus:L}}}),(function(){var e,t=this,a=t._self._c,s=t._self._setupProxy;return a("div",{staticClass:"py-12x h-full overflow-auto"},[(null==(e=s.pluginInfo)?void 0:e.status)?a("div",[a(L,{scopedSlots:t._u([{key:"header-left",fn:function(){return[a("div",{staticClass:"flex items-center"},[a(l,{on:{click:function(e){s.generatePopup=!0}}},[t._v("生成证书")]),a("div",{staticClass:"ml-20x"},[t._v(" 双向认证开关 "),a(F,{on:{change:s.setStatus},model:{value:s.certStatus,callback:function(e){s.certStatus=e},expression:"certStatus"}})],1)],1)]},proxy:!0},{key:"header-right",fn:function(){return[a("div",{staticClass:"flex items-center"},[t._v(" 状态 "),a(c,{staticClass:"ml-12x",attrs:{size:"mini"},on:{change:s.getList},model:{value:s.radioValue,callback:function(e){s.radioValue=e},expression:"radioValue"}},[a(m,{attrs:{label:"全部"}}),a(m,{attrs:{label:"正常"}}),a(m,{attrs:{label:"已撤销"}})],1),a(k,{staticClass:"ml-12x w-[16rem]",attrs:{placeholder:"请输入用户名"},on:{search:s.getList,clear:s.getList},model:{value:s.searchValue,callback:function(e){s.searchValue=e},expression:"searchValue"}})],1)]},proxy:!0},{key:"content",fn:function(){return[a(D,{directives:[{name:"loading",rawName:"v-loading",value:s.tableLoading,expression:"tableLoading"}],attrs:{column:s.tableColumns,data:s.tableData}})]},proxy:!0},{key:"footer-left",fn:function(){return[a(l,{attrs:{type:"default"},on:{click:s.openCertConfig}},[t._v("证书配置")])]},proxy:!0},{key:"footer-right",fn:function(){},proxy:!0},{key:"popup",fn:function(){return[a(i,{attrs:{title:"生成证书",visible:s.generatePopup,area:42,showFooter:""},on:{"update:visible":function(e){s.generatePopup=e},cancel:s.onCancelGenerate,confirm:s.onAddCert}},[a("div",{staticClass:"p-20x"},[a(p,{ref:"generateFormRef",attrs:{model:s.generateForm}},[a(u,{attrs:{label:"使用者"}},[a(j,{attrs:{placeholder:"请输入使用者（如“研发部-张三”）"},model:{value:s.generateForm.client,callback:function(e){t.$set(s.generateForm,"client",e)},expression:"generateForm.client"}})],1)],1)],1)]),a(i,{attrs:{title:"证书配置",visible:s.certPopup,area:42,showFooter:""},on:{"update:visible":function(e){s.certPopup=e},confirm:s.onAddCertConfig}},[a("div",{staticClass:"p-20x"},[a(p,{ref:"certFormRef",attrs:{model:s.certForm,rules:s.certRules}},[a(u,{attrs:{label:"公司名称",prop:"company"}},[a(j,{attrs:{placeholder:"请输入公司名称"},model:{value:s.certForm.company,callback:function(e){t.$set(s.certForm,"company",e)},expression:"certForm.company"}})],1),a(u,{attrs:{label:"使用者",prop:"domain"}},[a(j,{attrs:{type:"textarea",resize:"none",rows:6,placeholder:"请输入域名列表，多个域名可以用英文状态下的逗号隔开"},model:{value:s.certForm.domain,callback:function(e){t.$set(s.certForm,"domain",e)},expression:"certForm.domain"}})],1)],1)],1)])]},proxy:!0}],null,!1,4074533332)}),t._m(0)],1):a(w,{staticClass:"!px-20x !pt-8x",attrs:{data:s.productData}})],1)}),[function(){var e=this,t=e._self._c;return e._self._setupProxy,t("ul",{staticClass:"list-disc mt-20x pl-28x"},[t("li",[e._v("双向认证仅支持【HTTPS访问】，如需全站设置，还需通过网站设置开启【强制HTTPS】.")]),t("li",[e._v(" 给网站开启【双向认证】，开启后用户需要将【证书】导入到浏览器后才能访问该网站（目前支持Nginx/Apache） ")])])}],!1,null,"3a80329d",null,null).exports;const X=r(v({__name:"LimitAccessCompnent",props:{tabActive:{default:"encryptedAccess"},tableData:null,callback:null,compData:{default:()=>({})},tableColumn:null},setup(e){const t=e,{proxy:a}=C(),s=g([]),r=g(!1),l=g(t.tableData),i=h({isRecurrence:!1,describe:{title:"",th:"",message:"",propsValue:""}}),n=g([{label:"删除加密访问",value:"delPass",diyBatch:()=>{K({title:"批量删除选中的加密访问规则，该操作可能会存在风险，是否继续？",titleType:"批量删除加密访问规则",diyRes:!0,requestFun:async e=>{var r;let l=a.$load("正在删除,请稍后...");const i=await H({site_id:t.compData.id,names:s.value.map((e=>e.name))});l.close();let o=null==(r=i.data.success)?void 0:r.map((e=>({name:e,status:!0})));Object.keys(i.data.error).forEach((e=>{o.push({name:e,status:!1,msg:i.data.error[e]})})),M({resultData:o,resultTitle:"删除加密访问规则"}),t.callback()},isRecurrence:!1,dataList:s.value})}}]);return A((()=>t.tableData),(()=>{l.value=t.tableData}),{deep:!0}),{__sfc:!0,props:t,vm:a,checkedList:s,tableLoading:r,tableData:l,batchConfig:i,batchGroup:n,handleSelectionChange:e=>{s.value=e},handleOpenPopup:e=>{"encryptedAccess"===t.tabActive?o({isAsync:!0,title:"加密访问",area:46,showFooter:!0,compData:{...e,id:t.compData.id,refresh:()=>{t.callback()}},component:()=>y((()=>import("./PassLimitForm.js?v=1714377894636")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),import.meta.url)}):"forbidAccess"===t.tabActive&&o({isAsync:!0,title:"禁止访问",area:46,showFooter:!0,compData:{...e,id:t.compData.id,website:t.compData.name,refresh:()=>{t.callback()}},component:()=>y((()=>import("./ForbidLimitForm.js?v=1714377894636")),__vite__mapDeps([17,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),import.meta.url)})}}}}),(function(){var e=this,t=e._self._c,a=e._self._setupProxy;return t("div",{staticClass:"mt-20x relative"},[t(L,{scopedSlots:e._u([{key:"header-left",fn:function(){return[t(l,{on:{click:a.handleOpenPopup}},[e._v("添加"+e._s("encryptedAccess"===e.tabActive?"加密":"禁止")+"访问")])]},proxy:!0},{key:"header-right",fn:function(){},proxy:!0},{key:"content",fn:function(){return[t(D,{directives:[{name:"loading",rawName:"v-loading",value:a.tableLoading,expression:"tableLoading"}],ref:"encryptedAccessRef",attrs:{column:e.tableColumn,data:a.tableData},on:{"selection-change":a.handleSelectionChange}})]},proxy:!0},{key:"footer-left",fn:function(){return["encryptedAccess"===e.tabActive?t(J,{attrs:{data:a.batchGroup,config:a.batchConfig,"batch-fn":()=>{}}}):e._e()]},proxy:!0}])})],1)}),[],!1,null,"de60092e",null,null).exports;const Y=r(v({__name:"AccessRestriction",props:{compData:{default:()=>({})}},setup(e){const a=e,{proxy:s}=C(),{refs:{webServerType:r}}=t(),l=g("encryptedAccess"),i=g([]),n=g(!1),c=g([{text:"目录设置加密访问后，访问时需要输入账号密码才能访问"},{text:"例如我设置了加密访问 /test/ ,那我访问 http://aaa.com/test/ 时就要输入账号密码才能访问"}]),m=g([{text:"后缀：禁止访问的文件后缀"},{text:"目录：规则会在这个目录内生效"}]),p=g(!1),u=async()=>{try{p.value=!0;const e=await O({id:a.compData.id});i.value=e.data[a.compData.name]}catch(e){}finally{p.value=!1}},d=async()=>{try{p.value=!0;const e=await z({website:a.compData.name});i.value=e.data}catch(e){}finally{p.value=!1}},f=async e=>{let t="encryptedAccess"===l.value;B({confirm:{type:"calc",title:"删除"+(t?"加密":"禁止")+"访问规则【"+e.name+"】",icon:"warning",message:"删除选中的规则后，"+(t?"访问"+e.site_dir+"将不再需要安全验证，":"该保护目录将失去防护，")+"是否继续操作？"},loading:"正在删除，请稍后...",request:async()=>t?await N({id:a.compData.id,name:e.name}):await G({website:a.compData.name,deny_name:e.name}),async complete(){t?u():d()}})},b=e=>{"encryptedAccess"===l.value?o({isAsync:!0,title:"加密访问",area:46,showFooter:!0,compData:{...e,id:a.compData.id,refresh:u},component:()=>y((()=>import("./PassLimitForm.js?v=1714377894636")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),import.meta.url)}):"forbidAccess"===l.value&&o({isAsync:!0,title:"禁止访问",area:46,showFooter:!0,compData:{...e,id:a.compData.id,website:a.compData.name,refresh:d},component:()=>y((()=>import("./ForbidLimitForm.js?v=1714377894636")),__vite__mapDeps([17,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),import.meta.url)})},v=g([Q(),{label:"加密访问",prop:"site_dir"},{label:"名称",prop:"name"},U([{onClick:b,title:"编辑"},{onClick:f,title:"删除"}])]),_=g([{label:"名称",prop:"name"},{label:"保护的目录",prop:"dir"},{label:"规则",prop:"suffix"},U([{onClick:b,title:"编辑"},{onClick:f,title:"删除"}])]);return x((async()=>{"nginx"!=r.value?(s.$message.error("不支持nginx之外的服务器!"),n.value=!0):(n.value=!1,await u())})),{__sfc:!0,vm:s,props:a,webServerType:r,tabActive:l,tableData:i,maskLayer:n,passHelpList:c,forbidHelpList:m,tableLoading:p,getPassData:u,handleClickTab:e=>{"encryptedAccess"===e.name?u():"forbidAccess"===e.name&&d()},getForbidData:d,delRule:f,handleOpenPopup:b,passColumn:v,forbidColumn:_,CertAuthentication:W,LimitAccessComponent:X}}}),(function(){var t=this,a=t._self._c,s=t._self._setupProxy;return a("div",[a(b,{attrs:{type:"navtwo"},on:{"tab-click":s.handleClickTab},model:{value:s.tabActive,callback:function(e){s.tabActive=e},expression:"tabActive"}},[a(d,{attrs:{label:"加密访问",name:"encryptedAccess"}},[a(f,{attrs:{visible:s.maskLayer,width:"28rem"}},[t._v(" 不支持nginx之外的服务器 ")]),a(s.LimitAccessComponent,{attrs:{compData:t.compData,tableColumn:s.passColumn,tabActive:s.tabActive,"table-data":s.tableData,callback:s.getPassData}})],1),a(d,{attrs:{label:"禁止访问",name:"forbidAccess",lazy:!0}},[a(f,{attrs:{visible:s.maskLayer,width:"28rem"}},[t._v(" 不支持nginx之外的服务器 ")]),a(s.LimitAccessComponent,{attrs:{compData:t.compData,tableColumn:s.forbidColumn,tabActive:s.tabActive,"table-data":s.tableData,callback:s.getForbidData}})],1),a(d,{attrs:{name:"addBatch",lazy:!0}},[a("span",{staticClass:"inline-flex items-center",attrs:{slot:"label"},slot:"label"},[a(n,{staticClass:"mr-4x mt-2x inline-flex",attrs:{name:"icon-ltd",size:"1.6"}}),t._v(" 双向认证 "),a("span",{staticClass:"text-orange"},[t._v("【推荐】")])],1),a(s.CertAuthentication,{attrs:{compData:t.compData}})],1)],1),"encryptedAccess"===s.tabActive||"forbidAccess"===s.tabActive?a(e,{staticClass:"ml-20x mt-20x",attrs:{list:"encryptedAccess"===s.tabActive?s.passHelpList:s.forbidHelpList,"list-style":"disc"}}):t._e()],1)}),[],!1,null,"88c65d8b",null,null).exports;export{Y as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./PassLimitForm.js?v=1714377894636","./index85.js?v=1714377894636","./main.js?v=1714377894636","./modulepreload-polyfill.js?v=1714377894636","./vue-lib.js?v=1714377894636","./__commonjsHelpers__.js?v=1714377894636","./preload-helper.js?v=1714377894636","./request-lib.js?v=1714377894636","./locales-lib.js?v=1714377894636","./public-lib.js?v=1714377894636","./element-lib.js?v=1714377894636","./element-lib.js?v=1714377894636","./element-lib.js?v=1714377894636","./site.store.js?v=1714377894636","./check.js?v=1714377894636","./confirm.js?v=1714377894636","./config.js?v=1714377894636","./ForbidLimitForm.js?v=1714377894636"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
