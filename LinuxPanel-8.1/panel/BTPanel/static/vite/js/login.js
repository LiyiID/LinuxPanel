var t=Object.defineProperty,e=(e,s,n)=>(((e,s,n)=>{s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n})(e,"symbol"!=typeof s?s+"":s,n),n);function s(){import.meta.url,import("_").catch((()=>1)),async function*(){}().next()}import"./modulepreload-polyfill.js?v=1714377894636";import{_ as n,l as i}from"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";const o=class t{bindEvent(t,e,s){t&&t.addEventListener?t.addEventListener(e,s,!1):t&&t.attachEvent?t.attachEvent("on".concat(e),s):t["on".concat(e)]=s}delegateEvent(t,e,s,n){"string"==typeof s&&t?t.addEventListener(e,(function(t){const e=t.target.closest(s);this.contains(e)&&n&&n.call(e,t)}),!1):"string"!=typeof s&&this.bindEvent(t,e,s)}convertType(t,e){if(typeof t===e)return t;if("string"===e)return String(t);if("number"===e)return Number(t);throw new Error("Unsupported target type: ".concat(e))}renderSelect(t){const{el:e,options:s,active:n,change:i,size:o}=t,l=document.createElement("div"),c=document.createElement("div");if(e.classList.add("form-select-module"),e.innerHTML="",o&&e.classList.add(o),c.classList.add("select-list"),s.length>0){let t=n;void 0===n&&(t=s[0].key);for(let e=0;e<s.length;e++){const n=document.createElement("div");n.classList.add("select-item"),"boolean"==typeof s[e].disabled&&s[e].disabled&&n.classList.add("disabled"),n.innerText=s[e].label,n.dataset.key=s[e].key,n.dataset.disabled="".concat(Number(s[e].disabled)),s[e].key===t&&(n.classList.add("active"),l.innerText=s[e].label),c.appendChild(n)}}l.classList.add("select-display"),e.appendChild(l),e.appendChild(c);const r=t=>{t.target.classList.contains("disabled")&&t.target.classList.contains("select-item")?this.message({message:"当前选项不可选",type:"error",time:2e3}):(e.classList.remove("active"),window.removeEventListener("click",r))};return this.delegateEvent(l,"click",(t=>{t.stopPropagation(),e.classList.toggle("active"),e.classList.contains("active")?window.addEventListener("click",r):window.removeEventListener("click",r)})),this.delegateEvent(c,"click",".select-item",(t=>{const n=t.target,{key:o,disabled:r}=n.dataset,a=n.innerText;if(Number(r))return!1;const d=s.findIndex((t=>t.key===this.convertType(o,typeof t.key)));c.querySelectorAll(".select-item").forEach(((t,e)=>{d===e?t.classList.add("active"):t.classList.remove("active")})),l.innerText=a,e.classList.remove("active"),e.dataset.key=o,i&&i(o,d)})),window.removeEventListener("click",r),e.dataset.key}validateForm(t){const{rules:e}=t,s={},n={};for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)){n[i]=document.querySelector('[name="'.concat(i,'"]'));const t=e[i];t.trigger&&t.trigger.forEach((e=>{this.bindEvent(n[i],e,(function(){const e=this;let o=!1;s[i]=()=>(t.validator(n[i].value.trim(),(function(t){var s,n,i,l;try{throw new Error(t)}catch(c){const t=c.message.replace("Error: ","");null==(n=null==(s=e.parentElement)?void 0:s.querySelector(".error-tips"))||n.remove(),null==(i=e.parentElement)||i.classList.remove("error"),t&&(o=!0,null==(l=e.parentElement)||l.classList.add("error"),e.insertAdjacentHTML("afterend",'<div class="error-tips">'.concat(t,"</div>")))}})),!o||new Error("".concat(i,":").concat(n[i].vlaue))),s[i]()}))}))}return t=>{let e=0;for(const n in s)if(Object.prototype.hasOwnProperty.call(s,n)){const t=s[n];try{const e=t();if("object"==typeof e)throw e}catch(i){e++}}if(!e){const e={};for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const s=n[t],{value:i}=s;e[t]=i.trim()}t(e)}}}handleTransformRequest(t){let e="";for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){const n=t[s];e+="".concat(encodeURIComponent(s),"=").concat(encodeURIComponent(n),"&")}return e=e.slice(0,-1),e}async request({url:t,data:e,method:s}={method:"post",data:{},url:""}){try{const{default:i}=await n((()=>import("./request-lib.js?v=1714377894636").then((t=>t.i))),__vite__mapDeps([0,1]),import.meta.url),o=i.create({baseURL:"",timeout:25e4,headers:{"Content-Type":"application/x-www-form-urlencoded"}});return await o.request({url:t,data:e,method:s,transformRequest:[this.handleTransformRequest]})}catch(i){throw new Error(i)}}async rsaEncrypt(t){const{default:e}=await n((()=>import("./request-lib.js?v=1714377894636").then((t=>t.b))),__vite__mapDeps([0,1]),import.meta.url),s=window.vite_public_encryption;if(s.length<10)return t;const i=new e;return i.setPublicKey(s),i.encrypt(t)}async encryptionData(t){const{default:e}=await n((()=>import("./request-lib.js?v=1714377894636").then((t=>t.m))),__vite__mapDeps([0,1]),import.meta.url);return t.username=await this.rsaEncrypt(e(e(t.username+window.vite_public_login_token))),t.password=await this.rsaEncrypt(e("".concat(e(t.password),"_bt.cn"))),t}removeEmpty(t){return Object.entries(t).reduce(((t,[e,s])=>(null!=s&&""!==s&&(t[e]=s),t)),{})}loading(e){const s='<div id="full-loading" class="el-loading-mask  loginLoading" style="background-color: rgba(0, 0, 0, 0.3); z-index: 3006;">\n\t\t\t<div class="el-loading-spinner">\n\t\t\t\t<i class="el-icon-loading">'.concat(t.svgLogin,'</i>\n\t\t\t\t<p class="el-loading-text">').concat(e,"</p>\n\t\t\t</div>\n\t\t</div>");return window.document.body.insertAdjacentHTML("beforeend",s),{close(){const t=document.getElementById("full-loading");t&&t.remove()}}}message({message:t,type:e,time:s=2e3}){var n;null==(n=document.getElementById("el-message"))||n.remove();const i='<div id="el-message" class="el-message el-message--'.concat(e,'" style="z-index: 4001;">\n\t\t\t\t<div class="el-message__icon el-icon-').concat(e,'"></div>\n\t\t\t\t<div class="el-message__content">').concat(t||"","</div>\n\t\t\t</div>");window.document.body.insertAdjacentHTML("beforeend",i),document.getElementById("el-message"),s&&setTimeout((()=>{const t=document.getElementById("el-message");t&&t.remove()}),s)}tooltip({el:t,text:e}){var s;null==(s=document.getElementById("el-tooltip"))||s.remove();const n='<div  id="el-tooltip" x-placement="top" class="el-tooltip__popper is-dark el-tooltip-white overview-popover w-[40rem]" style="transform-origin: center bottom; z-index: 3009; display: none;">\n\t\t\t\t<div class="leading-8 p-8x">'.concat(e,'</div>\n\t\t\t\t<div class="popper__arrow" style="left: 154px;"></div>\n\t\t</div>');window.document.body.insertAdjacentHTML("beforeend",n);const i=document.getElementById("el-tooltip");let o=0;this.bindEvent(t,"mouseenter",(t=>{clearTimeout(o),i.style.display="block",i.style.left="".concat(t.clientX-t.offsetX-150,"px"),i.style.top="".concat(t.clientY-t.offsetY-i.clientHeight-10,"px")})),this.bindEvent(t,"mouseleave",(()=>{clearTimeout(o),o=setTimeout((()=>{i.style.display="none"}),100)})),this.bindEvent(i,"mouseenter",(()=>{clearTimeout(o),i.style.display="block"})),this.bindEvent(i,"mouseleave",(()=>{clearTimeout(o),o=setTimeout((()=>{i.style.display="none"}),100)})),i.style.left="calc(50% - ".concat(i.offsetWidth/2,"px)"),i.style.top="calc(50% - ".concat(i.offsetHeight/2,"px)")}};e(o,"svgLogin",'<svg style="font-size: 20px;" version="1.1" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 93 100" style="enable-background:new 0 0 93 100" xml:space="preserve"><style>.st0{fill:#20a43a}.st1{fill:#18842d}</style><path class="st0" d="M46.6 99.9c-.2-.4-.2-.9-.3-1.4V33.3c0-.7 0-1.4-.1-2.1 0-.1 0-.2.2-.2s.4 0 .6.1c2.1.6 4.1 1.2 6.2 1.7.5.1.7.4.6.9v4.8c0 .6.2.9.8 1 1.3.3 2.6.7 3.9.9h.1c.5-.2.8.1 1.2.3h.1c.9 0 .1-.4.3-.6-.1-1.4 0-2.7 0-4.1 0-.3 0-.7.3-.9h.2c2.1.6 4.1 1.2 6.2 1.8.4.1.4.4.4.7v4.7c0 .5.1.8.6.9 1.2.3 2.5.6 3.7 1h.1c.6-.2 1.1.3 1.7.2.1 0 .2-.1.2-.2.2-.7 0-1.4.1-2.1.1-.9 0-1.8 0-2.6v-.2c0-.3.1-.2.3-.2 2 .6 4.1 1.2 6.1 1.8.5.2.4.5.4.9 0 5.1.1 10.2.1 15.3 0 6.3 0 12.6.1 18.9 0 .7-.2 1.5-.5 2.1-1.7 3.3-4 6-6.8 8.5-5 4.5-10.8 7.6-17 10.2-2.9 1.2-5.8 2-8.7 3.1-.2.1-.3.1-.3.1h-.1c-.2.1-.4.2-.6.2"/><path class="st1" d="M46.2 31.1c.2 0 .4.2.4.4v68.6l-.2-.1s-4-1.3-6-2c-6.9-2.5-13.4-5.6-19-10.3-3.2-2.6-5.9-5.5-7.9-9.1-.6-1-.9-2.2-.9-3.3.1-11.2.1-22.4.1-33.6 0-.7.2-.9.8-1.1 2-.5 3.9-1.1 5.9-1.7.3.3.2.7.2 1v3.3c0 .8.1.9.9.7.3-.1.6-.1.9 0 1.3-.3 2.6-.7 4-1 .5-.1.5-.4.5-.8v-4.8c0-.3 0-.6.4-.7l6.3-1.8c.3.3.2.7.2 1.1 0 1.4-.1 2.8.1 4.3.5.4.9-.1 1.4-.1.2-.1.4 0 .7 0 1.2-.3 2.4-.7 3.6-1 .6-.1.8-.4.8-1-.1-1.6 0-3.2 0-4.9 0-.3 0-.6.4-.7 2.1-.3 4.3-.9 6.4-1.4z"/><path class="st0" d="M46.6 15.6c1 .1 1.7.5 1.8 1.6.1.9.2 2.1.8 2.7.6.6 1.8.6 2.7.9 11.3 3.2 22.6 6.4 33.9 9.5.6.2 1 .2 1.5-.3l.1-.1c1.6-1.6 3.4-2.1 5.6-1.2.1.2-.2.3-.3.5-1.8 2.4-3.6 4.7-5.4 7.1-.3.5-.6.6-1.2.4-12.9-3.8-25.9-7.5-38.8-11.2-.4-.1-.8-.2-1.3-.1.3-1 .2-2.1.2-3.1v-5.4c.1-.6.1-1 .4-1.3z"/><path class="st1" d="M46.6 15.6v8.7c0 .5 0 .8-.5 1-3.6 1-7.1 2.1-10.6 3.1-9.5 2.7-19 5.5-28.4 8.2-.3.1-.7.3-1-.1-2-2.6-4-5.2-6.1-7.9l3.1-.4c.2 0 .3 0 .5.1s.3.2.4.3c1.6 1.7 3.4 1.7 5.6 1.1 11.2-3.3 22.5-6.4 33.7-9.5.5-.2.9-.4 1-1 .1-.7.4-1.4.5-2.1.1-1.1.8-1.5 1.8-1.5z"/><path class="st0" d="M46.6.2c1.6-.1 1.6-.1 1.9 1.4.4 1.9.7 3.9 1.1 5.8 0 .4.3.7.7.8 10.5 3.2 21 6.3 31.5 9.5.3.1.7.1.9-.2l.1-.1c1.7-1.5 3.6-2.3 5.9-1.2 0 .2-.3.3-.4.4-2 2-4.1 3.9-6 5.9-.5.5-.9.6-1.6.4-11.1-3.1-22.3-6.2-33.4-9.3-.3-.1-.6-.1-.8-.2-.1-.3-.2-.6-.1-.8V1.5c-.1-.4-.2-.9.2-1.3z"/><path class="st1" d="M46.6.2v12.3c0 .3 0 .7-.2 1-5.5 1.5-10.9 3.1-16.4 4.6-5.8 1.6-11.6 3.2-17.4 4.9-.8.2-1.2.1-1.8-.5-2-2.2-4.1-4.4-6-6.5.6-.1 1.6-.2 2.6-.4.4-.1.7.2.9.4 1.7 1.7 3.4 1.6 5.6.9 9.5-3 19.2-5.8 28.7-8.7.6-.2.9-.5 1-1.1.3-2 .8-3.9 1.1-5.9.1-.9.4-1.3 1.4-1.1.2.1.3.1.5.1z"/><path class="st0" d="M21.5 44.1c-.5.2-1.1.4-1.7.5-.5.1-.4-.4-.4-.6v-4.9h.1c2 .3 2 .3 2 2.3-.1.8 0 1.7 0 2.7z"/><path d="M73.7 39v.3c.1 1.8.1 3.5 0 5.3-.7-.1-1.4-.4-2.1-.5v-3.8c0-.6.2-.9.8-1 .5-.1.9-.4 1.3-.3zm-14 1.7-1.2-.3v-4.2c0-.6.2-.9.8-.9.4 0 .8-.3 1.3-.2-.3.7-.1 1.5-.2 2.2v3.1c.1.4.1.5-.7.3z" style="fill:#18852d"/><path d="M34.3 40.5c.2 0 .5-.1.7-.1-.5 0-.3-.4-.3-.6v-3.7c0-.3.1-.6-.3-.6-.6-.1-1.1-.4-1.7-.3v5c0 .1 0 .8.2.9h.3c.1 0 .2 0 .3-.1" style="fill:#20a53a"/><path d="M73.7 44.6v-5.3c.3.2.2.6.2.9.1 1.4-.1 2.9.1 4.3 0 .1-.1.1-.1.2 0 0-.1-.1-.2-.1z" style="fill:#24a53e"/></svg>');let l=o;class c extends l{constructor(t){super(),e(this,"el"),e(this,"formData"),e(this,"formVerify"),e(this,"node"),e(this,"codeCheck"),e(this,"hostCheck"),e(this,"googleCheck"),e(this,"loginErrorTimer"),e(this,"timer"),e(this,"submitError"),this.initData(t),this.nodeMout(),this.render(),this.event()}initData(t){const e=localStorage.getItem("safeMode")||1;this.el="string"==typeof t?document.querySelector(t.el):t,this.formData={},this.node={},this.formData.safe_mode=Number(e),this.el.innerHTML=c.template(),this.codeCheck=window.vite_public_login_check,this.formVerify={form:null,vcode:null}}static template(){return'<div class="w-full">\n\t\t\t<div class="login-title">'.concat(window.vite_public_title,'</div>\n\t\t\t<div class="login-form">\n\t\t\t\t<div class="login-form-item">\n\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t<input class="login-form-input" name="username" autocomplete="off" type="text" autofocus placeholder="账号" />\n\t\t\t\t\t\t<div class="input-action-icon"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="login-form-item">\n\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t<input class="login-form-input" name="password" autocomplete="off" type="password" placeholder="密码" />\n\t\t\t\t\t\t<div class="input-action-icon"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="login-form-item">\n\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t<div class="login-safe-mode !w-[230px]"></div>\n\t\t\t\t\t\t<div class="el-icon-question cursor-pointer text-warning h-[20px] ml-[15px] text-[20px]"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="login-form-item flex login-code-view !hidden"> \n\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t<input class="login-form-input !w-[230px] mr-[15px]" name="code" type="code" placeholder="验证码" />\n\t\t\t\t\t\t<div class="input-action-icon"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="cut-login-code"><img title="点击切换验证码" class="w-[100%] h-[40px]" /></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="login-form-item">\n\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t<button class="login-form-button login-submit">登录</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="login-form-footer">\n\t\t\t\t\t<div class="flex">\n\t\t\t\t\t\t<div class="cdn-node"> 加速节点 </div>\n\t\t\t\t\t\t<div class="login-cdn-accelerate"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<a class="bt-link" href="https://www.bt.cn/bbs/thread-1172-1-1.html" target="_blank" rel="noreferrer noopener"> 忘记密码>> </a>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="login-form google-verify-view !hidden">\n\t\t\t\t\t<div class="login-google-verify">\n\t\t\t\t\t\t<div class="close-popup-btn -right-[15px] -top-[15px]"></div>\n\t\t\t\t\t\t<div class="login-title !mt-0">动态口令认证</div>\n\t\t\t\t\t\t<div class="login-form-item">\n\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t<input class="login-form-input" name="vcode" type="text" placeholder="请输入动态口令" />\n\t\t\t\t\t\t\t\t<div class="input-action-icon"></div>\n\t\t\t\t\t\t\t</div>\t\t\t\t\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="login-form-item">\n\t\t\t\t\t\t\t<button class="login-form-button login-google-verify-submit">验证并登录</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<ul class="mt-4x leading-8 text-[1.2rem]">\n\t\t\t\t\t\t\t<li>请使用宝塔APP或谷歌认证器获取验证代码</li>\n\t\t\t\t\t\t\t<li><a href="https://www.bt.cn/bbs/forum.php?mod=viewthread&tid=105839" target="_blank" rel="noreferrer noopener" class="bt-link" ><span class="el-link--inner"> 无法验证，点击帮助 </span></a></li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="google-verify-shade"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>')}nodeMout(){this.node={loginForm:this.el.querySelector(".login-form"),inputUsername:this.el.querySelector('[name="username"]'),inputPassword:this.el.querySelector('[name="password"]'),codeView:this.el.querySelector(".login-code-view"),inputCode:this.el.querySelector('[name="code"]'),cutCode:this.el.querySelector(".cut-login-code"),formSafeMode:this.el.querySelector(".login-safe-mode"),formSubmit:this.el.querySelector(".login-submit"),formGoogleVerifySubmit:this.el.querySelector(".login-google-verify-submit"),closePopupBtn:this.el.querySelector(".close-popup-btn"),formGoogleVerifyView:this.el.querySelector(".google-verify-view"),formGoogleVerifyInput:this.el.querySelector('[name="vcode"]'),formCdnAccelerate:this.el.querySelector(".login-cdn-accelerate"),formTipsQuestion:this.el.querySelector(".el-icon-question")}}render(){const{formSafeMode:t}=this.node;this.renderSelect({el:t,options:[{key:1,label:"安全登录模式(推荐)"},{key:0,label:"普通登录模式(不推荐)"}],active:this.formData.safe_mode,change:t=>{this.formData.safe_mode=Number(t),localStorage.setItem("safeMode",t)}}),this.renderHostsList(),this.codeVerify(this.codeCheck),this.cutCheckCode()}event(){const{cutCode:t,formSubmit:e,inputPassword:s,inputUsername:n,formGoogleVerifyInput:i,formGoogleVerifySubmit:o,formTipsQuestion:l,inputCode:c}=this.node;this.formVerify.form=this.validateForm({el:this.node.loginForm,rules:{username:{validator:(t,e)=>{""===t?e(new Error("账号不能为空")):t.length<3?e(new Error("账号长度必须大于等于3位")):e()},trigger:["input","blur"]},password:{validator:(t,e)=>{""===t?e(new Error("密码不能为空")):e()},trigger:["input","blur"]},code:{validator:(t,e)=>{""===t?e(new Error("验证码不能为空")):4!==t.length?e(new Error("验证码长度错误，必须为4位")):e()},trigger:["input","blur"]}}}),this.formVerify.vcode=this.validateForm({el:this.node.formGoogleVerifyView,rules:{vcode:{validator:(t,e)=>{""===t?e(new Error("动态口令不能为空")):t.length<6?e(new Error("动态口令长度必须为6位")):e()},trigger:["input","blur"]}}}),this.bindEvent(t,"click",this.cutCheckCode.bind(this)),this.bindEvent(this.node.closePopupBtn,"click",(()=>{this.googleVerify(!1)})),this.bindEvent(e,"click",this.submitLoginInfo.bind(this,"form")),this.bindEvent(n,"keyup",(t=>{13===t.keyCode&&e.click()})),this.bindEvent(s,"keyup",(t=>{13===t.keyCode&&e.click()})),this.bindEvent(c,"keyup",(t=>{13===t.keyCode&&e.click()})),this.bindEvent(o,"click",this.submitLoginInfo.bind(this,"vcode")),this.bindEvent(i,"keyup",(t=>{13===t.keyCode&&o.click()})),this.tooltip({el:l,text:'\n\t\t\t\t<div class="mb-[.8rem]">\n\t\t\t\t\t<div class="font-bold">安全登录模式（推荐）</div>\n\t\t\t\t\t<div>在安全模式下，将加强登录会话的安全性，防止“重放攻击”风险，强烈建议使用安全模式登录面板。</div>\n\t\t\t\t\t<div class="text-danger"> 注意：在安全模式下，极少数网络环境可能出现无限退出的情况。 </div>\n\t\t\t\t</div>\n\t\t\t\t<div class="font-bold">普通登录模式（不推荐）</div>\n\t\t\t\t<div>兼容性好，但存在“重放攻击”的风险，建议在开启面板SSL的情况下再使用普通模式。</div>'})}async renderHostsList(){const{formCdnAccelerate:t}=this.node,e=window.vite_public_hosts_list||[];if(this.hostCheck=e.length>0,t.classList[this.hostCheck?"remove":"add"]("!hidden"),document.querySelector(".cdn-node").classList[this.hostCheck?"remove":"add"]("!hidden"),!this.hostCheck)return!1;const s=[],n=[];for(let i=0;i<e.length;i++){const t=e[i];s.push({key:t.url,label:t.name}),n.push(this.getHostDelay(t.url))}this.monitorHostSpeed(s,n)}async monitorHostSpeed(t,e){const s=await Promise.all(e);t=t.map(((t,e)=>({key:t.key,label:"".concat(t.label).concat(s[e]?"(".concat(s[e],"ms)"):""),state:s[e],disabled:!s[e]}))).sort(((t,e)=>!1===t.state?1:t.state-e.state)),this.createHostSelect(t)}createHostSelect(t){const{formCdnAccelerate:e}=this.node;t&&(this.formData.cdn_url=t[0].key),this.renderSelect({el:e,size:"small",options:[{key:"",label:"不使用加速"},...t],active:t[0].key,change:t=>{this.formData.cdn_url=t}})}async getHostDelay(t){try{const e=(new Date).getTime(),{data:s}=await this.request({url:"https://".concat(t,"/test.txt"),data:{time:e}});if("boolean"==typeof s){const t=(new Date).getTime();return Promise.resolve(t-e)}return Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}getUrlInfo(){const{formSubmit:t,inputUsername:e,inputPassword:s}=this.node,n=window.location.href.split("?")[1],i=new URLSearchParams("?".concat(n)),o=i.get("username"),l=i.get("password");o&&l&&(e.value=o,s.value=l,t.click())}cutCheckCode(){this.node.cutCode.querySelector("img").src="/code?t=".concat((new Date).getTime())}googleVerify(t){const{formGoogleVerifyView:e,formGoogleVerifyInput:s}=this.node;this.googleCheck=t,this.formData.vcode="",s.value="",t?(e.classList.remove("!hidden"),s.focus()):e.classList.add("!hidden")}codeVerify(t){const{inputCode:e,codeView:s}=this.node;this.codeCheck=t,this.formData.code="",s.classList[t?"remove":"add"]("!hidden"),e.value=""}setFormSubmitError(t){var e,s,n;const{formSubmit:i}=this.node;return null==(s=null==(e=i.parentElement)?void 0:e.querySelector(".error-tips"))||s.remove(),null==(n=i.parentElement)||n.classList.add("error"),i.insertAdjacentHTML("afterend",'<div class="error-tips">'.concat(t,"</div>")),{close:()=>{var t,e,s;null==(t=i.parentElement)||t.classList.remove("error"),null==(s=null==(e=i.parentElement)?void 0:e.querySelector(".error-tips"))||s.remove()}}}async submitLoginInfo(t){const{inputPassword:e}=this.node;this.formVerify[t]((async s=>{const n=this.loading("正在登录面板，请稍候..."),i={...this.formData,...s};this.formData={...i},"string"==typeof t&&"vcode"===t&&(i.vcode=s.vcode);let o=await this.encryptionData(i);this.hostCheck&&(o.cdn_url=this.formData.cdn_url),this.googleCheck&&(o.vcode=this.formData.vcode),this.codeCheck&&(o.code=this.formData.code),o=this.removeEmpty(o);try{const{data:s}=await this.request({method:"post",url:"/login",data:o});if(n.close(),this.submitError&&this.submitError.close(),this.loginErrorTimer=!1,"number"==typeof s&&1===s)this.googleVerify(!0);else if("object"==typeof s){const{status:n,msg:i}=s;n?(this.message({type:"success",message:i}),sessionStorage.setItem("loginInfo",JSON.stringify(s)),setTimeout((()=>{window.location.href="/"}),500)):(this.message({type:"error",message:i}),"vcode"===t?this.googleVerify(!0):(e.value="",this.googleVerify(!1),this.codeVerify(!0),this.cutCheckCode(),-1!==i.indexOf("验证码错误")&&this.cutCheckCode(),this.countdownInfo(i)))}else this.message({message:s,type:"error"})}catch(l){this.message({type:"error",message:l}),n.close()}}))}countdownInfo(t){let e=0;if(!(t.indexOf("多次登录失败")>-1))return;const s=t.match(/\d+/g);s?(this.loginErrorTimer=!0,e=s[0],this.timer&&clearInterval(this.timer),this.timer=setInterval((()=>{e--,this.submitError=this.setFormSubmitError(t.replace(/\d+/g,e.toString())),(e<=0||!this.loginErrorTimer)&&(clearInterval(this.timer),this.submitError.close(),e=0)}),1e3)):setTimeout((()=>{this.submitError.close()}),3e3)}}class r extends l{constructor(t){super(),e(this,"el"),e(this,"node"),e(this,"pollingQuery",!0),this.el="string"==typeof t?document.querySelector(t.el):t,this.node={cutTips:null,loginAccount:null,loginScan:null},this.render()}template(){return'<div class="login-scan-view">\n\t\t\t<div class="login-scan-success">\n\t\t\t\t<div class="login-title">堡塔APP扫码登录</div>\n\t\t\t\t<canvas id="canvas" class="login-scan-canvas"></canvas>\n\t\t\t\t<div class="">\n\t\t\t\t\t<span><a href="https://www.bt.cn/bbs/thread-47408-1-1.html" title="点击查看链接信息" class="bt-link login-scan-tips">关于堡塔APP</a></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="login-scan-error !hidden">\n\t\t\t\t<span class="title">当前面板未绑定扫描登录，请按照以下顺序检查：</span>\n\t\t\t\t<span class="line ">1、检查堡塔APP插件(面板插件)是否安装，是否绑定</span>\n\t\t\t\t<span class="line">2、打开<a class="bt-link" rel="noreferrer noopener" href="https://www.bt.cn/bbs/thread-47408-1-1.html">堡塔APP(手机APP)</a>查看绑定情况</span>\n\t\t\t\t<span class="line">3、如果以上操作均无法解决问题，请<a target="_block" rel="noreferrer noopener" class="bt-link" href="https://www.bt.cn/new/wechat_customer">联系客服</a>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>'}render(){this.el.innerHTML=this.template(),this.getSacnLoginInfo()}async qrCodeRender(t){const{default:e}=await n((()=>import("./public-lib.js?v=1714377894636").then((t=>t.b))),__vite__mapDeps([2,1]),import.meta.url);e.toCanvas(document.getElementById("canvas"),t,{margin:1,width:140})}async getSacnLoginInfo(){var t,e,s,n;try{const{data:i}=await this.request({method:"post",url:"/public?name=app&fun=login_qrcode"});if("object"==typeof i){const{status:o,msg:l}=i;o?(this.qrCodeRender(o?l:"https://www.bt.cn/download/app.html"),this.pollingQuerySacnInfo(),null==(t=document.querySelector(".login-scan-success"))||t.classList.remove("!hidden"),null==(e=document.querySelector(".login-scan-error"))||e.classList.add("!hidden")):(null==(s=document.querySelector(".login-scan-success"))||s.classList.add("!hidden"),null==(n=document.querySelector(".login-scan-error"))||n.classList.remove("!hidden"))}}catch(i){}}async pollingQuerySacnInfo(){try{if(!this.pollingQuery)return!1;const{data:t}=await this.request({method:"post",url:"/public?name=app&fun=is_scan_ok"}),{status:e,msg:s}=t;"object"==typeof t&&e?this.loginAdmin(s):setTimeout((()=>{this.pollingQuerySacnInfo()}),2500)}catch(t){}}async loginAdmin(t){try{const{data:e}=await this.request({method:"post",url:"/public?name=app&fun=set_login",data:{secret_key:t}}),{status:s}=e;"object"==typeof e&&s&&(this.loading("登录成功,正在跳转..."),window.location.href="/")}catch(e){}}}new class extends l{constructor(t){super(),e(this,"loginType"),e(this,"el"),e(this,"node"),this.loginType=localStorage.getItem("loginType")||"account",this.el=document.querySelector(t.el),this.node={cutTips:null,loginAccount:null,loginScan:null},this.render(),window.onload=()=>{i(["request-lib.js?v=1714377894636","main.js?v=1714377894636","vue-lib.js?v=1714377894636","public-lib.js?v=1714377894636","element-lib.js?v=1714377894636"])}}template(){return'<div class="login-bg">\n\t\t<div class="login-main">\n\t\t\t<aside class="login-svg" >'.concat(l.svgLogin,'</aside>\n\t\t\t<aside class="cut-login-type ').concat(this.loginType,'">\n\t\t\t\t<div class="tips">\n\t\t\t\t\t<span class="account"></span>\n\t\t\t\t\t<span class="tips-text">切换扫码登录</span>\n\t\t\t\t</div>\n\t\t\t</aside>\n\t\t\t<aside class="login-account !hidden"></aside>\n\t\t\t<aside class="login-scan !hidden"></aside>\n\t\t</div>')}domMount(){this.node.cutTips=this.el.querySelector(".tips-text"),this.node.cutLoginType=this.el.querySelector(".cut-login-type"),this.node.loginAccount=this.el.querySelector(".login-account"),this.node.loginScan=this.el.querySelector(".login-scan")}eventMount(){const{cutLoginType:t,cutTips:e}=this.node;this.bindEvent(t,"click",(()=>{t.classList.add("account"===this.loginType?"scan":"account"),t.classList.remove("account"===this.loginType?"account":"scan"),"account"===this.loginType?(this.setLoginScan(),e.innerText="切换账号登录",localStorage.setItem("loginType","scan")):(this.setLoginAccount(),e.innerText="切换扫码登录",localStorage.setItem("loginType","account"))}))}setLoginScan(){const{loginScan:t,loginAccount:e}=this.node;this.loginType="scan",t.classList.remove("!hidden"),e.classList.add("!hidden"),new r(this.node.loginScan)}setLoginAccount(){const{loginScan:t,loginAccount:e}=this.node;this.loginType="account",t.classList.add("!hidden"),e.classList.remove("!hidden"),new c(this.node.loginAccount)}render(){this.el.innerHTML=this.template(),this.loginType=localStorage.getItem("loginType")||"account",this.domMount(),this.eventMount(),"account"===this.loginType?this.setLoginAccount():this.setLoginScan()}}({el:"#app"});export{s as __vite_legacy_guard};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./request-lib.js?v=1714377894636","./__commonjsHelpers__.js?v=1714377894636","./public-lib.js?v=1714377894636"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
