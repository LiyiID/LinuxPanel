import{_ as a}from"./index118.js?v=1714377894636";import{_ as e}from"./AlertForm.js?v=1714377894636";import{_ as t}from"./index85.js?v=1714377894636";import{w as o,x as l,q as s,s as n}from"./element-lib.js?v=1714377894636";import{g as r,n as i}from"./main.js?v=1714377894636";import{_ as c}from"./index41.js?v=1714377894636";import{e as m,b as p,h as u,I as d,j as _}from"./vue-lib.js?v=1714377894636";import{aw as v,ax as f}from"./mysql.store.js?v=1714377894636";import{o as b}from"./confirm.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./index134.js?v=1714377894636";import"./config.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./check.js?v=1714377894636";const D=i(m({__name:"IncrementForm",props:{compData:{default:()=>{}}},setup(a,{expose:e}){var t,o;const l=a,{proxy:s}=_(),{refs:{timeForm:n,noticeForm:i}}=r(),c=p(!1),m=p(),D=p(["localhost"]),h=p(),y=p([{title:"服务器磁盘",key:"localhost"},{title:"阿里云OSS",key:"alioss"},{title:"腾讯云OSS",key:"txcos"},{title:"七牛云存储",key:"qiniu"},{title:"华为云存储",key:"obs"},{title:"百度云存储",key:"bos"},{title:"天翼云存储",key:"tianyiyun"}]),w=p(null==(t=l.compData.selectOptions)?void 0:t.filter((a=>"all"!==a.value))),k=p(),j=p({db_name:(null==(o=w.value)?void 0:o.length)>0?w.value[0].value:"",zip_password:"",cron_type:"hour-n",backup_cycle:3,upload_alioss:"localhost",backup_type:"tables",name:"MySQL数据库增量备份",sType:"enterpriseBackup",sBody:"",sName:"tables",urladdress:"",save:"",save_local:1,tb_name:[""]}),x=p(["mail","dingding","feishu","weixin","sms","wx_account"]),O=p([{text:"请牢记压缩密码，以免因压缩密码导致无法恢复和下载数据",color:"text-danger",icon:"el-icon-warning",iconClass:"text-danger",disc:!1},{text:"远程数据库暂不支持增量备份"}]),g=async a=>{h.value.form.validate((async a=>{var e;if(a){let a={...i.value,...n.value,backupTo:D.value.join("|"),...j.value,name:"MySQL数据库增量备份["+j.value.db_name+"]",upload_alioss:-1!==(null==(e=D.value)?void 0:e.indexOf("localhost"))?"localhost":D.value[0],tb_name:""==j.value.tb_name[0]?"":"string"==typeof j.value.tb_name?j.value.tb_name:j.value.tb_name.join("|"),notice_channel:i.value.noticeChannel};a.notice_channel="all"===a.notice_channel?x.value.join(","):a.notice_channel,l.compData.rowData&&(a.id=l.compData.rowData.cron_id),b({$refs:m.value,loading:c,request:async()=>l.compData.rowData?(a.flock?a.flock=1:a.flock=0,await v(a)):(a.flock?a.flock=1:a.flock=0,await f(a)),async complete(){l.compData.refreshEvent()}})}}))};return e({onConfirm:g}),u((()=>{var a,e,t;l.compData.tableInnerBack&&(j.value.db_name=null==(e=null==(a=l.compData.selectOptions)?void 0:a.find((a=>a.value===l.compData.databaseName)))?void 0:e.value);const o=null==(t=l.compData.selectOptions)?void 0:t.find((a=>j.value.db_name===a.value));k.value=null==o?void 0:o.table_list,l.compData.rowData&&(Object.keys(j.value).forEach((a=>{l.compData.rowData.hasOwnProperty(a)&&(j.value[a]=l.compData.rowData[a])})),Object.keys(n.value).forEach((a=>{l.compData.rowData.hasOwnProperty(a)&&(n.value[a]=l.compData.rowData[a])})),Object.keys(i.value).forEach((a=>{"noticeChannel"==a&&(i.value[a]=l.compData.rowData.notice_channel===x.value.join(",")?"all":l.compData.rowData.notice_channel),l.compData.rowData.hasOwnProperty(a)&&(i.value[a]=l.compData.rowData[a])})),D.value=l.compData.rowData.backupTo)})),d((()=>{})),{__sfc:!0,props:l,vm:s,timeForm:n,noticeForm:i,formDisabled:c,increFormData:m,backup_address:D,alertForm:h,AddressOptions:y,selectOptions:w,tableOptionData:k,incrementFormData:j,allChannel:x,tipList:O,handleAddressChange:a=>{D.value=a},incrementBackupConfirm:g,handleChangeOption:async a=>{var e;if(a.length&&""!=a[a.length-1]){if((Array.isArray(a)||"string"==typeof a)&&a.length&&-1!==a.indexOf("")){const a=null==(e=j.value.tb_name)?void 0:e.indexOf("");-1!==a&&j.value.tb_name.splice(a,1)}}else j.value.tb_name=[""]}}}}),(function(){var r=this,i=r._self._c,m=r._self._setupProxy;return i("div",{staticClass:"flex flex-col justify-center items-center my-20x"},[i(o,{ref:"increFormData",staticClass:"mr-16x w-[90%]",attrs:{model:m.incrementFormData,disabled:m.formDisabled}},[r.compData.rowData?r._e():i(l,{attrs:{label:"数据库名称",prop:"db_name"}},[i(s,{staticClass:"w-[44rem]",model:{value:m.incrementFormData.db_name,callback:function(a){r.$set(m.incrementFormData,"db_name",a)},expression:"incrementFormData.db_name"}},r._l(m.selectOptions,(function(a,e){return i(n,{key:e,attrs:{label:a.name+(a.cron_id?"":"[无备份任务]"),value:a.value}})})),1)],1),r.compData.rowData?r._e():i(l,{attrs:{label:"选择表",prop:"list"}},[i(s,{staticClass:"w-[44rem]",attrs:{multiple:"","collapse-tags":"",placeholder:"请选择"},on:{change:m.handleChangeOption},model:{value:m.incrementFormData.tb_name,callback:function(a){r.$set(m.incrementFormData,"tb_name",a)},expression:"incrementFormData.tb_name"}},r._l(m.tableOptionData,(function(a,e){return i(n,{key:e,attrs:{label:a.tb_name+(a.cron_id?"":"[无备份任务]"),value:a.value}})})),1)],1),i(l,{attrs:{label:"数据备份到"}},[i(c,{staticClass:"w-[44rem]",attrs:{change:m.handleAddressChange,multiple:"",filterable:"","allow-create":"","default-first-option":"",options:m.AddressOptions},model:{value:m.backup_address,callback:function(a){m.backup_address=a},expression:"backup_address"}})],1),i(l,{attrs:{label:"压缩密码",prop:"zip_password"}},[i(t,{attrs:{isNull:!0,placeholder:"请输入或选取随机密码，密码可为空",iconType:!r.compData.rowData&&"refresh",disabled:!!r.compData.rowData,width:"44rem"},model:{value:m.incrementFormData.zip_password,callback:function(a){r.$set(m.incrementFormData,"zip_password",a)},expression:"incrementFormData.zip_password"}})],1),i(e,{ref:"alertForm",staticClass:"mt-20x",attrs:{needAll:!0,"is-edit":!!r.compData.rowData}})],1),"edit"!=r.compData.type?i(a,{staticClass:"mt-16x w-[78%]",attrs:{list:m.tipList,"list-style":"disc"}}):r._e()],1)}),[],!1,null,null,null,null).exports;export{D as default};
