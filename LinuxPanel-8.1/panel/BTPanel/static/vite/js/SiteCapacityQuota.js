import{g as a,o as e,p as t,n as s,q as r,a as i}from"./main.js?v=1714377894636";import{w as l,x as o,o as u}from"./element-lib.js?v=1714377894636";import{_ as n}from"./index40.js?v=1714377894636";import{_ as m}from"./index85.js?v=1714377894636";import{_ as p}from"./index46.js?v=1714377894636";import{e as c,b as d,v as g,h as f,U as v,j as y}from"./vue-lib.js?v=1714377894636";import{g as _,ec as b}from"./site.store.js?v=1714377894636";import{o as h}from"./confirm.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./config.js?v=1714377894636";import"./index.vue_vue_type_style_index_0_lang.js?v=1714377894636";import"./check.js?v=1714377894636";const x=s(c({__name:"SiteCapacityQuota",props:{compData:{default:()=>{}}},setup(s,{expose:r}){const i=s,{getPushConfigInfo:l,refs:{authType:o}}=a(),{refs:{phpModulesTableParams:u},getPhpModulesList:n}=_(),{proxy:m}=y(),p=d(),c=d(!1),x={size:[{required:!0,message:"容量不能为空",trigger:["blur"]},{validator:(a,e,t)=>{Number.isInteger(1*C.size)?t():t(new Error("容量必须为整数"))},trigger:["blur","change"]}],alarmSize:[{required:!0,message:"触发告警大小不能为空",trigger:["blur"]},{validator:(a,e,t)=>{C.status?Number.isInteger(1*C.alarmNum)?t():t(new Error("触发告警大小必须为整数")):t()},trigger:["blur","change"]}],alarmNum:[{required:!0,message:"告警次数不能为空",trigger:["blur"]},{validator:(a,e,t)=>{C.status?Number.isInteger(1*C.alarmNum)?t():t(new Error("告警次数必须为整数")):t()},trigger:["blur","change"]}],module:[{required:!0,validator:(a,e,t)=>{C.status&&0===C.module.length?t(new Error("请选择告警方式")):t()},trigger:["blur","change"]}]},C=g({used:0,size:0,status:!1,alarmSize:0,alarmNum:0,alarmModel:[],module:[],option:{}}),z=d(),j=d(!1),D=()=>{if(0===C.size)return void(z.value="未配置");const a=1024*C.size*1024;C.size>0&&C.used>=a?z.value="当前容量已用完":z.value=(C.used/1024/1024).toFixed(2)||0},w=a=>{c.value=!0;try{const{quota:e}=a||i.compData;let{quota_storage:t,quota_push:s}=e;t&&(C.used=t.used,C.size=t.size),s&&void 0!==s.module&&(C.status=s.status,C.alarmSize=s.size,C.alarmNum=s.push_count,C.module=s.module.split(",")),D(),c.value=!1}catch(e){}finally{c.value=!1}},N=()=>{const{path:a}=i.compData;if("ltd"!==o.value)return void t({sourceId:183,disablePro:!0});let e={path:a,quota_type:"site",quota_push:{status:C.status,size:Number(C.alarmSize),push_count:Number(C.alarmNum),module:C.module.join(",")},quota_storage:{size:Number(C.size)}};return C.status&&0===e.quota_push.module.length?m.$message.error("请选择至少一种告警方式"):e.quota_storage.size<e.quota_push.size?m.$message.error("容量配额必须大于触发告警大小"):void h({$refs:p.value,loading:j,request:async()=>{const a=await b({data:JSON.stringify(e)});if(a.status){m.$message.request(a),await n();let e=u.value.list.filter((a=>a.id===i.compData.id));w(e)}else m.$message.msg({customClass:"el-error-html-message",dangerouslyUseHTMLString:!0,message:a.msg,type:"error",duration:0,showClose:!0});return null}})};return f((()=>{w()})),r({onConfirm:N}),{__sfc:!0,props:i,getPushConfigInfo:l,authType:o,phpModulesTableParams:u,getPhpModulesList:n,vm:m,capsiteInfo:p,viewLoading:c,rules:x,capacityData:C,useSize:z,formDisabled:j,useSizeFun:D,init:w,onConfirm:N,isNumber:v,isRelease:e}}}),(function(){var a=this,e=a._self._c,t=a._self._setupProxy;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.viewLoading,expression:"viewLoading"}],staticClass:"p-[2rem] container-dialog"},[e(l,{ref:"capsiteInfo",attrs:{model:t.capacityData,rules:t.rules,"label-width":"10rem"}},[e(o,{attrs:{label:a.$t("FtpContent.CurrentlyUseCapacity")}},[e(u,{staticClass:"!w-[22rem]",attrs:{readonly:""},scopedSlots:a._u([t.isNumber(t.useSize)?{key:"append",fn:function(){return[e("span",{staticClass:"text-gray-500"},[a._v("MB")])]},proxy:!0}:null],null,!0),model:{value:t.useSize,callback:function(a){t.useSize=a},expression:"useSize"}})],1),e(o,{attrs:{label:a.$t("FtpContent.CurrentCapacityQuota"),prop:"size"}},[e(u,{staticClass:"!w-[22rem]",attrs:{min:0,type:"number"},scopedSlots:a._u([{key:"append",fn:function(){return[e("span",{staticClass:"text-gray-500"},[a._v("MB")])]},proxy:!0}]),model:{value:t.capacityData.size,callback:function(e){a.$set(t.capacityData,"size",e)},expression:"capacityData.size"}})],1),t.isRelease?a._e():e(o,{attrs:{label:"设置告警：",prop:"status"}},[e(p,{model:{value:t.capacityData.status,callback:function(e){a.$set(t.capacityData,"status",e)},expression:"capacityData.status"}})],1),t.capacityData.status&&!t.isRelease?[e(o,{staticClass:"my-[1.6rem]",attrs:{label:"触发告警大小：",prop:"alarmSize"}},[e(u,{staticClass:"!w-[22rem]",attrs:{min:0,type:"number"},scopedSlots:a._u([{key:"append",fn:function(){return[e("span",{staticClass:"text-gray-500"},[a._v("MB")])]},proxy:!0}],null,!1,2198664004),model:{value:t.capacityData.alarmSize,callback:function(e){a.$set(t.capacityData,"alarmSize",e)},expression:"capacityData.alarmSize"}})],1),e(o,{attrs:{label:"告警次数：",prop:"alarmNum"}},[e(m,{attrs:{min:0,type:"number",prependText:"每日最多触发",width:"26rem","text-type":"次"},model:{value:t.capacityData.alarmNum,callback:function(e){a.$set(t.capacityData,"alarmNum",e)},expression:"capacityData.alarmNum"}})],1),e(o,{attrs:{label:"告警方式：",prop:"module"}},[e(n,{model:{value:t.capacityData.module,callback:function(e){a.$set(t.capacityData,"module",e)},expression:"capacityData.module"}})],1)]:a._e(),e(o,{attrs:{label:" "}},[e(r,{on:{click:t.onConfirm}},[a._v("保存")])],1),e("div",{staticClass:"tip"},[e("ul",{staticClass:"mt-8x leading-10 list-disc ml-20x"},[e("li",{directives:[{name:"show",rawName:"v-show",value:"ltd"!==t.authType,expression:"authType !== 'ltd'"}],staticClass:"items-center leading-[2.4rem]"},[e("span",{staticClass:"text-danger"},[a._v("温馨提示：此功能为企业版专享功能")])]),e("li",{directives:[{name:"show",rawName:"v-show",value:t.capacityData.status,expression:"capacityData.status"}],staticClass:"items-center leading-[2.4rem]"},[a._v(" 点击配置后状态未更新，尝试点击【 "),e(i,{on:{click:t.getPushConfigInfo}},[a._v("手动刷新")]),a._v(" 】 ")],1),e("li",{staticClass:"items-center leading-[2.4rem]"},[e("span",{staticClass:"text-[#777]"},[a._v("需要XFS文件系统，且包含prjquota挂载参数才能使用")])]),e("li",{staticClass:"items-center leading-[2.4rem]"},[e("span",{staticClass:"text-[#777]"},[a._v("fstab配置示例：/dev/vdc1 /data xfs defaults,prjquota 0 0")])]),e("li",{staticClass:"items-center leading-[2.4rem]"},[e("span",{staticClass:"text-[#777]"},[a._v("配额容量：如需取消容量配额，请设为“0”")])])])])],2)],1)}),[],!1,null,"16cb6329",null,null).exports;export{x as default};
