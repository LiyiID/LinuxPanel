import{j as e,F as t,P as s}from"./element-lib.js?v=1714377894636";import{n as a,g as r,c as i,f as l,q as o}from"./main.js?v=1714377894636";import{e as n,b as c,j as m,v as u,c as d,h as p,l as f,I as v}from"./vue-lib.js?v=1714377894636";import{g}from"./docker.store.js?v=1714377894636";import{C as _,a as h}from"./docker.popup.js?v=1714377894636";import{c as x}from"./check.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import{g as C}from"./docker.api.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./preload-helper.js?v=1714377894636";import"./request-lib.js?v=1714377894636";const b=a(n({__name:"index",props:{text:{default:""},placement:{default:"top"},popperClass:{default:""}},setup(e){const t=e,{proxy:s}=m(),a=c(!1);return{__sfc:!0,props:t,vm:s,tooltipFlag:a,visibilityChange:e=>{const t=e.target.offsetWidth,r=s.$refs.tlp.$el.parentNode.clientWidth;a.value=r<t}}}}),(function(){var t=this,s=t._self._c,a=t._self._setupProxy;return s(e,{ref:"tlp",attrs:{content:t.text,disabled:!a.tooltipFlag,placement:a.props.placement,"popper-class":a.props.popperClass}},[s("span",t._g(t._b({on:{mouseenter:function(e){return a.visibilityChange(e)}}},"span",t.$attrs,!1),t.$listeners),[t._v(t._s(t.text))])])}),[],!1,null,null,null,null).exports;const y=a(n({__name:"DockerContainerManger",setup(e,{expose:t}){const{proxy:s}=m(),a=c(!1),{refs:{containerTableData:o},getCurrentCon:n,getCList:b}=g(),{refs:{mainHeight:y,routerActive:w}}=r(),j=c(!1),k=c(null),L=u({cpu:{percentage:0,load:!0},memory:{percentage:0,userd:0,all:0,load:!0},total:0,p:1,row:50,loading:!1,errmsg:""});const D=d((()=>0===o.value.usedList.length&&!L.loading)),M=d((()=>{const e=(L.p-1)*L.row,t=L.p*L.row;return o.value.usedList.slice(e,t)})),O=async(e,t)=>{try{t.data.cpu_info&&$(t.data),t.data.mem_info&&N(t.data),t.data.container_stats_data&&E(t.data),L.total=t.data.container_count||0,t.end&&(x(t.data,"object",{},(()=>{E({container_stats_data:[]}),L.errmsg=t.msg}),!0),s.$modelSocket.send({model_index:"btdocker",mod_name:"container",def_name:"get_all_stats",ws_callback:1002}))}catch(a){}},S=async()=>{0===o.value.usedList.length&&(L.loading=!0),C(O)},P=e=>{k.value&&(j.value=e,k.value.style.height=j.value?"0":"10rem")},$=e=>{if(!e.cpu_info)return;const t=e.cpu_info;L.cpu.percentage=parseFloat(t[0]),L.cpu.load=!1},N=e=>{if(!e.mem_info)return;const t=e.mem_info,s=Number(t.memRealUsed),a=Number(t.memTotal);L.memory.userd=s,L.memory.all=a,L.memory.percentage=Math.round(s/a*1e3)/10,L.memory.load=!1},E=e=>{if(!e.container_stats_data)return;const t=e.container_stats_data;0===o.value.usedList.length?o.value.usedList=t:o.value.usedList.forEach((e=>{const s=t.find((t=>t.id===e.id));s&&(e.cpu_usage=s.cpu_usage,e.mem_usage=s.mem_usage)})),L.loading&&(L.loading=!1)},R=async()=>{try{a.value=!0,S()}catch(e){}finally{a.value=!1}},T=()=>{var e;null==(e=s.$modelSocket)||e.close(),s.$modelSocket=null},U=()=>{y.value<=700?P(!0):P(!1)};return p((()=>{R(),f((()=>{U()}))})),t({init:R,destroy:T}),v((()=>{T()})),{__sfc:!0,vm:s,regionLoad:a,containerTableData:o,getCurrentCon:n,getCList:b,mainHeight:y,routerActive:w,hideOverview:j,useMenuRef:k,use:L,useSocket:null,timer:null,isLoadErr:D,showList:M,cpuColors:[{color:"#f7b851",percentage:90},{color:"#ef0808",percentage:100}],memColors:[{color:"#52a9ff",percentage:90},{color:"#ef0808",percentage:100}],onWSReceive:O,rsyncData:S,hideSystemOverview:P,setCpu:$,setMen:N,setCon:E,changePageLimit:e=>{L.row=e,L.p=1,s.$refs.scrollContainer.scrollTop=0},changePageSize:e=>{L.p=e,s.$refs.scrollContainer.scrollTop=0},utc2beijing:e=>{if(null==e)return"格式错误";let t=e.indexOf("T"),s=e.indexOf("Z"),a=e.substr(0,t)+" "+e.substr(t+1,s-t-1);let r=new Date(Date.parse(a)).getTime();return r/=1e3,r+=28800,l(r)},conDetailEvent:async e=>{await n(e.id),o.value.list.length>0||await b(),o.value.list.find((t=>{t.id===e.id&&h(t)}))},clearData:()=>{o.value.usedList=[],L.cpu.percentage=0,L.memory.percentage=0,L.memory.userd=0,L.memory.all=0,L.errmsg=""},init:R,destroy:T,checkSystemOverview:U,CreateRealMonitorDialog:_,getByteUnit:i}}}),(function(){var e=this,a=e._self._c,r=e._self._setupProxy;return a("div",{staticClass:"w-full",style:"min-height:".concat(r.mainHeight-140,"px;")},[a("div",{staticClass:"flex flex-wrap"},[a("div",{staticClass:"manger-con"},[a("div",[a("div",{staticClass:"pb-[1rem] text-[2rem] flex justify-between items-center"},[e._v(" 运行容器 "),a("div",[a(o,{attrs:{type:"default"},on:{click:r.rsyncData}},[e._v("刷新容器列表")]),a(o,{attrs:{type:"default"},on:{click:function(e){return r.hideSystemOverview(!r.hideOverview)}}},[e._v(e._s(r.hideOverview?"展开CPU、内存总览":"隐藏CPU、内存总览"))])],1)]),a("div",{ref:"useMenuRef",staticClass:"use-menu",class:r.hideOverview?"":"pb-[1.6rem]"},[a("div",{staticClass:"use-box"},[a("div",{staticClass:"flex-col flex justify-center flex-1 h-full"},[a("div",{staticClass:"font-bold text-[1.4rem] mb-[1rem]"},[e._v(" CPU使用率 "),a("span",{directives:[{name:"show",rawName:"v-show",value:r.use.cpu.load,expression:"use.cpu.load"}],staticClass:"text-[1.2rem] text-[#ccc]"},[e._v("正在计算中"),a("span",{staticClass:"el-icon-loading"})])]),a("div",{staticClass:"text-[1.2rem] mb-[1rem]"},[a("span",{staticClass:"text-[1.6rem] font-bold"},[e._v(e._s(r.use.cpu.percentage))]),e._v("% ")]),a(t,{attrs:{percentage:r.use.cpu.percentage,color:r.cpuColors}})],1)]),a("div",{staticClass:"use-box"},[a("div",{staticClass:"flex-col flex justify-center flex-1 h-full"},[a("div",{staticClass:"font-bold text-[1.4rem] mb-[1rem]"},[e._v(" 内存使用率 "),a("span",{directives:[{name:"show",rawName:"v-show",value:r.use.memory.load,expression:"use.memory.load"}],staticClass:"text-[1.2rem] text-[#ccc]"},[e._v("正在计算中"),a("span",{staticClass:"el-icon-loading"})])]),a("div",{staticClass:"text-[1.2rem] mb-[1rem]"},[a("span",{staticClass:"text-[1.6rem] font-bold"},[e._v(e._s(r.use.memory.userd))]),e._v("MB "),a("span",{staticClass:"text-[1.6rem] font-bold"},[e._v("/"+e._s(r.use.memory.all))]),e._v("MB ")]),a(t,{attrs:{percentage:r.use.memory.percentage,color:r.memColors}})],1)])]),a("div",{directives:[{name:"bt-loading",rawName:"v-bt-loading",value:r.use.loading,expression:"use.loading"},{name:"bt-loading",rawName:"v-bt-loading:title",value:"正在加载运行中的容器列表，请稍候...",expression:"'正在加载运行中的容器列表，请稍候...'",arg:"title"}],ref:"scrollContainer",class:r.isLoadErr?"flex pt-[1.6rem] justify-center items-center":"con-grid",staticStyle:{transition:"height 0.5s"},style:"height:".concat(r.hideOverview?r.mainHeight-190:r.mainHeight-280,"px;")},[e._l(r.showList,(function(t){var s;return a("div",{key:t.id,staticClass:"w-full h-[19rem] border border-[#ccc] rounded-2x text-[1.2rem] text-[#999]"},[a("div",{staticClass:"h-[8rem] p-[1rem] relative pl-[5rem] border-b border-[#ccc] flex flex-col justify-between"},[a("span",{staticClass:"monitor el-icon-monitor",on:{click:function(e){return r.CreateRealMonitorDialog(t)}}}),a("div",{staticClass:"text-[1.4rem] leading-[1.3] w-full truncate cursor-pointer font-bold text-primary",on:{click:function(e){return r.conDetailEvent(t)}}},[a(b,{attrs:{text:t.name}})],1),a("div",{staticClass:"w-full truncate leading-[1.3]"},[a(b,{attrs:{text:t.image}})],1),a("div",[e._v("创建时间："+e._s(r.utc2beijing(t.create_time)))])]),a("div",{staticClass:"w-full h-[11rem] p-[1rem] flex items-center"},[a("div",{staticClass:"chart bg-[#f5f5f5]"},[a("div",{staticClass:"chart-use bg-[#f7b851]",style:{height:"".concat(t.cpu_usage,"%")}})]),a("div",{staticClass:"chart bg-[#f5f5f5] ml-[2rem]"},[a("div",{staticClass:"chart-use bg-[#52a9ff]",style:{height:"".concat(t.mem_percent,"%")}})]),a("div",{staticClass:"h-full w-[12rem] flex flex-col justify-end ml-[3rem] pb-[.3rem]"},[a("div",{staticClass:"flex items-center justify-between cpu-before mb-[1rem]"},[e._v(" CPU "),a("span",[e._v(e._s(t.cpu_usage)+"%")])]),a("div",{staticClass:"flex items-center justify-between ram-before"},[e._v(" RAM "),a("span",[e._v(e._s(r.getByteUnit(null==(s=t.mem_usage)?void 0:s.mem_usage)))])])])])])})),a(s,{directives:[{name:"show",rawName:"v-show",value:r.isLoadErr,expression:"isLoadErr"}],attrs:{description:r.use.errmsg}})],2)])])])])}),[],!1,null,"88988688",null,null).exports;export{y as default};
