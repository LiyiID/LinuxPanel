import{l as t,n as a,D as e,q as o}from"./main.js?v=1714377894636";import{w as r,x as s}from"./element-lib.js?v=1714377894636";import{_ as i}from"./index85.js?v=1714377894636";import{_ as n}from"./preload-helper.js?v=1714377894636";import{e as l,b as m,v as u,f as p,j as c}from"./vue-lib.js?v=1714377894636";import{g as d,ax as f,ay as h,az as _}from"./site.store.js?v=1714377894636";import"./modulepreload-polyfill.js?v=1714377894636";import"./request-lib.js?v=1714377894636";import"./__commonjsHelpers__.js?v=1714377894636";import"./locales-lib.js?v=1714377894636";import"./public-lib.js?v=1714377894636";import"./check.js?v=1714377894636";const g=a(l({__name:"HotlinkProtectionForm",props:{compData:{default:()=>{}},isConfig:{type:Boolean,default:!1},formData:{default:()=>({})}},emits:["update:formData"],setup(a,{expose:e,emit:o}){var r,s;const i=a,{getPhpModulesList:l}=d(),{proxy:g}=c(),D=m(),v=u({fix:i.formData.fix||"jpg,jpeg,gif,png,js,css",domains:(null==(s=null==(r=i.formData.domains)?void 0:r.toString())?void 0:s.replace(/,/g,"\n"))||"",return_rule:i.formData.return_rule||"404",http_status:i.formData.http_status||!1,status:i.formData.status||!1}),k=async a=>{var e,r,s;let m=g.$load("正在设置防盗链，请稍后...");try{if(await D.value.validate(),i.isConfig){if("proxy"===i.compData.project_type){const t=await f({...v,id:i.compData.id,domains:null==(e=v.domains)?void 0:e.replace(/\n/g,","),site_name:i.compData.name});return g.$message.request(t),void o("update:formData")}const t=await h({...v,id:i.compData.id,domains:null==(r=v.domains)?void 0:r.replace(/\n/g,","),name:i.compData.name});return g.$message.request(t),void o("update:formData")}const m=await _({...v,domains:null==(s=v.domains)?void 0:s.split("\n"),site_ids:JSON.stringify(i.compData.map((t=>t.id)))});let u=[];await m.data.errors.forEach((t=>{u.push({...t,name:i.compData.find((a=>a.id===t.id)).name})})),await m.data.succeed.forEach((t=>{u.push({...t,name:i.compData.find((a=>a.id===t.id)).name})})),await t({title:"批量设置结果",area:42,component:()=>n((()=>import("./index63.js?v=1714377894636")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url),compData:{resultData:u,resultTitle:"结果"}}),l(),a()}catch(u){}finally{m.close()}};return p((()=>i.formData),(()=>{var t,a;v.fix=i.formData.fix||"jpg,jpeg,gif,png,js,css",v.domains=(null==(a=null==(t=i.formData.domains)?void 0:t.toString())?void 0:a.replace(/,/g,"\n"))||"",v.return_rule=i.formData.return_rule||"404",v.http_status=i.formData.http_status||!1,v.status=i.formData.status||!1}),{immediate:!0}),e({onConfirm:k}),{__sfc:!0,emit:o,props:i,getPhpModulesList:l,vm:g,hotFormRef:D,rules:{fix:[{required:!0,message:"请输入url后缀",trigger:"blur"}],return_rule:[{required:!0,message:"请输入响应资源",trigger:"blur"}]},hotLinkProtectForm:v,handleChangeHttp:t=>{if(!v.status)return g.$message.error("请先启用防盗链!")},handleChangeStatus:t=>{v.status=t,t||(v.http_status=!1)},onConfirm:k}}}),(function(){var t=this,a=t._self._c,n=t._self._setupProxy;return a("div",{staticClass:"p-20x"},[a(r,{ref:"hotFormRef",attrs:{model:n.hotLinkProtectForm,rules:n.rules}},[a(s,{attrs:{label:"URL后缀",prop:"fix"}},[a(i,{model:{value:n.hotLinkProtectForm.fix,callback:function(a){t.$set(n.hotLinkProtectForm,"fix",a)},expression:"hotLinkProtectForm.fix"}})],1),a(s,{attrs:{label:"许可域名"}},[a(i,{attrs:{type:"textarea",resize:"none",rows:8,placeholder:"默认添加主域名，可追加其他的允许域名，一行一个，可为空"},model:{value:n.hotLinkProtectForm.domains,callback:function(a){t.$set(n.hotLinkProtectForm,"domains",a)},expression:"hotLinkProtectForm.domains"}})],1),a(s,{attrs:{label:"响应资源",prop:"return_rule"}},[a(i,{model:{value:n.hotLinkProtectForm.return_rule,callback:function(a){t.$set(n.hotLinkProtectForm,"return_rule",a)},expression:"hotLinkProtectForm.return_rule"}})],1),a(s,{attrs:{label:" "}},[a(e,{on:{change:n.handleChangeStatus},model:{value:n.hotLinkProtectForm.status,callback:function(a){t.$set(n.hotLinkProtectForm,"status",a)},expression:"hotLinkProtectForm.status"}},[t._v("启用防盗链")]),a(e,{attrs:{disabled:!n.hotLinkProtectForm.status},on:{change:n.handleChangeHttp},model:{value:n.hotLinkProtectForm.http_status,callback:function(a){t.$set(n.hotLinkProtectForm,"http_status",a)},expression:"hotLinkProtectForm.http_status"}},[t._v("允许空HTTP_REFERER请求")])],1),n.props.isConfig?a(s,{attrs:{label:" "}},[a(o,{on:{click:n.onConfirm}},[t._v("保存")])],1):t._e()],1)],1)}),[],!1,null,"b7ac9f53",null,null).exports;export{g as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./index63.js?v=1714377894636","./index39.js?v=1714377894636","./element-lib.js?v=1714377894636","./__commonjsHelpers__.js?v=1714377894636","./vue-lib.js?v=1714377894636","./public-lib.js?v=1714377894636","./main.js?v=1714377894636","./modulepreload-polyfill.js?v=1714377894636","./preload-helper.js?v=1714377894636","./request-lib.js?v=1714377894636","./locales-lib.js?v=1714377894636","./element-lib.js?v=1714377894636"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
